import{r as e,a as t,b as n,_ as i,c as r,D as o,s as a}from"./CobrowseIO.index.CIIRGibA.mjs";import"./CobrowseIO.web.queue-microtask.C2zI4dgg.mjs";var s,c={};!function(){if(s)return c;s=1;var i=e(),r=t(),o=n();i({target:"Object",stat:!0},{fromEntries:function(e){var t={};return r(e,(function(e,n){o(t,e,n)}),{AS_ENTRIES:!0}),t}})}();const l=["children"],d=["children"],u=["children"],h=["active"],p=["active","initial"],m=["visible","className","grow","dep"],f=["visible","children","className","grow","dep"],g=["variant","children","icon","className","iconClassName","truncate"],v=["className"],b=["className"],y=["visible"],k=["iconOnly","isDisconnected","children"],w=["scope","children"],C=["scope","children"],T=["asChild"],S=["disableOutsidePointerEvents","onEscapeKeyDown","onPointerDownOutside","onFocusOutside","onInteractOutside","onDismiss"],_=["loop","trapped","onMountAutoFocus","onUnmountAutoFocus"],x=["mainAxis","crossAxis","fallbackPlacements","fallbackStrategy","fallbackAxisSideDirection","flipAlignment"],E=["strategy"],P=["mainAxis","crossAxis","limiter"],R=["apply"],I=["children","width","height"],O=["__scopePopper","virtualRef"],D=["__scopePopper","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","onPlaced"],A=["__scopePopper"],M=["container"],N=["__scopeSelect","disabled"],L=["__scopeSelect","className","style","children","placeholder"],U=["__scopeSelect","children"],F=["__scopeSelect","position","onCloseAutoFocus","onEscapeKeyDown","onPointerDownOutside","side","sideOffset","align","alignOffset","arrowPadding","collisionBoundary","collisionPadding","sticky","hideWhenDetached","avoidCollisions"],j=["__scopeSelect","onPlaced"],B=["__scopeSelect","align","collisionPadding"],V=["__scopeSelect","nonce"],q=["__scopeSelect"],H=["__scopeSelect"],z=["__scopeSelect","value","disabled","textValue"],W=["__scopeSelect","className","style"],G=["__scopeSelect"],K=["__scopeSelect","onAutoScroll"],$=["__scopeSelect"],J=["__scopeSelect"],Y=["__scopeSelect","value"],X=["size","flagCode","className"],Q=["children"],Z=["className"],ee=["expanded","className"],te=["expanded","className"],ne=["visible","className"],ie=["className"],re=["className"];var oe,ae,se,ce,le,de,ue,he,pe,me,fe,ge,ve,be=Object.defineProperty,ye=(e,t,n)=>((e,t,n)=>t in e?be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n),ke={},we=[],Ce=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Te=Array.isArray;function Se(e,t){for(var n in t)e[n]=t[n];return e}function _e(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function xe(e,t,n){var i,r,o,a={};for(o in t)"key"==o?i=t[o]:"ref"==o?r=t[o]:a[o]=t[o];if(arguments.length>2&&(a.children=arguments.length>3?oe.call(arguments,2):n),"function"==typeof e&&null!=e.defaultProps)for(o in e.defaultProps)void 0===a[o]&&(a[o]=e.defaultProps[o]);return Ee(e,a,i,r,null)}function Ee(e,t,n,i,r){var o={type:e,props:t,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null!=r?r:++se,__i:-1,__u:0};return null==r&&null!=ae.vnode&&ae.vnode(o),o}function Pe(){return{current:null}}function Re(e){return e.children}function Ie(e,t){this.props=e,this.context=t}function Oe(e,t){if(null==t)return e.__?Oe(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?Oe(e):null}function De(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return De(e)}}function Ae(e){(!e.__d&&(e.__d=!0)&&le.push(e)&&!Me.__r++||de!=ae.debounceRendering)&&((de=ae.debounceRendering)||ue)(Me)}function Me(){for(var e,t,n,i,r,o,a,s=1;le.length;){var c;le.length>s&&le.sort(he),e=le.shift(),s=le.length,e.__d&&(n=void 0,r=(i=(t=e).__v).__e,o=[],a=[],t.__P&&((n=Se({},i)).__v=i.__v+1,ae.vnode&&ae.vnode(n),qe(t.__P,n,i,t.__n,t.__P.namespaceURI,32&i.__u?[r]:null,o,null!==(c=r)&&void 0!==c?c:Oe(i),!!(32&i.__u),a),n.__v=i.__v,n.__.__k[n.__i]=n,ze(o,n,a),n.__e!=r&&De(n)))}Me.__r=0}function Ne(e,t,n,i,r,o,a,s,c,l,d){var u,h,p,m,f,g,v,b=i&&i.__k||we,y=t.length;for(c=function(e,t,n,i,r){var o,a,s,c,l,d=n.length,u=d,h=0;for(e.__k=new Array(r),o=0;o<r;o++)null!=(a=t[o])&&"boolean"!=typeof a&&"function"!=typeof a?(c=o+h,(a=e.__k[o]="string"==typeof a||"number"==typeof a||"bigint"==typeof a||a.constructor==String?Ee(null,a,null,null,null):Te(a)?Ee(Re,{children:a},null,null,null):null==a.constructor&&a.__b>0?Ee(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):a).__=e,a.__b=e.__b+1,s=null,-1!=(l=a.__i=Fe(a,n,c,u))&&(u--,(s=n[l])&&(s.__u|=2)),null==s||null==s.__v?(-1==l&&(r>d?h--:r<d&&h++),"function"!=typeof a.type&&(a.__u|=4)):l!=c&&(l==c-1?h--:l==c+1?h++:(l>c?h--:h++,a.__u|=4))):e.__k[o]=null;if(u)for(o=0;o<d;o++)null!=(s=n[o])&&!(2&s.__u)&&(s.__e==i&&(i=Oe(s)),Ke(s,s));return i}(n,t,b,c,y),u=0;u<y;u++)null!=(p=n.__k[u])&&(h=-1==p.__i?ke:b[p.__i]||ke,p.__i=u,g=qe(e,p,h,r,o,a,s,c,l,d),m=p.__e,p.ref&&h.ref!=p.ref&&(h.ref&&Ge(h.ref,null,p),d.push(p.ref,p.__c||m,p)),null==f&&null!=m&&(f=m),(v=!!(4&p.__u))||h.__k===p.__k?c=Le(p,c,e,v):"function"==typeof p.type&&void 0!==g?c=g:m&&(c=m.nextSibling),p.__u&=-7);return n.__e=f,c}function Le(e,t,n,i){var r,o;if("function"==typeof e.type){for(r=e.__k,o=0;r&&o<r.length;o++)r[o]&&(r[o].__=e,t=Le(r[o],t,n,i));return t}e.__e!=t&&(i&&(t&&e.type&&!t.parentNode&&(t=Oe(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do{t=t&&t.nextSibling}while(null!=t&&8==t.nodeType);return t}function Ue(e,t){return t=t||[],null==e||"boolean"==typeof e||(Te(e)?e.some((function(e){Ue(e,t)})):t.push(e)),t}function Fe(e,t,n,i){var r,o,a,s=e.key,c=e.type,l=t[n],d=null!=l&&!(2&l.__u);if(null===l&&null==e.key||d&&s==l.key&&c==l.type)return n;if(i>(d?1:0))for(r=n-1,o=n+1;r>=0||o<t.length;)if(null!=(l=t[a=r>=0?r--:o++])&&!(2&l.__u)&&s==l.key&&c==l.type)return a;return-1}function je(e,t,n){"-"==t[0]?e.setProperty(t,null!=n?n:""):e[t]=null==n?"":"number"!=typeof n||Ce.test(t)?n:n+"px"}function Be(e,t,n,i,r){var o,a;e:if("style"==t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof i&&(e.style.cssText=i=""),i)for(t in i)n&&t in n||je(e.style,t,"");if(n)for(t in n)i&&n[t]==i[t]||je(e.style,t,n[t])}else if("o"==t[0]&&"n"==t[1])o=t!=(t=t.replace(pe,"$1")),a=t.toLowerCase(),t=a in e||"onFocusOut"==t||"onFocusIn"==t?a.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=n,n?i?n.u=i.u:(n.u=me,e.addEventListener(t,o?ge:fe,o)):e.removeEventListener(t,o?ge:fe,o);else{if("http://www.w3.org/2000/svg"==r)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=t&&"height"!=t&&"href"!=t&&"list"!=t&&"form"!=t&&"tabIndex"!=t&&"download"!=t&&"rowSpan"!=t&&"colSpan"!=t&&"role"!=t&&"popover"!=t&&t in e)try{e[t]=null!=n?n:"";break e}catch(e){}"function"==typeof n||(null==n||!1===n&&"-"!=t[4]?e.removeAttribute(t):e.setAttribute(t,"popover"==t&&1==n?"":n))}}function Ve(e){return function(t){if(this.l){var n=this.l[t.type+e];if(null==t.t)t.t=me++;else if(t.t<n.u)return;return n(ae.event?ae.event(t):t)}}}function qe(e,t,n,i,r,o,a,s,c,l){var d,u,h,p,m,f,g,v,b,y,k,w,C,T,S,_,x,E=t.type;if(null!=t.constructor)return null;128&n.__u&&(c=!!(32&n.__u),o=[s=t.__e=n.__e]),(d=ae.__b)&&d(t);e:if("function"==typeof E)try{if(v=t.props,b="prototype"in E&&E.prototype.render,y=(d=E.contextType)&&i[d.__c],k=d?y?y.props.value:d.__:i,n.__c?g=(u=t.__c=n.__c).__=u.__E:(b?t.__c=u=new E(v,k):(t.__c=u=new Ie(v,k),u.constructor=E,u.render=$e),y&&y.sub(u),u.props=v,u.state||(u.state={}),u.context=k,u.__n=i,h=u.__d=!0,u.__h=[],u._sb=[]),b&&null==u.__s&&(u.__s=u.state),b&&null!=E.getDerivedStateFromProps&&(u.__s==u.state&&(u.__s=Se({},u.__s)),Se(u.__s,E.getDerivedStateFromProps(v,u.__s))),p=u.props,m=u.state,u.__v=t,h)b&&null==E.getDerivedStateFromProps&&null!=u.componentWillMount&&u.componentWillMount(),b&&null!=u.componentDidMount&&u.__h.push(u.componentDidMount);else{if(b&&null==E.getDerivedStateFromProps&&v!==p&&null!=u.componentWillReceiveProps&&u.componentWillReceiveProps(v,k),!u.__e&&null!=u.shouldComponentUpdate&&!1===u.shouldComponentUpdate(v,u.__s,k)||t.__v==n.__v){for(t.__v!=n.__v&&(u.props=v,u.state=u.__s,u.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some((function(e){e&&(e.__=t)})),w=0;w<u._sb.length;w++)u.__h.push(u._sb[w]);u._sb=[],u.__h.length&&a.push(u);break e}null!=u.componentWillUpdate&&u.componentWillUpdate(v,u.__s,k),b&&null!=u.componentDidUpdate&&u.__h.push((function(){u.componentDidUpdate(p,m,f)}))}if(u.context=k,u.props=v,u.__P=e,u.__e=!1,C=ae.__r,T=0,b){for(u.state=u.__s,u.__d=!1,C&&C(t),d=u.render(u.props,u.state,u.context),S=0;S<u._sb.length;S++)u.__h.push(u._sb[S]);u._sb=[]}else do{u.__d=!1,C&&C(t),d=u.render(u.props,u.state,u.context),u.state=u.__s}while(u.__d&&++T<25);u.state=u.__s,null!=u.getChildContext&&(i=Se(Se({},i),u.getChildContext())),b&&!h&&null!=u.getSnapshotBeforeUpdate&&(f=u.getSnapshotBeforeUpdate(p,m)),_=d,null!=d&&d.type===Re&&null==d.key&&(_=We(d.props.children)),s=Ne(e,Te(_)?_:[_],t,n,i,r,o,a,s,c,l),u.base=t.__e,t.__u&=-161,u.__h.length&&a.push(u),g&&(u.__E=u.__=null)}catch(e){if(t.__v=null,c||null!=o)if(e.then){for(t.__u|=c?160:128;s&&8==s.nodeType&&s.nextSibling;)s=s.nextSibling;o[o.indexOf(s)]=null,t.__e=s}else{for(x=o.length;x--;)_e(o[x]);He(t)}else t.__e=n.__e,t.__k=n.__k,e.then||He(t);ae.__e(e,t,n)}else null==o&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):s=t.__e=function(e,t,n,i,r,o,a,s,c){var l,d,u,h,p,m,f,g=n.props,v=t.props,b=t.type;if("svg"==b?r="http://www.w3.org/2000/svg":"math"==b?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),null!=o)for(l=0;l<o.length;l++)if((p=o[l])&&"setAttribute"in p==!!b&&(b?p.localName==b:3==p.nodeType)){e=p,o[l]=null;break}if(null==e){if(null==b)return document.createTextNode(v);e=document.createElementNS(r,b,v.is&&v),s&&(ae.__m&&ae.__m(t,o),s=!1),o=null}if(null==b)g===v||s&&e.data==v||(e.data=v);else{if(o=o&&oe.call(e.childNodes),g=n.props||ke,!s&&null!=o)for(g={},l=0;l<e.attributes.length;l++)g[(p=e.attributes[l]).name]=p.value;for(l in g)if(p=g[l],"children"!=l)if("dangerouslySetInnerHTML"==l)u=p;else if(!(l in v)){if("value"==l&&"defaultValue"in v||"checked"==l&&"defaultChecked"in v)continue;Be(e,l,null,p,r)}for(l in v)p=v[l],"children"==l?h=p:"dangerouslySetInnerHTML"==l?d=p:"value"==l?m=p:"checked"==l?f=p:s&&"function"!=typeof p||g[l]===p||Be(e,l,p,g[l],r);if(d)s||u&&(d.__html==u.__html||d.__html==e.innerHTML)||(e.innerHTML=d.__html),t.__k=[];else if(u&&(e.innerHTML=""),Ne("template"==t.type?e.content:e,Te(h)?h:[h],t,n,i,"foreignObject"==b?"http://www.w3.org/1999/xhtml":r,o,a,o?o[0]:n.__k&&Oe(n,0),s,c),null!=o)for(l=o.length;l--;)_e(o[l]);s||(l="value","progress"==b&&null==m?e.removeAttribute("value"):null!=m&&(m!==e[l]||"progress"==b&&!m||"option"==b&&m!=g[l])&&Be(e,l,m,g[l],r),l="checked",null!=f&&f!=e[l]&&Be(e,l,f,g[l],r))}return e}(n.__e,t,n,i,r,o,a,c,l);return(d=ae.diffed)&&d(t),128&t.__u?void 0:s}function He(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(He)}function ze(e,t,n){for(var i=0;i<n.length;i++)Ge(n[i],n[++i],n[++i]);ae.__c&&ae.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){ae.__e(e,t.__v)}}))}function We(e){return"object"!=typeof e||null==e||e.__b&&e.__b>0?e:Te(e)?e.map(We):Se({},e)}function Ge(e,t,n){try{if("function"==typeof e){var i="function"==typeof e.__u;i&&e.__u(),i&&null==t||(e.__u=e(t))}else e.current=t}catch(e){ae.__e(e,n)}}function Ke(e,t,n){var i,r;if(ae.unmount&&ae.unmount(e),(i=e.ref)&&(i.current&&i.current!=e.__e||Ge(i,null,t)),null!=(i=e.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(e){ae.__e(e,t)}i.base=i.__P=null}if(i=e.__k)for(r=0;r<i.length;r++)i[r]&&Ke(i[r],t,n||"function"!=typeof e.type);n||_e(e.__e),e.__c=e.__=e.__e=void 0}function $e(e,t,n){return this.constructor(e,n)}function Je(e,t,n){var i,r,o,a;t==document&&(t=document.documentElement),ae.__&&ae.__(e,t),r=(i="function"==typeof n)?null:n&&n.__k||t.__k,o=[],a=[],qe(t,e=(!i&&n||t).__k=xe(Re,null,[e]),r||ke,ke,t.namespaceURI,!i&&n?[n]:r?null:t.firstChild?oe.call(t.childNodes):null,o,!i&&n?n:r?r.__e:t.firstChild,i,a),ze(o,e,a)}function Ye(e,t){Je(e,t,Ye)}function Xe(e,t,n){var i,r,o,a,s=Se({},e.props);for(o in e.type&&e.type.defaultProps&&(a=e.type.defaultProps),t)"key"==o?i=t[o]:"ref"==o?r=t[o]:s[o]=void 0===t[o]&&null!=a?a[o]:t[o];return arguments.length>2&&(s.children=arguments.length>3?oe.call(arguments,2):n),Ee(e.type,s,i||e.key,r||e.ref,null)}function Qe(e){function t(e){var n,i;return this.getChildContext||(n=new Set,(i={})[t.__c]=this,this.getChildContext=function(){return i},this.componentWillUnmount=function(){n=null},this.shouldComponentUpdate=function(e){this.props.value!=e.value&&n.forEach((function(e){e.__e=!0,Ae(e)}))},this.sub=function(e){n.add(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){n&&n.delete(e),t&&t.call(e)}}),e.children}return t.__c="__cC"+ve++,t.__=e,t.Provider=t.__l=(t.Consumer=function(e,t){return e.children(t)}).contextType=t,t}function Ze(){return Ze=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ze.apply(this,arguments)}oe=we.slice,ae={__e:function(e,t,n,i){for(var r,o,a;t=t.__;)if((r=t.__c)&&!r.__)try{if((o=r.constructor)&&null!=o.getDerivedStateFromError&&(r.setState(o.getDerivedStateFromError(e)),a=r.__d),null!=r.componentDidCatch&&(r.componentDidCatch(e,i||{}),a=r.__d),a)return r.__E=r}catch(t){e=t}throw e}},se=0,ce=function(e){return null!=e&&null==e.constructor},Ie.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!=this.state?this.__s:this.__s=Se({},this.state),"function"==typeof e&&(e=e(Se({},n),this.props)),e&&Se(n,e),null!=e&&this.__v&&(t&&this._sb.push(t),Ae(this))},Ie.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Ae(this))},Ie.prototype.render=Re,le=[],ue="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,he=function(e,t){return e.__v.__b-t.__v.__b},Me.__r=0,pe=/(PointerCapture)$|Capture$/i,me=0,fe=Ve(!1),ge=Ve(!0),ve=0;var et=["context","children"];function tt(e){return this.getChildContext=function(){return e.context},Xe(e.children,function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)t.indexOf(n=o[i])>=0||(r[n]=e[n]);return r}(e,et))}function nt(){var e=new CustomEvent("_preact",{detail:{},bubbles:!0,cancelable:!0});this.dispatchEvent(e),this._vdom=xe(tt,Ze({},this._props,{context:e.detail.context}),st(this,this._vdomComponent)),(this.hasAttribute("hydrate")?Ye:Je)(this._vdom,this._root)}function it(e){return e.replace(/-(\w)/g,(function(e,t){return t?t.toUpperCase():""}))}function rt(e,t,n){if(this._vdom){var i,r={};r[e]=n=null!==(i=n)&&void 0!==i?i:void 0,r[it(e)]=n,this._vdom=Xe(this._vdom,r),Je(this._vdom,this._root)}}function ot(){Je(this._vdom=null,this._root)}function at(e,t){var n=this;return xe("slot",Ze({},e,{ref:function(e){e?(n.ref=e,n._listener||(n._listener=function(e){e.stopPropagation(),e.detail.context=t},e.addEventListener("_preact",n._listener))):n.ref.removeEventListener("_preact",n._listener)}}))}function st(e,t){if(3===e.nodeType)return e.data;if(1!==e.nodeType)return null;var n=[],i={},r=0,o=e.attributes,a=e.childNodes;for(r=o.length;r--;)"slot"!==o[r].name&&(i[o[r].name]=o[r].value,i[it(o[r].name)]=o[r].value);for(r=a.length;r--;){var s=st(a[r],null),c=a[r].slot;c?i[c]=xe(at,{name:c},s):n[r]=s}var l=t?xe(at,null,n):n;return xe(t||e.nodeName.toLowerCase(),i,l)}function ct(e){return e?"true"===e||"false"!==e&&null:null}function lt(e){if(!e)return null;try{return JSON.parse(e)}catch(e){console.error("Failed to parse JSON attribute",e)}return null}const dt=["variant","placement","override-config","avatar-image-url","avatar-orb-color-1","avatar-orb-color-2","agent-id","signed-url","terms-key","server-location","language","dynamic-variables","show-avatar-when-collapsed","override-prompt","override-first-message","override-language","override-voice-id","override-text-only","mic-muting","transcript","transcript-entries","text-input","text-contents","default-expanded","always-expanded","user-id","use-rtc","auto-resume","collect-feedback"];var ut=0;function ht(e,t,n,i,r,o){t||(t={});var a,s,c=t;if("ref"in c)for(s in c={},t)"ref"==s?a=t[s]:c[s]=t[s];var l={type:e,props:c,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--ut,__i:-1,__u:0,__source:r,__self:o};if("function"==typeof e&&(a=e.defaultProps))for(s in a)void 0===c[s]&&(c[s]=a[s]);return ae.vnode&&ae.vnode(l),l}var pt,mt,ft,gt,vt=0,bt=[],yt=ae,kt=yt.__b,wt=yt.__r,Ct=yt.diffed,Tt=yt.__c,St=yt.unmount,_t=yt.__;function xt(e,t){yt.__h&&yt.__h(mt,e,vt||t),vt=0;var n=mt.__H||(mt.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function Et(e){return vt=1,Pt(zt,e)}function Pt(e,t,n){var i=xt(pt++,2);if(i.t=e,!i.__c&&(i.__=[n?n(t):zt(void 0,t),function(e){var t=i.__N?i.__N[0]:i.__[0],n=i.t(t,e);t!==n&&(i.__N=[n,i.__[1]],i.__c.setState({}))}],i.__c=mt,!mt.__f)){var r=function(e,t,n){if(!i.__c.__H)return!0;var r=i.__c.__H.__.filter((function(e){return!!e.__c}));if(r.every((function(e){return!e.__N})))return!o||o.call(this,e,t,n);var a=i.__c.props!==e;return r.forEach((function(e){if(e.__N){var t=e.__[0];e.__=e.__N,e.__N=void 0,t!==e.__[0]&&(a=!0)}})),o&&o.call(this,e,t,n)||a};mt.__f=!0;var o=mt.shouldComponentUpdate,a=mt.componentWillUpdate;mt.componentWillUpdate=function(e,t,n){if(this.__e){var i=o;o=void 0,r(e,t,n),o=i}a&&a.call(this,e,t,n)},mt.shouldComponentUpdate=r}return i.__N||i.__}function Rt(e,t){var n=xt(pt++,3);!yt.__s&&Ht(n.__H,t)&&(n.__=e,n.u=t,mt.__H.__h.push(n))}function It(e,t){var n=xt(pt++,4);!yt.__s&&Ht(n.__H,t)&&(n.__=e,n.u=t,mt.__h.push(n))}function Ot(e){return vt=5,At((function(){return{current:e}}),[])}function Dt(e,t,n){vt=6,It((function(){if("function"==typeof e){var n=e(t());return function(){e(null),n&&"function"==typeof n&&n()}}if(e)return e.current=t(),function(){return e.current=null}}),null==n?n:n.concat(e))}function At(e,t){var n=xt(pt++,7);return Ht(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function Mt(e,t){return vt=8,At((function(){return e}),t)}function Nt(e){var t=mt.context[e.__c],n=xt(pt++,9);return n.c=e,t?(null==n.__&&(n.__=!0,t.sub(mt)),t.props.value):e.__}function Lt(e,t){yt.useDebugValue&&yt.useDebugValue(t?t(e):e)}function Ut(){var e=xt(pt++,11);if(!e.__){for(var t=mt.__v;null!==t&&!t.__m&&null!==t.__;)t=t.__;var n=t.__m||(t.__m=[0,0]);e.__="P"+n[0]+"-"+n[1]++}return e.__}function Ft(){for(var e;e=bt.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(Vt),e.__H.__h.forEach(qt),e.__H.__h=[]}catch(t){e.__H.__h=[],yt.__e(t,e.__v)}}yt.__b=function(e){mt=null,kt&&kt(e)},yt.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),_t&&_t(e,t)},yt.__r=function(e){wt&&wt(e),pt=0;var t=(mt=e.__c).__H;t&&(ft===mt?(t.__h=[],mt.__h=[],t.__.forEach((function(e){e.__N&&(e.__=e.__N),e.u=e.__N=void 0}))):(t.__h.forEach(Vt),t.__h.forEach(qt),t.__h=[],pt=0)),ft=mt},yt.diffed=function(e){Ct&&Ct(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(1!==bt.push(t)&&gt===yt.requestAnimationFrame||((gt=yt.requestAnimationFrame)||Bt)(Ft)),t.__H.__.forEach((function(e){e.u&&(e.__H=e.u),e.u=void 0}))),ft=mt=null},yt.__c=function(e,t){t.some((function(e){try{e.__h.forEach(Vt),e.__h=e.__h.filter((function(e){return!e.__||qt(e)}))}catch(n){t.some((function(e){e.__h&&(e.__h=[])})),t=[],yt.__e(n,e.__v)}})),Tt&&Tt(e,t)},yt.unmount=function(e){St&&St(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach((function(e){try{Vt(e)}catch(e){t=e}})),n.__H=void 0,t&&yt.__e(t,n.__v))};var jt="function"==typeof requestAnimationFrame;function Bt(e){var t,n=function(){clearTimeout(i),jt&&cancelAnimationFrame(t),setTimeout(e)},i=setTimeout(n,35);jt&&(t=requestAnimationFrame(n))}function Vt(e){var t=mt,n=e.__c;"function"==typeof n&&(e.__c=void 0,n()),mt=t}function qt(e){var t=mt;e.__c=e.__(),mt=t}function Ht(e,t){return!e||e.length!==t.length||t.some((function(t,n){return t!==e[n]}))}function zt(e,t){return"function"==typeof t?t(e):t}function Wt(e,t){for(var n in t)e[n]=t[n];return e}function Gt(e,t){for(var n in e)if("__source"!==n&&!(n in t))return!0;for(var i in t)if("__source"!==i&&e[i]!==t[i])return!0;return!1}function Kt(e,t){var n=t(),i=Et({t:{__:n,u:t}}),r=i[0].t,o=i[1];return It((function(){r.__=n,r.u=t,$t(r)&&o({t:r})}),[e,n,t]),Rt((function(){return $t(r)&&o({t:r}),e((function(){$t(r)&&o({t:r})}))}),[e]),n}function $t(e){var t,n,i=e.u,r=e.__;try{var o=i();return!((t=r)===(n=o)&&(0!==t||1/t==1/n)||t!=t&&n!=n)}catch(e){return!0}}function Jt(e){e()}function Yt(e){return e}function Xt(){return[!1,Jt]}var Qt=It;function Zt(e,t){this.props=e,this.context=t}function en(e,t){function n(e){var n=this.props.ref,i=n==e.ref;return!i&&n&&(n.call?n(null):n.current=null),t?!t(this.props,e)||!i:Gt(this.props,e)}function i(t){return this.shouldComponentUpdate=n,xe(e,t)}return i.displayName="Memo("+(e.displayName||e.name)+")",i.prototype.isReactComponent=!0,i.__f=!0,i.type=e,i}(Zt.prototype=new Ie).isPureReactComponent=!0,Zt.prototype.shouldComponentUpdate=function(e,t){return Gt(this.props,e)||Gt(this.state,t)};var tn=ae.__b;ae.__b=function(e){e.type&&e.type.__f&&e.ref&&(e.props.ref=e.ref,e.ref=null),tn&&tn(e)};var nn=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function rn(e){function t(t){var n=Wt({},t);return delete n.ref,e(n,t.ref||null)}return t.$$typeof=nn,t.render=e,t.prototype.isReactComponent=t.__f=!0,t.displayName="ForwardRef("+(e.displayName||e.name)+")",t}var on=function(e,t){return null==e?null:Ue(Ue(e).map(t))},an={map:on,forEach:on,count:function(e){return e?Ue(e).length:0},only:function(e){var t=Ue(e);if(1!==t.length)throw"Children.only";return t[0]},toArray:Ue},sn=ae.__e;ae.__e=function(e,t,n,i){if(e.then)for(var r,o=t;o=o.__;)if((r=o.__c)&&r.__c)return null==t.__e&&(t.__e=n.__e,t.__k=n.__k),r.__c(e,t);sn(e,t,n,i)};var cn=ae.unmount;function ln(e,t,n){return e&&(e.__c&&e.__c.__H&&(e.__c.__H.__.forEach((function(e){"function"==typeof e.__c&&e.__c()})),e.__c.__H=null),null!=(e=Wt({},e)).__c&&(e.__c.__P===n&&(e.__c.__P=t),e.__c.__e=!0,e.__c=null),e.__k=e.__k&&e.__k.map((function(e){return ln(e,t,n)}))),e}function dn(e,t,n){return e&&n&&(e.__v=null,e.__k=e.__k&&e.__k.map((function(e){return dn(e,t,n)})),e.__c&&e.__c.__P===t&&(e.__e&&n.appendChild(e.__e),e.__c.__e=!0,e.__c.__P=n)),e}function un(){this.__u=0,this.o=null,this.__b=null}function hn(e){var t=e.__.__c;return t&&t.__a&&t.__a(e)}function pn(e){var t,n,i;function r(r){if(t||(t=e()).then((function(e){n=e.default||e}),(function(e){i=e})),i)throw i;if(!n)throw t;return xe(n,r)}return r.displayName="Lazy",r.__f=!0,r}function mn(){this.i=null,this.l=null}ae.unmount=function(e){var t=e.__c;t&&t.__R&&t.__R(),t&&32&e.__u&&(e.type=null),cn&&cn(e)},(un.prototype=new Ie).__c=function(e,t){var n=t.__c,i=this;null==i.o&&(i.o=[]),i.o.push(n);var r=hn(i.__v),o=!1,a=function(){o||(o=!0,n.__R=null,r?r(s):s())};n.__R=a;var s=function(){if(! --i.__u){if(i.state.__a){var e=i.state.__a;i.__v.__k[0]=dn(e,e.__c.__P,e.__c.__O)}var t;for(i.setState({__a:i.__b=null});t=i.o.pop();)t.forceUpdate()}};i.__u++||32&t.__u||i.setState({__a:i.__b=i.__v.__k[0]}),e.then(a,a)},un.prototype.componentWillUnmount=function(){this.o=[]},un.prototype.render=function(e,t){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),i=this.__v.__k[0].__c;this.__v.__k[0]=ln(this.__b,n,i.__O=i.__P)}this.__b=null}var r=t.__a&&xe(Re,null,e.fallback);return r&&(r.__u&=-33),[xe(Re,null,t.__a?null:e.children),r]};var fn=function(e,t,n){if(++n[1]===n[0]&&e.l.delete(t),e.props.revealOrder&&("t"!==e.props.revealOrder[0]||!e.l.size))for(n=e.i;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;e.i=n=n[2]}};function gn(e){return this.getChildContext=function(){return e.context},e.children}function vn(e){var t=this,n=e.h;if(t.componentWillUnmount=function(){Je(null,t.v),t.v=null,t.h=null},t.h&&t.h!==n&&t.componentWillUnmount(),!t.v){for(var i=t.__v;null!==i&&!i.__m&&null!==i.__;)i=i.__;t.h=n,t.v={nodeType:1,parentNode:n,childNodes:[],__k:{__m:i.__m},contains:function(){return!0},insertBefore:function(e,n){this.childNodes.push(e),t.h.insertBefore(e,n)},removeChild:function(e){this.childNodes.splice(this.childNodes.indexOf(e)>>>1,1),t.h.removeChild(e)}}}Je(xe(gn,{context:t.context},e.__v),t.v)}function bn(e,t){var n=xe(vn,{__v:e,h:t});return n.containerInfo=t,n}(mn.prototype=new Ie).__a=function(e){var t=this,n=hn(t.__v),i=t.l.get(e);return i[0]++,function(r){var o=function(){t.props.revealOrder?(i.push(r),fn(t,e,i)):r()};n?n(o):o()}},mn.prototype.render=function(e){this.i=null,this.l=new Map;var t=Ue(e.children);e.revealOrder&&"b"===e.revealOrder[0]&&t.reverse();for(var n=t.length;n--;)this.l.set(t[n],this.i=[1,0,this.i]);return e.children},mn.prototype.componentDidUpdate=mn.prototype.componentDidMount=function(){var e=this;this.l.forEach((function(t,n){fn(e,n,t)}))};var yn=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,kn=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,wn=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Cn=/[A-Z0-9]/g,Tn=typeof document<"u",Sn=function(e){return(typeof Symbol<"u"&&"symbol"==typeof Symbol()?/fil|che|rad/:/fil|che|ra/).test(e)};function _n(e,t,n){return null==t.__k&&(t.textContent=""),Je(e,t),"function"==typeof n&&n(),e?e.__c:null}function xn(e,t,n){return Ye(e,t),"function"==typeof n&&n(),e?e.__c:null}Ie.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach((function(e){Object.defineProperty(Ie.prototype,e,{configurable:!0,get:function(){return this["UNSAFE_"+e]},set:function(t){Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t})}})}));var En=ae.event;function Pn(){}function Rn(){return this.cancelBubble}function In(){return this.defaultPrevented}ae.event=function(e){return En&&(e=En(e)),e.persist=Pn,e.isPropagationStopped=Rn,e.isDefaultPrevented=In,e.nativeEvent=e};var On,Dn={enumerable:!1,configurable:!0,get:function(){return this.class}},An=ae.vnode;ae.vnode=function(e){"string"==typeof e.type&&function(e){var t=e.props,n=e.type,i={},r=-1===n.indexOf("-");for(var o in t){var a=t[o];if(!("value"===o&&"defaultValue"in t&&null==a||Tn&&"children"===o&&"noscript"===n||"class"===o||"className"===o)){var s=o.toLowerCase();"defaultValue"===o&&"value"in t&&null==t.value?o="value":"download"===o&&!0===a?a="":"translate"===s&&"no"===a?a=!1:"o"===s[0]&&"n"===s[1]?"ondoubleclick"===s?o="ondblclick":"onchange"!==s||"input"!==n&&"textarea"!==n||Sn(t.type)?"onfocus"===s?o="onfocusin":"onblur"===s?o="onfocusout":wn.test(o)&&(o=s):s=o="oninput":r&&kn.test(o)?o=o.replace(Cn,"-$&").toLowerCase():null===a&&(a=void 0),"oninput"===s&&i[o=s]&&(o="oninputCapture"),i[o]=a}}"select"==n&&i.multiple&&Array.isArray(i.value)&&(i.value=Ue(t.children).forEach((function(e){e.props.selected=-1!=i.value.indexOf(e.props.value)}))),"select"==n&&null!=i.defaultValue&&(i.value=Ue(t.children).forEach((function(e){e.props.selected=i.multiple?-1!=i.defaultValue.indexOf(e.props.value):i.defaultValue==e.props.value}))),t.class&&!t.className?(i.class=t.class,Object.defineProperty(i,"className",Dn)):(t.className&&!t.class||t.class&&t.className)&&(i.class=i.className=t.className),e.props=i}(e),e.$$typeof=yn,An&&An(e)};var Mn=ae.__r;ae.__r=function(e){Mn&&Mn(e),On=e.__c};var Nn=ae.diffed;ae.diffed=function(e){Nn&&Nn(e);var t=e.props,n=e.__e;null!=n&&"textarea"===e.type&&"value"in t&&t.value!==n.value&&(n.value=null==t.value?"":t.value),On=null};var Ln={ReactCurrentDispatcher:{current:{readContext:function(e){return On.__n[e.__c].props.value},useCallback:Mt,useContext:Nt,useDebugValue:Lt,useDeferredValue:Yt,useEffect:Rt,useId:Ut,useImperativeHandle:Dt,useInsertionEffect:Qt,useLayoutEffect:It,useMemo:At,useReducer:Pt,useRef:Ot,useState:Et,useSyncExternalStore:Kt,useTransition:Xt}}};function Un(e){return xe.bind(null,e)}function Fn(e){return!!e&&e.$$typeof===yn}function jn(e){return Fn(e)&&e.type===Re}function Bn(e){return!!e&&!!e.displayName&&("string"==typeof e.displayName||e.displayName instanceof String)&&e.displayName.startsWith("Memo(")}function Vn(e){return Fn(e)?Xe.apply(null,arguments):e}function qn(e){return!!e.__k&&(Je(null,e),!0)}function Hn(e){return e&&(e.base||1===e.nodeType&&e)||null}var zn=function(e,t){return e(t)},Wn=function(e,t){return e(t)},Gn=Re,Kn=Fn,$n={useState:Et,useId:Ut,useReducer:Pt,useEffect:Rt,useLayoutEffect:It,useInsertionEffect:Qt,useTransition:Xt,useDeferredValue:Yt,useSyncExternalStore:Kt,startTransition:Jt,useRef:Ot,useImperativeHandle:Dt,useMemo:At,useCallback:Mt,useContext:Nt,useDebugValue:Lt,version:"18.3.1",Children:an,render:_n,hydrate:xn,unmountComponentAtNode:qn,createPortal:bn,createElement:xe,createContext:Qe,createFactory:Un,cloneElement:Vn,createRef:Pe,Fragment:Re,isValidElement:Fn,isElement:Kn,isFragment:jn,isMemo:Bn,findDOMNode:Hn,Component:Ie,PureComponent:Zt,memo:en,forwardRef:rn,flushSync:Wn,unstable_batchedUpdates:zn,StrictMode:Gn,Suspense:un,SuspenseList:mn,lazy:pn,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Ln};const Jn=Object.freeze(Object.defineProperty({__proto__:null,Children:an,Component:Ie,Fragment:Re,PureComponent:Zt,StrictMode:Gn,Suspense:un,SuspenseList:mn,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Ln,cloneElement:Vn,createContext:Qe,createElement:xe,createFactory:Un,createPortal:bn,createRef:Pe,default:$n,findDOMNode:Hn,flushSync:Wn,forwardRef:rn,hydrate:xn,isElement:Kn,isFragment:jn,isMemo:Bn,isValidElement:Fn,lazy:pn,memo:en,render:_n,startTransition:Jt,unmountComponentAtNode:qn,unstable_batchedUpdates:zn,useCallback:Mt,useContext:Nt,useDebugValue:Lt,useDeferredValue:Yt,useEffect:Rt,useErrorBoundary:function(e){var t=xt(pt++,10),n=Et();return t.__=e,mt.componentDidCatch||(mt.componentDidCatch=function(e,i){t.__&&t.__(e,i),n[1](e)}),[n[0],function(){n[1](void 0)}]},useId:Ut,useImperativeHandle:Dt,useInsertionEffect:Qt,useLayoutEffect:It,useMemo:At,useReducer:Pt,useRef:Ot,useState:Et,useSyncExternalStore:Kt,useTransition:Xt,version:"18.3.1"},Symbol.toStringTag,{value:"Module"}));var Yn=Symbol.for("preact-signals");function Xn(){if(ni>1)ni--;else{for(var e,t=!1;void 0!==ti;){var n=ti;for(ti=void 0,ii++;void 0!==n;){var i=n.o;if(n.o=void 0,n.f&=-3,!(8&n.f)&&ci(n))try{n.c()}catch(n){t||(e=n,t=!0)}n=i}}if(ii=0,ni--,t)throw e}}function Qn(e){if(ni>0)return e();ni++;try{return e()}finally{Xn()}}var Zn=void 0;function ei(e){var t=Zn;Zn=void 0;try{return e()}finally{Zn=t}}var ti=void 0,ni=0,ii=0,ri=0;function oi(e){if(void 0!==Zn){var t=e.n;if(void 0===t||t.t!==Zn)return t={i:0,S:e,p:Zn.s,n:void 0,t:Zn,e:void 0,x:void 0,r:t},void 0!==Zn.s&&(Zn.s.n=t),Zn.s=t,e.n=t,32&Zn.f&&e.S(t),t;if(-1===t.i)return t.i=0,void 0!==t.n&&(t.n.p=t.p,void 0!==t.p&&(t.p.n=t.n),t.p=Zn.s,t.n=void 0,Zn.s.n=t,Zn.s=t),t}}function ai(e,t){this.v=e,this.i=0,this.n=void 0,this.t=void 0,this.W=null==t?void 0:t.watched,this.Z=null==t?void 0:t.unwatched,this.name=null==t?void 0:t.name}function si(e,t){return new ai(e,t)}function ci(e){for(var t=e.s;void 0!==t;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function li(e){for(var t=e.s;void 0!==t;t=t.n){var n=t.S.n;if(void 0!==n&&(t.r=n),t.S.n=t,t.i=-1,void 0===t.n){e.s=t;break}}}function di(e){for(var t=e.s,n=void 0;void 0!==t;){var i=t.p;-1===t.i?(t.S.U(t),void 0!==i&&(i.n=t.n),void 0!==t.n&&(t.n.p=i)):n=t,t.S.n=t.r,void 0!==t.r&&(t.r=void 0),t=i}e.s=n}function ui(e,t){ai.call(this,void 0),this.x=e,this.s=void 0,this.g=ri-1,this.f=4,this.W=null==t?void 0:t.watched,this.Z=null==t?void 0:t.unwatched,this.name=null==t?void 0:t.name}function hi(e,t){return new ui(e,t)}function pi(e){var t=e.u;if(e.u=void 0,"function"==typeof t){ni++;var n=Zn;Zn=void 0;try{t()}catch(t){throw e.f&=-2,e.f|=8,mi(e),t}finally{Zn=n,Xn()}}}function mi(e){for(var t=e.s;void 0!==t;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,pi(e)}function fi(e){if(Zn!==this)throw new Error("Out-of-order effect");di(this),Zn=e,this.f&=-2,8&this.f&&mi(this),Xn()}function gi(e,t){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=null==t?void 0:t.name}function vi(e,t){var n=new gi(e,t);try{n.c()}catch(e){throw n.d(),e}var i=n.d.bind(n);return i[Symbol.dispose]=i,i}ai.prototype.brand=Yn,ai.prototype.h=function(){return!0},ai.prototype.S=function(e){var t=this,n=this.t;n!==e&&void 0===e.e&&(e.x=n,this.t=e,void 0!==n?n.e=e:ei((function(){var e;null==(e=t.W)||e.call(t)})))},ai.prototype.U=function(e){var t=this;if(void 0!==this.t){var n=e.e,i=e.x;void 0!==n&&(n.x=i,e.e=void 0),void 0!==i&&(i.e=n,e.x=void 0),e===this.t&&(this.t=i,void 0===i&&ei((function(){var e;null==(e=t.Z)||e.call(t)})))}},ai.prototype.subscribe=function(e){var t=this;return vi((function(){var n=t.value,i=Zn;Zn=void 0;try{e(n)}finally{Zn=i}}),{name:"sub"})},ai.prototype.valueOf=function(){return this.value},ai.prototype.toString=function(){return this.value+""},ai.prototype.toJSON=function(){return this.value},ai.prototype.peek=function(){var e=Zn;Zn=void 0;try{return this.value}finally{Zn=e}},Object.defineProperty(ai.prototype,"value",{get:function(){var e=oi(this);return void 0!==e&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){if(ii>100)throw new Error("Cycle detected");this.v=e,this.i++,ri++,ni++;try{for(var t=this.t;void 0!==t;t=t.x)t.t.N()}finally{Xn()}}}}),ui.prototype=new ai,ui.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if(32==(36&this.f)||(this.f&=-5,this.g===ri))return!0;if(this.g=ri,this.f|=1,this.i>0&&!ci(this))return this.f&=-2,!0;var e=Zn;try{li(this),Zn=this;var t=this.x();(16&this.f||this.v!==t||0===this.i)&&(this.v=t,this.f&=-17,this.i++)}catch(e){this.v=e,this.f|=16,this.i++}return Zn=e,di(this),this.f&=-2,!0},ui.prototype.S=function(e){if(void 0===this.t){this.f|=36;for(var t=this.s;void 0!==t;t=t.n)t.S.S(t)}ai.prototype.S.call(this,e)},ui.prototype.U=function(e){if(void 0!==this.t&&(ai.prototype.U.call(this,e),void 0===this.t)){this.f&=-33;for(var t=this.s;void 0!==t;t=t.n)t.S.U(t)}},ui.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;void 0!==e;e=e.x)e.t.N()}},Object.defineProperty(ui.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var e=oi(this);if(this.h(),void 0!==e&&(e.i=this.i),16&this.f)throw this.v;return this.v}}),gi.prototype.c=function(){var e=this.S();try{if(8&this.f||void 0===this.x)return;var t=this.x();"function"==typeof t&&(this.u=t)}finally{e()}},gi.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,pi(this),li(this),ni++;var e=Zn;return Zn=this,fi.bind(this,e)},gi.prototype.N=function(){2&this.f||(this.f|=2,this.o=ti,ti=this)},gi.prototype.d=function(){this.f|=8,1&this.f||mi(this)},gi.prototype.dispose=function(){this.d()};var bi,yi,ki,wi=[],Ci=[];function Ti(e,t){ae[e]=t.bind(null,ae[e]||function(){})}function Si(e){ki&&ki(),ki=e&&e.S()}function _i(e){var t=this,n=e.data,i=Ei(n);i.value=n;var r=At((function(){for(var e=t,n=t.__v;n=n.__;)if(n.__c){n.__c.__$f|=4;break}var r=hi((function(){var e=i.value.value;return 0===e?0:!0===e?"":e||""})),o=hi((function(){return!Array.isArray(r.value)&&!ce(r.value)})),a=vi((function(){if(this.N=Mi,o.value){var t=r.value;e.__v&&e.__v.__e&&3===e.__v.__e.nodeType&&(e.__v.__e.data=t)}})),s=t.__$u.d;return t.__$u.d=function(){a(),s.call(this)},[o,r]}),[]),o=r[0],a=r[1];return o.value?a.peek():a.value}function xi(e,t,n,i){var r=t in e&&void 0===e.ownerSVGElement,o=si(n);return{o:function(e,t){o.value=e,i=t},d:vi((function(){this.N=Mi;var n=o.value.value;i[t]!==n&&(i[t]=n,r?e[t]=n:n?e.setAttribute(t,n):e.removeAttribute(t))}))}}function Ei(e,t){return Et((function(){return si(e,t)}))[0]}function Pi(e,t){var n=Ot(e);return n.current=e,yi.__$f|=4,At((function(){return hi((function(){return n.current()}),t)}),[])}vi((function(){bi=this.N}))(),_i.displayName="ReactiveTextNode",Object.defineProperties(ai.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:_i},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}}),Ti("__b",(function(e,t){if("function"==typeof t.type&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),"string"==typeof t.type){var n,i=t.props;for(var r in i)if("children"!==r){var o=i[r];o instanceof ai&&(n||(t.__np=n={}),n[r]=o,i[r]=o.peek())}}e(t)})),Ti("__r",(function(e,t){if("function"==typeof t.type&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.enterComponent(t.type.displayName||t.type.name||"Unknown"),t.type!==Re){Si();var n,i=t.__c;i&&(i.__$f&=-2,void 0===(n=i.__$u)&&(i.__$u=(vi((function(){r=this})),r.c=function(){i.__$f|=1,i.setState({})},n=r))),yi=i,Si(n)}var r;e(t)})),Ti("__e",(function(e,t,n,i){typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),Si(),yi=void 0,e(t,n,i)})),Ti("diffed",(function(e,t){var n;if("function"==typeof t.type&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),Si(),yi=void 0,"string"==typeof t.type&&(n=t.__e)){var i=t.__np,r=t.props;if(i){var o=n.U;if(o)for(var a in o){var s=o[a];void 0!==s&&!(a in i)&&(s.d(),o[a]=void 0)}else o={},n.U=o;for(var c in i){var l=o[c],d=i[c];void 0===l?(l=xi(n,c,d,r),o[c]=l):l.o(d,r)}}}e(t)})),Ti("unmount",(function(e,t){if("string"==typeof t.type){var n=t.__e;if(n){var i=n.U;if(i)for(var r in n.U=void 0,i){var o=i[r];o&&o.d()}}}else{var a=t.__c;if(a){var s=a.__$u;s&&(a.__$u=void 0,s.d())}}e(t)})),Ti("__h",(function(e,t,n,i){(i<3||9===i)&&(t.__$f|=2),e(t,n,i)})),Ie.prototype.shouldComponentUpdate=function(e,t){var n=this.__$u,i=n&&void 0!==n.s;for(var r in t)return!0;if(this.__f||"boolean"==typeof this.u&&!0===this.u){var o=2&this.__$f;if(!(i||o||4&this.__$f)||1&this.__$f)return!0}else if(!(i||4&this.__$f)||3&this.__$f)return!0;for(var a in e)if("__source"!==a&&e[a]!==this.props[a])return!0;for(var s in this.props)if(!(s in e))return!0;return!1};var Ri=typeof requestAnimationFrame>"u"?setTimeout:function(e){var t=function(){clearTimeout(n),cancelAnimationFrame(i),e()},n=setTimeout(t,35),i=requestAnimationFrame(t)},Ii=function(e){queueMicrotask((function(){queueMicrotask(e)}))};function Oi(){Qn((function(){for(var e;e=wi.shift();)bi.call(e)}))}function Di(){1===wi.push(this)&&(ae.requestAnimationFrame||Ri)(Oi)}function Ai(){Qn((function(){for(var e;e=Ci.shift();)bi.call(e)}))}function Mi(){1===Ci.push(this)&&(ae.requestAnimationFrame||Ii)(Ai)}function Ni(e,t){var n=Ot(e);n.current=e,Rt((function(){return vi((function(){return this.N=Di,n.current()}),t)}),[])}const Li=["tiny","compact","full"];function Ui(e){return Li.includes(e)?e:Li[0]}const Fi=["top-left","top","top-right","bottom-left","bottom","bottom-right"];function ji(e){return Fi.includes(e)?e:"bottom-right"}const Bi={main_label:"Need help?",start_call:"Start a call",start_chat:"Start a chat",send_message:"Send",new_call:"New call",end_call:"End",mute_microphone:"Mute microphone",change_language:"Change language",collapse:"Collapse",expand:"Expand",copied:"Copied!",accept_terms:"Accept",dismiss_terms:"Cancel",listening_status:"Listening",speaking_status:"Talk to interrupt",connecting_status:"Connecting",chatting_status:"Chatting with AI Agent",input_label:"Text message input",input_placeholder:"Send a message",input_placeholder_text_only:"Send a message",input_placeholder_new_conversation:"Start a new conversation",user_ended_conversation:"You ended the conversation",agent_ended_conversation:"The agent ended the conversation",conversation_id:"ID",error_occurred:"An error occurred",copy_id:"Copy ID",initiate_feedback:"How was this conversation?",request_follow_up_feedback:"Tell us more",thanks_for_feedback:"Thank you for your feedback!",thanks_for_feedback_details:"Your feedback helps us improve our service and better support you in the future.",follow_up_feedback_placeholder:"Tell us more about your experience...",submit:"Submit",go_back:"Go back"},Vi=Object.keys(Bi),qi={base:"#ffffff",base_hover:"#f9fafb",base_active:"#f3f4f6",base_border:"#e5e7eb",base_subtle:"#6b7280",base_primary:"#000000",base_error:"#ef4444",accent:"#000000",accent_hover:"#1f2937",accent_active:"#374151",accent_border:"#4b5563",accent_subtle:"#6b7280",accent_primary:"#ffffff",overlay_padding:32,button_radius:18,input_radius:10,bubble_radius:15,sheet_radius:"calc(var(--el-button-radius) + 6px)",compact_sheet_radius:"calc(var(--el-button-radius) + 12px)",dropdown_sheet_radius:"calc(var(--el-input-radius) + 6px)"},Hi=Object.keys(qi);function zi(e){const t=Nt(e);if(null==t)throw new Error(`${e.displayName} cannot be used outside of provider`);return t}const Wi=Qe(null);function Gi({value:e,children:t}){const n=At((()=>Object.fromEntries(dt.map((t=>[t,si(e[t])])))),[]);return dt.forEach((t=>{n[t].value=e[t]})),ht(Wi.Provider,{value:n,children:t})}function Ki(e){return zi(Wi)[e]}const $i=Qe(null);function Ji({children:e}){const t=Ki("server-location"),n=At((()=>{const e=hi((()=>function(e="us"){switch(e){case"eu-residency":case"in-residency":case"us":case"global":return e;default:return console.warn(`[ConversationalAI] Invalid server-location: ${e}. Defaulting to "us"`),"us"}}(t.value))),n={us:"https://api.us.elevenlabs.io","eu-residency":"https://api.eu.residency.elevenlabs.io","in-residency":"https://api.in.residency.elevenlabs.io",global:"https://api.elevenlabs.io"},i={us:"wss://api.us.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"};return{location:e,serverUrl:hi((()=>n[e.value])),webSocketUrl:hi((()=>i[e.value]))}}),[]);return ht($i.Provider,{value:n,children:e})}function Yi(){return zi($i)}const Xi={en:{name:"English",flagCode:"us",languageCode:"en"},zh:{name:"中文",flagCode:"cn",languageCode:"zh"},es:{name:"Español",flagCode:"es",languageCode:"es"},hi:{name:"हिन्दी",flagCode:"in",languageCode:"hi"},pt:{name:"Português (Portugal)",flagCode:"pt",languageCode:"pt"},"pt-br":{name:"Português (Brasil)",flagCode:"br",languageCode:"pt-br"},fr:{name:"Français",flagCode:"fr",languageCode:"fr"},de:{name:"Deutsch",flagCode:"de",languageCode:"de"},ja:{name:"日本語",flagCode:"jp",languageCode:"ja"},ar:{name:"العربية",flagCode:"ae",languageCode:"ar"},ru:{name:"Русский",flagCode:"ru",languageCode:"ru"},ko:{name:"한국어",flagCode:"kr",languageCode:"ko"},id:{name:"Bahasa Indonesia",flagCode:"id",languageCode:"id"},it:{name:"Italiano",flagCode:"it",languageCode:"it"},nl:{name:"Nederlands",flagCode:"nl",languageCode:"nl"},tr:{name:"Türkçe",flagCode:"tr",languageCode:"tr"},pl:{name:"Polski",flagCode:"pl",languageCode:"pl"},sv:{name:"Svenska",flagCode:"se",languageCode:"sv"},ms:{name:"Bahasa Melayu",flagCode:"my",languageCode:"ms"},ro:{name:"Română",flagCode:"ro",languageCode:"ro"},uk:{name:"Українська",flagCode:"ua",languageCode:"uk"},el:{name:"Ελληνικά",flagCode:"gr",languageCode:"el"},cs:{name:"Čeština",flagCode:"cz",languageCode:"cs"},da:{name:"Dansk",flagCode:"dk",languageCode:"da"},fi:{name:"Suomi",flagCode:"fi",languageCode:"fi"},bg:{name:"Български",flagCode:"bg",languageCode:"bg"},hr:{name:"Hrvatski",flagCode:"hr",languageCode:"hr"},sk:{name:"Slovenčina",flagCode:"sk",languageCode:"sk"},ta:{name:"தமிழ்",flagCode:"in",languageCode:"ta"},hu:{name:"Magyar",flagCode:"hu",languageCode:"hu"},no:{name:"Norsk",flagCode:"no",languageCode:"no"},vi:{name:"Tiếng Việt",flagCode:"vn",languageCode:"vi"},tl:{name:"Filipino",flagCode:"ph",languageCode:"tl"}};function Qi(e){return Object.keys(Xi).includes(null!=e?e:"")}const Zi=Qe(null);function er({children:e}){var t;const n=Tp(),i=Ki("language"),r=Ki("override-language"),o=Ei(null!==(t=i.peek())&&void 0!==t?t:n.peek().language),a=Pi((()=>{var e;return(null!==(e=n.value.supported_language_overrides)&&void 0!==e?e:[]).filter(Qi)})),s=Pi((()=>a.value.map((e=>Xi[e])).sort(((e,t)=>e.name.localeCompare(t.name))))),c=At((()=>({language:hi((()=>Qi(r.value)?Xi[r.value]:Qi(o.value)&&a.value.includes(o.value)?Xi[o.value]:Xi[n.value.language])),setLanguage:e=>{o.value=e},options:s,showPicker:hi((()=>s.value.length>0))})),[]);return ht(Zi.Provider,{value:c,children:e})}function tr(){return zi(Zi)}function nr(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var ir=Object.defineProperty,rr=(e,t,n)=>((e,t,n)=>t in e?ir(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);let or=class{constructor(){rr(this,"_locking"),rr(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){let e;this._locks+=1;const t=new Promise((t=>e=()=>{this._locks-=1,t()})),n=this._locking.then((()=>e));return this._locking=this._locking.then((()=>t)),n}};function ar(e,t){if(!e)throw new Error(t)}function sr(e){if("number"!=typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw new Error("invalid int 32: "+e)}function cr(e){if("number"!=typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>4294967295||e<0)throw new Error("invalid uint 32: "+e)}function lr(e){if("number"!=typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw new Error("invalid float 32: "+e)}const dr=Symbol("@bufbuild/protobuf/enum-type");function ur(e){const t=e[dr];return ar(t,"missing enum type on enum object"),t}function hr(e,t,n,i){e[dr]=pr(t,n.map((t=>({no:t.no,name:t.name,localName:e[t.no]}))))}function pr(e,t,n){const i=Object.create(null),r=Object.create(null),o=[];for(const e of t){const t=fr(e);o.push(t),i[e.name]=t,r[e.no]=t}return{typeName:e,values:o,findName:e=>i[e],findNumber:e=>r[e]}}function mr(e,t,n){const i={};for(const e of t){const t=fr(e);i[t.localName]=t.no,i[t.no]=t.localName}return hr(i,e,t),i}function fr(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}class gr{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const n=this.getType().runtime.bin,i=n.makeReadOptions(t);return n.readMessage(this,i.readerFactory(e),e.byteLength,i),this}fromJson(e,t){const n=this.getType(),i=n.runtime.json,r=i.makeReadOptions(t);return i.readMessage(n,e,r,this),this}fromJsonString(e,t){let n;try{n=JSON.parse(e)}catch(e){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(e instanceof Error?e.message:String(e)))}return this.fromJson(n,t)}toBinary(e){const t=this.getType().runtime.bin,n=t.makeWriteOptions(e),i=n.writerFactory();return t.writeMessage(this,i,n),i.finish()}toJson(e){const t=this.getType().runtime.json,n=t.makeWriteOptions(e);return t.writeMessage(this,n)}toJsonString(e){var t;const n=this.toJson(e);return JSON.stringify(n,null,null!==(t=null==e?void 0:e.prettySpaces)&&void 0!==t?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function vr(){let e=0,t=0;for(let n=0;n<28;n+=7){let i=this.buf[this.pos++];if(e|=(127&i)<<n,!(128&i))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,!(128&n))return this.assertBounds(),[e,t];for(let n=3;n<=31;n+=7){let i=this.buf[this.pos++];if(t|=(127&i)<<n,!(128&i))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function br(e,t,n){for(let i=0;i<28;i+=7){const r=e>>>i,o=!(!(r>>>7)&&0==t),a=255&(o?128|r:r);if(n.push(a),!o)return}const i=e>>>28&15|(7&t)<<4,r=!!(t>>3);if(n.push(255&(r?128|i:i)),r){for(let e=3;e<31;e+=7){const i=t>>>e,r=!!(i>>>7),o=255&(r?128|i:i);if(n.push(o),!r)return}n.push(t>>>31&1)}}const yr=4294967296;function kr(e){const t="-"===e[0];t&&(e=e.slice(1));const n=1e6;let i=0,r=0;function o(t,o){const a=Number(e.slice(t,o));r*=n,i=i*n+a,i>=yr&&(r+=i/yr|0,i%=yr)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),t?Tr(i,r):Cr(i,r)}function wr(e,t){if(({lo:e,hi:t}=function(e,t){return{lo:e>>>0,hi:t>>>0}}(e,t)),t<=2097151)return String(yr*t+e);const n=16777215&(e>>>24|t<<8),i=t>>16&65535;let r=(16777215&e)+6777216*n+6710656*i,o=n+8147497*i,a=2*i;const s=1e7;return r>=s&&(o+=Math.floor(r/s),r%=s),o>=s&&(a+=Math.floor(o/s),o%=s),a.toString()+Sr(o)+Sr(r)}function Cr(e,t){return{lo:0|e,hi:0|t}}function Tr(e,t){return t=~t,e?e=1+~e:t+=1,Cr(e,t)}const Sr=e=>{const t=String(e);return"0000000".slice(t.length)+t};function _r(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function xr(){let e=this.buf[this.pos++],t=127&e;if(!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,!(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let t=5;128&e&&t<10;t++)e=this.buf[this.pos++];if(128&e)throw new Error("invalid varint");return this.assertBounds(),t>>>0}const Er=function(){const e=new DataView(new ArrayBuffer(8));if("function"==typeof BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64&&("object"!=typeof process||"object"!=typeof process.env||"1"!==process.env.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),i=BigInt("0"),r=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const i="bigint"==typeof e?e:BigInt(e);if(i>n||i<t)throw new Error("int64 invalid: ".concat(e));return i},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>r||t<i)throw new Error("uint64 invalid: ".concat(e));return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)),uDec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0))}}const t=e=>ar(/^-?[0-9]+$/.test(e),"int64 invalid: ".concat(e)),n=e=>ar(/^[0-9]+$/.test(e),"uint64 invalid: ".concat(e));return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),t(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),n(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),t(e),kr(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),n(e),kr(e)),dec:(e,t)=>function(e,t){let n=Cr(e,t);const i=2147483648&n.hi;i&&(n=Tr(n.lo,n.hi));const r=wr(n.lo,n.hi);return i?"-"+r:r}(e,t),uDec:(e,t)=>wr(e,t)}}();var Pr,Rr,Ir,Or;function Dr(e,t,n){if(t===n)return!0;if(e==Pr.BYTES){if(!(t instanceof Uint8Array&&n instanceof Uint8Array&&t.length===n.length))return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}switch(e){case Pr.UINT64:case Pr.FIXED64:case Pr.INT64:case Pr.SFIXED64:case Pr.SINT64:return t==n}return!1}function Ar(e,t){switch(e){case Pr.BOOL:return!1;case Pr.UINT64:case Pr.FIXED64:case Pr.INT64:case Pr.SFIXED64:case Pr.SINT64:return 0==t?Er.zero:"0";case Pr.DOUBLE:case Pr.FLOAT:return 0;case Pr.BYTES:return new Uint8Array(0);case Pr.STRING:return"";default:return 0}}function Mr(e,t){switch(e){case Pr.BOOL:return!1===t;case Pr.STRING:return""===t;case Pr.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return 0==t}}(Rr=Pr||(Pr={}))[Rr.DOUBLE=1]="DOUBLE",Rr[Rr.FLOAT=2]="FLOAT",Rr[Rr.INT64=3]="INT64",Rr[Rr.UINT64=4]="UINT64",Rr[Rr.INT32=5]="INT32",Rr[Rr.FIXED64=6]="FIXED64",Rr[Rr.FIXED32=7]="FIXED32",Rr[Rr.BOOL=8]="BOOL",Rr[Rr.STRING=9]="STRING",Rr[Rr.BYTES=12]="BYTES",Rr[Rr.UINT32=13]="UINT32",Rr[Rr.SFIXED32=15]="SFIXED32",Rr[Rr.SFIXED64=16]="SFIXED64",Rr[Rr.SINT32=17]="SINT32",Rr[Rr.SINT64=18]="SINT64",function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING"}(Ir||(Ir={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(Or||(Or={}));class Nr{constructor(e){this.stack=[],this.textEncoder=null!=e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let t=0;t<this.chunks.length;t++)e+=this.chunks[t].length;let t=new Uint8Array(e),n=0;for(let e=0;e<this.chunks.length;e++)t.set(this.chunks[e],n),n+=this.chunks[e].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(cr(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return sr(e),_r(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){lr(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){cr(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){sr(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return sr(e),_r(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=Er.enc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=Er.uEnc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=Er.enc(e);return br(t.lo,t.hi,this.buf),this}sint64(e){let t=Er.enc(e),n=t.hi>>31;return br(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){let t=Er.uEnc(e);return br(t.lo,t.hi,this.buf),this}}class Lr{constructor(e,t){this.varint64=vr,this.uint32=xr,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!=t?t:new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e,t){let n=this.pos;switch(e){case Or.Varint:for(;128&this.buf[this.pos++];);break;case Or.Bit64:this.pos+=4;case Or.Bit32:this.pos+=4;break;case Or.LengthDelimited:let n=this.uint32();this.pos+=n;break;case Or.StartGroup:for(;;){const[e,n]=this.tag();if(n===Or.EndGroup){if(void 0!==t&&e!==t)throw new Error("invalid end group tag");break}this.skip(n,e)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return Er.dec(...this.varint64())}uint64(){return Er.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,Er.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Er.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Er.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function Ur(e){const t=e.field.localName,n=Object.create(null);return n[t]=function(e){const t=e.field;if(t.repeated)return[];if(void 0!==t.default)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return Ar(t.T,t.L);case"message":const e=t.T,n=new e;return e.fieldWrapper?e.fieldWrapper.unwrapField(n):n;case"map":throw"map fields are not allowed to be extensions"}}(e),[n,()=>n[t]]}let Fr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),jr=[];for(let e=0;e<Fr.length;e++)jr[Fr[e].charCodeAt(0)]=e;jr[45]=Fr.indexOf("+"),jr[95]=Fr.indexOf("/");const Br={dec(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let n,i=new Uint8Array(t),r=0,o=0,a=0;for(let t=0;t<e.length;t++){if(n=jr[e.charCodeAt(t)],void 0===n)switch(e[t]){case"=":o=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(o){case 0:a=n,o=1;break;case 1:i[r++]=a<<2|(48&n)>>4,a=n,o=2;break;case 2:i[r++]=(15&a)<<4|(60&n)>>2,a=n,o=3;break;case 3:i[r++]=(3&a)<<6|n,o=0}}if(1==o)throw Error("invalid base64 string.");return i.subarray(0,r)},enc(e){let t,n="",i=0,r=0;for(let o=0;o<e.length;o++)switch(t=e[o],i){case 0:n+=Fr[t>>2],r=(3&t)<<4,i=1;break;case 1:n+=Fr[r|t>>4],r=(15&t)<<2,i=2;break;case 2:n+=Fr[r|t>>6],n+=Fr[63&t],i=0}return i&&(n+=Fr[r],n+="=",1==i&&(n+="=")),n}};function Vr(e,t,n){zr(t,e);const i=t.runtime.bin.makeReadOptions(n),r=function(e,t){if(!t.repeated&&("enum"==t.kind||"scalar"==t.kind)){for(let n=e.length-1;n>=0;--n)if(e[n].no==t.no)return[e[n]];return[]}return e.filter((e=>e.no===t.no))}(e.getType().runtime.bin.listUnknownFields(e),t.field),[o,a]=Ur(t);for(const e of r)t.runtime.bin.readField(o,i.readerFactory(e.data),t.field,e.wireType,i);return a()}function qr(e,t,n,i){zr(t,e);const r=t.runtime.bin.makeReadOptions(i),o=t.runtime.bin.makeWriteOptions(i);if(Hr(e,t)){const n=e.getType().runtime.bin.listUnknownFields(e).filter((e=>e.no!=t.field.no));e.getType().runtime.bin.discardUnknownFields(e);for(const t of n)e.getType().runtime.bin.onUnknownField(e,t.no,t.wireType,t.data)}const a=o.writerFactory();let s=t.field;!s.opt&&!s.repeated&&("enum"==s.kind||"scalar"==s.kind)&&(s=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(s,n,a,o);const c=r.readerFactory(a.finish());for(;c.pos<c.len;){const[t,n]=c.tag(),i=c.skip(n,t);e.getType().runtime.bin.onUnknownField(e,t,n,i)}}function Hr(e,t){const n=e.getType();return t.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(e).find((e=>e.no==t.field.no))}function zr(e,t){ar(e.extendee.typeName==t.getType().typeName,"extension ".concat(e.typeName," can only be applied to message ").concat(e.extendee.typeName))}function Wr(e,t){const n=e.localName;if(e.repeated)return t[n].length>0;if(e.oneof)return t[e.oneof.localName].case===n;switch(e.kind){case"enum":case"scalar":return e.opt||e.req?void 0!==t[n]:"enum"==e.kind?t[n]!==e.T.values[0].no:!Mr(e.T,t[n]);case"message":return void 0!==t[n];case"map":return Object.keys(t[n]).length>0}}function Gr(e,t){const n=e.localName,i=!e.opt&&!e.req;if(e.repeated)t[n]=[];else if(e.oneof)t[e.oneof.localName]={case:void 0};else switch(e.kind){case"map":t[n]={};break;case"enum":t[n]=i?e.T.values[0].no:void 0;break;case"scalar":t[n]=i?Ar(e.T,e.L):void 0;break;case"message":t[n]=void 0}}function Kr(e,t){if(null===e||"object"!=typeof e||!Object.getOwnPropertyNames(gr.prototype).every((t=>t in e&&"function"==typeof e[t])))return!1;const n=e.getType();return null!==n&&"function"==typeof n&&"typeName"in n&&"string"==typeof n.typeName&&(void 0===t||n.typeName==t.typeName)}function $r(e,t){return Kr(t)||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}Pr.DOUBLE,Pr.FLOAT,Pr.INT64,Pr.UINT64,Pr.INT32,Pr.UINT32,Pr.BOOL,Pr.STRING,Pr.BYTES;const Jr={ignoreUnknownFields:!1},Yr={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Xr(e){return e?Object.assign(Object.assign({},Jr),e):Jr}function Qr(e){return e?Object.assign(Object.assign({},Yr),e):Yr}const Zr=Symbol(),eo=Symbol();function to(e){if(null===e)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return String(e)}}function no(e,t,n,i,r){let o=n.localName;if(n.repeated){if(ar("map"!=n.kind),null===t)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(to(t)));const a=e[o];for(const e of t){if(null===e)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(to(e)));switch(n.kind){case"message":a.push(n.T.fromJson(e,i));break;case"enum":const t=oo(n.T,e,i.ignoreUnknownFields,!0);t!==eo&&a.push(t);break;case"scalar":try{a.push(ro(n.T,e,n.L,!0))}catch(t){let i="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(to(e));throw t instanceof Error&&t.message.length>0&&(i+=": ".concat(t.message)),new Error(i)}}}}else if("map"==n.kind){if(null===t)return;if("object"!=typeof t||Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(to(t)));const a=e[o];for(const[e,o]of Object.entries(t)){if(null===o)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let s;try{s=io(n.K,e)}catch(e){let i="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(to(t));throw e instanceof Error&&e.message.length>0&&(i+=": ".concat(e.message)),new Error(i)}switch(n.V.kind){case"message":a[s]=n.V.T.fromJson(o,i);break;case"enum":const e=oo(n.V.T,o,i.ignoreUnknownFields,!0);e!==eo&&(a[s]=e);break;case"scalar":try{a[s]=ro(n.V.T,o,Ir.BIGINT,!0)}catch(e){let i="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(to(t));throw e instanceof Error&&e.message.length>0&&(i+=": ".concat(e.message)),new Error(i)}}}}else switch(n.oneof&&(e=e[n.oneof.localName]={case:o},o="value"),n.kind){case"message":const a=n.T;if(null===t&&"google.protobuf.Value"!=a.typeName)return;let s=e[o];Kr(s)?s.fromJson(t,i):(e[o]=s=a.fromJson(t,i),a.fieldWrapper&&!n.oneof&&(e[o]=a.fieldWrapper.unwrapField(s)));break;case"enum":const c=oo(n.T,t,i.ignoreUnknownFields,!1);switch(c){case Zr:Gr(n,e);break;case eo:break;default:e[o]=c}break;case"scalar":try{const i=ro(n.T,t,n.L,!1);i===Zr?Gr(n,e):e[o]=i}catch(e){let i="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(to(t));throw e instanceof Error&&e.message.length>0&&(i+=": ".concat(e.message)),new Error(i)}}}function io(e,t){if(e===Pr.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1}return ro(e,t,Ir.BIGINT,!0).toString()}function ro(e,t,n,i){if(null===t)return i?Ar(e,n):Zr;switch(e){case Pr.DOUBLE:case Pr.FLOAT:if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t||"string"==typeof t&&t.trim().length!==t.length||"string"!=typeof t&&"number"!=typeof t)break;const i=Number(t);if(Number.isNaN(i)||!Number.isFinite(i))break;return e==Pr.FLOAT&&lr(i),i;case Pr.INT32:case Pr.FIXED32:case Pr.SFIXED32:case Pr.SINT32:case Pr.UINT32:let r;if("number"==typeof t?r=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(r=Number(t)),void 0===r)break;return e==Pr.UINT32||e==Pr.FIXED32?cr(r):sr(r),r;case Pr.INT64:case Pr.SFIXED64:case Pr.SINT64:if("number"!=typeof t&&"string"!=typeof t)break;const o=Er.parse(t);return n?o.toString():o;case Pr.FIXED64:case Pr.UINT64:if("number"!=typeof t&&"string"!=typeof t)break;const a=Er.uParse(t);return n?a.toString():a;case Pr.BOOL:if("boolean"!=typeof t)break;return t;case Pr.STRING:if("string"!=typeof t)break;try{encodeURIComponent(t)}catch(e){throw new Error("invalid UTF8")}return t;case Pr.BYTES:if(""===t)return new Uint8Array(0);if("string"!=typeof t)break;return Br.dec(t)}throw new Error}function oo(e,t,n,i){if(null===t)return"google.protobuf.NullValue"==e.typeName?0:i?e.values[0].no:Zr;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const i=e.findName(t);if(void 0!==i)return i.no;if(n)return eo}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(to(t)))}function ao(e){return!(!e.repeated&&"map"!=e.kind&&(e.oneof||"message"==e.kind||e.opt||e.req))}function so(e,t,n){if("map"==e.kind){ar("object"==typeof t&&null!=t);const i={},r=Object.entries(t);switch(e.V.kind){case"scalar":for(const[t,n]of r)i[t.toString()]=lo(e.V.T,n);break;case"message":for(const[e,t]of r)i[e.toString()]=t.toJson(n);break;case"enum":const t=e.V.T;for(const[e,o]of r)i[e.toString()]=co(t,o,n.enumAsInteger)}return n.emitDefaultValues||r.length>0?i:void 0}if(e.repeated){ar(Array.isArray(t));const i=[];switch(e.kind){case"scalar":for(let n=0;n<t.length;n++)i.push(lo(e.T,t[n]));break;case"enum":for(let r=0;r<t.length;r++)i.push(co(e.T,t[r],n.enumAsInteger));break;case"message":for(let e=0;e<t.length;e++)i.push(t[e].toJson(n))}return n.emitDefaultValues||i.length>0?i:void 0}switch(e.kind){case"scalar":return lo(e.T,t);case"enum":return co(e.T,t,n.enumAsInteger);case"message":return $r(e.T,t).toJson(n)}}function co(e,t,n){var i;if(ar("number"==typeof t),"google.protobuf.NullValue"==e.typeName)return null;if(n)return t;const r=e.findNumber(t);return null!==(i=null==r?void 0:r.name)&&void 0!==i?i:t}function lo(e,t){switch(e){case Pr.INT32:case Pr.SFIXED32:case Pr.SINT32:case Pr.FIXED32:case Pr.UINT32:return ar("number"==typeof t),t;case Pr.FLOAT:case Pr.DOUBLE:return ar("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case Pr.STRING:return ar("string"==typeof t),t;case Pr.BOOL:return ar("boolean"==typeof t),t;case Pr.UINT64:case Pr.FIXED64:case Pr.INT64:case Pr.SFIXED64:case Pr.SINT64:return ar("bigint"==typeof t||"string"==typeof t||"number"==typeof t),t.toString();case Pr.BYTES:return ar(t instanceof Uint8Array),Br.enc(t)}}const uo=Symbol("@bufbuild/protobuf/unknown-fields"),ho={readUnknownFields:!0,readerFactory:e=>new Lr(e)},po={writeUnknownFields:!0,writerFactory:()=>new Nr};function mo(e){return e?Object.assign(Object.assign({},ho),e):ho}function fo(e){return e?Object.assign(Object.assign({},po),e):po}function go(e,t,n,i,r){let{repeated:o,localName:a}=n;switch(n.oneof&&((e=e[n.oneof.localName]).case!=a&&delete e.value,e.case=a,a="value"),n.kind){case"scalar":case"enum":const s="enum"==n.kind?Pr.INT32:n.T;let c=yo;if("scalar"==n.kind&&n.L>0&&(c=bo),o){let n=e[a];if(i==Or.LengthDelimited&&s!=Pr.STRING&&s!=Pr.BYTES){let e=t.uint32()+t.pos;for(;t.pos<e;)n.push(c(t,s))}else n.push(c(t,s))}else e[a]=c(t,s);break;case"message":const l=n.T;o?e[a].push(vo(t,new l,r,n)):Kr(e[a])?vo(t,e[a],r,n):(e[a]=vo(t,new l,r,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(e[a]=l.fieldWrapper.unwrapField(e[a])));break;case"map":let[d,u]=function(e,t,n){const i=t.uint32(),r=t.pos+i;let o,a;for(;t.pos<r;){const[i]=t.tag();switch(i){case 1:o=yo(t,e.K);break;case 2:switch(e.V.kind){case"scalar":a=yo(t,e.V.T);break;case"enum":a=t.int32();break;case"message":a=vo(t,new e.V.T,n,void 0)}}}if(void 0===o&&(o=Ar(e.K,Ir.BIGINT)),"string"!=typeof o&&"number"!=typeof o&&(o=o.toString()),void 0===a)switch(e.V.kind){case"scalar":a=Ar(e.V.T,Ir.BIGINT);break;case"enum":a=e.V.T.values[0].no;break;case"message":a=new e.V.T}return[o,a]}(n,t,r);e[a][d]=u}}function vo(e,t,n,i){const r=t.getType().runtime.bin,o=null==i?void 0:i.delimited;return r.readMessage(t,e,o?i.no:e.uint32(),n,o),t}function bo(e,t){const n=yo(e,t);return"bigint"==typeof n?n.toString():n}function yo(e,t){switch(t){case Pr.STRING:return e.string();case Pr.BOOL:return e.bool();case Pr.DOUBLE:return e.double();case Pr.FLOAT:return e.float();case Pr.INT32:return e.int32();case Pr.INT64:return e.int64();case Pr.UINT64:return e.uint64();case Pr.FIXED64:return e.fixed64();case Pr.BYTES:return e.bytes();case Pr.FIXED32:return e.fixed32();case Pr.SFIXED32:return e.sfixed32();case Pr.SFIXED64:return e.sfixed64();case Pr.SINT64:return e.sint64();case Pr.UINT32:return e.uint32();case Pr.SINT32:return e.sint32()}}function ko(e,t,n,i){ar(void 0!==t);const r=e.repeated;switch(e.kind){case"scalar":case"enum":let o="enum"==e.kind?Pr.INT32:e.T;if(r)if(ar(Array.isArray(t)),e.packed)!function(e,t,n,i){if(!i.length)return;e.tag(n,Or.LengthDelimited).fork();let[,r]=So(t);for(let t=0;t<i.length;t++)e[r](i[t]);e.join()}(n,o,e.no,t);else for(const i of t)To(n,o,e.no,i);else To(n,o,e.no,t);break;case"message":if(r){ar(Array.isArray(t));for(const r of t)Co(n,i,e,r)}else Co(n,i,e,t);break;case"map":ar("object"==typeof t&&null!=t);for(const[r,o]of Object.entries(t))wo(n,i,e,r,o)}}function wo(e,t,n,i,r){e.tag(n.no,Or.LengthDelimited),e.fork();let o=i;switch(n.K){case Pr.INT32:case Pr.FIXED32:case Pr.UINT32:case Pr.SFIXED32:case Pr.SINT32:o=Number.parseInt(i);break;case Pr.BOOL:ar("true"==i||"false"==i),o="true"==i}switch(To(e,n.K,1,o),n.V.kind){case"scalar":To(e,n.V.T,2,r);break;case"enum":To(e,Pr.INT32,2,r);break;case"message":ar(void 0!==r),e.tag(2,Or.LengthDelimited).bytes(r.toBinary(t))}e.join()}function Co(e,t,n,i){const r=$r(n.T,i);n.delimited?e.tag(n.no,Or.StartGroup).raw(r.toBinary(t)).tag(n.no,Or.EndGroup):e.tag(n.no,Or.LengthDelimited).bytes(r.toBinary(t))}function To(e,t,n,i){ar(void 0!==i);let[r,o]=So(t);e.tag(n,r)[o](i)}function So(e){let t=Or.Varint;switch(e){case Pr.BYTES:case Pr.STRING:t=Or.LengthDelimited;break;case Pr.DOUBLE:case Pr.FIXED64:case Pr.SFIXED64:t=Or.Bit64;break;case Pr.FIXED32:case Pr.SFIXED32:case Pr.FLOAT:t=Or.Bit32}return[t,Pr[e].toLowerCase()]}function _o(e){if(void 0===e)return e;if(Kr(e))return e.clone();if(e instanceof Uint8Array){const t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function xo(e){return e instanceof Uint8Array?e:new Uint8Array(e)}class Eo{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const e={};for(const t of this.list())e[t.jsonName]=e[t.name]=t;this.jsonNames=e}return this.jsonNames[e]}find(e){if(!this.numbers){const e={};for(const t of this.list())e[t.no]=t;this.numbers=e}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort(((e,t)=>e.no-t.no))),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const n of this.list())n.oneof?n.oneof!==t&&(t=n.oneof,e.push(t)):e.push(n)}return this.members}}function Po(e,t){const n=Io(e);return t?n:No(Mo(n))}const Ro=Io;function Io(e){let t=!1;const n=[];for(let i=0;i<e.length;i++){let r=e.charAt(i);switch(r){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),t=!1;break;default:t&&(t=!1,r=r.toUpperCase()),n.push(r)}}return n.join("")}const Oo=new Set(["constructor","toString","toJSON","valueOf"]),Do=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Ao=e=>"".concat(e,"$"),Mo=e=>Do.has(e)?Ao(e):e,No=e=>Oo.has(e)?Ao(e):e;class Lo{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=function(e){return Po(e,!1)}(e)}addField(e){ar(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[e]}}const Uo={syntax:"proto3",json:{makeReadOptions:Xr,makeWriteOptions:Qr,readMessage(e,t,n,i){var r;if(null==t||Array.isArray(t)||"object"!=typeof t)throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(to(t)));i=null!==(r=i)&&void 0!==r?r:new e;const o=new Map,a=n.typeRegistry;for(const[r,s]of Object.entries(t)){const t=e.fields.findJsonName(r);if(t){if(t.oneof){if(null===s&&"scalar"==t.kind)continue;const n=o.get(t.oneof);if(void 0!==n)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(t.oneof.name,'" present: "').concat(n,'", "').concat(r,'"'));o.set(t.oneof,r)}no(i,s,t,n,e)}else{let t=!1;if(null!=a&&a.findExtension&&r.startsWith("[")&&r.endsWith("]")){const o=a.findExtension(r.substring(1,r.length-1));if(o&&o.extendee.typeName==e.typeName){t=!0;const[e,r]=Ur(o);no(e,s,o.field,n,o),qr(i,o,r(),n)}}if(!t&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(r,'" is unknown'))}}return i},writeMessage(e,t){const n=e.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!Wr(r,e)){if(r.req)throw"required field not set";if(!t.emitDefaultValues||!ao(r))continue}const n=so(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t);void 0!==n&&(i[t.useProtoFieldName?r.name:r.jsonName]=n)}const o=t.typeRegistry;if(null!=o&&o.findExtensionFor)for(const r of n.runtime.bin.listUnknownFields(e)){const a=o.findExtensionFor(n.typeName,r.no);if(a&&Hr(e,a)){const n=Vr(e,a,t),r=so(a.field,n,t);void 0!==r&&(i[a.field.jsonName]=r)}}}catch(e){const t=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),i=e instanceof Error?e.message:String(e);throw new Error(t+(i.length>0?": ".concat(i):""))}return i},readScalar:(e,t,n)=>ro(e,t,null!=n?n:Ir.BIGINT,!0),writeScalar(e,t,n){if(void 0!==t&&(n||Mr(e,t)))return lo(e,t)},debug:to},bin:{makeReadOptions:mo,makeWriteOptions:fo,listUnknownFields(e){var t;return null!==(t=e[uo])&&void 0!==t?t:[]},discardUnknownFields(e){delete e[uo]},writeUnknownFields(e,t){const n=e[uo];if(n)for(const e of n)t.tag(e.no,e.wireType).raw(e.data)},onUnknownField(e,t,n,i){const r=e;Array.isArray(r[uo])||(r[uo]=[]),r[uo].push({no:t,wireType:n,data:i})},readMessage(e,t,n,i,r){const o=e.getType(),a=r?t.len:t.pos+n;let s,c;for(;t.pos<a&&([s,c]=t.tag(),!0!==r||c!=Or.EndGroup);){const n=o.fields.find(s);if(n)go(e,t,n,c,i);else{const n=t.skip(c,s);i.readUnknownFields&&this.onUnknownField(e,s,c,n)}}if(r&&(c!=Or.EndGroup||s!==n))throw new Error("invalid end group tag")},readField:go,writeMessage(e,t,n){const i=e.getType();for(const r of i.fields.byNumber())if(Wr(r,e))ko(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t,n);else if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));return n.writeUnknownFields&&this.writeUnknownFields(e,t),t},writeField(e,t,n,i){void 0!==t&&ko(e,t,n,i)}},util:Object.assign(Object.assign({},{setEnumType:hr,initPartial(e,t){if(void 0===e)return;const n=t.getType();for(const i of n.fields.byMember()){const n=i.localName,r=t,o=e;if(null!=o[n])switch(i.kind){case"oneof":const e=o[n].case;if(void 0===e)continue;const t=i.findField(e);let a=o[n].value;t&&"message"==t.kind&&!Kr(a,t.T)?a=new t.T(a):t&&"scalar"===t.kind&&t.T===Pr.BYTES&&(a=xo(a)),r[n]={case:e,value:a};break;case"scalar":case"enum":let s=o[n];i.T===Pr.BYTES&&(s=i.repeated?s.map(xo):xo(s)),r[n]=s;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===Pr.BYTES)for(const[e,t]of Object.entries(o[n]))r[n][e]=xo(t);else Object.assign(r[n],o[n]);break;case"message":const e=i.V.T;for(const t of Object.keys(o[n])){let i=o[n][t];e.fieldWrapper||(i=new e(i)),r[n][t]=i}}break;case"message":const c=i.T;if(i.repeated)r[n]=o[n].map((e=>Kr(e,c)?e:new c(e)));else{const e=o[n];c.fieldWrapper?"google.protobuf.BytesValue"===c.typeName?r[n]=xo(e):r[n]=e:r[n]=Kr(e,c)?e:new c(e)}}}},equals:(e,t,n)=>t===n||!(!t||!n)&&e.fields.byMember().every((e=>{const i=t[e.localName],r=n[e.localName];if(e.repeated){if(i.length!==r.length)return!1;switch(e.kind){case"message":return i.every(((t,n)=>e.T.equals(t,r[n])));case"scalar":return i.every(((t,n)=>Dr(e.T,t,r[n])));case"enum":return i.every(((e,t)=>Dr(Pr.INT32,e,r[t])))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":let t=i,n=r;return e.T.fieldWrapper&&(void 0!==t&&!Kr(t)&&(t=e.T.fieldWrapper.wrapField(t)),void 0!==n&&!Kr(n)&&(n=e.T.fieldWrapper.wrapField(n))),e.T.equals(t,n);case"enum":return Dr(Pr.INT32,i,r);case"scalar":return Dr(e.T,i,r);case"oneof":if(i.case!==r.case)return!1;const o=e.findField(i.case);if(void 0===o)return!0;switch(o.kind){case"message":return o.T.equals(i.value,r.value);case"enum":return Dr(Pr.INT32,i.value,r.value);case"scalar":return Dr(o.T,i.value,r.value)}throw new Error("oneof cannot contain ".concat(o.kind));case"map":const a=Object.keys(i).concat(Object.keys(r));switch(e.V.kind){case"message":const t=e.V.T;return a.every((e=>t.equals(i[e],r[e])));case"enum":return a.every((e=>Dr(Pr.INT32,i[e],r[e])));case"scalar":const n=e.V.T;return a.every((e=>Dr(n,i[e],r[e])))}}})),clone(e){const t=e.getType(),n=new t,i=n;for(const n of t.fields.byMember()){const t=e[n.localName];let r;if(n.repeated)r=t.map(_o);else if("map"==n.kind){r=i[n.localName];for(const[e,n]of Object.entries(t))r[e]=_o(n)}else r="oneof"==n.kind?n.findField(t.case)?{case:t.case,value:_o(t.value)}:{case:void 0}:_o(t);i[n.localName]=r}for(const n of t.runtime.bin.listUnknownFields(e))t.runtime.bin.onUnknownField(i,n.no,n.wireType,n.data);return n}}),{newFieldList:e=>new Eo(e,(e=>function(e){var t,n,i,r,o,a;const s=[];let c;for(const l of"function"==typeof e?e():e){const e=l;if(e.localName=Po(l.name,void 0!==l.oneof),e.jsonName=null!==(t=l.jsonName)&&void 0!==t?t:Ro(l.name),e.repeated=null!==(n=l.repeated)&&void 0!==n&&n,"scalar"==l.kind&&(e.L=null!==(i=l.L)&&void 0!==i?i:Ir.BIGINT),e.delimited=null!==(r=l.delimited)&&void 0!==r&&r,e.req=null!==(o=l.req)&&void 0!==o&&o,e.opt=null!==(a=l.opt)&&void 0!==a&&a,void 0===l.packed&&(e.packed="enum"==l.kind||"scalar"==l.kind&&l.T!=Pr.BYTES&&l.T!=Pr.STRING),void 0!==l.oneof){const t="string"==typeof l.oneof?l.oneof:l.oneof.name;(!c||c.name!=t)&&(c=new Lo(t)),e.oneof=c,c.addField(e)}s.push(e)}return s}(e))),initFields:e=>{for(const t of e.getType().fields.byMember()){if(t.opt)continue;const n=t.localName,i=e;if(t.repeated)i[n]=[];else switch(t.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Ar(t.T,t.L)}}}}),makeMessageType(e,t,n){return function(e,t,n,i){var r;const o=null!==(r=null==i?void 0:i.localName)&&void 0!==r?r:t.substring(t.lastIndexOf(".")+1),a={[o]:function(t){e.util.initFields(this),e.util.initPartial(t,this)}}[o];return Object.setPrototypeOf(a.prototype,new gr),Object.assign(a,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary:(e,t)=>(new a).fromBinary(e,t),fromJson:(e,t)=>(new a).fromJson(e,t),fromJsonString:(e,t)=>(new a).fromJsonString(e,t),equals:(t,n)=>e.util.equals(a,t,n)}),a}(this,e,t,n)},makeEnum:mr,makeEnumType:pr,getEnumType:ur,makeExtension(e,t,n){return function(e,t,n,i){let r;return{typeName:t,extendee:n,get field(){if(!r){const n="function"==typeof i?i():i;n.name=t.split(".").pop(),n.jsonName="[".concat(t,"]"),r=e.util.newFieldList([n]).list()[0]}return r},runtime:e}}(this,e,t,n)}};class Fo extends gr{constructor(e){super(),this.seconds=Er.zero,this.nanos=0,Uo.util.initPartial(e,this)}fromJson(e,t){if("string"!=typeof e)throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(Uo.json.debug(e)));const n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=Er.parse(i/1e3),this.nanos=0,n[7]&&(this.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),this}toJson(e){const t=1e3*Number(this.seconds);if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let n="Z";if(this.nanos>0){const e=(this.nanos+1e9).toString().substring(1);n="000000"===e.substring(3)?"."+e.substring(0,3)+"Z":"000"===e.substring(6)?"."+e.substring(0,6)+"Z":"."+e+"Z"}return new Date(t).toISOString().replace(".000Z",n)}toDate(){return new Date(1e3*Number(this.seconds)+Math.ceil(this.nanos/1e6))}static now(){return Fo.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new Fo({seconds:Er.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return(new Fo).fromBinary(e,t)}static fromJson(e,t){return(new Fo).fromJson(e,t)}static fromJsonString(e,t){return(new Fo).fromJsonString(e,t)}static equals(e,t){return Uo.util.equals(Fo,e,t)}}Fo.runtime=Uo,Fo.typeName="google.protobuf.Timestamp",Fo.fields=Uo.util.newFieldList((()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]));const jo=Uo.makeMessageType("livekit.MetricsBatch",(()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Fo},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:Bo,repeated:!0},{no:5,name:"events",kind:"message",T:qo,repeated:!0}])),Bo=Uo.makeMessageType("livekit.TimeSeriesMetric",(()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:Vo,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}])),Vo=Uo.makeMessageType("livekit.MetricSample",(()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Fo},{no:3,name:"value",kind:"scalar",T:2}])),qo=Uo.makeMessageType("livekit.EventMetric",(()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Fo},{no:7,name:"normalized_end_timestamp",kind:"message",T:Fo,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}])),Ho=Uo.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),zo=Uo.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Wo=Uo.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Go=Uo.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Ko=Uo.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),$o=Uo.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Jo=Uo.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Yo=Uo.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),Xo=Uo.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Qo=Uo.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),Zo=Uo.makeMessageType("livekit.Room",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:ea,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Oa}])),ea=Uo.makeMessageType("livekit.Codec",(()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}])),ta=Uo.makeMessageType("livekit.ParticipantPermission",(()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:Uo.getEnumType(Wo),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}])),na=Uo.makeMessageType("livekit.ParticipantInfo",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:Uo.getEnumType(ia)},{no:4,name:"tracks",kind:"message",T:ca,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:ta},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:Uo.getEnumType(ra)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:Uo.getEnumType(Jo)},{no:18,name:"kind_details",kind:"enum",T:Uo.getEnumType(oa),repeated:!0}])),ia=Uo.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),ra=Uo.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),oa=Uo.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),aa=Uo.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),sa=Uo.makeMessageType("livekit.SimulcastCodecInfo",(()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:la,repeated:!0}])),ca=Uo.makeMessageType("livekit.TrackInfo",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:Uo.getEnumType(zo)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:Uo.getEnumType(Wo)},{no:10,name:"layers",kind:"message",T:la,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:sa,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:Uo.getEnumType(aa)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Oa},{no:19,name:"audio_features",kind:"enum",T:Uo.getEnumType(Qo),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:Uo.getEnumType(Ho)}])),la=Uo.makeMessageType("livekit.VideoLayer",(()=>[{no:1,name:"quality",kind:"enum",T:Uo.getEnumType(Go)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}])),da=Uo.makeMessageType("livekit.DataPacket",(()=>[{no:1,name:"kind",kind:"enum",T:Uo.getEnumType(ua)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:ma,oneof:"value"},{no:3,name:"speaker",kind:"message",T:ha,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:fa,oneof:"value"},{no:7,name:"transcription",kind:"message",T:ga,oneof:"value"},{no:8,name:"metrics",kind:"message",T:jo,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:ba,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:ya,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:ka,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:wa,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Na,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:La,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Ua,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}])),ua=Uo.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),ha=Uo.makeMessageType("livekit.ActiveSpeakerUpdate",(()=>[{no:1,name:"speakers",kind:"message",T:pa,repeated:!0}])),pa=Uo.makeMessageType("livekit.SpeakerInfo",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}])),ma=Uo.makeMessageType("livekit.UserPacket",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}])),fa=Uo.makeMessageType("livekit.SipDTMF",(()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}])),ga=Uo.makeMessageType("livekit.Transcription",(()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:va,repeated:!0}])),va=Uo.makeMessageType("livekit.TranscriptionSegment",(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}])),ba=Uo.makeMessageType("livekit.ChatMessage",(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}])),ya=Uo.makeMessageType("livekit.RpcRequest",(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}])),ka=Uo.makeMessageType("livekit.RpcAck",(()=>[{no:1,name:"request_id",kind:"scalar",T:9}])),wa=Uo.makeMessageType("livekit.RpcResponse",(()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:Ca,oneof:"value"}])),Ca=Uo.makeMessageType("livekit.RpcError",(()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}])),Ta=Uo.makeMessageType("livekit.ParticipantTracks",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}])),Sa=Uo.makeMessageType("livekit.ServerInfo",(()=>[{no:1,name:"edition",kind:"enum",T:Uo.getEnumType(_a)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}])),_a=Uo.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),xa=Uo.makeMessageType("livekit.ClientInfo",(()=>[{no:1,name:"sdk",kind:"enum",T:Uo.getEnumType(Ea)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}])),Ea=Uo.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),Pa=Uo.makeMessageType("livekit.ClientConfiguration",(()=>[{no:1,name:"video",kind:"message",T:Ra},{no:2,name:"screen",kind:"message",T:Ra},{no:3,name:"resume_connection",kind:"enum",T:Uo.getEnumType($o)},{no:4,name:"disabled_codecs",kind:"message",T:Ia},{no:5,name:"force_relay",kind:"enum",T:Uo.getEnumType($o)}])),Ra=Uo.makeMessageType("livekit.VideoConfiguration",(()=>[{no:1,name:"hardware_encoder",kind:"enum",T:Uo.getEnumType($o)}])),Ia=Uo.makeMessageType("livekit.DisabledCodecs",(()=>[{no:1,name:"codecs",kind:"message",T:ea,repeated:!0},{no:2,name:"publish",kind:"message",T:ea,repeated:!0}])),Oa=Uo.makeMessageType("livekit.TimedVersion",(()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}])),Da=Uo.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Aa=Uo.makeMessageType("livekit.DataStream.TextHeader",(()=>[{no:1,name:"operation_type",kind:"enum",T:Uo.getEnumType(Da)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}]),{localName:"DataStream_TextHeader"}),Ma=Uo.makeMessageType("livekit.DataStream.ByteHeader",(()=>[{no:1,name:"name",kind:"scalar",T:9}]),{localName:"DataStream_ByteHeader"}),Na=Uo.makeMessageType("livekit.DataStream.Header",(()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:Uo.getEnumType(aa)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Aa,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:Ma,oneof:"content_header"}]),{localName:"DataStream_Header"}),La=Uo.makeMessageType("livekit.DataStream.Chunk",(()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}]),{localName:"DataStream_Chunk"}),Ua=Uo.makeMessageType("livekit.DataStream.Trailer",(()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}]),{localName:"DataStream_Trailer"}),Fa=Uo.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),ja=Uo.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),Ba=Uo.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),Va=Uo.makeMessageType("livekit.SignalRequest",(()=>[{no:1,name:"offer",kind:"message",T:Xa,oneof:"message"},{no:2,name:"answer",kind:"message",T:Xa,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Wa,oneof:"message"},{no:4,name:"add_track",kind:"message",T:za,oneof:"message"},{no:5,name:"mute",kind:"message",T:Ga,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Za,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:es,oneof:"message"},{no:8,name:"leave",kind:"message",T:is,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:os,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:bs,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:ws,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Ss,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:as,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:_s,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:ts,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:ns,oneof:"message"}])),qa=Uo.makeMessageType("livekit.SignalResponse",(()=>[{no:1,name:"join",kind:"message",T:Ka,oneof:"message"},{no:2,name:"answer",kind:"message",T:Xa,oneof:"message"},{no:3,name:"offer",kind:"message",T:Xa,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Wa,oneof:"message"},{no:5,name:"update",kind:"message",T:Qa,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Ja,oneof:"message"},{no:8,name:"leave",kind:"message",T:is,oneof:"message"},{no:9,name:"mute",kind:"message",T:Ga,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:cs,oneof:"message"},{no:11,name:"room_update",kind:"message",T:ls,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:us,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:ps,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:gs,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:ys,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:Ya,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:$a,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:xs,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:Rs,oneof:"message"},{no:22,name:"request_response",kind:"message",T:Is,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:Ds,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:ks,oneof:"message"}])),Ha=Uo.makeMessageType("livekit.SimulcastCodec",(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}])),za=Uo.makeMessageType("livekit.AddTrackRequest",(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:Uo.getEnumType(zo)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:Uo.getEnumType(Wo)},{no:9,name:"layers",kind:"message",T:la,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Ha,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:Uo.getEnumType(aa)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:Uo.getEnumType(Ho)},{no:17,name:"audio_features",kind:"enum",T:Uo.getEnumType(Qo),repeated:!0}])),Wa=Uo.makeMessageType("livekit.TrickleRequest",(()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:Uo.getEnumType(Fa)},{no:3,name:"final",kind:"scalar",T:8}])),Ga=Uo.makeMessageType("livekit.MuteTrackRequest",(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}])),Ka=Uo.makeMessageType("livekit.JoinResponse",(()=>[{no:1,name:"room",kind:"message",T:Zo},{no:2,name:"participant",kind:"message",T:na},{no:3,name:"other_participants",kind:"message",T:na,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:ss,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Pa},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Sa},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:ea,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}])),$a=Uo.makeMessageType("livekit.ReconnectResponse",(()=>[{no:1,name:"ice_servers",kind:"message",T:ss,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Pa},{no:3,name:"server_info",kind:"message",T:Sa},{no:4,name:"last_message_seq",kind:"scalar",T:13}])),Ja=Uo.makeMessageType("livekit.TrackPublishedResponse",(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:ca}])),Ya=Uo.makeMessageType("livekit.TrackUnpublishedResponse",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9}])),Xa=Uo.makeMessageType("livekit.SessionDescription",(()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13}])),Qa=Uo.makeMessageType("livekit.ParticipantUpdate",(()=>[{no:1,name:"participants",kind:"message",T:na,repeated:!0}])),Za=Uo.makeMessageType("livekit.UpdateSubscription",(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Ta,repeated:!0}])),es=Uo.makeMessageType("livekit.UpdateTrackSettings",(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:Uo.getEnumType(Go)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}])),ts=Uo.makeMessageType("livekit.UpdateLocalAudioTrack",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:Uo.getEnumType(Qo),repeated:!0}])),ns=Uo.makeMessageType("livekit.UpdateLocalVideoTrack",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}])),is=Uo.makeMessageType("livekit.LeaveRequest",(()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:Uo.getEnumType(Jo)},{no:3,name:"action",kind:"enum",T:Uo.getEnumType(rs)},{no:4,name:"regions",kind:"message",T:Es}])),rs=Uo.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),os=Uo.makeMessageType("livekit.UpdateVideoLayers",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:la,repeated:!0}])),as=Uo.makeMessageType("livekit.UpdateParticipantMetadata",(()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}])),ss=Uo.makeMessageType("livekit.ICEServer",(()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}])),cs=Uo.makeMessageType("livekit.SpeakersChanged",(()=>[{no:1,name:"speakers",kind:"message",T:pa,repeated:!0}])),ls=Uo.makeMessageType("livekit.RoomUpdate",(()=>[{no:1,name:"room",kind:"message",T:Zo}])),ds=Uo.makeMessageType("livekit.ConnectionQualityInfo",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:Uo.getEnumType(Ko)},{no:3,name:"score",kind:"scalar",T:2}])),us=Uo.makeMessageType("livekit.ConnectionQualityUpdate",(()=>[{no:1,name:"updates",kind:"message",T:ds,repeated:!0}])),hs=Uo.makeMessageType("livekit.StreamStateInfo",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:Uo.getEnumType(ja)}])),ps=Uo.makeMessageType("livekit.StreamStateUpdate",(()=>[{no:1,name:"stream_states",kind:"message",T:hs,repeated:!0}])),ms=Uo.makeMessageType("livekit.SubscribedQuality",(()=>[{no:1,name:"quality",kind:"enum",T:Uo.getEnumType(Go)},{no:2,name:"enabled",kind:"scalar",T:8}])),fs=Uo.makeMessageType("livekit.SubscribedCodec",(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:ms,repeated:!0}])),gs=Uo.makeMessageType("livekit.SubscribedQualityUpdate",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:ms,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:fs,repeated:!0}])),vs=Uo.makeMessageType("livekit.TrackPermission",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}])),bs=Uo.makeMessageType("livekit.SubscriptionPermission",(()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:vs,repeated:!0}])),ys=Uo.makeMessageType("livekit.SubscriptionPermissionUpdate",(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}])),ks=Uo.makeMessageType("livekit.RoomMovedResponse",(()=>[{no:1,name:"room",kind:"message",T:Zo},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:na},{no:4,name:"other_participants",kind:"message",T:na,repeated:!0}])),ws=Uo.makeMessageType("livekit.SyncState",(()=>[{no:1,name:"answer",kind:"message",T:Xa},{no:2,name:"subscription",kind:"message",T:Za},{no:3,name:"publish_tracks",kind:"message",T:Ja,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Ts,repeated:!0},{no:5,name:"offer",kind:"message",T:Xa},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:Cs,repeated:!0}])),Cs=Uo.makeMessageType("livekit.DataChannelReceiveState",(()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}])),Ts=Uo.makeMessageType("livekit.DataChannelInfo",(()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:Uo.getEnumType(Fa)}])),Ss=Uo.makeMessageType("livekit.SimulateScenario",(()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:Uo.getEnumType(Ba),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}])),_s=Uo.makeMessageType("livekit.Ping",(()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}])),xs=Uo.makeMessageType("livekit.Pong",(()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}])),Es=Uo.makeMessageType("livekit.RegionSettings",(()=>[{no:1,name:"regions",kind:"message",T:Ps,repeated:!0}])),Ps=Uo.makeMessageType("livekit.RegionInfo",(()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}])),Rs=Uo.makeMessageType("livekit.SubscriptionResponse",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:Uo.getEnumType(Xo)}])),Is=Uo.makeMessageType("livekit.RequestResponse",(()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:Uo.getEnumType(Os)},{no:3,name:"message",kind:"scalar",T:9}])),Os=Uo.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),Ds=Uo.makeMessageType("livekit.TrackSubscribed",(()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]));function As(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ms,Ns,Ls,Us={exports:{}},Fs=Us.exports,js=(Ms||(Ms=1,function(e){var t,n;t=Fs,n=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],r={},o=null;function a(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var n=this.getLevel(),r=0;r<i.length;r++){var o=i[r];this[o]=r<n?e:this.methodFactory(o,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function l(e){return function(){typeof console!==t&&(c.call(this),this[e].apply(this,arguments))}}function d(i,r,o){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?a(console,i):void 0!==console.log?a(console,"log"):e)}(i)||l.apply(this,arguments)}function u(e,n){var a,s,l,u=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,i=encodeURIComponent(h),r=n.indexOf(i+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r+i.length+1))[1])}catch(e){}return void 0===u.levels[e]&&(e=void 0),e}}function m(e){var t=e;if("string"==typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=u.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=n||d,u.getLevel=function(){var e,t;return null!==(e=null!==(t=l)&&void 0!==t?t:s)&&void 0!==e?e:a},u.setLevel=function(e,n){return l=m(e),!1!==n&&function(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch(e){}}}(l),c.call(u)},u.setDefaultLevel=function(e){s=m(e),p()||u.setLevel(e,!1)},u.resetLevel=function(){l=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),c.call(u)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)},u.rebuild=function(){if(o!==u&&(a=m(o.getLevel())),c.call(u),o===u)for(var e in r)r[e].rebuild()},a=m(o?o.getLevel():"WARN");var f=p();null!=f&&(l=m(f)),c.call(u)}(o=new u).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=r[e];return t||(t=r[e]=new u(e,o.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=h),o},o.getLoggers=function(){return r},o.default=o,o},e.exports?e.exports=n():t.log=n()}(Us)),Us.exports);!function(e){e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent"}(Ns||(Ns={})),function(e){e.Default="livekit",e.Room="livekit-room",e.Participant="livekit-participant",e.Track="livekit-track",e.Publication="livekit-track-publication",e.Engine="livekit-engine",e.Signal="livekit-signal",e.PCManager="livekit-pc-manager",e.PCTransport="livekit-pc-transport",e.E2EE="lk-e2ee"}(Ls||(Ls={}));let Bs=js.getLogger("livekit");function Vs(e){const t=js.getLogger(e);return t.setDefaultLevel(Bs.getLevel()),t}Object.values(Ls).map((e=>js.getLogger(e))),Bs.setDefaultLevel(Ns.info);const qs=js.getLogger("lk-e2ee"),Hs=7e3,zs=[0,300,1200,2700,4800,Hs,Hs,Hs,Hs,Hs];function Ws(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}c((i=i.apply(e,t||[])).next())}))}function Gs(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,r){!function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)}(i,r,(t=e[n](t)).done,t.value)}))}}}var Ks,$s={exports:{}},Js=function(){if(Ks)return $s.exports;Ks=1;var e,t="object"==typeof Reflect?Reflect:null,n=t&&"function"==typeof t.apply?t.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};e=t&&"function"==typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function r(){r.init.call(this)}$s.exports=r,$s.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,o),i(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}m(e,t,o,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,r)}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function s(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var r,o,c;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),c=o[t]),void 0===c)c=o[t]=n,++e._eventsCount;else if("function"==typeof c?c=o[t]=i?[n,c]:[c,n]:i?c.unshift(n):c.push(n),(r=s(e))>0&&c.length>r&&!c.warned){c.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=c.length,function(e){console&&console.warn&&console.warn(e)}(l)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=l.bind(i);return r.listener=n,i.wrapFn=r,r}function u(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):p(r,r.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function m(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(o){i.once&&e.removeEventListener(t,r),n(o)}))}}return Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),r.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return s(this)},r.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var l=c.length,d=p(c,l);for(i=0;i<l;++i)n(d[i],this,t)}return!0},r.prototype.addListener=function(e,t){return c(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return c(this,e,t,!0)},r.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,i,r,o,s;if(a(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},r.prototype.listeners=function(e){return u(this,e,!0)},r.prototype.rawListeners=function(e){return u(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},r.prototype.listenerCount=h,r.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]},$s.exports}();let Ys=!0,Xs=!0;function Qs(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseFloat(i[n],10)}function Zs(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);const o=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,o),r.apply(this,[e,o])};const o=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function ec(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Ys=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function tc(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Xs=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function nc(){if("object"==typeof window){if(Ys)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function ic(e,t){Xs&&console.warn(e+" is deprecated, please use "+t+" instead.")}function rc(e){return"[object Object]"===Object.prototype.toString.call(e)}function oc(e){return rc(e)?Object.keys(e).reduce((function(t,n){const i=rc(e[n]),r=i?oc(e[n]):e[n],o=i&&!Object.keys(r).length;return void 0===r||o?t:Object.assign(t,{[n]:r})}),{}):e}function ac(e,t,n){!t||n.has(t.id)||(n.set(t.id,t),Object.keys(t).forEach((i=>{i.endsWith("Id")?ac(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach((t=>{ac(e,e.get(t),n)}))})))}function sc(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===i&&n.trackId===t.id&&ac(e,n,r)}))})),r}const cc=nc;function lc(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[r("min",n)]=i.ideal,t.optional.push(e),e={},e[r("max",n)]=i.ideal,t.optional.push(e)):(e[r("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach((e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const a=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:("user"===o.exact||"user"===o.ideal)&&(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let a=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!a&&n.length&&t.includes("back")&&(a=n[n.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=i(e.video),cc("chrome: "+JSON.stringify(e)),r(e)}))}e.video=i(e.video)}return cc("chrome: "+JSON.stringify(e)),r(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{i&&i(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return r(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(o(e))))))}}}function dc(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function uc(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const r=new Event("track");r.track=n.track,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)})),t.stream.getTracks().forEach((n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const r=new Event("track");r.track=n,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Zs(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function hc(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function pc(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>sc(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Zs(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>sc(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach((n=>{n.track===e&&(t?i=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?i=!0:n=t),t.track===e))),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function mc(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),r.apply(this,arguments)}}function fc(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return mc(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=i[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=s.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function gc(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}))}function vc(e,t){Zs(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var bc=Object.freeze({__proto__:null,fixNegotiationNeeded:vc,shimAddTrackRemoveTrack:fc,shimAddTrackRemoveTrackWithNative:mc,shimGetSendersWithDtmf:hc,shimGetUserMedia:lc,shimMediaStream:dc,shimOnTrack:uc,shimPeerConnection:gc,shimSenderReceiverGetStats:pc});function yc(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){ic("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function kc(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function wc(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,o]=arguments;return i.apply(this,[e||null]).then((e=>{if(t.version<53&&!r)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(r,o)}}function Cc(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Tc(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Zs(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Sc(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){ic("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function _c(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function xc(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return i})}function Ec(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function Pc(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function Rc(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var Ic=Object.freeze({__proto__:null,shimAddTransceiver:xc,shimCreateAnswer:Rc,shimCreateOffer:Pc,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:Ec,shimGetUserMedia:yc,shimOnTrack:kc,shimPeerConnection:wc,shimRTCDataChannel:_c,shimReceiverGetStats:Tc,shimRemoveStream:Sc,shimSenderGetStats:Cc});function Oc(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i&&i.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function Dc(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function Ac(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};let s=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=s,s=function(e,t,n){const i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=s,s=function(e,t,n){const i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=s}function Mc(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(Nc(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function Nc(e){return e&&void 0!==e.video?Object.assign({},e,{video:oc(e.video)}):e}function Lc(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];void 0===i.urls&&i.url?(ic("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Uc(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Fc(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){typeof e.offerToReceiveAudio<"u"&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0===e.offerToReceiveAudio&&!t&&this.addTransceiver("audio",{direction:"recvonly"}),typeof e.offerToReceiveVideo<"u"&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0===e.offerToReceiveVideo&&!n&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function jc(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Bc,Vc=Object.freeze({__proto__:null,shimAudioContext:jc,shimCallbacksAPI:Ac,shimConstraints:Nc,shimCreateOfferLegacy:Fc,shimGetUserMedia:Mc,shimLocalStreamsAPI:Oc,shimRTCIceServerUrls:Lc,shimRemoteStreamsAPI:Dc,shimTrackEventTransceiver:Uc}),qc={exports:{}},Hc=(Bc||(Bc=1,function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<i.length;e++)n=i[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substring(t+1,i),n.value=e.substring(i+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");n.profile=i[2];for(let r=3;r<i.length;r++){const o=i[r],a=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){const i=t.parseRtpMap(a),r=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(i.parameters=r.length?t.parseFmtp(r[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const r=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{r.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)}));let r=0;return n.codecs.forEach((e=>{e.maxptime>r&&(r=e.maxptime)})),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{i+=t.writeExtmap(e)})),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),s=a.length>0&&a[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));l.length>0&&l[0].length>1&&l[0][0]===s&&(c=l[0][1]),i.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),n.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&s&&n.push({ssrc:s});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=d}))),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return r.length>0?(n=r[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substring(19),10)),isNaN(r)&&(r=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:r};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,i){let r;const o=void 0!==n?n:2;return r=e||t.generateSessionId(),"v=0\r\no="+(i||"thisisadapterortc")+" "+r+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let e=0;e<i.length;e++)switch(i[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[e].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t}(qc)),qc.exports),zc=As(Hc),Wc=nr({__proto__:null,default:zc},[Hc]);function Gc(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),i=zc.parseCandidate(e.candidate);for(const e in i)e in n||Object.defineProperty(n,e,{value:i[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Zs(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function Kc(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Zs(e,"icecandidate",(e=>{if(e.candidate){const t=zc.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function $c(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=zc.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=zc.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),i=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const r=zc.matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i}(arguments[0],e);let r;r=0===n&&0===i?Number.POSITIVE_INFINITY:0===n||0===i?Math.max(n,i):Math.min(n,i);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>r}),this._sctp=o}return n.apply(this,arguments)}}function Jc(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},Zs(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function Yc(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function Xc(e,t){if(!e.RTCPeerConnection||"chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t._safariVersion>=13.1)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Qc(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;!n||0===n.length||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Zc(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;!n||0===n.length||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}var el=Object.freeze({__proto__:null,removeExtmapAllowMixed:Xc,shimAddIceCandidateNullOrEmpty:Qc,shimConnectionState:Yc,shimMaxMessageSize:$c,shimParameterlessSetLocalDescription:Zc,shimRTCIceCandidate:Gc,shimRTCIceCandidateRelayProtocol:Kc,shimSendThrowTypeError:Jc});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=nc,i=function(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.userAgentData&&n.userAgentData.brands){const e=n.userAgentData.brands.find((e=>"Chromium"===e.brand));if(e)return{browser:"chrome",version:parseInt(e.version,10)}}if(n.mozGetUserMedia)t.browser="firefox",t.version=parseInt(Qs(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(Qs(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=parseInt(Qs(n.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,t._safariVersion=Qs(n.userAgent,/Version\/(\d+(\.?\d+))/,1)}return t}(e),r={browserDetails:i,commonShim:el,extractVersion:Qs,disableLog:ec,disableWarnings:tc,sdp:Wc};switch(i.browser){case"chrome":if(!bc||!gc||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=bc,Qc(e,i),Zc(e),lc(e,i),dc(e),gc(e,i),uc(e),fc(e,i),hc(e),pc(e),vc(e,i),Gc(e),Kc(e),Yc(e),$c(e,i),Jc(e),Xc(e,i);break;case"firefox":if(!Ic||!wc||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=Ic,Qc(e,i),Zc(e),yc(e,i),wc(e,i),kc(e),Sc(e),Cc(e),Tc(e),_c(e),xc(e),Ec(e),Pc(e),Rc(e),Gc(e),Yc(e),$c(e,i),Jc(e);break;case"safari":if(!Vc||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Vc,Qc(e,i),Zc(e),Lc(e),Fc(e),Ac(e),Oc(e),Dc(e),Uc(e),Mc(e),jc(e),Gc(e),Kc(e),$c(e,i),Jc(e),Xc(e,i);break;default:n("Unsupported browser!")}}({window:typeof window>"u"?void 0:window});const tl="lk_e2ee";var nl,il,rl,ol,al,sl,cl,ll,dl,ul,hl,pl;function ml(){return typeof window.RTCRtpScriptTransform<"u"}!function(e){e.SetKey="setKey",e.RatchetRequest="ratchetRequest",e.KeyRatcheted="keyRatcheted"}(nl||(nl={})),(il||(il={})).KeyRatcheted="keyRatcheted",function(e){e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError"}(rl||(rl={})),(ol||(ol={})).Error="cryptorError",Js.EventEmitter;class fl extends Error{constructor(e,t){super(t||"an error has occured"),this.name="LiveKitError",this.code=e}}!function(e){e[e.NotAllowed=0]="NotAllowed",e[e.ServerUnreachable=1]="ServerUnreachable",e[e.InternalError=2]="InternalError",e[e.Cancelled=3]="Cancelled",e[e.LeaveRequest=4]="LeaveRequest",e[e.Timeout=5]="Timeout"}(al||(al={}));class gl extends fl{constructor(e,t,n,i){super(1,e),this.name="ConnectionError",this.status=n,this.reason=t,this.context=i,this.reasonName=al[t]}}class vl extends fl{constructor(e){super(21,null!=e?e:"device is unsupported"),this.name="DeviceUnsupportedError"}}class bl extends fl{constructor(e){super(20,null!=e?e:"track is invalid"),this.name="TrackInvalidError"}}class yl extends fl{constructor(e){super(10,null!=e?e:"unsupported server"),this.name="UnsupportedServer"}}class kl extends fl{constructor(e){super(12,null!=e?e:"unexpected connection state"),this.name="UnexpectedConnectionState"}}class wl extends fl{constructor(e){super(13,null!=e?e:"unable to negotiate"),this.name="NegotiationError"}}class Cl extends fl{constructor(e,t){super(15,e),this.name="PublishTrackError",this.status=t}}class Tl extends fl{constructor(e,t){super(15,e),this.reason=t,this.reasonName="string"==typeof t?t:Os[t]}}!function(e){e[e.AlreadyOpened=0]="AlreadyOpened",e[e.AbnormalEnd=1]="AbnormalEnd",e[e.DecodeFailed=2]="DecodeFailed",e[e.LengthExceeded=3]="LengthExceeded",e[e.Incomplete=4]="Incomplete",e[e.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered"}(sl||(sl={}));class Sl extends fl{constructor(e,t){super(16,e),this.name="DataStreamError",this.reason=t,this.reasonName=sl[t]}}function _l(e){return typeof e>"u"?e:"function"==typeof structuredClone?"object"==typeof e&&null!==e?structuredClone(Object.assign({},e)):structuredClone(e):JSON.parse(JSON.stringify(e))}!function(e){e.PermissionDenied="PermissionDenied",e.NotFound="NotFound",e.DeviceInUse="DeviceInUse",e.Other="Other"}(cl||(cl={})),function(e){e.getFailure=function(t){if(t&&"name"in t)return"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?e.NotFound:"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?e.PermissionDenied:"NotReadableError"===t.name||"TrackStartError"===t.name?e.DeviceInUse:e.Other}}(cl||(cl={})),function(e){e[e.InvalidKey=0]="InvalidKey",e[e.MissingKey=1]="MissingKey",e[e.InternalError=2]="InternalError"}(ll||(ll={})),function(e){e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting",e.Reconnected="reconnected",e.Disconnected="disconnected",e.ConnectionStateChanged="connectionStateChanged",e.Moved="moved",e.MediaDevicesChanged="mediaDevicesChanged",e.ParticipantConnected="participantConnected",e.ParticipantDisconnected="participantDisconnected",e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalAudioSilenceDetected="localAudioSilenceDetected",e.ActiveSpeakersChanged="activeSpeakersChanged",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.ParticipantAttributesChanged="participantAttributesChanged",e.ParticipantActive="participantActive",e.RoomMetadataChanged="roomMetadataChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.AudioPlaybackStatusChanged="audioPlaybackChanged",e.VideoPlaybackStatusChanged="videoPlaybackChanged",e.MediaDevicesError="mediaDevicesError",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.SignalConnected="signalConnected",e.RecordingStatusChanged="recordingStatusChanged",e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ActiveDeviceChanged="activeDeviceChanged",e.ChatMessage="chatMessage",e.LocalTrackSubscribed="localTrackSubscribed",e.MetricsReceived="metricsReceived"}(dl||(dl={})),function(e){e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackCpuConstrained="localTrackCpuConstrained",e.LocalSenderCreated="localSenderCreated",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.IsSpeakingChanged="isSpeakingChanged",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.TrackCpuConstrained="trackCpuConstrained",e.MediaDevicesError="mediaDevicesError",e.AudioStreamAcquired="audioStreamAcquired",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.PCTrackAdded="pcTrackAdded",e.AttributesChanged="attributesChanged",e.LocalTrackSubscribed="localTrackSubscribed",e.ChatMessage="chatMessage",e.Active="active"}(ul||(ul={})),function(e){e.TransportsCreated="transportsCreated",e.Connected="connected",e.Disconnected="disconnected",e.Resuming="resuming",e.Resumed="resumed",e.Restarting="restarting",e.Restarted="restarted",e.SignalResumed="signalResumed",e.SignalRestarted="signalRestarted",e.Closing="closing",e.MediaTrackAdded="mediaTrackAdded",e.ActiveSpeakersUpdate="activeSpeakersUpdate",e.DataPacketReceived="dataPacketReceived",e.RTPVideoMapUpdate="rtpVideoMapUpdate",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ParticipantUpdate="participantUpdate",e.RoomUpdate="roomUpdate",e.SpeakersChanged="speakersChanged",e.StreamStateChanged="streamStateChanged",e.ConnectionQualityUpdate="connectionQualityUpdate",e.SubscriptionError="subscriptionError",e.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",e.RemoteMute="remoteMute",e.SubscribedQualityUpdate="subscribedQualityUpdate",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackSubscribed="localTrackSubscribed",e.Offline="offline",e.SignalRequestResponse="signalRequestResponse",e.SignalConnected="signalConnected",e.RoomMoved="roomMoved"}(hl||(hl={})),function(e){e.Message="message",e.Muted="muted",e.Unmuted="unmuted",e.Restarted="restarted",e.Ended="ended",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed",e.CpuConstrained="cpuConstrained",e.UpdateSettings="updateSettings",e.UpdateSubscription="updateSubscription",e.AudioPlaybackStarted="audioPlaybackStarted",e.AudioPlaybackFailed="audioPlaybackFailed",e.AudioSilenceDetected="audioSilenceDetected",e.VisibilityChanged="visibilityChanged",e.VideoDimensionsChanged="videoDimensionsChanged",e.VideoPlaybackStarted="videoPlaybackStarted",e.VideoPlaybackFailed="videoPlaybackFailed",e.ElementAttached="elementAttached",e.ElementDetached="elementDetached",e.UpstreamPaused="upstreamPaused",e.UpstreamResumed="upstreamResumed",e.SubscriptionPermissionChanged="subscriptionPermissionChanged",e.SubscriptionStatusChanged="subscriptionStatusChanged",e.SubscriptionFailed="subscriptionFailed",e.TrackProcessorUpdate="trackProcessorUpdate",e.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",e.TranscriptionReceived="transcriptionReceived",e.TimeSyncUpdate="timeSyncUpdate",e.PreConnectBufferFlushed="preConnectBufferFlushed"}(pl||(pl={}));const xl=/version\/(\d+(\.?_?\d+)+)/i;let El;function Pl(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(void 0===El||t){const e=Rl.find((e=>{let{test:t}=e;return t.test(n)}));El=null==e?void 0:e.describe(n)}return El}const Rl=[{test:/firefox|iceweasel|fxios/i,describe:e=>({name:"Firefox",version:Il(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Ol(e)})},{test:/chrom|crios|crmo/i,describe:e=>({name:"Chrome",version:Il(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Ol(e)})},{test:/safari|applewebkit/i,describe:e=>({name:"Safari",version:Il(xl,e),os:e.includes("mobile/")?"iOS":"macOS",osVersion:Ol(e)})}];function Il(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=t.match(e);return i&&i.length>=n&&i[n]||""}function Ol(e){return e.includes("mac os")?Il(/\(.+?(\d+_\d+(:?_\d+)?)/,e,1).replace(/_/g,"."):void 0}class Dl{}Dl.setTimeout=function(){return setTimeout(...arguments)},Dl.setInterval=function(){return setInterval(...arguments)},Dl.clearTimeout=function(){return clearTimeout(...arguments)},Dl.clearInterval=function(){return clearInterval(...arguments)};const Al=[];var Ml;!function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH"}(Ml||(Ml={}));class Nl extends Js.EventEmitter{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=Nl.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Bs,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),"hidden"===document.visibilityState?this.backgroundTimeout=setTimeout((()=>this.handleAppVisibilityChanged()),5e3):this.handleAppVisibilityChanged()},this.log=Vs(null!==(i=n.loggerName)&&void 0!==i?i:Ls.Track),this.loggerContextCb=n.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=Nl.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),Vd(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===Nl.Kind.Video&&(t="video"),0===this.attachedElements.length&&this.kind===Nl.Kind.Video&&this.addAppVisibilityListener(),e||("audio"===t&&(Al.forEach((t=>{null===t.parentElement&&!e&&(e=t)})),e&&Al.splice(Al.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),Ll(this.mediaStreamTrack,e);const n=e.srcObject.getTracks(),i=n.some((e=>"audio"===e.kind));return e.play().then((()=>{this.emit(i?pl.AudioPlaybackStarted:pl.VideoPlaybackStarted)})).catch((t=>{"NotAllowedError"===t.name?this.emit(i?pl.AudioPlaybackFailed:pl.VideoPlaybackFailed,t):"AbortError"===t.name?Bs.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):Bs.warn("could not playback ".concat(i?"audio":"video"),t),i&&e&&n.some((e=>"video"===e.kind))&&"NotAllowedError"===t.name&&(e.muted=!0,e.play().catch((()=>{})))})),this.emit(pl.ElementAttached,e),e}detach(e){try{if(e){Ul(this.mediaStreamTrack,e);const t=this.attachedElements.indexOf(e);return t>=0&&(this.attachedElements.splice(t,1),this.recycleElement(e),this.emit(pl.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach((e=>{Ul(this.mediaStreamTrack,e),t.push(e),this.recycleElement(e),this.emit(pl.ElementDetached,e)})),this.attachedElements=[],t}finally{0===this.attachedElements.length&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Vs(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),Al.forEach((e=>{e.parentElement||(t=!1)})),t&&Al.push(e)}}handleAppVisibilityChanged(){return Ws(this,void 0,void 0,(function*(){this.isInBackground="hidden"===document.visibilityState,!this.isInBackground&&this.kind===Nl.Kind.Video&&setTimeout((()=>this.attachedElements.forEach((e=>e.play().catch((()=>{}))))),0)}))}addAppVisibilityListener(){id()?(this.isInBackground="hidden"===document.visibilityState,document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){id()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Ll(e,t){let n,i;n=t.srcObject instanceof MediaStream?t.srcObject:new MediaStream,i="audio"===e.kind?n.getAudioTracks():n.getVideoTracks(),i.includes(e)||(i.forEach((e=>{n.removeTrack(e)})),n.addTrack(e)),ed()&&t instanceof HTMLVideoElement||(t.autoplay=!0),t.muted=0===n.getAudioTracks().length,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,(ed()||Zl())&&t instanceof HTMLVideoElement&&setTimeout((()=>{t.srcObject=n,t.play().catch((()=>{}))}),0))}function Ul(e,t){if(t.srcObject instanceof MediaStream){const n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}!function(e){let t;var n;let i,r;(n=t=e.Kind||(e.Kind={})).Audio="audio",n.Video="video",n.Unknown="unknown",function(e){e.Camera="camera",e.Microphone="microphone",e.ScreenShare="screen_share",e.ScreenShareAudio="screen_share_audio",e.Unknown="unknown"}(i=e.Source||(e.Source={})),function(e){e.Active="active",e.Paused="paused",e.Unknown="unknown"}(r=e.StreamState||(e.StreamState={})),e.kindToProto=function(e){switch(e){case t.Audio:return zo.AUDIO;case t.Video:return zo.VIDEO;default:return zo.DATA}},e.kindFromProto=function(e){switch(e){case zo.AUDIO:return t.Audio;case zo.VIDEO:return t.Video;default:return t.Unknown}},e.sourceToProto=function(e){switch(e){case i.Camera:return Wo.CAMERA;case i.Microphone:return Wo.MICROPHONE;case i.ScreenShare:return Wo.SCREEN_SHARE;case i.ScreenShareAudio:return Wo.SCREEN_SHARE_AUDIO;default:return Wo.UNKNOWN}},e.sourceFromProto=function(e){switch(e){case Wo.CAMERA:return i.Camera;case Wo.MICROPHONE:return i.Microphone;case Wo.SCREEN_SHARE:return i.ScreenShare;case Wo.SCREEN_SHARE_AUDIO:return i.ScreenShareAudio;default:return i.Unknown}},e.streamStateFromProto=function(e){switch(e){case ja.ACTIVE:return r.Active;case ja.PAUSED:return r.Paused;default:return r.Unknown}}}(Nl||(Nl={}));class Fl{constructor(e,t,n,i,r){if("object"==typeof e)this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else{if(void 0===t||void 0===n)throw new TypeError("Unsupported options: provide at least width, height and maxBitrate");this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:n,maxFramerate:i,priority:r}}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const jl=["vp8","h264"],Bl=["vp8","h264","vp9","av1","h265"];function Vl(e){return!!jl.find((t=>t===e))}var ql,Hl;!function(e){e[e.PREFER_REGRESSION=0]="PREFER_REGRESSION",e[e.SIMULCAST=1]="SIMULCAST",e[e.REGRESSION=2]="REGRESSION"}(ql||(ql={})),function(e){e.telephone={maxBitrate:12e3},e.speech={maxBitrate:24e3},e.music={maxBitrate:48e3},e.musicStereo={maxBitrate:64e3},e.musicHighQuality={maxBitrate:96e3},e.musicHighQualityStereo={maxBitrate:128e3}}(Hl||(Hl={}));const zl={h90:new Fl(160,90,9e4,20),h180:new Fl(320,180,16e4,20),h216:new Fl(384,216,18e4,20),h360:new Fl(640,360,45e4,20),h540:new Fl(960,540,8e5,25),h720:new Fl(1280,720,17e5,30),h1080:new Fl(1920,1080,3e6,30),h1440:new Fl(2560,1440,5e6,30),h2160:new Fl(3840,2160,8e6,30)},Wl={h120:new Fl(160,120,7e4,20),h180:new Fl(240,180,125e3,20),h240:new Fl(320,240,14e4,20),h360:new Fl(480,360,33e4,20),h480:new Fl(640,480,5e5,20),h540:new Fl(720,540,6e5,25),h720:new Fl(960,720,13e5,30),h1080:new Fl(1440,1080,23e5,30),h1440:new Fl(1920,1440,38e5,30)},Gl={h360fps3:new Fl(640,360,2e5,3,"medium"),h360fps15:new Fl(640,360,4e5,15,"medium"),h720fps5:new Fl(1280,720,8e5,5,"medium"),h720fps15:new Fl(1280,720,15e5,15,"medium"),h720fps30:new Fl(1280,720,2e6,30,"medium"),h1080fps15:new Fl(1920,1080,25e5,15,"medium"),h1080fps30:new Fl(1920,1080,5e6,30,"medium"),original:new Fl(0,0,7e6,30,"medium")},Kl="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function $l(e){return Ws(this,void 0,void 0,(function*(){return new Promise((t=>Dl.setTimeout(t,e)))}))}function Jl(){return"addTransceiver"in RTCPeerConnection.prototype}function Yl(){return"addTrack"in RTCPeerConnection.prototype}function Xl(e){return"av1"===e||"vp9"===e}function Ql(e){return!(!document||td())&&(e||(e=document.createElement("audio")),"setSinkId"in e)}function Zl(){var e;return"Firefox"===(null===(e=Pl())||void 0===e?void 0:e.name)}function ed(){var e;return"Safari"===(null===(e=Pl())||void 0===e?void 0:e.name)}function td(){const e=Pl();return"Safari"===(null==e?void 0:e.name)||"iOS"===(null==e?void 0:e.os)}function nd(){var e,t;return!!id()&&(null!==(t=null===(e=navigator.userAgentData)||void 0===e?void 0:e.mobile)&&void 0!==t?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent))}function id(){return typeof document<"u"}function rd(){return"ReactNative"==navigator.product}function od(e){return e.hostname.endsWith(".livekit.cloud")||e.hostname.endsWith(".livekit.run")}function ad(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function sd(){if(!rd())return;let e=ad();return e?e.platform:void 0}function cd(){if(id())return window.devicePixelRatio;if(rd()){let e=ad();if(e)return e.devicePixelRatio}return 1}function ld(e,t){const n=e.split("."),i=t.split("."),r=Math.min(n.length,i.length);for(let e=0;e<r;++e){const t=parseInt(n[e],10),o=parseInt(i[e],10);if(t>o)return 1;if(t<o)return-1;if(e===r-1&&t===o)return 0}return""===e&&""!==t?-1:""===t?1:n.length==i.length?0:n.length<i.length?-1:1}function dd(e){for(const t of e)t.target.handleResize(t)}function ud(e){for(const t of e)t.target.handleVisibilityChanged(t)}let hd=null;const pd=()=>(hd||(hd=new ResizeObserver(dd)),hd);let md=null;const fd=()=>(md||(md=new IntersectionObserver(ud,{root:null,rootMargin:"0px"})),md);function gd(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=document.createElement("canvas");r.width=e,r.height=t;const o=r.getContext("2d");null==o||o.fillRect(0,0,r.width,r.height),i&&o&&(o.beginPath(),o.arc(e/2,t/2,50,0,2*Math.PI,!0),o.closePath(),o.fillStyle="grey",o.fill());const a=r.captureStream(),[s]=a.getTracks();if(!s)throw Error("Could not get empty media stream video track");return s.enabled=n,s}let vd;function bd(){if(!vd){const e=new AudioContext,t=e.createOscillator(),n=e.createGain();n.gain.setValueAtTime(0,0);const i=e.createMediaStreamDestination();if(t.connect(n),n.connect(i),t.start(),[vd]=i.stream.getAudioTracks(),!vd)throw Error("Could not get empty media stream audio track");vd.enabled=!1}return vd.clone()}class yd{get isResolved(){return this._isResolved}constructor(e,t){this._isResolved=!1,this.onFinally=t,this.promise=new Promise(((t,n)=>Ws(this,void 0,void 0,(function*(){this.resolve=t,this.reject=n,e&&(yield e(t,n))})))).finally((()=>{var e;this._isResolved=!0,null===(e=this.onFinally)||void 0===e||e.call(this)}))}}function kd(e){if("string"==typeof e||"number"==typeof e)return e;if(Array.isArray(e))return e[0];if(void 0!==e.exact)return Array.isArray(e.exact)?e.exact[0]:e.exact;if(void 0!==e.ideal)return Array.isArray(e.ideal)?e.ideal[0]:e.ideal;throw Error("could not unwrap constraint")}function wd(e){return e.startsWith("ws")?e.replace(/^(ws)/,"http"):e}function Cd(e){switch(e.reason){case al.LeaveRequest:return e.context;case al.Cancelled:return Jo.CLIENT_INITIATED;case al.NotAllowed:return Jo.USER_REJECTED;case al.ServerUnreachable:return Jo.JOIN_FAILURE;default:return Jo.UNKNOWN_REASON}}function Td(e){return void 0!==e?Number(e):void 0}function Sd(e){return void 0!==e?BigInt(e):void 0}function _d(e){return!!e&&!(e instanceof MediaStreamTrack)&&e.isLocal}function xd(e){return!!e&&e.kind==Nl.Kind.Audio}function Ed(e){return!!e&&e.kind==Nl.Kind.Video}function Pd(e){return _d(e)&&Ed(e)}function Rd(e){return _d(e)&&xd(e)}function Id(e){return!!e&&!e.isLocal}function Od(e){return!!e&&!e.isLocal}function Dd(e){return Id(e)&&Ed(e)}function Ad(e,t,n){var i,r,o,a;const{optionsWithoutProcessor:s,audioProcessor:c,videoProcessor:l}=qd(null!=e?e:{}),d=null==t?void 0:t.processor,u=null==n?void 0:n.processor,h=null!=s?s:{};return!0===h.audio&&(h.audio={}),!0===h.video&&(h.video={}),h.audio&&(Md(h.audio,t),null!==(i=(o=h.audio).deviceId)&&void 0!==i||(o.deviceId={ideal:"default"}),(c||d)&&(h.audio.processor=null!=c?c:d)),h.video&&(Md(h.video,n),null!==(r=(a=h.video).deviceId)&&void 0!==r||(a.deviceId={ideal:"default"}),(l||u)&&(h.video.processor=null!=l?l:u)),h}function Md(e,t){return Object.keys(t).forEach((n=>{void 0===e[n]&&(e[n]=t[n])})),e}function Nd(e){var t,n,i,r;const o={};if(e.video)if("object"==typeof e.video){const n={},r=n,a=e.video;Object.keys(a).forEach((e=>{"resolution"===e?Md(r,a.resolution):r[e]=a[e]})),o.video=n,null!==(t=(i=o.video).deviceId)&&void 0!==t||(i.deviceId={ideal:"default"})}else o.video=!!e.video&&{deviceId:{ideal:"default"}};else o.video=!1;return e.audio?"object"==typeof e.audio?(o.audio=e.audio,null!==(n=(r=o.audio).deviceId)&&void 0!==n||(r.deviceId={ideal:"default"})):o.audio={deviceId:{ideal:"default"}}:o.audio=!1,o}function Ld(){var e;const t=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(t){const n=new t({latencyHint:"interactive"});if("suspended"===n.state&&typeof window<"u"&&null!==(e=window.document)&&void 0!==e&&e.body){const e=()=>Ws(this,void 0,void 0,(function*(){var t;try{"suspended"===n.state&&(yield n.resume())}catch(e){console.warn("Error trying to auto-resume audio context",e)}null===(t=window.document.body)||void 0===t||t.removeEventListener("click",e)}));window.document.body.addEventListener("click",e)}return n}}function Ud(e){return"audioinput"===e?Nl.Source.Microphone:"videoinput"===e?Nl.Source.Camera:Nl.Source.Unknown}function Fd(e){return e===Nl.Source.Microphone?"audioinput":e===Nl.Source.Camera?"videoinput":void 0}function jd(e){return e.split("/")[1].toLowerCase()}function Bd(e){const t=[];return e.forEach((e=>{void 0!==e.track&&t.push(new Ja({cid:e.track.mediaStreamID,track:e.trackInfo}))})),t}function Vd(e){return"mediaStreamTrack"in e?{trackID:e.sid,source:e.source,muted:e.isMuted,enabled:e.mediaStreamTrack.enabled,kind:e.kind,streamID:e.mediaStreamID,streamTrackID:e.mediaStreamTrack.id}:{trackID:e.trackSid,enabled:e.isEnabled,muted:e.isMuted,trackInfo:Object.assign({mimeType:e.mimeType,name:e.trackName,encrypted:e.isEncrypted,kind:e.kind,source:e.source},e.track?Vd(e.track):{})}}function qd(e){const t=Object.assign({},e);let n,i;return"object"==typeof t.audio&&t.audio.processor&&(n=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),"object"==typeof t.video&&t.video.processor&&(i=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:_l(t)}}function Hd(e,t){return e.width*e.height<t.width*t.height}class zd extends Js.EventEmitter{constructor(e){super(),this.onWorkerMessage=e=>{var t,n;const{kind:i,data:r}=e.data;switch(i){case"error":Bs.error(r.error.message),this.emit(rl.EncryptionError,r.error);break;case"initAck":r.enabled&&this.keyProvider.getKeys().forEach((e=>{this.postKey(e)}));break;case"enable":if(r.enabled&&this.keyProvider.getKeys().forEach((e=>{this.postKey(e)})),this.encryptionEnabled!==r.enabled&&r.participantIdentity===(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))this.emit(rl.ParticipantEncryptionStatusChanged,r.enabled,this.room.localParticipant),this.encryptionEnabled=r.enabled;else if(r.participantIdentity){const e=null===(n=this.room)||void 0===n?void 0:n.getParticipantByIdentity(r.participantIdentity);if(!e)throw TypeError("couldn't set encryption status, participant not found".concat(r.participantIdentity));this.emit(rl.ParticipantEncryptionStatusChanged,r.enabled,e)}break;case"ratchetKey":this.keyProvider.emit(nl.KeyRatcheted,r.ratchetResult,r.participantIdentity,r.keyIndex)}},this.onWorkerError=e=>{Bs.error("e2ee worker encountered an error:",{error:e.error}),this.emit(rl.EncryptionError,e.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!(typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"||ml()))throw new vl("tried to setup end-to-end encryption on an unsupported browser");if(Bs.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:qs.getLevel()}};this.worker&&(Bs.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){Bs.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){e&&0!==e.length?this.postSifTrailer(e):Bs.warn("ignoring server sent trailer as it's empty")}setupEngine(e){e.on(hl.RTPVideoMapUpdate,(e=>{this.postRTPMap(e)}))}setupEventListeners(e,t){e.on(dl.TrackPublished,((e,t)=>this.setParticipantCryptorEnabled(e.trackInfo.encryption!==aa.NONE,t.identity))),e.on(dl.ConnectionStateChanged,(t=>{t===oh.Connected&&e.remoteParticipants.forEach((e=>{e.trackPublications.forEach((t=>{this.setParticipantCryptorEnabled(t.trackInfo.encryption!==aa.NONE,e.identity)}))}))})).on(dl.TrackUnsubscribed,((e,t,n)=>{var i;const r={kind:"removeTransform",data:{participantIdentity:n.identity,trackId:e.mediaStreamID}};null===(i=this.worker)||void 0===i||i.postMessage(r)})).on(dl.TrackSubscribed,((e,t,n)=>{this.setupE2EEReceiver(e,n.identity,t.trackInfo)})).on(dl.SignalConnected,(()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");t.getKeys().forEach((e=>{this.postKey(e)})),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)})),e.localParticipant.on(ul.LocalSenderCreated,((e,t)=>Ws(this,void 0,void 0,(function*(){this.setupE2EESender(t,e)})))),t.on(nl.SetKey,(e=>this.postKey(e))).on(nl.RatchetRequest,((e,t)=>this.postRatchetRequest(e,t)))}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const n={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(n)}postKey(e){let{key:t,participantIdentity:n,keyIndex:i}=e;var r;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:n,isPublisher:n===(null===(r=this.room)||void 0===r?void 0:r.localParticipant.identity),key:t,keyIndex:i}};this.worker.postMessage(o)}postEnable(e,t){if(!this.worker)throw new ReferenceError("failed to enable e2ee, worker is not ready");{const n={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(n)}}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(null===(t=this.room)||void 0===t||!t.localParticipant.identity)throw TypeError("could not post rtp map, local participant identity is missing");const n={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(n)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,n){if(e.receiver){if(null==n||!n.mimeType||""===n.mimeType)throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,"video"===e.kind?jd(n.mimeType):void 0)}}setupE2EESender(e,t){_d(e)&&t?this.handleSender(t,e.mediaStreamID,void 0):t||Bs.warn("early return because sender is not ready")}handleReceiver(e,t,n,i){return Ws(this,void 0,void 0,(function*(){if(this.worker){if(ml()){const r={kind:"decode",participantIdentity:n,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,r)}else{if(tl in e&&i){const e={kind:"updateCodec",data:{trackId:t,codec:i,participantIdentity:n}};return void this.worker.postMessage(e)}let r=e.writableStream,o=e.readableStream;if(!r||!o){const t=e.createEncodedStreams();e.writableStream=t.writable,r=t.writable,e.readableStream=t.readable,o=t.readable}const a={kind:"decode",data:{readableStream:o,writableStream:r,trackId:t,codec:i,participantIdentity:n,isReuse:tl in e}};this.worker.postMessage(a,[o,r])}e[tl]=!0}}))}handleSender(e,t,n){var i;if(!(tl in e)&&this.worker){if(null===(i=this.room)||void 0===i||!i.localParticipant.identity||""===this.room.localParticipant.identity)throw TypeError("local identity needs to be known in order to set up encrypted sender");if(ml()){Bs.info("initialize script transform");const i={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:n};e.transform=new RTCRtpScriptTransform(this.worker,i)}else{Bs.info("initialize encoded streams");const i=e.createEncodedStreams(),r={kind:"encode",data:{readableStream:i.readable,writableStream:i.writable,codec:n,trackId:t,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(r,[i.readable,i.writable])}e[tl]=!0}}}const Wd="default";class Gd{constructor(){this._previousDevices=[]}static getInstance(){return void 0===this.instance&&(this.instance=new Gd),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return Ws(this,arguments,void 0,(function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i;if((null===(i=Gd.userMediaPromiseMap)||void 0===i?void 0:i.size)>0){Bs.debug("awaiting getUserMedia promise");try{e?yield Gd.userMediaPromiseMap.get(e):yield Promise.all(Gd.userMediaPromiseMap.values())}catch(e){Bs.warn("error waiting for media permissons")}}let r=yield navigator.mediaDevices.enumerateDevices();if(n&&(!ed()||!t.hasDeviceInUse(e))&&(0===r.filter((t=>t.kind===e)).length||r.some((t=>{const n=""===t.label,i=!e||t.kind===e;return n&&i})))){const t={video:"audioinput"!==e&&"audiooutput"!==e,audio:"videoinput"!==e&&{deviceId:{ideal:"default"}}},n=yield navigator.mediaDevices.getUserMedia(t);r=yield navigator.mediaDevices.enumerateDevices(),n.getTracks().forEach((e=>{e.stop()}))}return t._previousDevices=r,e&&(r=r.filter((t=>t.kind===e))),r}()}))}normalizeDeviceId(e,t,n){return Ws(this,void 0,void 0,(function*(){if(t!==Wd)return t;const i=yield this.getDevices(e),r=i.find((e=>e.deviceId===Wd));if(!r)return void Bs.warn("could not reliably determine default device");const o=i.find((e=>e.deviceId!==Wd&&e.groupId===(null!=n?n:r.groupId)));if(o)return null==o?void 0:o.deviceId;Bs.warn("could not reliably determine default device")}))}hasDeviceInUse(e){return e?Gd.userMediaPromiseMap.has(e):Gd.userMediaPromiseMap.size>0}}var Kd;Gd.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],Gd.userMediaPromiseMap=new Map,function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"}(Kd||(Kd={}));class $d{constructor(){this.pendingTasks=new Map,this.taskMutex=new or,this.nextTaskIndex=0}run(e){return Ws(this,void 0,void 0,(function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Kd.WAITING};this.pendingTasks.set(t.id,t);const n=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=Kd.RUNNING,yield e()}finally{t.status=Kd.COMPLETED,this.pendingTasks.delete(t.id),n()}}))}flush(){return Ws(this,void 0,void 0,(function*(){return this.run((()=>Ws(this,void 0,void 0,(function*(){}))))}))}snapshot(){return Array.from(this.pendingTasks.values())}}function Jd(e,t){return e.pathname="".concat(function(e){return e.endsWith("/")?e:"".concat(e,"/")}(e.pathname)).concat(t),e.toString()}const Yd=["syncState","trickle","offer","answer","simulate","leave"];var Xd;!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.RECONNECTING=2]="RECONNECTING",e[e.DISCONNECTING=3]="DISCONNECTING",e[e.DISCONNECTED=4]="DISCONNECTED"}(Xd||(Xd={}));class Qd{get currentState(){return this.state}get isDisconnected(){return this.state===Xd.DISCONNECTING||this.state===Xd.DISCONNECTED}get isEstablishingConnection(){return this.state===Xd.CONNECTING||this.state===Xd.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;this.rtt=0,this.state=Xd.DISCONNECTED,this.log=Bs,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=Vs(null!==(n=t.loggerName)&&void 0!==n?n:Ls.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new $d,this.queuedRequests=[],this.closingLock=new or,this.connectionLock=new or,this.state=Xd.DISCONNECTED}get logContext(){var e,t;return null!==(t=null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this))&&void 0!==t?t:{}}join(e,t,n,i){return Ws(this,void 0,void 0,(function*(){return this.state=Xd.CONNECTING,this.options=n,yield this.connect(e,t,n,i)}))}reconnect(e,t,n,i){return Ws(this,void 0,void 0,(function*(){if(this.options)return this.state=Xd.RECONNECTING,this.clearPingInterval(),yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:n,reconnectReason:i}));this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext)}))}connect(e,t,n,i){this.connectOptions=n;const r=function(){var e;const t=new xa({sdk:Ea.JS,protocol:16,version:"2.15.5"});return rd()&&(t.os=null!==(e=sd())&&void 0!==e?e:""),t}(),o=function(e,t,n){var i;const r=new URLSearchParams;return r.set("access_token",e),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",rd()?"reactnative":"js"),r.set("version",t.version),r.set("protocol",t.protocol.toString()),t.deviceModel&&r.set("device_model",t.deviceModel),t.os&&r.set("os",t.os),t.osVersion&&r.set("os_version",t.osVersion),t.browser&&r.set("browser",t.browser),t.browserVersion&&r.set("browser_version",t.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!(null===(i=navigator.connection)||void 0===i)&&i.type&&r.set("network",navigator.connection.type),r}(t,r,n),a=function(e,t){const n=new URL(function(e){return e.startsWith("http")?e.replace(/^(http)/,"ws"):e}(e));return t.forEach(((e,t)=>{n.searchParams.set(t,e)})),Jd(n,"rtc")}(e,o),s=function(e){return Jd(new URL(wd(e)),"validate")}(a);return new Promise(((e,t)=>Ws(this,void 0,void 0,(function*(){const r=yield this.connectionLock.lock();try{const r=()=>Ws(this,void 0,void 0,(function*(){this.close(),clearTimeout(o),t(new gl("room connection has been cancelled (signal)",al.Cancelled))})),o=setTimeout((()=>{this.close(),t(new gl("room connection has timed out (signal)",al.ServerUnreachable))}),n.websocketTimeout);null!=i&&i.aborted&&r(),null==i||i.addEventListener("abort",r);const c=new URL(a);c.searchParams.has("access_token")&&c.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(c),Object.assign({reconnect:n.reconnect,reconnectReason:n.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(o)},this.ws.onerror=e=>Ws(this,void 0,void 0,(function*(){if(this.state===Xd.CONNECTED)this.handleWSError(e);else{this.state=Xd.DISCONNECTED,clearTimeout(o);try{const n=yield fetch(s);if(n.status.toFixed(0).startsWith("4")){const e=yield n.text();t(new gl(e,al.NotAllowed,n.status))}else t(new gl("Encountered unknown websocket error during connection: ".concat(e.toString()),al.InternalError,n.status))}catch(e){t(new gl(e instanceof Error?e.message:"server was not reachable",al.ServerUnreachable))}}})),this.ws.onmessage=o=>Ws(this,void 0,void 0,(function*(){var a,s,c;let l;if("string"==typeof o.data){const e=JSON.parse(o.data);l=qa.fromJson(e,{ignoreUnknownFields:!0})}else{if(!(o.data instanceof ArrayBuffer))return void this.log.error("could not decode websocket message: ".concat(typeof o.data),this.logContext);l=qa.fromBinary(new Uint8Array(o.data))}if(this.state!==Xd.CONNECTED){let o=!1;if("join"===(null===(a=l.message)||void 0===a?void 0:a.case)?(this.state=Xd.CONNECTED,null==i||i.removeEventListener("abort",r),this.pingTimeoutDuration=l.message.value.pingTimeout,this.pingIntervalDuration=l.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),e(l.message.value)):this.state===Xd.RECONNECTING&&"leave"!==l.message.case?(this.state=Xd.CONNECTED,null==i||i.removeEventListener("abort",r),this.startPingInterval(),"reconnect"===(null===(s=l.message)||void 0===s?void 0:s.case)?e(l.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),e(void 0),o=!0)):this.isEstablishingConnection&&"leave"===l.message.case?t(new gl("Received leave request while trying to (re)connect",al.LeaveRequest,void 0,l.message.value.reason)):n.reconnect||t(new gl("did not receive join response, got ".concat(null===(c=l.message)||void 0===c?void 0:c.case," instead"),al.InternalError)),!o)return}this.signalLatency&&(yield $l(this.signalLatency)),this.handleSignalResponse(l)})),this.ws.onclose=e=>{this.isEstablishingConnection&&t(new gl("Websocket got closed during a (re)connection attempt",al.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:e.reason,code:e.code,wasClean:e.wasClean,state:this.state})),this.handleOnClose(e.reason)}}finally{r()}}))))}close(){return Ws(this,arguments,void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){const n=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=Xd.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const t=new Promise((t=>{e.ws?e.ws.onclose=()=>{t()}:t()}));e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([t,$l(250)])),e.ws=void 0}}finally{t&&(e.state=Xd.DISCONNECTED),n()}}()}))}sendOffer(e,t){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:eu(e,t)})}sendAnswer(e,t){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:eu(e,t)})}sendIceCandidate(e,t){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Wa({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new Ga({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return Ws(this,arguments,void 0,(function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function*(){const r=n.getNextRequestId();return yield n.sendRequest({case:"updateMetadata",value:new as({requestId:r,metadata:e,name:t,attributes:i})}),r}()}))}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new os({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new bs({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:Er.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new _s({timestamp:Er.parse(Date.now()),rtt:Er.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new ts({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new is({reason:Jo.CLIENT_INITIATED,action:rs.DISCONNECT})})}sendRequest(e){return Ws(this,arguments,void 0,(function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function*(){if(!n&&!function(e){const t=Yd.indexOf(e.case)>=0;return Bs.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}(e)&&t.state===Xd.RECONNECTING)return void t.queuedRequests.push((()=>Ws(t,void 0,void 0,(function*(){yield this.sendRequest(e,!0)}))));if(n||(yield t.requestQueue.flush()),t.signalLatency&&(yield $l(t.signalLatency)),t.isDisconnected)return void t.log.debug("skipping signal request (type: ".concat(e.case,") - SignalClient disconnected"));if(!t.ws||t.ws.readyState!==t.ws.OPEN)return void t.log.error("cannot send signal request before connected, type: ".concat(null==e?void 0:e.case),t.logContext);const i=new Va({message:e});try{t.useJSON?t.ws.send(i.toJsonString()):t.ws.send(i.toBinary())}catch(e){t.log.error("error sending signal message",Object.assign(Object.assign({},t.logContext),{error:e}))}}()}))}handleSignalResponse(e){var t,n;const i=e.message;if(null==i)return void this.log.debug("received unsupported message",this.logContext);let r=!1;if("answer"===i.case){const e=Zd(i.value);this.onAnswer&&this.onAnswer(e,i.value.id)}else if("offer"===i.case){const e=Zd(i.value);this.onOffer&&this.onOffer(e,i.value.id)}else if("trickle"===i.case){const e=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(e,i.value.target)}else"update"===i.case?this.onParticipantUpdate&&this.onParticipantUpdate(null!==(t=i.value.participants)&&void 0!==t?t:[]):"trackPublished"===i.case?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):"speakersChanged"===i.case?this.onSpeakersChanged&&this.onSpeakersChanged(null!==(n=i.value.speakers)&&void 0!==n?n:[]):"leave"===i.case?this.onLeave&&this.onLeave(i.value):"mute"===i.case?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):"roomUpdate"===i.case?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):"connectionQuality"===i.case?this.onConnectionQuality&&this.onConnectionQuality(i.value):"streamStateUpdate"===i.case?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):"subscribedQualityUpdate"===i.case?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):"subscriptionPermissionUpdate"===i.case?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):"refreshToken"===i.case?this.onTokenRefresh&&this.onTokenRefresh(i.value):"trackUnpublished"===i.case?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):"subscriptionResponse"===i.case?this.onSubscriptionError&&this.onSubscriptionError(i.value):"pong"===i.case||("pongResp"===i.case?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),r=!0):"requestResponse"===i.case?this.onRequestResponse&&this.onRequestResponse(i.value):"trackSubscribed"===i.case?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(i.value.trackSid):"roomMoved"===i.case?(this.onTokenRefresh&&this.onTokenRefresh(i.value.token),this.onRoomMoved&&this.onRoomMoved(i.value)):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));r||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return Ws(this,void 0,void 0,(function*(){if(this.state===Xd.DISCONNECTED)return;const t=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)}))}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){this.clearPingTimeout(),this.pingTimeoutDuration?this.pingTimeout=Dl.setTimeout((()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-1e3*this.pingTimeoutDuration).toUTCString()),this.logContext),this.handleOnClose("ping timeout")}),1e3*this.pingTimeoutDuration):this.log.warn("ping timeout duration not set",this.logContext)}clearPingTimeout(){this.pingTimeout&&Dl.clearTimeout(this.pingTimeout)}startPingInterval(){this.clearPingInterval(),this.resetPingTimeout(),this.pingIntervalDuration?(this.log.debug("start ping interval",this.logContext),this.pingInterval=Dl.setInterval((()=>{this.sendPing()}),1e3*this.pingIntervalDuration)):this.log.warn("ping interval duration not set",this.logContext)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Dl.clearInterval(this.pingInterval)}}function Zd(e){const t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type}return t}function eu(e,t){return new Xa({sdp:e.sdp,type:e.type,id:t})}class tu{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const t=this.buffer[0];if(this._totalSize-t.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class nu{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,t){const n=Date.now();n-this._lastCleanup>this.ttl/2&&this.cleanup();const i=n+this.ttl;return this._map.set(e,{value:t,expiresAt:i}),this}get(e){const t=this._map.get(e);if(t)return t.expiresAt<Date.now()?void this._map.delete(e):t.value}has(e){const t=this._map.get(e);return!(!t||t.expiresAt<Date.now()&&(this._map.delete(e),1))}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[t,n]of this._map.entries())n.expiresAt<e&&this._map.delete(t);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[t,n]of this._map.entries())n.expiresAt>=Date.now()&&e(n.value,t,this.asValueMap())}map(e){this.cleanup();const t=[],n=this.asValueMap();for(const[i,r]of n.entries())t.push(e(r,i,n));return t}asValueMap(){const e=new Map;for(const[t,n]of this._map.entries())n.expiresAt>=Date.now()&&e.set(t,n.value);return e}}var iu,ru,ou,au,su,cu={},lu={},du={exports:{}};function uu(){if(iu)return du.exports;iu=1;var e=du.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(e).forEach((function(t){e[t].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))})),du.exports}function hu(){if(au)return ou;au=1;var e=uu(),t=/%[sdv%]/g,n=function(e){var n=1,i=arguments,r=i.length;return e.replace(t,(function(e){if(n>=r)return e;var t=i[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}}))},i=function(e,t,i){var r=[e+"="+(t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var a=t.names[o];t.name?r.push(i[t.name][a]):r.push(i[t.names[o]])}else r.push(i[t.name]);return n.apply(null,r)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return ou=function(t,n){n=n||{},null==t.version&&(t.version=0),null==t.name&&(t.name=" "),t.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var a=n.outerOrder||r,s=n.innerOrder||o,c=[];return a.forEach((function(n){e[n].forEach((function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach((function(t){c.push(i(n,e,t))}))}))})),t.media.forEach((function(t){c.push(i("m",e.m[0],t)),s.forEach((function(n){e[n].forEach((function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach((function(t){c.push(i(n,e,t))}))}))}))})),c.join("\r\n")+"\r\n"}}var pu=function(){if(su)return cu;su=1;var e=(ru||(ru=1,function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,i){var r=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:r&&!n[e.name]&&(n[e.name]={});var o=e.push?{}:r?n[e.name]:n;(function(e,n,i,r){if(r&&!i)n[r]=t(e[1]);else for(var o=0;o<i.length;o+=1)null!=e[o+1]&&(n[i[o]]=t(e[o+1]))})(i.match(e.reg),o,e.names,e.name),e.push&&n[e.push].push(o)},i=uu(),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach((function(e){var t=e[0],r=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),a=o[o.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var c=i[t][s];if(c.reg.test(r))return n(c,a,r)}})),t.media=o,t};var o=function(e,n){var i=n.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&n.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],i=e.split(" ").map(t),r=0;r<i.length;r+=3)n.push({component:i[r],ip:i[r+1],port:i[r+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var n,i=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),i=!0),{scid:n,paused:i}}))}))}}(lu)),lu),t=hu(),n=uu();return cu.grammar=n,cu.write=t,cu.parse=e.parse,cu.parseParams=e.parseParams,cu.parseFmtpConfig=e.parseFmtpConfig,cu.parsePayloads=e.parsePayloads,cu.parseRemoteCandidates=e.parseRemoteCandidates,cu.parseImageAttributes=e.parseImageAttributes,cu.parseSimulcastStreamList=e.parseSimulcastStreamList,cu}();function mu(e,t,n){var i,r,o;void 0===t&&(t=50),void 0===n&&(n={});var a=null!=(i=n.isImmediate)&&i,s=null!=(r=n.callback)&&r,c=n.maxWait,l=Date.now(),d=[],u=function(){var n=[].slice.call(arguments),i=this;return new Promise((function(r,u){var h=a&&void 0===o;if(void 0!==o&&clearTimeout(o),o=setTimeout((function(){if(o=void 0,l=Date.now(),!a){var t=e.apply(i,n);s&&s(t),d.forEach((function(e){return(0,e.resolve)(t)})),d=[]}}),function(){if(void 0!==c){var e=Date.now()-l;if(e+t>=c)return c-e}return t}()),h){var p=e.apply(i,n);return s&&s(p),r(p)}d.push({resolve:r,reject:u})}))};return u.cancel=function(e){void 0!==o&&clearTimeout(o),d.forEach((function(t){return(0,t.reject)(e)})),d=[]},u}const fu="negotiationStarted",gu="negotiationComplete",vu="rtpVideoPayloadTypes";class bu extends Js.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;super(),this.log=Bs,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=mu((e=>Ws(this,void 0,void 0,(function*(){this.emit(fu);try{yield this.createAndSendOffer()}catch(t){if(!e)throw t;e(t)}}))),20),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Vs(null!==(n=t.loggerName)&&void 0!==n?n:Ls.PCTransport),this.loggerOptions=t,this.config=e,this._pc=this.createPC(),this.offerLock=new or}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=e=>{var t;e.candidate&&(null===(t=this.onIceCandidate)||void 0===t||t.call(this,e.candidate))},e.onicecandidateerror=e=>{var t;null===(t=this.onIceCandidateError)||void 0===t||t.call(this,e)},e.oniceconnectionstatechange=()=>{var t;null===(t=this.onIceConnectionStateChange)||void 0===t||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;null===(t=this.onSignalingStatechange)||void 0===t||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,e.connectionState)},e.ondatachannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},e.ontrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},e}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}get isICEConnected(){return null!==this._pc&&("connected"===this.pc.iceConnectionState||"completed"===this.pc.iceConnectionState)}addIceCandidate(e){return Ws(this,void 0,void 0,(function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)}))}setRemoteDescription(e,t){return Ws(this,void 0,void 0,(function*(){var n;if("answer"===e.type&&this.latestOfferId>0&&t>0&&t!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:t,latestOfferId:this.latestOfferId})),!1;let i;if("offer"===e.type){let{stereoMids:t,nackMids:n}=function(e){var t;const n=[],i=[],r=pu.parse(null!==(t=e.sdp)&&void 0!==t?t:"");let o=0;return r.media.forEach((e=>{var t;"audio"===e.type&&(e.rtp.some((e=>"opus"===e.codec&&(o=e.payload,!0))),!(null===(t=e.rtcpFb)||void 0===t)&&t.some((e=>e.payload===o&&"nack"===e.type))&&i.push(e.mid),e.fmtp.some((t=>t.payload===o&&(t.config.includes("sprop-stereo=1")&&n.push(e.mid),!0))))})),{stereoMids:n,nackMids:i}}(e);this.remoteStereoMids=t,this.remoteNackMids=n}else if("answer"===e.type){const t=pu.parse(null!==(n=e.sdp)&&void 0!==n?n:"");t.media.forEach((e=>{"audio"===e.type&&this.trackBitrates.some((t=>{if(!t.transceiver||e.mid!=t.transceiver.mid)return!1;let n=0;if(e.rtp.some((e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0))),0===n)return!0;let i=!1;for(const r of e.fmtp)if(r.payload===n){r.config=r.config.split(";").filter((e=>!e.includes("maxaveragebitrate"))).join(";"),t.maxbr>0&&(r.config+=";maxaveragebitrate=".concat(1e3*t.maxbr)),i=!0;break}return i||t.maxbr>0&&e.fmtp.push({payload:n,config:"maxaveragebitrate=".concat(1e3*t.maxbr)}),!0}))})),i=pu.write(t)}return yield this.setMungedSDP(e,i,!0),this.pendingCandidates.forEach((e=>{this.pc.addIceCandidate(e)})),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):"answer"===e.type&&(this.emit(gu),e.sdp&&pu.parse(e.sdp).media.forEach((e=>{"video"===e.type&&this.emit(vu,e.rtp)}))),!0}))}createAndSendOffer(e){return Ws(this,void 0,void 0,(function*(){var t;const n=yield this.offerLock.lock();try{if(void 0===this.onOffer)return;if(null!=e&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&"have-local-offer"===this._pc.signalingState){const t=this._pc.remoteDescription;if(null==e||!e.iceRestart||!t)return void(this.renegotiate=!0);yield this._pc.setRemoteDescription(t)}else if(!this._pc||"closed"===this._pc.signalingState)return void this.log.warn("could not createOffer with closed peer connection",this.logContext);this.log.debug("starting to negotiate",this.logContext);const n=this.latestOfferId+1;this.latestOfferId=n;const i=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:i.sdp},this.logContext));const r=pu.parse(null!==(t=i.sdp)&&void 0!==t?t:"");if(r.media.forEach((e=>{ku(e),"audio"===e.type?yu(e,[],[]):"video"===e.type&&this.trackBitrates.some((t=>{if(!e.msid||!t.cid||!e.msid.includes(t.cid))return!1;let n=0;if(e.rtp.some((e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0))),0===n||(Xl(t.codec)&&!ed()&&this.ensureVideoDDExtensionForSVC(e,r),"av1"!==t.codec))return!0;const i=Math.round(.7*t.maxbr);for(const t of e.fmtp)if(t.payload===n){t.config.includes("x-google-start-bitrate")||(t.config+=";x-google-start-bitrate=".concat(i));break}return!0}))})),this.latestOfferId>n)return void this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:n}));yield this.setMungedSDP(i,pu.write(r)),this.onOffer(i,this.latestOfferId)}finally{n()}}))}createAndSetAnswer(){return Ws(this,void 0,void 0,(function*(){var e;const t=yield this.pc.createAnswer(),n=pu.parse(null!==(e=t.sdp)&&void 0!==e?e:"");return n.media.forEach((e=>{ku(e),"audio"===e.type&&yu(e,this.remoteStereoMids,this.remoteNackMids)})),yield this.setMungedSDP(t,pu.write(n)),t}))}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new kl("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new kl("PC closed, cannot configure");return null===(t=this._pc)||void 0===t?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!(null===(e=this._pc)||void 0===e||!e.removeTrack)}removeTrack(e){var t;return null===(t=this._pc)||void 0===t?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.connectionState)&&void 0!==t?t:"closed"}getICEConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.iceConnectionState)&&void 0!==t?t:"closed"}getSignallingState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.signalingState)&&void 0!==t?t:"closed"}getTransceivers(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getTransceivers())&&void 0!==t?t:[]}getSenders(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getSenders())&&void 0!==t?t:[]}getLocalDescription(){var e;return null===(e=this._pc)||void 0===e?void 0:e.localDescription}getRemoteDescription(){var e;return null===(e=this.pc)||void 0===e?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return Ws(this,void 0,void 0,(function*(){var e;if(!this._pc)return;let t="";const n=new Map,i=new Map;if((yield this._pc.getStats()).forEach((e=>{switch(e.type){case"transport":t=e.selectedCandidatePairId;break;case"candidate-pair":""===t&&e.selected&&(t=e.id),n.set(e.id,e);break;case"remote-candidate":i.set(e.id,"".concat(e.address,":").concat(e.port))}})),""===t)return;const r=null===(e=n.get(t))||void 0===e?void 0:e.remoteCandidateId;return void 0!==r?i.get(r):void 0}))}setMungedSDP(e,t,n){return Ws(this,void 0,void 0,(function*(){if(t){const i=e.sdp;e.sdp=t;try{return this.log.debug("setting munged ".concat(n?"remote":"local"," description"),this.logContext),void(n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e))}catch(n){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:n,sdp:t})),e.sdp=i}}try{n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(t){let i="unknown error";t instanceof Error?i=t.message:"string"==typeof t&&(i=t);const r={error:i,sdp:e.sdp};throw!n&&this.pc.remoteDescription&&(r.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:r})),new wl(i)}}))}ensureVideoDDExtensionForSVC(e,t){var n,i;if(!(null===(n=e.ext)||void 0===n?void 0:n.some((e=>e.uri===Kl)))){if(0===this.ddExtID){let e=0;t.media.forEach((t=>{var n;"video"===t.type&&(null===(n=t.ext)||void 0===n||n.forEach((t=>{t.value>e&&(e=t.value)})))})),this.ddExtID=e+1}null===(i=e.ext)||void 0===i||i.push({value:this.ddExtID,uri:Kl})}}}function yu(e,t,n){let i=0;e.rtp.some((e=>"opus"===e.codec&&(i=e.payload,!0))),i>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(e.mid)&&!e.rtcpFb.some((e=>e.payload===i&&"nack"===e.type))&&e.rtcpFb.push({payload:i,type:"nack"}),t.includes(e.mid)&&e.fmtp.some((e=>e.payload===i&&(e.config.includes("stereo=1")||(e.config+=";stereo=1"),!0))))}function ku(e){if(e.connection){const t=e.connection.ip.indexOf(":")>=0;(4===e.connection.version&&t||6===e.connection.version&&!t)&&(e.connection.ip="0.0.0.0",e.connection.version=4)}}const wu="vp8",Cu={audioPreset:Hl.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Gl.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:wu,backupCodec:!0,preConnectBuffer:!1},Tu={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Su={deviceId:{ideal:"default"},resolution:zl.h720.resolution},_u={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new class{constructor(e){this._retryDelays=void 0!==e?[...e]:zs}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+1e3*Math.random()}},disconnectOnPageLeave:!0,webAudioMix:!1},xu={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Eu;!function(e){e[e.NEW=0]="NEW",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED",e[e.CLOSING=4]="CLOSING",e[e.CLOSED=5]="CLOSED"}(Eu||(Eu={}));class Pu{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,t,n){var i;this.peerConnectionTimeout=xu.peerConnectionTimeout,this.log=Bs,this.updateState=()=>{var e;const t=this.state,n=this.requiredTransports.map((e=>e.getConnectionState()));n.every((e=>"connected"===e))?this.state=Eu.CONNECTED:n.some((e=>"failed"===e))?this.state=Eu.FAILED:n.some((e=>"connecting"===e))?this.state=Eu.CONNECTING:n.every((e=>"closed"===e))?this.state=Eu.CLOSED:n.some((e=>"closed"===e))?this.state=Eu.CLOSING:n.every((e=>"new"===e))&&(this.state=Eu.NEW),t!==this.state&&(this.log.debug("pc state change: from ".concat(Eu[t]," to ").concat(Eu[this.state]),this.logContext),null===(e=this.onStateChange)||void 0===e||e.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=Vs(null!==(i=n.loggerName)&&void 0!==i?i:Ls.PCManager),this.loggerOptions=n,this.isPublisherConnectionRequired=!t,this.isSubscriberConnectionRequired=t,this.publisher=new bu(e,n),this.subscriber=new bu(e,n),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,Fa.PUBLISHER)},this.subscriber.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,Fa.SUBSCRIBER)},this.subscriber.onDataChannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},this.subscriber.onTrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},this.publisher.onOffer=(e,t)=>{var n;null===(n=this.onPublisherOffer)||void 0===n||n.call(this,e,t)},this.state=Eu.NEW,this.connectionLock=new or,this.remoteOfferLock=new or}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}requirePublisher(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,t){return this.publisher.setRemoteDescription(e,t)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return Ws(this,void 0,void 0,(function*(){if(this.publisher&&"closed"!==this.publisher.getSignallingState()){const e=this.publisher;for(const t of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(t)}catch(e){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:e}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()}))}triggerIceRestart(){return Ws(this,void 0,void 0,(function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))}))}addIceCandidate(e,t){return Ws(this,void 0,void 0,(function*(){t===Fa.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)}))}createSubscriberAnswerFromOffer(e,t){return Ws(this,void 0,void 0,(function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const n=yield this.remoteOfferLock.lock();try{return(yield this.subscriber.setRemoteDescription(e,t))?yield this.subscriber.createAndSetAnswer():void 0}finally{n()}}))}updateConfiguration(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return Ws(this,void 0,void 0,(function*(){var n;const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&"connected"!==this.publisher.getConnectionState()&&"connecting"!==this.publisher.getConnectionState()&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all(null===(n=this.requiredTransports)||void 0===n?void 0:n.map((n=>this.ensureTransportConnected(n,e,t))))}finally{i()}}))}negotiate(e){return Ws(this,void 0,void 0,(function*(){return new Promise(((t,n)=>Ws(this,void 0,void 0,(function*(){const i=setTimeout((()=>{n("negotiation timed out")}),this.peerConnectionTimeout);e.signal.addEventListener("abort",(()=>{clearTimeout(i),n("negotiation aborted")})),this.publisher.once(fu,(()=>{e.signal.aborted||this.publisher.once(gu,(()=>{clearTimeout(i),t()}))})),yield this.publisher.negotiate((e=>{clearTimeout(i),n(e)}))}))))}))}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===Fa.PUBLISHER||e===Fa.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,t){return Ws(this,arguments,void 0,(function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.peerConnectionTimeout;return function*(){if("connected"!==e.getConnectionState())return new Promise(((e,r)=>Ws(n,void 0,void 0,(function*(){const n=()=>{this.log.warn("abort transport connection",this.logContext),Dl.clearTimeout(o),r(new gl("room connection has been cancelled",al.Cancelled))};null!=t&&t.signal.aborted&&n(),null==t||t.signal.addEventListener("abort",n);const o=Dl.setTimeout((()=>{null==t||t.signal.removeEventListener("abort",n),r(new gl("could not establish pc connection",al.InternalError))}),i);for(;this.state!==Eu.CONNECTED;)if(yield $l(50),null!=t&&t.signal.aborted)return void r(new gl("room connection has been cancelled",al.Cancelled));Dl.clearTimeout(o),null==t||t.signal.removeEventListener("abort",n),e()}))))}()}))}}class Ru extends Error{constructor(e,t,n){super(t),this.code=e,this.message=Ou(t,Ru.MAX_MESSAGE_BYTES),this.data=n?Ou(n,Ru.MAX_DATA_BYTES):void 0}static fromProto(e){return new Ru(e.code,e.message,e.data)}toProto(){return new Ca({code:this.code,message:this.message,data:this.data})}static builtIn(e,t){return new Ru(Ru.ErrorCode[e],Ru.ErrorMessage[e],t)}}function Iu(e){return(new TextEncoder).encode(e).length}function Ou(e,t){if(Iu(e)<=t)return e;let n=0,i=e.length;const r=new TextEncoder;for(;n<i;){const o=Math.floor((n+i+1)/2);r.encode(e.slice(0,o)).length<=t?n=o:i=o-1}return e.slice(0,n)}Ru.MAX_MESSAGE_BYTES=256,Ru.MAX_DATA_BYTES=15360,Ru.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404},Ru.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const Du=2e3;function Au(e,t){if(!t)return 0;let n,i;return"bytesReceived"in e?(n=e.bytesReceived,i=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,i=t.bytesSent),void 0===n||void 0===i||void 0===e.timestamp||void 0===t.timestamp?0:8*(n-i)*1e3/(e.timestamp-t.timestamp)}const Mu=typeof MediaRecorder<"u",Nu=Mu?MediaRecorder:class{constructor(){throw new Error("MediaRecorder is not available in this environment")}};class Lu extends Nu{constructor(e,t){if(!Mu)throw new Error("MediaRecorder is not available in this environment");let n,i;super(new MediaStream([e.mediaStreamTrack]),t);const r=()=>{this.removeEventListener("dataavailable",n),this.removeEventListener("stop",r),this.removeEventListener("error",o),null==i||i.close(),i=void 0},o=e=>{null==i||i.error(e),this.removeEventListener("dataavailable",n),this.removeEventListener("stop",r),this.removeEventListener("error",o),i=void 0};this.byteStream=new ReadableStream({start:e=>{i=e,n=t=>Ws(this,void 0,void 0,(function*(){let n;if(t.data.arrayBuffer){const e=yield t.data.arrayBuffer();n=new Uint8Array(e)}else{if(!t.data.byteArray)throw new Error("no data available!");n=t.data.byteArray}void 0===i||e.enqueue(n)})),this.addEventListener("dataavailable",n)},cancel:()=>{r()}}),this.addEventListener("stop",r),this.addEventListener("error",o)}}class Uu extends Nl{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(e,t,arguments.length>4?arguments[4]:void 0),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch((()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext))),this.debouncedTrackMuteHandler=mu((()=>Ws(this,void 0,void 0,(function*(){yield this.pauseUpstream()}))),5e3),this.handleTrackUnmuteEvent=()=>Ws(this,void 0,void 0,(function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()})),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(pl.Ended,this)},this.reacquireTrack=!1,this.providedByUser=i,this.muteLock=new or,this.pauseUpstreamLock=new or,this.trackChangeLock=new or,this.trackChangeLock.lock().then((t=>Ws(this,void 0,void 0,(function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{t()}})))),this._constraints=e.getConstraints(),n&&(this._constraints=n)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==Nl.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();return e&&t?{width:e,height:t}:void 0}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return null!==(t=null===(e=this.processor)||void 0===e?void 0:e.processedTrack)&&void 0!==t?t:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,t){return Ws(this,void 0,void 0,(function*(){var n,i;if(e===this._mediaStreamTrack&&!t)return;let r;if(this._mediaStreamTrack&&(this.attachedElements.forEach((e=>{Ul(this._mediaStreamTrack,e)})),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints()),this.processor&&e){if(this.log.debug("restarting processor",this.logContext),"unknown"===this.kind)throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Ll(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&"closed"!==(null===(i=this.sender.transport)||void 0===i?void 0:i.state)&&(yield this.sender.replaceTrack(null!==(n=r)&&void 0!==n?n:e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach((t=>{var n;Ll(null!==(n=r)&&void 0!==n?n:e,t)})))}))}waitForDimensions(){return Ws(this,arguments,void 0,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return function*(){var n;if(e.kind===Nl.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");"iOS"===(null===(n=Pl())||void 0===n?void 0:n.os)&&(yield $l(10));const i=Date.now();for(;Date.now()-i<t;){const t=e.dimensions;if(t)return t;yield $l(50)}throw new bl("unable to get track dimensions after timeout")}()}))}setDeviceId(e){return Ws(this,void 0,void 0,(function*(){return!!(this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===kd(e)||(this._constraints.deviceId=e,this.isMuted))||(yield this.restartTrack(),kd(e)===this._mediaStreamTrack.getSettings().deviceId)}))}getDeviceId(){return Ws(this,arguments,void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){if(e.source===Nl.Source.ScreenShare)return;const{deviceId:n,groupId:i}=e._mediaStreamTrack.getSettings(),r=e.kind===Nl.Kind.Audio?"audioinput":"videoinput";return t?Gd.getInstance().normalizeDeviceId(r,n,i):n}()}))}mute(){return Ws(this,void 0,void 0,(function*(){return this.setTrackMuted(!0),this}))}unmute(){return Ws(this,void 0,void 0,(function*(){return this.setTrackMuted(!1),this}))}replaceTrack(e,t){return Ws(this,void 0,void 0,(function*(){const n=yield this.trackChangeLock.lock();try{var i;if(!this.sender)throw new bl("unable to replace an unpublished track");let n,r;return"boolean"==typeof t?n=t:void 0!==t&&(n=t.userProvidedTrack,r=t.stopProcessor),this.providedByUser=null===(i=n)||void 0===i||i,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),r&&this.processor&&(yield this.internalStopProcessor()),this}finally{n()}}))}restart(e){return Ws(this,void 0,void 0,(function*(){this.manuallyStopped=!1;const t=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:t,facingMode:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const r={audio:!1,video:!1};this.kind===Nl.Kind.Video?r.video=!t&&!n||{deviceId:t,facingMode:n}:r.audio=!t||{deviceId:t},this.attachedElements.forEach((e=>{Ul(this.mediaStreamTrack,e)})),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const o=(yield navigator.mediaDevices.getUserMedia(r)).getTracks()[0];return yield o.applyConstraints(i),o.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(o),this._constraints=e,this.emit(pl.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{t()}}))}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),(this.isMuted!==e||this._mediaStreamTrack.enabled===e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?pl.Muted:pl.Unmuted,this))}get needsReAcquisition(){return"live"!==this._mediaStreamTrack.readyState||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Ws(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),nd()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))}))}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),null===(e=this.processor)||void 0===e||e.destroy(),this.processor=void 0}pauseUpstream(){return Ws(this,void 0,void 0,(function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(!0===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to pause upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!0,this.emit(pl.UpstreamPaused,this);const t=Pl();if("Safari"===(null==t?void 0:t.name)&&ld(t.version,"12.0")<0)throw new vl("pauseUpstream is not supported on Safari < 12.");"closed"!==(null===(e=this.sender.transport)||void 0===e?void 0:e.state)&&(yield this.sender.replaceTrack(null))}finally{t()}}))}resumeUpstream(){return Ws(this,void 0,void 0,(function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(!1===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to resume upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!1,this.emit(pl.UpstreamResumed,this),"closed"!==(null===(e=this.sender.transport)||void 0===e?void 0:e.state)&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{t()}}))}getRTCStatsReport(){return Ws(this,void 0,void 0,(function*(){var e;return null!==(e=this.sender)&&void 0!==e&&e.getStats?yield this.sender.getStats():void 0}))}setProcessor(e){return Ws(this,arguments,void 0,(function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i;const r=yield t.trackChangeLock.lock();try{t.log.debug("setting up processor",t.logContext);const r=document.createElement(t.kind),o={kind:t.kind,track:t._mediaStreamTrack,element:r,audioContext:t.audioContext};if(yield e.init(o),t.log.debug("processor initialized",t.logContext),t.processor&&(yield t.internalStopProcessor()),"unknown"===t.kind)throw TypeError("cannot set processor on track of unknown kind");if(Ll(t._mediaStreamTrack,r),r.muted=!0,r.play().catch((e=>{e instanceof DOMException&&"AbortError"===e.name?(t.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},t.logContext),{error:e})),setTimeout((()=>{r.play().catch((e=>{t.log.error("failed to play processor element",Object.assign(Object.assign({},t.logContext),{err:e}))}))}),100)):t.log.error("failed to play processor element",Object.assign(Object.assign({},t.logContext),{error:e}))})),t.processor=e,t.processorElement=r,t.processor.processedTrack){for(const e of t.attachedElements)e!==t.processorElement&&n&&(Ul(t._mediaStreamTrack,e),Ll(t.processor.processedTrack,e));yield null===(i=t.sender)||void 0===i?void 0:i.replaceTrack(t.processor.processedTrack)}t.emit(pl.TrackProcessorUpdate,t.processor)}finally{r()}}()}))}getProcessor(){return this.processor}stopProcessor(){return Ws(this,arguments,void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){const n=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(t)}finally{n()}}()}))}internalStopProcessor(){return Ws(this,arguments,void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,i;e.processor&&(e.log.debug("stopping processor",e.logContext),null===(n=e.processor.processedTrack)||void 0===n||n.stop(),yield e.processor.destroy(),e.processor=void 0,t||(null===(i=e.processorElement)||void 0===i||i.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(pl.TrackProcessorUpdate))}()}))}startPreConnectBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;if(Mu)if(this.localTrackRecorder)this.log.warn("preconnect buffer already started");else{{let e="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(e)||(e="video/mp4"),this.localTrackRecorder=new Lu(this,{mimeType:e})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout((()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()}),1e4)}else this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return null===(e=this.localTrackRecorder)||void 0===e?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return null===(e=this.localTrackRecorder)||void 0===e?void 0:e.mimeType}}class Fu extends Uu{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;super(e,Nl.Kind.Audio,t,n,r),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>Ws(this,void 0,void 0,(function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(e){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:e}))}e&&this.prevStats&&(this._currentBitrate=Au(e,this.prevStats)),this.prevStats=e})),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(pl.AudioTrackFeatureUpdate,this,Qo.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(pl.AudioTrackFeatureUpdate,this,Qo.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=i,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return Ws(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Nl.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}}))}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return Ws(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const t=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==kd(this._constraints.deviceId);return this.source===Nl.Source.Microphone&&(this.stopOnMute||"ended"===this._mediaStreamTrack.readyState||t)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}}))}restartTrack(e){return Ws(this,void 0,void 0,(function*(){let t;if(e){const n=Nd({audio:e});"boolean"!=typeof n.audio&&(t=n.audio)}yield this.restart(t)}))}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return Ws(this,void 0,void 0,(function*(){const n=yield t.restart.call(this,e);return this.checkForSilence(),n}))}startMonitor(){id()&&(this.monitorInterval||(this.monitorInterval=setInterval((()=>{this.monitorSender()}),Du)))}setProcessor(e){return Ws(this,void 0,void 0,(function*(){var t;const n=yield this.trackChangeLock.lock();try{if(!rd()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const n={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(n),this.processor=e,this.processor.processedTrack&&(yield null===(t=this.sender)||void 0===t?void 0:t.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(pl.TrackProcessorUpdate,this.processor)}finally{n()}}))}setAudioContext(e){this.audioContext=e}getSenderStats(){return Ws(this,void 0,void 0,(function*(){var e;if(null===(e=this.sender)||void 0===e||!e.getStats)return;let t;return(yield this.sender.getStats()).forEach((e=>{"outbound-rtp"===e.type&&(t={type:"audio",streamId:e.id,packetsSent:e.packetsSent,packetsLost:e.packetsLost,bytesSent:e.bytesSent,timestamp:e.timestamp,roundTripTime:e.roundTripTime,jitter:e.jitter})})),t}))}checkForSilence(){return Ws(this,void 0,void 0,(function*(){const e=yield function(e){return Ws(this,arguments,void 0,(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return function*(){const n=Ld();if(n){const i=n.createAnalyser();i.fftSize=2048;const r=i.frequencyBinCount,o=new Uint8Array(r);n.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield $l(t),i.getByteTimeDomainData(o);const a=o.some((e=>128!==e&&0!==e));return n.close(),!a}return!1}()}))}(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(pl.AudioSilenceDetected)),e}))}}const ju=Object.values(zl),Bu=Object.values(Wl),Vu=Object.values(Gl),qu=[zl.h180,zl.h360],Hu=[Wl.h180,Wl.h360],zu=["q","h","f"];function Wu(e,t,n,i){var r,o;let a=null==i?void 0:i.videoEncoding;e&&(a=null==i?void 0:i.screenShareEncoding);const s=null==i?void 0:i.simulcast,c=null==i?void 0:i.scalabilityMode,l=null==i?void 0:i.videoCodec;if(!a&&!s&&!c||!t||!n)return[{}];a||(a=function(e,t,n,i){const r=function(e,t,n){if(e)return Vu;const i=t>n?t/n:n/t;return Math.abs(i-16/9)<Math.abs(i-4/3)?ju:Bu}(e,t,n);let{encoding:o}=r[0];const a=Math.max(t,n);for(let e=0;e<r.length;e+=1){const t=r[e];if(o=t.encoding,t.width>=a)break}if(i)switch(i){case"av1":case"h265":o=Object.assign({},o),o.maxBitrate=.7*o.maxBitrate;break;case"vp9":o=Object.assign({},o),o.maxBitrate=.85*o.maxBitrate}return o}(e,t,n,l),Bs.debug("using video encoding",a));const d=a.maxFramerate,u=new Fl(t,n,a.maxBitrate,a.maxFramerate,a.priority);if(c&&Xl(l)){const e=new Ju(c),t=[];if(e.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const n=Pl();if(td()||rd()||"Chrome"===(null==n?void 0:n.name)&&ld(null==n?void 0:n.version,"113")<0){const i="h"==e.suffix?2:3,r=function(e){return e||(e=Pl()),"Safari"===(null==e?void 0:e.name)&&ld(e.version,"18.3")>0||"iOS"===(null==e?void 0:e.os)&&!(null==e||!e.osVersion)&&ld(e.osVersion,"18.3")>0}(n);for(let n=0;n<e.spatial;n+=1)t.push({rid:zu[2-n],maxBitrate:a.maxBitrate/Math.pow(i,n),maxFramerate:u.encoding.maxFramerate,scaleResolutionDownBy:r?Math.pow(2,n):void 0});t[0].scalabilityMode=c}else t.push({maxBitrate:a.maxBitrate,maxFramerate:u.encoding.maxFramerate,scalabilityMode:c});return u.encoding.priority&&(t[0].priority=u.encoding.priority,t[0].networkPriority=u.encoding.priority),Bs.debug("using svc encoding",{encodings:t}),t}if(!s)return[a];let h,p=[];if(p=e?null!==(r=$u(null==i?void 0:i.screenShareSimulcastLayers))&&void 0!==r?r:Gu(e,u):null!==(o=$u(null==i?void 0:i.videoSimulcastLayers))&&void 0!==o?o:Gu(e,u),p.length>0){const e=p[0];p.length>1&&([,h]=p);const i=Math.max(t,n);if(i>=960&&h)return Ku(t,n,[e,h,u],d);if(i>=480)return Ku(t,n,[e,u],d)}return Ku(t,n,[u])}function Gu(e,t){if(e)return(e=>[{scaleResolutionDownBy:2,fps:e.encoding.maxFramerate}].map((t=>{var n,i;return new Fl(Math.floor(e.width/t.scaleResolutionDownBy),Math.floor(e.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(e.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*((null!==(n=e.encoding.maxFramerate)&&void 0!==n?n:30)/(null!==(i=t.fps)&&void 0!==i?i:30))))),t.fps,e.encoding.priority)})))(t);const{width:n,height:i}=t,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?qu:Hu}function Ku(e,t,n,i){const r=[];if(n.forEach(((n,o)=>{if(o>=zu.length)return;const a=Math.min(e,t),s={rid:zu[o],scaleResolutionDownBy:Math.max(1,a/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate},c=i&&n.encoding.maxFramerate?Math.min(i,n.encoding.maxFramerate):n.encoding.maxFramerate;c&&(s.maxFramerate=c);const l=Zl()||0===o;n.encoding.priority&&l&&(s.priority=n.encoding.priority,s.networkPriority=n.encoding.priority),r.push(s)})),rd()&&"ios"===sd()){let e;r.forEach((t=>{e?t.maxFramerate&&t.maxFramerate>e&&(e=t.maxFramerate):e=t.maxFramerate}));let t=!0;r.forEach((n=>{var i;n.maxFramerate!=e&&(t&&(t=!1,Bs.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Bs.info('Setting framerate of encoding "'.concat(null!==(i=n.rid)&&void 0!==i?i:"",'" to ').concat(e)),n.maxFramerate=e)}))}return r}function $u(e){if(e)return e.sort(((e,t)=>{const{encoding:n}=e,{encoding:i}=t;return n.maxBitrate>i.maxBitrate?1:n.maxBitrate<i.maxBitrate?-1:n.maxBitrate===i.maxBitrate&&n.maxFramerate&&i.maxFramerate?n.maxFramerate>i.maxFramerate?1:-1:0}))}class Ju{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat(null!==(e=this.suffix)&&void 0!==e?e:"")}}class Yu extends Uu{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0;super(e,Nl.Kind.Video,t,n,i),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>Ws(this,void 0,void 0,(function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(e){return void this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:e}))}const t=new Map(e.map((e=>[e.rid,e]))),n=e.some((e=>"cpu"===e.qualityLimitationReason));if(n!==this.isCpuConstrained&&(this.isCpuConstrained=n,this.isCpuConstrained&&this.emit(pl.CpuConstrained)),this.prevStats){let e=0;t.forEach(((t,n)=>{var i;const r=null===(i=this.prevStats)||void 0===i?void 0:i.get(n);e+=Au(t,r)})),this._currentBitrate=e}this.prevStats=t})),this.senderLock=new or}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!id())return;const n=null===(t=this.sender)||void 0===t?void 0:t.getParameters();n&&(this.encodings=n.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval((()=>{this.monitorSender()}),Du))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach((e=>{e.mediaStreamTrack.stop()})),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return Ws(this,void 0,void 0,(function*(){var t,n,i,r,o;yield e.pauseUpstream.call(this);try{for(var a,s=!0,c=Gs(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);s=!0)r=a.value,s=!1,yield null===(o=r.sender)||void 0===o?void 0:o.replaceTrack(null)}catch(e){n={error:e}}finally{try{!s&&!t&&(i=c.return)&&(yield i.call(c))}finally{if(n)throw n.error}}}))}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return Ws(this,void 0,void 0,(function*(){var t,n,i,r,o;yield e.resumeUpstream.call(this);try{for(var a,s=!0,c=Gs(this.simulcastCodecs.values());!(t=(a=yield c.next()).done);s=!0){r=a.value,s=!1;const e=r;yield null===(o=e.sender)||void 0===o?void 0:o.replaceTrack(e.mediaStreamTrack)}}catch(e){n={error:e}}finally{try{!s&&!t&&(i=c.return)&&(yield i.call(c))}finally{if(n)throw n.error}}}))}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return Ws(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===Nl.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}}))}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return Ws(this,void 0,void 0,(function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source===Nl.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}}))}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return Ws(this,void 0,void 0,(function*(){var e;if(null===(e=this.sender)||void 0===e||!e.getStats)return[];const t=[],n=yield this.sender.getStats();return n.forEach((e=>{var i;if("outbound-rtp"===e.type){const r={type:"video",streamId:e.id,frameHeight:e.frameHeight,frameWidth:e.frameWidth,framesPerSecond:e.framesPerSecond,framesSent:e.framesSent,firCount:e.firCount,pliCount:e.pliCount,nackCount:e.nackCount,packetsSent:e.packetsSent,bytesSent:e.bytesSent,qualityLimitationReason:e.qualityLimitationReason,qualityLimitationDurations:e.qualityLimitationDurations,qualityLimitationResolutionChanges:e.qualityLimitationResolutionChanges,rid:null!==(i=e.rid)&&void 0!==i?i:e.id,retransmittedPacketsSent:e.retransmittedPacketsSent,targetBitrate:e.targetBitrate,timestamp:e.timestamp},o=n.get(e.remoteId);o&&(r.jitter=o.jitter,r.packetsLost=o.packetsLost,r.roundTripTime=o.roundTripTime),t.push(r)}})),t.sort(((e,t)=>{var n,i;return(null!==(n=t.frameWidth)&&void 0!==n?n:0)-(null!==(i=e.frameWidth)&&void 0!==i?i:0)})),t}))}setPublishingQuality(e){const t=[];for(let n=Ml.LOW;n<=Ml.HIGH;n+=1)t.push(new ms({quality:n,enabled:n<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(Xl(this.codec),t)}restartTrack(e){return Ws(this,void 0,void 0,(function*(){var t,n,i,r,o;let a;if(e){const t=Nd({video:e});"boolean"!=typeof t.video&&(a=t.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var s,c=!0,l=Gs(this.simulcastCodecs.values());!(t=(s=yield l.next()).done);c=!0){r=s.value,c=!1;const e=r;e.sender&&"closed"!==(null===(o=e.sender.transport)||void 0===o?void 0:o.state)&&(e.mediaStreamTrack=this.mediaStreamTrack.clone(),yield e.sender.replaceTrack(e.mediaStreamTrack))}}catch(e){n={error:e}}finally{try{!c&&!t&&(i=l.return)&&(yield i.call(l))}finally{if(n)throw n.error}}}))}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return Ws(this,arguments,void 0,(function(e){var n=this;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var r,o,a,s,c,l;if(yield t.setProcessor.call(n,e,i),null!==(c=n.processor)&&void 0!==c&&c.processedTrack)try{for(var d,u=!0,h=Gs(n.simulcastCodecs.values());!(r=(d=yield h.next()).done);u=!0)s=d.value,u=!1,yield null===(l=s.sender)||void 0===l?void 0:l.replaceTrack(n.processor.processedTrack)}catch(e){o={error:e}}finally{try{!u&&!r&&(a=h.return)&&(yield a.call(h))}finally{if(o)throw o.error}}}()}))}setDegradationPreference(e){return Ws(this,void 0,void 0,(function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(e){this.log.warn("failed to set degradationPreference",Object.assign({error:e},this.logContext))}}))}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e))return void this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);const n={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,n),n}setSimulcastTrackSender(e,t){const n=this.simulcastCodecs.get(e);n&&(n.sender=t,setTimeout((()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)}),5e3))}setPublishingCodecs(e){return Ws(this,void 0,void 0,(function*(){var t,n,i,r,o,a,s;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(Xl(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(t=!0,n=Gs(e);!(r=(i=yield n.next()).done);t=!0){s=i.value,t=!1;const e=s;if(this.codec&&this.codec!==e.codec){const t=this.simulcastCodecs.get(e.codec);if(this.log.debug("try setPublishingCodec for ".concat(e.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:t})),t&&t.sender)t.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(e.codec),this.logContext),yield Xu(t.sender,t.encodings,e.qualities,this.senderLock,Xl(e.codec),this.log,this.logContext));else for(const t of e.qualities)if(t.enabled){c.push(e.codec);break}}else yield this.setPublishingLayers(Xl(e.codec),e.qualities)}}catch(e){o={error:e}}finally{try{!t&&!r&&(a=n.return)&&(yield a.call(n))}finally{if(o)throw o.error}}return c}))}setPublishingLayers(e,t){return Ws(this,void 0,void 0,(function*(){this.optimizeForPerformance?this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:t})):(this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:t})),this.sender&&this.encodings&&(yield Xu(this.sender,this.encodings,t,this.senderLock,e,this.log,this.logContext)))}))}prioritizePerformance(){return Ws(this,void 0,void 0,(function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const e=this.sender.getParameters();e.encodings=e.encodings.map(((e,t)=>{var n;return Object.assign(Object.assign({},e),{active:0===t,scaleResolutionDownBy:Math.max(1,Math.ceil((null!==(n=this.mediaStreamTrack.getSettings().height)&&void 0!==n?n:360)/360)),scalabilityMode:0===t&&Xl(this.codec)?"L1T3":void 0,maxFramerate:0===t?15:0,maxBitrate:0===t?e.maxBitrate:0})})),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:e.encodings})),this.encodings=e.encodings,yield this.sender.setParameters(e)}catch(e){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:e})),this.optimizeForPerformance=!1}finally{e()}}))}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Ws(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),nd()&&this.isInBackground&&this.source===Nl.Source.Camera&&(this._mediaStreamTrack.enabled=!1)}))}}function Xu(e,t,n,i,r,o,a){return Ws(this,void 0,void 0,(function*(){const s=yield i.lock();o.debug("setPublishingLayersForSender",Object.assign(Object.assign({},a),{sender:e,qualities:n,senderEncodings:t}));try{const i=e.getParameters(),{encodings:s}=i;if(!s)return;if(s.length!==t.length)return void o.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},a),{encodings:s,senderEncodings:t}));let c=!1;r&&n.some((e=>e.enabled))&&n.forEach((e=>e.enabled=!0)),s.forEach(((e,i)=>{var r;let s=null!==(r=e.rid)&&void 0!==r?r:"";""===s&&(s="q");const l=Qu(s),d=n.find((e=>e.quality===l));d&&e.active!==d.enabled&&(c=!0,e.active=d.enabled,o.debug("setting layer ".concat(d.quality," to ").concat(e.active?"enabled":"disabled"),a),Zl()&&(d.enabled?(e.scaleResolutionDownBy=t[i].scaleResolutionDownBy,e.maxBitrate=t[i].maxBitrate,e.maxFrameRate=t[i].maxFrameRate):(e.scaleResolutionDownBy=4,e.maxBitrate=10,e.maxFrameRate=2)))})),c&&(i.encodings=s,o.debug("setting encodings",Object.assign(Object.assign({},a),{encodings:i.encodings})),yield e.setParameters(i))}finally{s()}}))}function Qu(e){switch(e){case"f":default:return Ml.HIGH;case"h":return Ml.MEDIUM;case"q":return Ml.LOW}}function Zu(e,t,n,i){if(!n)return[new la({quality:Ml.HIGH,width:e,height:t,bitrate:0,ssrc:0})];if(i){const i=n[0].scalabilityMode,r=new Ju(i),o=[],a="h"==r.suffix?1.5:2,s="h"==r.suffix?2:3;for(let i=0;i<r.spatial;i+=1)o.push(new la({quality:Math.min(Ml.HIGH,r.spatial-1)-i,width:Math.ceil(e/Math.pow(a,i)),height:Math.ceil(t/Math.pow(a,i)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(s,i)):0,ssrc:0}));return o}return n.map((n=>{var i,r,o;const a=null!==(i=n.scaleResolutionDownBy)&&void 0!==i?i:1;let s=Qu(null!==(r=n.rid)&&void 0!==r?r:"");return new la({quality:s,width:Math.ceil(e/a),height:Math.ceil(t/a),bitrate:null!==(o=n.maxBitrate)&&void 0!==o?o:0,ssrc:0})}))}const eh="_lossy",th="_reliable",nh="leave-reconnect";var ih,rh,oh,ah;!function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"}(ih||(ih={}));class sh extends Js.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=xu.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=ih.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Bs,this.reliableDataSequence=1,this.reliableMessageBuffer=new tu,this.reliableReceivedState=new nu(3e4),this.handleDataChannel=e=>Ws(this,[e],void 0,(function(e){var t=this;let{channel:n}=e;return function*(){if(n){if(n.label===th)t.reliableDCSub=n;else{if(n.label!==eh)return;t.lossyDCSub=n}t.log.debug("on data channel ".concat(n.id,", ").concat(n.label),t.logContext),n.onmessage=t.handleDataMessage}}()})),this.handleDataMessage=e=>Ws(this,void 0,void 0,(function*(){var t,n;const i=yield this.dataProcessLock.lock();try{let i;if(e.data instanceof ArrayBuffer)i=e.data;else{if(!(e.data instanceof Blob))return void this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:e.data}));i=yield e.data.arrayBuffer()}const r=da.fromBinary(new Uint8Array(i));if(r.sequence>0&&""!==r.participantSid){const e=this.reliableReceivedState.get(r.participantSid);if(e&&r.sequence<=e)return;this.reliableReceivedState.set(r.participantSid,r.sequence)}"speaker"===(null===(t=r.value)||void 0===t?void 0:t.case)?this.emit(hl.ActiveSpeakersUpdate,r.value.value.speakers):("user"===(null===(n=r.value)||void 0===n?void 0:n.case)&&function(e,t){const n=e.participantIdentity?e.participantIdentity:t.participantIdentity;e.participantIdentity=n,t.participantIdentity=n;const i=0!==e.destinationIdentities.length?e.destinationIdentities:t.destinationIdentities;e.destinationIdentities=i,t.destinationIdentities=i}(r,r.value.value),this.emit(hl.DataPacketReceived,r))}finally{i()}})),this.handleDataError=e=>{const t=0===e.currentTarget.maxRetransmits?"lossy":"reliable";if(e instanceof ErrorEvent&&e.error){const{error:n}=e.error;this.log.error("DataChannel error on ".concat(t,": ").concat(e.message),Object.assign(Object.assign({},this.logContext),{error:n}))}else this.log.error("Unknown DataChannel error on ".concat(t),Object.assign(Object.assign({},this.logContext),{event:e}))},this.handleBufferedAmountLow=e=>{const t=0===e.currentTarget.maxRetransmits?ua.LOSSY:ua.RELIABLE;this.updateAndEmitDCBufferStatus(t)},this.handleDisconnect=(e,t)=>{if(this._isClosed)return;this.log.warn("".concat(e," disconnected"),this.logContext),0===this.reconnectAttempts&&(this.reconnectStart=Date.now());const n=Date.now()-this.reconnectStart;let i=this.getNextRetryDelay({elapsedMs:n,retryCount:this.reconnectAttempts});null!==i?(e===nh&&(i=0),this.log.debug("reconnecting in ".concat(i,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Dl.setTimeout((()=>this.attemptReconnect(t).finally((()=>this.reconnectTimeout=void 0))),i)):(e=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(e,"ms. giving up"),this.logContext),this.emit(hl.Disconnected),this.close()})(n)},this.waitForRestarted=()=>new Promise(((e,t)=>{this.pcState===ih.Connected&&e();const n=()=>{this.off(hl.Disconnected,i),e()},i=()=>{this.off(hl.Restarted,n),t()};this.once(hl.Restarted,n),this.once(hl.Disconnected,i)})),this.updateAndEmitDCBufferStatus=e=>{const t=this.isBufferStatusLow(e);typeof t<"u"&&t!==this.dcBufferStatus.get(e)&&(this.dcBufferStatus.set(e,t),this.emit(hl.DCBufferStatusChanged,t,e))},this.isBufferStatusLow=e=>{const t=this.dataChannelForKind(e);if(t)return e===ua.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(t.bufferedAmount),t.bufferedAmount<=t.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===Xd.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(Yo.RR_SIGNAL_DISCONNECTED))},this.log=Vs(null!==(t=e.loggerName)&&void 0!==t?t:Ls.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Qd(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new or,this.dataProcessLock=new or,this.dcBufferStatus=new Map([[ua.LOSSY,!0],[ua.RELIABLE,!0]]),this.client.onParticipantUpdate=e=>this.emit(hl.ParticipantUpdate,e),this.client.onConnectionQuality=e=>this.emit(hl.ConnectionQualityUpdate,e),this.client.onRoomUpdate=e=>this.emit(hl.RoomUpdate,e),this.client.onSubscriptionError=e=>this.emit(hl.SubscriptionError,e),this.client.onSubscriptionPermissionUpdate=e=>this.emit(hl.SubscriptionPermissionUpdate,e),this.client.onSpeakersChanged=e=>this.emit(hl.SpeakersChanged,e),this.client.onStreamStateUpdate=e=>this.emit(hl.StreamStateChanged,e),this.client.onRequestResponse=e=>this.emit(hl.SignalRequestResponse,e)}get logContext(){var e,t,n,i,r,o;return{room:null===(t=null===(e=this.latestJoinResponse)||void 0===e?void 0:e.room)||void 0===t?void 0:t.name,roomID:null===(i=null===(n=this.latestJoinResponse)||void 0===n?void 0:n.room)||void 0===i?void 0:i.sid,participant:null===(o=null===(r=this.latestJoinResponse)||void 0===r?void 0:r.participant)||void 0===o?void 0:o.identity,pID:this.participantSid}}join(e,t,n,i){return Ws(this,void 0,void 0,(function*(){this.url=e,this.token=t,this.signalOpts=n,this.maxJoinAttempts=n.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const r=yield this.client.join(e,t,n,i);return this._isClosed=!1,this.latestJoinResponse=r,this.subscriberPrimary=r.subscriberPrimary,this.pcManager||(yield this.configure(r)),(!this.subscriberPrimary||r.fastPublish)&&this.negotiate(),this.clientConfiguration=r.clientConfiguration,this.emit(hl.SignalConnected,r),r}catch(r){if(r instanceof gl&&r.reason===al.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,n,i);throw r}}))}close(){return Ws(this,void 0,void 0,(function*(){const e=yield this.closingLock.lock();if(this.isClosed)e();else try{this._isClosed=!0,this.joinAttempts=0,this.emit(hl.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}}))}cleanupPeerConnections(){return Ws(this,void 0,void 0,(function*(){var e;yield null===(e=this.pcManager)||void 0===e?void 0:e.close(),this.pcManager=void 0;const t=e=>{e&&(e.close(),e.onbufferedamountlow=null,e.onclose=null,e.onclosing=null,e.onerror=null,e.onmessage=null,e.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new tu,this.reliableDataSequence=1,this.reliableReceivedState.clear()}))}cleanupClient(){return Ws(this,void 0,void 0,(function*(){yield this.client.close(),this.client.resetCallbacks()}))}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new bl("a track with the same ID has already been published");return new Promise(((t,n)=>{const i=setTimeout((()=>{delete this.pendingTrackResolvers[e.cid],n(new gl("publication of local track timed out, no response from server",al.Timeout))}),1e4);this.pendingTrackResolvers[e.cid]={resolve:e=>{clearTimeout(i),t(e)},reject:()=>{clearTimeout(i),n(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)}))}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(e){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:e}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return null===(e=this.reliableDCSub)||void 0===e?void 0:e.readyState}getConnectedServerAddress(){return Ws(this,void 0,void 0,(function*(){var e;return null===(e=this.pcManager)||void 0===e?void 0:e.getConnectedAddress()}))}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return Ws(this,void 0,void 0,(function*(){var t,n;if(this.pcManager&&this.pcManager.currentState!==Eu.NEW)return;this.participantSid=null===(t=e.participant)||void 0===t?void 0:t.sid;const i=this.makeRTCConfiguration(e);this.pcManager=new Pu(i,e.subscriberPrimary,this.loggerOptions),this.emit(hl.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(e,t)=>{this.client.sendIceCandidate(e,t)},this.pcManager.onPublisherOffer=(e,t)=>{this.client.sendOffer(e,t)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(t,n,i)=>Ws(this,void 0,void 0,(function*(){if(this.log.debug("primary PC state changed ".concat(t),this.logContext),["closed","disconnected","failed"].includes(n)&&(this.publisherConnectionPromise=void 0),t===Eu.CONNECTED){const t=this.pcState===ih.New;this.pcState=ih.Connected,t&&this.emit(hl.Connected,e)}else t===Eu.FAILED&&this.pcState===ih.Connected&&(this.pcState=ih.Disconnected,this.handleDisconnect("peerconnection failed","failed"===i?Yo.RR_SUBSCRIBER_FAILED:Yo.RR_PUBLISHER_FAILED));const r=this.client.isDisconnected||this.client.currentState===Xd.RECONNECTING,o=[Eu.FAILED,Eu.CLOSING,Eu.CLOSED].includes(t);r&&o&&!this._isClosed&&this.emit(hl.Offline)})),this.pcManager.onTrack=e=>{this.emit(hl.MediaTrackAdded,e.track,e.streams[0],e.receiver)},function(e){return void 0!==e&&e>13}(null===(n=e.serverInfo)||void 0===n?void 0:n.protocol)||this.createDataChannels()}))}setupSignalClientCallbacks(){this.client.onAnswer=(e,t)=>Ws(this,void 0,void 0,(function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e,t))})),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=(e,t)=>Ws(this,void 0,void 0,(function*(){if(this.latestRemoteOfferId=t,!this.pcManager)return;const n=yield this.pcManager.createSubscriberAnswerFromOffer(e,t);n&&this.client.sendAnswer(n,t)})),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:null===(t=e.track)||void 0===t?void 0:t.sid})),!this.pendingTrackResolvers[e.cid])return void this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));const{resolve:n}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],n(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(hl.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(hl.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(hl.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(hl.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var t;this.participantSid=null===(t=e.participant)||void 0===t?void 0:t.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(hl.RoomMoved,e)},this.client.onClose=()=>{this.handleDisconnect("signal",Yo.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:null==e?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case rs.DISCONNECT:this.emit(hl.Disconnected,null==e?void 0:e.reason),this.close();break;case rs.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(nh);break;case rs.RESUME:this.handleDisconnect(nh)}}}makeRTCConfiguration(e){var t;const n=Object.assign({},this.rtcConfig);if(!(null===(t=this.signalOpts)||void 0===t)&&t.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),n.encodedInsertableStreams=!0),e.iceServers&&!n.iceServers){const t=[];e.iceServers.forEach((e=>{const n={urls:e.urls};e.username&&(n.username=e.username),e.credential&&(n.credential=e.credential),t.push(n)})),n.iceServers=t}return e.clientConfiguration&&e.clientConfiguration.forceRelay===$o.ENABLED&&(n.iceTransportPolicy="relay"),n.sdpSemantics="unified-plan",n.continualGatheringPolicy="gather_continually",n}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(eh,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(th,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,t,n){return Ws(this,void 0,void 0,(function*(){if(Jl())return yield this.createTransceiverRTCRtpSender(e,t,n);if(Yl())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new kl("Required webRTC APIs not supported on this device")}))}createSimulcastSender(e,t,n,i){return Ws(this,void 0,void 0,(function*(){if(Jl())return this.createSimulcastTransceiverSender(e,t,n,i);if(Yl())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new kl("Cannot stream on this device")}))}createTransceiverRTCRtpSender(e,t,n){return Ws(this,void 0,void 0,(function*(){if(!this.pcManager)throw new kl("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream),Ed(e)&&(e.codec=t.videoCodec);const r={direction:"sendonly",streams:i};return n&&(r.sendEncodings=n),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,r)).sender}))}createSimulcastTransceiverSender(e,t,n,i){return Ws(this,void 0,void 0,(function*(){if(!this.pcManager)throw new kl("publisher is closed");const r={direction:"sendonly"};i&&(r.sendEncodings=i);const o=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,r);if(n.videoCodec)return e.setSimulcastTrackSender(n.videoCodec,o.sender),o.sender}))}createRTCRtpSender(e){return Ws(this,void 0,void 0,(function*(){if(!this.pcManager)throw new kl("publisher is closed");return this.pcManager.addPublisherTrack(e)}))}attemptReconnect(e){return Ws(this,void 0,void 0,(function*(){var t,n,i;if(!this._isClosed){if(this.attemptingReconnect)return void Bs.warn("already attempting reconnect, returning early",this.logContext);((null===(t=this.clientConfiguration)||void 0===t?void 0:t.resumeConnection)===$o.DISABLED||(null!==(i=null===(n=this.pcManager)||void 0===n?void 0:n.currentState)&&void 0!==i?i:Eu.NEW)===Eu.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(e){this.reconnectAttempts+=1;let t=!0;e instanceof kl?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:e})),t=!1):e instanceof ch||(this.fullReconnectOnNext=!0),t?this.handleDisconnect("reconnect",Yo.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(hl.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}}))}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(e){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:e}))}return null}restartConnection(e){return Ws(this,void 0,void 0,(function*(){var t,n,i;try{if(!this.url||!this.token)throw new kl("could not reconnect, url or token not saved");let n;this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(hl.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new ch;n=yield this.join(null!=e?e:this.url,this.token,this.signalOpts)}catch(e){throw e instanceof gl&&e.reason===al.NotAllowed?new kl("could not reconnect, token might be expired"):new ch}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(hl.SignalRestarted,n),yield this.waitForPCReconnected(),this.client.currentState!==Xd.CONNECTED)throw new ch("Signal connection got severed during reconnect");null===(t=this.regionUrlProvider)||void 0===t||t.resetAttempts(),this.emit(hl.Restarted)}catch(e){const t=yield null===(n=this.regionUrlProvider)||void 0===n?void 0:n.getNextBestRegionUrl();if(t)return void(yield this.restartConnection(t));throw null===(i=this.regionUrlProvider)||void 0===i||i.resetAttempts(),e}}))}resumeConnection(e){return Ws(this,void 0,void 0,(function*(){var t;if(!this.url||!this.token)throw new kl("could not reconnect, url or token not saved");if(!this.pcManager)throw new kl("publisher and subscriber connections unset");let n;this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(hl.Resuming);try{this.setupSignalClientCallbacks(),n=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(e){let t="";throw e instanceof Error&&(t=e.message,this.log.error(e.message,Object.assign(Object.assign({},this.logContext),{error:e}))),e instanceof gl&&e.reason===al.NotAllowed?new kl("could not reconnect, token might be expired"):e instanceof gl&&e.reason===al.LeaveRequest?e:new ch(t)}if(this.emit(hl.SignalResumed),n){const e=this.makeRTCConfiguration(n);this.pcManager.updateConfiguration(e),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=n.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Xd.CONNECTED)throw new ch("Signal connection got severed during reconnect");this.client.setReconnected(),"open"===(null===(t=this.reliableDC)||void 0===t?void 0:t.readyState)&&null===this.reliableDC.id&&this.createDataChannels(),null!=n&&n.lastMessageSeq&&this.resendReliableMessagesForResume(n.lastMessageSeq),this.emit(hl.Resumed)}))}waitForPCInitialConnection(e,t){return Ws(this,void 0,void 0,(function*(){if(!this.pcManager)throw new kl("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)}))}waitForPCReconnected(){return Ws(this,void 0,void 0,(function*(){this.pcState=ih.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield $l(2e3),!this.pcManager)throw new kl("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=ih.Connected}catch(e){throw this.pcState=ih.Disconnected,new gl("could not establish PC connection, ".concat(e.message),al.InternalError)}}))}publishRpcResponse(e,t,n,i){return Ws(this,void 0,void 0,(function*(){const r=new da({destinationIdentities:[e],kind:ua.RELIABLE,value:{case:"rpcResponse",value:new wa({requestId:t,value:i?{case:"error",value:i.toProto()}:{case:"payload",value:null!=n?n:""}})}});yield this.sendDataPacket(r,ua.RELIABLE)}))}publishRpcAck(e,t){return Ws(this,void 0,void 0,(function*(){const n=new da({destinationIdentities:[e],kind:ua.RELIABLE,value:{case:"rpcAck",value:new ka({requestId:t})}});yield this.sendDataPacket(n,ua.RELIABLE)}))}sendDataPacket(e,t){return Ws(this,void 0,void 0,(function*(){yield this.ensurePublisherConnected(t),t===ua.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const n=e.toBinary(),i=this.dataChannelForKind(t);if(i){if(t===ua.RELIABLE&&this.reliableMessageBuffer.push({data:n,sequence:e.sequence}),this.attemptingReconnect)return;i.send(n)}this.updateAndEmitDCBufferStatus(t)}))}resendReliableMessagesForResume(e){return Ws(this,void 0,void 0,(function*(){yield this.ensurePublisherConnected(ua.RELIABLE);const t=this.dataChannelForKind(ua.RELIABLE);t&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach((e=>{t.send(e.data)}))),this.updateAndEmitDCBufferStatus(ua.RELIABLE)}))}waitForBufferStatusLow(e){return new Promise(((t,n)=>Ws(this,void 0,void 0,(function*(){if(this.isBufferStatusLow(e))t();else{const i=()=>n("Engine closed");for(this.once(hl.Closing,i);!this.dcBufferStatus.get(e);)yield $l(10);this.off(hl.Closing,i),t()}}))))}ensureDataTransportConnected(e){return Ws(this,arguments,void 0,(function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.subscriberPrimary;return function*(){var i;if(!t.pcManager)throw new kl("PC manager is closed");const r=n?t.pcManager.subscriber:t.pcManager.publisher,o=n?"Subscriber":"Publisher";if(!r)throw new gl("".concat(o," connection not set"),al.InternalError);let a=!1;!n&&!t.dataChannelForKind(e,n)&&(t.createDataChannels(),a=!0),!a&&!n&&!t.pcManager.publisher.isICEConnected&&"checking"!==t.pcManager.publisher.getICEConnectionState()&&(a=!0),a&&t.negotiate();const s=t.dataChannelForKind(e,n);if("open"===(null==s?void 0:s.readyState))return;const c=(new Date).getTime()+t.peerConnectionTimeout;for(;(new Date).getTime()<c;){if(r.isICEConnected&&"open"===(null===(i=t.dataChannelForKind(e,n))||void 0===i?void 0:i.readyState))return;yield $l(50)}throw new gl("could not establish ".concat(o," connection, state: ").concat(r.getICEConnectionState()),al.InternalError)}()}))}ensurePublisherConnected(e){return Ws(this,void 0,void 0,(function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise}))}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==Eu.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return Ws(this,void 0,void 0,(function*(){return new Promise(((e,t)=>Ws(this,void 0,void 0,(function*(){if(!this.pcManager)return void t(new wl("PC manager is closed"));this.pcManager.requirePublisher(),0==this.pcManager.publisher.getTransceivers().length&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const n=new AbortController,i=()=>{n.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t("cannot negotiate on closed engine"),this.on(hl.Closing,i),this.pcManager.publisher.once(vu,(e=>{const t=new Map;e.forEach((e=>{const n=e.codec.toLowerCase();(function(e){return Bl.includes(e)})(n)&&t.set(e.payload,n)})),this.emit(hl.RTPVideoMapUpdate,t)}));try{yield this.pcManager.negotiate(n),e()}catch(e){e instanceof wl&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Yo.RR_UNKNOWN),t(e)}finally{this.off(hl.Closing,i)}}))))}))}dataChannelForKind(e,t){if(t){if(e===ua.LOSSY)return this.lossyDCSub;if(e===ua.RELIABLE)return this.reliableDCSub}else{if(e===ua.LOSSY)return this.lossyDC;if(e===ua.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var n,i;if(!this.pcManager)return void this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);const r=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),a=null===(i=null===(n=this.signalOpts)||void 0===n?void 0:n.autoSubscribe)||void 0===i||i,s=new Array,c=new Array;e.forEach((e=>{e.isDesired!==a&&s.push(e.trackSid),e.isEnabled||c.push(e.trackSid)})),this.client.sendSyncState(new ws({answer:r?eu({sdp:r.sdp,type:r.type}):void 0,offer:o?eu({sdp:o.sdp,type:o.type}):void 0,subscription:new Za({trackSids:s,subscribe:!a,participantTracks:[]}),publishTracks:Bd(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:c,datachannelReceiveStates:this.reliableReceivedState.map(((e,t)=>new Cs({publisherSid:t,lastSeq:e})))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(t,n)=>{void 0!==(null==t?void 0:t.id)&&null!==t.id&&e.push(new Ts({label:t.label,id:t.id,target:n}))};return t(this.dataChannelForKind(ua.LOSSY),Fa.PUBLISHER),t(this.dataChannelForKind(ua.RELIABLE),Fa.PUBLISHER),t(this.dataChannelForKind(ua.LOSSY,!0),Fa.SUBSCRIBER),t(this.dataChannelForKind(ua.RELIABLE,!0),Fa.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Dl.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){id()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){id()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class ch extends Error{}class lh{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return od(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return Ws(this,void 0,void 0,(function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter((e=>!this.attemptedRegions.find((t=>t.url===e.url))));if(t.length>0){const e=t[0];return this.attemptedRegions.push(e),Bs.debug("next region: ".concat(e.region)),e.url}return null}))}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return Ws(this,void 0,void 0,(function*(){const t=yield fetch("".concat(function(e){return"".concat(e.protocol.replace("ws","http"),"//").concat(e.host,"/settings")}(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(t.ok){const e=yield t.json();return this.lastUpdateAt=Date.now(),e}throw new gl("Could not fetch region settings: ".concat(t.statusText),401===t.status?al.NotAllowed:al.InternalError,t.status)}))}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}class dh{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if("number"==typeof this.totalByteSize&&0!==this.totalByteSize){if(e&&this.bytesReceived<this.totalByteSize)throw new Sl("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),sl.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new Sl("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),sl.LengthExceeded)}}constructor(e,t,n,i){this.reader=t,this.totalByteSize=n,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=i}}class uh extends dh{handleChunkReceived(e){var t;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const n=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;null===(t=this.onProgress)||void 0===t||t.call(this,n)}[Symbol.asyncIterator](){const e=this.reader.getReader();let t=new yd,n=null,i=null;if(this.signal){const e=this.signal;i=()=>{var n;null===(n=t.reject)||void 0===n||n.call(t,e.reason)},e.addEventListener("abort",i),n=e}const r=()=>{e.releaseLock(),n&&i&&n.removeEventListener("abort",i),this.signal=void 0};return{next:()=>Ws(this,void 0,void 0,(function*(){var n,i;try{const{done:r,value:o}=yield Promise.race([e.read(),t.promise,null!==(i=null===(n=this.outOfBandFailureRejectingFuture)||void 0===n?void 0:n.promise)&&void 0!==i?i:new Promise((()=>{}))]);return r?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(o),{done:!1,value:o.content})}catch(e){throw r(),e}})),return(){return Ws(this,void 0,void 0,(function*(){return r(),{done:!0,value:void 0}}))}}}withAbortSignal(e){return this.signal=e,this}readAll(){return Ws(this,arguments,void 0,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function*(){var n,i,r,o;let a=new Set;const s=t.signal?e.withAbortSignal(t.signal):e;try{for(var c,l=!0,d=Gs(s);!(n=(c=yield d.next()).done);l=!0){o=c.value,l=!1;const e=o;a.add(e)}}catch(e){i={error:e}}finally{try{!l&&!n&&(r=d.return)&&(yield r.call(d))}finally{if(i)throw i.error}}return Array.from(a)}()}))}}class hh extends dh{constructor(e,t,n,i){super(e,t,n,i),this.receivedChunks=new Map}handleChunkReceived(e){var t;const n=Td(e.chunkIndex),i=this.receivedChunks.get(n);if(i&&i.version>e.version)return;this.receivedChunks.set(n,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;null===(t=this.onProgress)||void 0===t||t.call(this,r)}[Symbol.asyncIterator](){const e=this.reader.getReader(),t=new TextDecoder("utf-8",{fatal:!0});let n=new yd,i=null,r=null;if(this.signal){const e=this.signal;r=()=>{var t;null===(t=n.reject)||void 0===t||t.call(n,e.reason)},e.addEventListener("abort",r),i=e}const o=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>Ws(this,void 0,void 0,(function*(){var i,r;try{const{done:o,value:a}=yield Promise.race([e.read(),n.promise,null!==(r=null===(i=this.outOfBandFailureRejectingFuture)||void 0===i?void 0:i.promise)&&void 0!==r?r:new Promise((()=>{}))]);if(o)return this.validateBytesReceived(!0),{done:!0,value:void 0};{let e;this.handleChunkReceived(a);try{e=t.decode(a.content)}catch(e){throw new Sl("Cannot decode datastream chunk ".concat(a.chunkIndex," as text: ").concat(e),sl.DecodeFailed)}return{done:!1,value:e}}}catch(e){throw o(),e}})),return(){return Ws(this,void 0,void 0,(function*(){return o(),{done:!0,value:void 0}}))}}}withAbortSignal(e){return this.signal=e,this}readAll(){return Ws(this,arguments,void 0,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function*(){var n,i,r,o;let a="";const s=t.signal?e.withAbortSignal(t.signal):e;try{for(var c,l=!0,d=Gs(s);!(n=(c=yield d.next()).done);l=!0)o=c.value,l=!1,a+=o}catch(e){i={error:e}}finally{try{!l&&!n&&(r=d.return)&&(yield r.call(d))}finally{if(i)throw i.error}}return a}()}))}}class ph{constructor(){this.log=Bs,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,t){if(this.textStreamHandlers.has(e))throw new Sl('A text stream handler for topic "'.concat(e,'" has already been set.'),sl.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,t)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,t){if(this.byteStreamHandlers.has(e))throw new Sl('A byte stream handler for topic "'.concat(e,'" has already been set.'),sl.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,t)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearHandlersAndControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear(),this.byteStreamHandlers.clear(),this.textStreamHandlers.clear()}validateParticipantHasNoActiveDataStreams(e){var t,n,i,r;const o=Array.from(this.textStreamControllers.entries()).filter((t=>t[1].sendingParticipantIdentity===e)),a=Array.from(this.byteStreamControllers.entries()).filter((t=>t[1].sendingParticipantIdentity===e));if(o.length>0||a.length>0){const s=new Sl("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),sl.AbnormalEnd);for(const[e,i]of a)null===(n=(t=i.outOfBandFailureRejectingFuture).reject)||void 0===n||n.call(t,s),this.byteStreamControllers.delete(e);for(const[e,t]of o)null===(r=(i=t.outOfBandFailureRejectingFuture).reject)||void 0===r||r.call(i,s),this.textStreamControllers.delete(e)}}handleDataStreamPacket(e){return Ws(this,void 0,void 0,(function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity);case"streamChunk":return this.handleStreamChunk(e.value.value);case"streamTrailer":return this.handleStreamTrailer(e.value.value);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}}))}handleStreamHeader(e,t){return Ws(this,void 0,void 0,(function*(){var n;if("byteHeader"===e.contentHeader.case){const i=this.byteStreamHandlers.get(e.topic);if(!i)return void this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);let r;const o=new yd,a={id:e.streamId,name:null!==(n=e.contentHeader.value.name)&&void 0!==n?n:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Td(e.timestamp),attributes:e.attributes},s=new ReadableStream({start:n=>{if(r=n,this.textStreamControllers.has(e.streamId))throw new Sl("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),sl.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:a,controller:r,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:o})}});i(new uh(a,s,Td(e.totalLength),o),{identity:t})}else if("textHeader"===e.contentHeader.case){const n=this.textStreamHandlers.get(e.topic);if(!n)return void this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);let i;const r=new yd,o={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},a=new ReadableStream({start:n=>{if(i=n,this.textStreamControllers.has(e.streamId))throw new Sl("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),sl.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:o,controller:i,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:r})}});n(new hh(o,a,Td(e.totalLength),r),{identity:t})}}))}handleStreamChunk(e){const t=this.byteStreamControllers.get(e.streamId);t&&e.content.length>0&&t.controller.enqueue(e);const n=this.textStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e)}handleStreamTrailer(e){const t=this.textStreamControllers.get(e.streamId);t&&(t.info.attributes=Object.assign(Object.assign({},t.info.attributes),e.attributes),t.controller.close(),this.textStreamControllers.delete(e.streamId));const n=this.byteStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.byteStreamControllers.delete(e.streamId))}}class mh{constructor(e,t,n){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=n,this.info=t}write(e){return this.defaultWriter.write(e)}close(){return Ws(this,void 0,void 0,(function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),null===(e=this.onClose)||void 0===e||e.call(this)}))}}class fh extends mh{}class gh extends mh{}class vh{constructor(e,t){this.engine=e,this.log=t}setupEngine(e){this.engine=e}sendText(e,t){return Ws(this,void 0,void 0,(function*(){var n;const i=crypto.randomUUID(),r=(new TextEncoder).encode(e).byteLength,o=null===(n=null==t?void 0:t.attachments)||void 0===n?void 0:n.map((()=>crypto.randomUUID())),a=new Array(o?o.length+1:1).fill(0),s=(e,n)=>{var i;a[n]=e;const r=a.reduce(((e,t)=>e+t),0);null===(i=null==t?void 0:t.onProgress)||void 0===i||i.call(t,r)},c=yield this.streamText({streamId:i,totalSize:r,destinationIdentities:null==t?void 0:t.destinationIdentities,topic:null==t?void 0:t.topic,attachedStreamIds:o,attributes:null==t?void 0:t.attributes});return yield c.write(e),s(1,0),yield c.close(),null!=t&&t.attachments&&o&&(yield Promise.all(t.attachments.map(((e,n)=>Ws(this,void 0,void 0,(function*(){return this._sendFile(o[n],e,{topic:t.topic,mimeType:e.type,onProgress:e=>{s(e,n+1)}})})))))),c.info}))}streamText(e){return Ws(this,void 0,void 0,(function*(){var t,n;const i=null!==(t=null==e?void 0:e.streamId)&&void 0!==t?t:crypto.randomUUID(),r={id:i,mimeType:"text/plain",timestamp:Date.now(),topic:null!==(n=null==e?void 0:e.topic)&&void 0!==n?n:"",size:null==e?void 0:e.totalSize,attributes:null==e?void 0:e.attributes},o=new Na({streamId:i,mimeType:r.mimeType,topic:r.topic,timestamp:Sd(r.timestamp),totalLength:Sd(null==e?void 0:e.totalSize),attributes:r.attributes,contentHeader:{case:"textHeader",value:new Aa({version:null==e?void 0:e.version,attachedStreamIds:null==e?void 0:e.attachedStreamIds,replyToStreamId:null==e?void 0:e.replyToStreamId,operationType:"update"===(null==e?void 0:e.type)?Da.UPDATE:Da.CREATE})}}),a=null==e?void 0:e.destinationIdentities,s=new da({destinationIdentities:a,value:{case:"streamHeader",value:o}});yield this.engine.sendDataPacket(s,ua.RELIABLE);let c=0;const l=this.engine,d=new WritableStream({write(e){return Ws(this,void 0,void 0,(function*(){for(const t of function(e){const t=[];let n=(new TextEncoder).encode(e);for(;n.length>15e3;){let e=15e3;for(;e>0;){const t=n[e];if(void 0!==t&&128!=(192&t))break;e--}t.push(n.slice(0,e)),n=n.slice(e)}return n.length>0&&t.push(n),t}(e)){yield l.waitForBufferStatusLow(ua.RELIABLE);const e=new La({content:t,streamId:i,chunkIndex:Sd(c)}),n=new da({destinationIdentities:a,value:{case:"streamChunk",value:e}});yield l.sendDataPacket(n,ua.RELIABLE),c+=1}}))},close(){return Ws(this,void 0,void 0,(function*(){const e=new Ua({streamId:i}),t=new da({destinationIdentities:a,value:{case:"streamTrailer",value:e}});yield l.sendDataPacket(t,ua.RELIABLE)}))},abort(e){console.log("Sink error:",e)}});let u=()=>Ws(this,void 0,void 0,(function*(){yield h.close()}));l.once(hl.Closing,u);const h=new fh(d,r,(()=>this.engine.off(hl.Closing,u)));return h}))}sendFile(e,t){return Ws(this,void 0,void 0,(function*(){const n=crypto.randomUUID();return yield this._sendFile(n,e,t),{id:n}}))}_sendFile(e,t,n){return Ws(this,void 0,void 0,(function*(){var i;const r=yield this.streamBytes({streamId:e,totalSize:t.size,name:t.name,mimeType:null!==(i=null==n?void 0:n.mimeType)&&void 0!==i?i:t.type,topic:null==n?void 0:n.topic,destinationIdentities:null==n?void 0:n.destinationIdentities}),o=t.stream().getReader();for(;;){const{done:e,value:t}=yield o.read();if(e)break;yield r.write(t)}return yield r.close(),r.info}))}streamBytes(e){return Ws(this,void 0,void 0,(function*(){var t,n,i,r,o;const a=null!==(t=null==e?void 0:e.streamId)&&void 0!==t?t:crypto.randomUUID(),s=null==e?void 0:e.destinationIdentities,c={id:a,mimeType:null!==(n=null==e?void 0:e.mimeType)&&void 0!==n?n:"application/octet-stream",topic:null!==(i=null==e?void 0:e.topic)&&void 0!==i?i:"",timestamp:Date.now(),attributes:null==e?void 0:e.attributes,size:null==e?void 0:e.totalSize,name:null!==(r=null==e?void 0:e.name)&&void 0!==r?r:"unknown"},l=new Na({totalLength:Sd(null!==(o=c.size)&&void 0!==o?o:0),mimeType:c.mimeType,streamId:a,topic:c.topic,timestamp:Sd(Date.now()),attributes:c.attributes,contentHeader:{case:"byteHeader",value:new Ma({name:c.name})}}),d=new da({destinationIdentities:s,value:{case:"streamHeader",value:l}});yield this.engine.sendDataPacket(d,ua.RELIABLE);let u=0;const h=new or,p=this.engine,m=this.log,f=new WritableStream({write(e){return Ws(this,void 0,void 0,(function*(){const t=yield h.lock();let n=0;try{for(;n<e.byteLength;){const t=e.slice(n,n+15e3);yield p.waitForBufferStatusLow(ua.RELIABLE);const i=new da({destinationIdentities:s,value:{case:"streamChunk",value:new La({content:t,streamId:a,chunkIndex:Sd(u)})}});yield p.sendDataPacket(i,ua.RELIABLE),u+=1,n+=t.byteLength}}finally{t()}}))},close(){return Ws(this,void 0,void 0,(function*(){const e=new Ua({streamId:a}),t=new da({destinationIdentities:s,value:{case:"streamTrailer",value:e}});yield p.sendDataPacket(t,ua.RELIABLE)}))},abort(e){m.error("Sink error:",e)}});return new gh(f,c)}))}}class bh extends Nl{constructor(e,t,n,i,r){super(e,n,r),this.sid=t,this.receiver=i}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?pl.Muted:pl.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=n=>{n.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(pl.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return Ws(this,void 0,void 0,(function*(){var e;return null!==(e=this.receiver)&&void 0!==e&&e.getStats?yield this.receiver.getStats():void 0}))}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval((()=>this.monitorReceiver()),Du)),typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var t;this.timeSyncHandle=requestAnimationFrame((()=>e()));const n=null===(t=this.receiver)||void 0===t?void 0:t.getSynchronizationSources()[0];if(n){const{timestamp:e,rtpTimestamp:t}=n;t&&this.rtpTimestamp!==t&&(this.emit(pl.TimeSyncUpdate,{timestamp:e,rtpTimestamp:t}),this.rtpTimestamp=t)}};e()}}class yh extends bh{constructor(e,t,n,i,r,o){super(e,t,Nl.Kind.Audio,n,o),this.monitorReceiver=()=>Ws(this,void 0,void 0,(function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=Au(e,this.prevStats)),this.prevStats=e})),this.audioContext=i,this.webAudioPluginNodes=[],r&&(this.sinkId=r.deviceId)}setVolume(e){var t;for(const n of this.attachedElements)this.audioContext?null===(t=this.gainNode)||void 0===t||t.gain.setTargetAtTime(e,0,.1):n.volume=e;rd()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(rd())return 1;let e=0;return this.attachedElements.forEach((t=>{t.volume>e&&(e=t.volume)})),e}setSinkId(e){return Ws(this,void 0,void 0,(function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map((t=>{if(Ql(t))return t.setSinkId(e)})))}))}attach(e){const t=0===this.attachedElements.length;return e?super.attach(e):e=super.attach(),this.sinkId&&Ql(e)&&e.setSinkId(this.sinkId).catch((e=>{this.log.error("Failed to set sink id on remote audio track",e,this.logContext)})),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let n=this.sourceNode;this.webAudioPluginNodes.forEach((e=>{n.connect(e),n=e})),this.gainNode=e.createGain(),n.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),"running"!==e.state&&e.resume().then((()=>{"running"!==e.state&&this.emit(pl.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))})).catch((e=>{this.emit(pl.AudioPlaybackFailed,e)}))}disconnectWebAudio(){var e,t;null===(e=this.gainNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return Ws(this,void 0,void 0,(function*(){if(!this.receiver||!this.receiver.getStats)return;let e;return(yield this.receiver.getStats()).forEach((t=>{"inbound-rtp"===t.type&&(e={type:"audio",streamId:t.id,timestamp:t.timestamp,jitter:t.jitter,bytesReceived:t.bytesReceived,concealedSamples:t.concealedSamples,concealmentEvents:t.concealmentEvents,silentConcealedSamples:t.silentConcealedSamples,silentConcealmentEvents:t.silentConcealmentEvents,totalAudioEnergy:t.totalAudioEnergy,totalSamplesDuration:t.totalSamplesDuration})})),e}))}}class kh extends bh{constructor(e,t,n,i,r){super(e,t,Nl.Kind.Video,n,r),this.elementInfos=[],this.monitorReceiver=()=>Ws(this,void 0,void 0,(function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=Au(e,this.prevStats)),this.prevStats=e})),this.debouncedHandleResize=mu((()=>{this.updateDimensions()}),100),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return void 0!==this.adaptiveStreamSettings}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach((t=>{e?Ul(this._mediaStreamTrack,t):Ll(this._mediaStreamTrack,t)}))}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&void 0===this.elementInfos.find((t=>t.element===e))){const t=new wh(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&void 0===this.elementInfos.find((t=>t===e))?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream)return void this.log.warn("stopObservingElementInfo ignored",this.logContext);const t=this.elementInfos.filter((t=>t===e));for(const e of t)e.stopObserving();this.elementInfos=this.elementInfos.filter((t=>t!==e)),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const e of t)this.stopObservingElement(e);return t}getDecoderImplementation(){var e;return null===(e=this.prevStats)||void 0===e?void 0:e.decoderImplementation}getReceiverStats(){return Ws(this,void 0,void 0,(function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,n="",i=new Map;return e.forEach((e=>{"inbound-rtp"===e.type?(n=e.codecId,t={type:"video",streamId:e.id,framesDecoded:e.framesDecoded,framesDropped:e.framesDropped,framesReceived:e.framesReceived,packetsReceived:e.packetsReceived,packetsLost:e.packetsLost,frameWidth:e.frameWidth,frameHeight:e.frameHeight,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount,jitter:e.jitter,timestamp:e.timestamp,bytesReceived:e.bytesReceived,decoderImplementation:e.decoderImplementation}):"codec"===e.type&&i.set(e.id,e)})),t&&""!==n&&i.get(n)&&(t.mimeType=i.get(n).mimeType),t}))}stopObservingElement(e){const t=this.elementInfos.filter((t=>t.element===e));for(const e of t)this.stopObservingElementInfo(e)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return Ws(this,void 0,void 0,(function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()}))}updateVisibility(){var e,t;const n=this.elementInfos.reduce(((e,t)=>Math.max(e,t.visibilityChangedAt||0)),0),i=!(null!==(t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pauseVideoInBackground)&&void 0!==t&&!t)&&this.isInBackground,r=this.elementInfos.some((e=>e.pictureInPicture)),o=this.elementInfos.some((e=>e.visible))&&!i||r;if(this.lastVisible!==o){if(!o&&Date.now()-n<100)return void Dl.setTimeout((()=>{this.updateVisibility()}),100);this.lastVisible=o,this.emit(pl.VisibilityChanged,o,this)}}updateDimensions(){var e,t;let n=0,i=0;const r=this.getPixelDensity();for(const e of this.elementInfos){const t=e.width()*r,o=e.height()*r;t+o>n+i&&(n=t,i=o)}(null===(e=this.lastDimensions)||void 0===e?void 0:e.width)===n&&(null===(t=this.lastDimensions)||void 0===t?void 0:t.height)===i||(this.lastDimensions={width:n,height:i},this.emit(pl.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pixelDensity;return"screen"===t?cd():t||(cd()>2?2:1)}}class wh{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=e=>{var t;const{target:n,isIntersecting:i}=e;n===this.element&&(this.isIntersecting=i,this.isPiP=Ch(this.element),this.visibilityChangedAt=Date.now(),null===(t=this.handleVisibilityChanged)||void 0===t||t.call(this))},this.onEnterPiP=()=>{var e,t,n;null===(t=null===(e=window.documentPictureInPicture)||void 0===e?void 0:e.window)||void 0===t||t.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Ch(this.element),null===(n=this.handleVisibilityChanged)||void 0===n||n.call(this)},this.onLeavePiP=()=>{var e;this.isPiP=Ch(this.element),null===(e=this.handleVisibilityChanged)||void 0===e||e.call(this)},this.element=e,this.isIntersecting=null!=t?t:Th(e),this.isPiP=id()&&Ch(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,t,n;this.isIntersecting=Th(this.element),this.isPiP=Ch(this.element),this.element.handleResize=()=>{var e;null===(e=this.handleResize)||void 0===e||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,fd().observe(this.element),pd().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),null===(e=window.documentPictureInPicture)||void 0===e||e.addEventListener("enter",this.onEnterPiP),null===(n=null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)||void 0===n||n.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,t,n,i,r;null===(e=fd())||void 0===e||e.unobserve(this.element),null===(t=pd())||void 0===t||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),null===(n=window.documentPictureInPicture)||void 0===n||n.removeEventListener("enter",this.onEnterPiP),null===(r=null===(i=window.documentPictureInPicture)||void 0===i?void 0:i.window)||void 0===r||r.removeEventListener("pagehide",this.onLeavePiP)}}function Ch(e){var t,n;return document.pictureInPictureElement===e||!(null===(t=window.documentPictureInPicture)||void 0===t||!t.window)&&Th(e,null===(n=window.documentPictureInPicture)||void 0===n?void 0:n.window)}function Th(e,t){const n=t||window;let i=e.offsetTop,r=e.offsetLeft;const o=e.offsetWidth,a=e.offsetHeight,{hidden:s}=e,{display:c}=getComputedStyle(e);for(;e.offsetParent;)i+=(e=e.offsetParent).offsetTop,r+=e.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+a>n.pageYOffset&&r+o>n.pageXOffset&&!s&&"none"!==c}class Sh extends Js.EventEmitter{constructor(e,t,n,i){var r;super(),this.metadataMuted=!1,this.encryption=aa.NONE,this.log=Bs,this.handleMuted=()=>{this.emit(pl.Muted)},this.handleUnmuted=()=>{this.emit(pl.Unmuted)},this.log=Vs(null!==(r=null==i?void 0:i.loggerName)&&void 0!==r?r:Ls.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=n,this.source=Nl.Source.Unknown}setTrack(e){this.track&&(this.track.off(pl.Muted,this.handleMuted),this.track.off(pl.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(pl.Muted,this.handleMuted),e.on(pl.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),Vd(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return void 0!==this.track}get isEncrypted(){return this.encryption!==aa.NONE}get audioTrack(){if(xd(this.track))return this.track}get videoTrack(){if(Ed(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=Nl.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===Nl.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}!function(e){var t;(t=e.SubscriptionStatus||(e.SubscriptionStatus={})).Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(e.PermissionStatus||(e.PermissionStatus={}))}(Sh||(Sh={}));class _h extends Sh{get isUpstreamPaused(){var e;return null===(e=this.track)||void 0===e?void 0:e.isUpstreamPaused}constructor(e,t,n,i){super(e,t.sid,t.name,i),this.track=void 0,this.handleTrackEnded=()=>{this.emit(pl.Ended)},this.handleCpuConstrained=()=>{this.track&&Ed(this.track)&&this.emit(pl.CpuConstrained,this.track)},this.updateInfo(t),this.setTrack(n)}setTrack(e){this.track&&(this.track.off(pl.Ended,this.handleTrackEnded),this.track.off(pl.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(pl.Ended,this.handleTrackEnded),e.on(pl.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return Ws(this,void 0,void 0,(function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.mute()}))}unmute(){return Ws(this,void 0,void 0,(function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.unmute()}))}pauseUpstream(){return Ws(this,void 0,void 0,(function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.pauseUpstream()}))}resumeUpstream(){return Ws(this,void 0,void 0,(function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.resumeUpstream()}))}getTrackFeatures(){var e;if(xd(this.track)){const t=this.track.getSourceTrackSettings(),n=new Set;return t.autoGainControl&&n.add(Qo.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&n.add(Qo.TF_ECHO_CANCELLATION),t.noiseSuppression&&n.add(Qo.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&n.add(Qo.TF_STEREO),!(null===(e=this.options)||void 0===e)&&e.dtx||n.add(Qo.TF_NO_DTX),this.track.enhancedNoiseCancellation&&n.add(Qo.TF_ENHANCED_NOISE_CANCELLATION),Array.from(n.values())}return[]}}function xh(e,t){return Ws(this,void 0,void 0,(function*(){var n;null!==(n=e)&&void 0!==n||(e={});let i=!1;const{audioProcessor:r,videoProcessor:o,optionsWithoutProcessor:a}=qd(e);let s=a.audio,c=a.video;if(r&&"object"==typeof a.audio&&(a.audio.processor=r),o&&"object"==typeof a.video&&(a.video.processor=o),e.audio&&"object"==typeof a.audio&&"string"==typeof a.audio.deviceId){const e=a.audio.deviceId;a.audio.deviceId={exact:e},i=!0,s=Object.assign(Object.assign({},a.audio),{deviceId:{ideal:e}})}if(a.video&&"object"==typeof a.video&&"string"==typeof a.video.deviceId){const e=a.video.deviceId;a.video.deviceId={exact:e},i=!0,c=Object.assign(Object.assign({},a.video),{deviceId:{ideal:e}})}(!0===a.audio||"object"==typeof a.audio&&!a.audio.deviceId)&&(a.audio={deviceId:"default"}),!0===a.video?a.video={deviceId:"default"}:"object"==typeof a.video&&!a.video.deviceId&&(a.video.deviceId="default");const l=Ad(a,Tu,Su),d=Nd(l),u=navigator.mediaDevices.getUserMedia(d);a.audio&&(Gd.userMediaPromiseMap.set("audioinput",u),u.catch((()=>Gd.userMediaPromiseMap.delete("audioinput")))),a.video&&(Gd.userMediaPromiseMap.set("videoinput",u),u.catch((()=>Gd.userMediaPromiseMap.delete("videoinput"))));try{const e=yield u;return yield Promise.all(e.getTracks().map((n=>Ws(this,void 0,void 0,(function*(){const i="audio"===n.kind;let a,s=i?l.audio:l.video;("boolean"==typeof s||!s)&&(s={});const c=i?d.audio:d.video;"boolean"!=typeof c&&(a=c);const u=n.getSettings().deviceId;null!=a&&a.deviceId&&kd(a.deviceId)!==u?a.deviceId=u:a||(a={deviceId:u});const h=function(e,t,n){switch(e.kind){case"audio":return new Fu(e,t,!1,void 0,n);case"video":return new Yu(e,t,!1,n);default:throw new bl("unsupported track type: ".concat(e.kind))}}(n,a,t);return h.kind===Nl.Kind.Video?h.source=Nl.Source.Camera:h.kind===Nl.Kind.Audio&&(h.source=Nl.Source.Microphone),h.mediaStream=e,xd(h)&&r?yield h.setProcessor(r):Ed(h)&&o&&(yield h.setProcessor(o)),h})))))}catch(n){if(!i)throw n;return xh(Object.assign(Object.assign({},e),{audio:s,video:c}),t)}}))}!function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Lost="lost",e.Unknown="unknown"}(rh||(rh={}));class Eh extends Js.EventEmitter{get logContext(){var e,t;return Object.assign({},null===(t=null===(e=this.loggerOptions)||void 0===e?void 0:e.loggerContextCb)||void 0===t?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every((e=>e.isEncrypted))}get isAgent(){var e;return(null===(e=this.permissions)||void 0===e?void 0:e.agent)||this.kind===ra.AGENT}get isActive(){var e;return(null===(e=this.participantInfo)||void 0===e?void 0:e.state)===ia.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,t,n,i,r,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:ra.STANDARD;var s;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=rh.Unknown,this.log=Bs,this.log=Vs(null!==(s=null==o?void 0:o.loggerName)&&void 0!==s?s:Ls.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=n,this.metadata=i,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=null!=r?r:{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}waitUntilActive(){return this.isActive?Promise.resolve():(this.activeFuture||(this.activeFuture=new yd,this.once(ul.Active,(()=>{var e,t;null===(t=null===(e=this.activeFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.activeFuture=void 0}))),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(Nl.Source.Camera);return!(null===(e=null==t?void 0:t.isMuted)||void 0===e||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(Nl.Source.Microphone);return!(null===(e=null==t?void 0:t.isMuted)||void 0===e||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(Nl.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(1e3*Number.parseInt(this.participantInfo.joinedAt.toString())):new Date}updateInfo(e){var t;return!(this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version||(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===ia.ACTIVE&&(null===(t=this.participantInfo)||void 0===t?void 0:t.state)!==ia.ACTIVE&&this.emit(ul.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,0))}_setMetadata(e){const t=this.metadata!==e,n=this.metadata;this.metadata=e,t&&this.emit(ul.ParticipantMetadataChanged,n)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(ul.ParticipantNameChanged,e)}_setAttributes(e){const t=function(e,t){var n;void 0===e&&(e={}),void 0===t&&(t={});const i=[...Object.keys(t),...Object.keys(e)],r={};for(const o of i)e[o]!==t[o]&&(r[o]=null!==(n=t[o])&&void 0!==n?n:"");return r}(this.attributes,e);this._attributes=e,Object.keys(t).length>0&&this.emit(ul.AttributesChanged,t)}setPermissions(e){var t,n,i,r,o,a;const s=this.permissions,c=e.canPublish!==(null===(t=this.permissions)||void 0===t?void 0:t.canPublish)||e.canSubscribe!==(null===(n=this.permissions)||void 0===n?void 0:n.canSubscribe)||e.canPublishData!==(null===(i=this.permissions)||void 0===i?void 0:i.canPublishData)||e.hidden!==(null===(r=this.permissions)||void 0===r?void 0:r.hidden)||e.recorder!==(null===(o=this.permissions)||void 0===o?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some(((e,t)=>{var n;return e!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublishSources[t])}))||e.canSubscribeMetrics!==(null===(a=this.permissions)||void 0===a?void 0:a.canSubscribeMetrics);return this.permissions=e,c&&this.emit(ul.ParticipantPermissionsChanged,s),c}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(ul.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=function(e){switch(e){case Ko.EXCELLENT:return rh.Excellent;case Ko.GOOD:return rh.Good;case Ko.POOR:return rh.Poor;case Ko.LOST:return rh.Lost;default:return rh.Unknown}}(e),t!==this._connectionQuality&&this.emit(ul.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,t;this.activeFuture&&(null===(t=(e=this.activeFuture).reject)||void 0===t||t.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach((t=>xd(t.track)&&t.track.setAudioContext(e)))}addTrackPublication(e){e.on(pl.Muted,(()=>{this.emit(ul.TrackMuted,e)})),e.on(pl.Unmuted,(()=>{this.emit(ul.TrackUnmuted,e)}));const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case Nl.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case Nl.Kind.Video:this.videoTrackPublications.set(e.trackSid,e)}}}class Ph extends Eh{constructor(e,t,n,i,r,o){super(e,t,void 0,void 0,void 0,{loggerName:i.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=aa.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new yd)},this.handleReconnected=()=>{var e,t;null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var e,t,n,i,r,o;this.reconnectFuture&&(this.reconnectFuture.promise.catch((e=>this.log.warn(e.message,this.logContext))),null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.reject)||void 0===t||t.call(e,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&(null===(i=(n=this.signalConnectedFuture).reject)||void 0===i||i.call(n,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),null===(o=null===(r=this.activeAgentFuture)||void 0===r?void 0:r.reject)||void 0===o||o.call(r,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=e=>{var t,n;e.participant&&this.updateInfo(e.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new yd),null===(n=(t=this.signalConnectedFuture).resolve)||void 0===n||n.call(t)},this.handleSignalRequestResponse=e=>{const{requestId:t,reason:n,message:i}=e,r=this.pendingSignalRequests.get(t);r&&(n!==Os.OK&&r.reject(new Tl(i,n)),this.pendingSignalRequests.delete(t))},this.handleDataPacket=e=>{switch(e.value.case){case"rpcResponse":let t=e.value.value,n=null,i=null;"payload"===t.value.case?n=t.value.value:"error"===t.value.case&&(i=Ru.fromProto(t.value.value)),this.handleIncomingRpcResponse(t.requestId,n,i);break;case"rpcAck":let r=e.value.value;this.handleIncomingRpcAck(r.requestId)}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map((e=>function(e){var t,n,i;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new vs({participantIdentity:null!==(t=e.participantIdentity)&&void 0!==t?t:"",participantSid:null!==(n=e.participantSid)&&void 0!==n?n:"",allTracks:null!==(i=e.allowAll)&&void 0!==i&&i,trackSids:e.allowedTrackSids||[]})}(e))))},this.onTrackUnmuted=e=>{this.onTrackMuted(e,e.isUpstreamPaused)},this.onTrackMuted=(e,t)=>{void 0===t&&(t=!0),e.sid?this.engine.updateMuteStatus(e.sid,t):this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Vd(e)))},this.onTrackUpstreamPaused=e=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Vd(e))),this.onTrackMuted(e,!0)},this.onTrackUpstreamResumed=e=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Vd(e))),this.onTrackMuted(e,e.isMuted)},this.onTrackFeatureUpdate=e=>{const t=this.audioTrackPublications.get(e.sid);t?this.engine.client.sendUpdateLocalAudioTrack(t.trackSid,t.getTrackFeatures()):this.log.warn("Could not update local audio track settings, missing publication for track ".concat(e.sid),this.logContext)},this.onTrackCpuConstrained=(e,t)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Vd(t))),this.emit(ul.LocalTrackCpuConstrained,e,t)},this.handleSubscribedQualityUpdate=e=>Ws(this,void 0,void 0,(function*(){var t,n,i,r,o;if(null===(o=this.roomOptions)||void 0===o||!o.dynacast)return;const a=this.videoTrackPublications.get(e.trackSid);if(!a)return void this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}));if(!a.videoTrack)return;const s=yield a.videoTrack.setPublishingCodecs(e.subscribedCodecs);try{for(var c,l=!0,d=Gs(s);!(t=(c=yield d.next()).done);l=!0){r=c.value,l=!1;const e=r;Vl(e)&&(this.log.debug("publish ".concat(e," for ").concat(a.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Vd(a))),yield this.publishAdditionalCodecForTrack(a.videoTrack,e,a.options))}}catch(e){n={error:e}}finally{try{!l&&!t&&(i=d.return)&&(yield i.call(d))}finally{if(n)throw n.error}}})),this.handleLocalTrackUnpublished=e=>{const t=this.trackPublications.get(e.trackSid);t?this.unpublishTrack(t.track):this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))},this.handleTrackEnded=e=>Ws(this,void 0,void 0,(function*(){if(e.source===Nl.Source.ScreenShare||e.source===Nl.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Vd(e))),this.unpublishTrack(e);else if(e.isUserProvided)yield e.mute();else if(Rd(e)||Pd(e))try{if(id())try{const t=yield null==navigator?void 0:navigator.permissions.query({name:e.source===Nl.Source.Camera?"camera":"microphone"});if(t&&"denied"===t.state)throw this.log.warn("user has revoked access to ".concat(e.source),Object.assign(Object.assign({},this.logContext),Vd(e))),t.onchange=()=>{"denied"!==t.state&&(e.isMuted||e.restartTrack(),t.onchange=null)},new Error("GetUserMedia Permission denied")}catch(e){}e.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Vd(e))),Rd(e)?yield e.restartTrack({deviceId:"default"}):yield e.restartTrack())}catch(t){this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Vd(e))),yield e.mute()}})),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=n,this.roomOptions=i,this.setupEngine(n),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=r,this.roomOutgoingDataStreamManager=o}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==aa.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(e){var t;this.engine=e,this.engine.on(hl.RemoteMute,((e,t)=>{const n=this.trackPublications.get(e);!n||!n.track||(t?n.mute():n.unmute())})),!(null===(t=this.signalConnectedFuture)||void 0===t)&&t.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(hl.Connected,this.handleReconnected).on(hl.SignalConnected,this.handleSignalConnected).on(hl.SignalRestarted,this.handleReconnected).on(hl.SignalResumed,this.handleReconnected).on(hl.Restarting,this.handleReconnecting).on(hl.Resuming,this.handleReconnecting).on(hl.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(hl.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(hl.Closing,this.handleClosing).on(hl.SignalRequestResponse,this.handleSignalRequestResponse).on(hl.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return Ws(this,void 0,void 0,(function*(){yield this.requestMetadataUpdate({metadata:e})}))}setName(e){return Ws(this,void 0,void 0,(function*(){yield this.requestMetadataUpdate({name:e})}))}setAttributes(e){return Ws(this,void 0,void 0,(function*(){yield this.requestMetadataUpdate({attributes:e})}))}requestMetadataUpdate(e){return Ws(this,arguments,void 0,(function(e){var t=this;let{metadata:n,name:i,attributes:r}=e;return function*(){return new Promise(((e,o)=>Ws(t,void 0,void 0,(function*(){var t,a;try{let s=!1;const c=yield this.engine.client.sendUpdateLocalMetadata(null!==(t=null!=n?n:this.metadata)&&void 0!==t?t:"",null!==(a=null!=i?i:this.name)&&void 0!==a?a:"",r),l=performance.now();for(this.pendingSignalRequests.set(c,{resolve:e,reject:e=>{o(e),s=!0},values:{name:i,metadata:n,attributes:r}});performance.now()-l<5e3&&!s;){if((!i||this.name===i)&&(!n||this.metadata===n)&&(!r||Object.entries(r).every((e=>{let[t,n]=e;return this.attributes[t]===n||""===n&&!this.attributes[t]}))))return this.pendingSignalRequests.delete(c),void e();yield $l(50)}o(new Tl("Request to update local metadata timed out","TimeoutError"))}catch(e){e instanceof Error&&o(e)}}))))}()}))}setCameraEnabled(e,t,n){return this.setTrackEnabled(Nl.Source.Camera,e,t,n)}setMicrophoneEnabled(e,t,n){return this.setTrackEnabled(Nl.Source.Microphone,e,t,n)}setScreenShareEnabled(e,t,n){return this.setTrackEnabled(Nl.Source.ScreenShare,e,t,n)}setPermissions(e){const t=this.permissions,n=super.setPermissions(e);return n&&t&&this.emit(ul.ParticipantPermissionsChanged,t),n}setE2EEEnabled(e){return Ws(this,void 0,void 0,(function*(){this.encryptionType=e?aa.GCM:aa.NONE,yield this.republishAllTracks(void 0,!1)}))}setTrackEnabled(e,t,n,i){return Ws(this,void 0,void 0,(function*(){var r,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(t)if(a)yield a.unmute();else{let t;if(this.pendingPublishing.has(e)){const t=yield this.waitForPendingPublicationOfSource(e);return t||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield null==t?void 0:t.unmute(),t}this.pendingPublishing.add(e);try{switch(e){case Nl.Source.Camera:t=yield this.createTracks({video:null===(r=n)||void 0===r||r});break;case Nl.Source.Microphone:t=yield this.createTracks({audio:null===(o=n)||void 0===o||o});break;case Nl.Source.ScreenShare:t=yield this.createScreenTracks(Object.assign({},n));break;default:throw new bl(e)}}catch(n){throw null==t||t.forEach((e=>{e.stop()})),n instanceof Error&&this.emit(ul.MediaDevicesError,n,Fd(e)),this.pendingPublishing.delete(e),n}for(const i of t){const t=Object.assign(Object.assign({},this.roomOptions.publishDefaults),n);e===Nl.Source.Microphone&&xd(i)&&t.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),i.startPreConnectBuffer())}try{const e=[];for(const n of t)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Vd(n))),e.push(this.publishTrack(n,i));[a]=yield Promise.all(e)}catch(e){throw null==t||t.forEach((e=>{e.stop()})),e}finally{this.pendingPublishing.delete(e)}}else if(!(null!=a&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===Nl.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const e=this.getTrackPublication(Nl.Source.ScreenShareAudio);e&&e.track&&this.unpublishTrack(e.track)}else yield a.mute();return a}))}enableCameraAndMicrophone(){return Ws(this,void 0,void 0,(function*(){if(!this.pendingPublishing.has(Nl.Source.Camera)&&!this.pendingPublishing.has(Nl.Source.Microphone)){this.pendingPublishing.add(Nl.Source.Camera),this.pendingPublishing.add(Nl.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map((e=>this.publishTrack(e))))}finally{this.pendingPublishing.delete(Nl.Source.Camera),this.pendingPublishing.delete(Nl.Source.Microphone)}}}))}createTracks(e){return Ws(this,void 0,void 0,(function*(){var t,n,i;null!==(t=e)&&void 0!==t||(e={});const r=Ad(e,null===(n=this.roomOptions)||void 0===n?void 0:n.audioCaptureDefaults,null===(i=this.roomOptions)||void 0===i?void 0:i.videoCaptureDefaults);try{return(yield xh(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map((e=>(xd(e)&&(this.microphoneError=void 0,e.setAudioContext(this.audioContext),e.source=Nl.Source.Microphone,this.emit(ul.AudioStreamAcquired)),Ed(e)&&(this.cameraError=void 0,e.source=Nl.Source.Camera),e)))}catch(t){throw t instanceof Error&&(e.audio&&(this.microphoneError=t),e.video&&(this.cameraError=t)),t}}))}createScreenTracks(e){return Ws(this,void 0,void 0,(function*(){if(void 0===e&&(e={}),void 0===navigator.mediaDevices.getDisplayMedia)throw new vl("getDisplayMedia not supported");void 0===e.resolution&&!function(){const e=Pl();return"Safari"===(null==e?void 0:e.name)&&e.version.startsWith("17.")||"iOS"===(null==e?void 0:e.os)&&!(null==e||!e.osVersion)&&ld(e.osVersion,"17")>=0}()&&(e.resolution=Gl.h1080fps30.resolution);const t=function(e){var t,n;let i=null===(t=e.video)||void 0===t||t;return e.resolution&&e.resolution.width>0&&e.resolution.height>0&&(i="boolean"==typeof i?{}:i,i=ed()?Object.assign(Object.assign({},i),{width:{max:e.resolution.width},height:{max:e.resolution.height},frameRate:e.resolution.frameRate}):Object.assign(Object.assign({},i),{width:{ideal:e.resolution.width},height:{ideal:e.resolution.height},frameRate:e.resolution.frameRate})),{audio:null!==(n=e.audio)&&void 0!==n&&n,video:i,controller:e.controller,selfBrowserSurface:e.selfBrowserSurface,surfaceSwitching:e.surfaceSwitching,systemAudio:e.systemAudio,preferCurrentTab:e.preferCurrentTab}}(e),n=yield navigator.mediaDevices.getDisplayMedia(t),i=n.getVideoTracks();if(0===i.length)throw new bl("no video track found");const r=new Yu(i[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});r.source=Nl.Source.ScreenShare,e.contentHint&&(r.mediaStreamTrack.contentHint=e.contentHint);const o=[r];if(n.getAudioTracks().length>0){this.emit(ul.AudioStreamAcquired);const e=new Fu(n.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});e.source=Nl.Source.ScreenShareAudio,o.push(e)}return o}))}publishTrack(e,t){return Ws(this,void 0,void 0,(function*(){return this.publishOrRepublishTrack(e,t)}))}publishOrRepublishTrack(e,t){return Ws(this,arguments,void 0,(function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function*(){var r,o,a,s;let c,l;if(Rd(e)&&e.setAudioContext(n.audioContext),yield null===(r=n.reconnectFuture)||void 0===r?void 0:r.promise,n.republishPromise&&!i&&(yield n.republishPromise),_d(e)&&n.pendingPublishPromises.has(e)&&(yield n.pendingPublishPromises.get(e)),e instanceof MediaStreamTrack)c=e.getConstraints();else{let t;switch(c=e.constraints,e.source){case Nl.Source.Microphone:t="audioinput";break;case Nl.Source.Camera:t="videoinput"}t&&n.activeDeviceMap.has(t)&&(c=Object.assign(Object.assign({},c),{deviceId:n.activeDeviceMap.get(t)}))}if(e instanceof MediaStreamTrack)switch(e.kind){case"audio":e=new Fu(e,c,!0,n.audioContext,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;case"video":e=new Yu(e,c,!0,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;default:throw new bl("unsupported MediaStreamTrack kind ".concat(e.kind))}else e.updateLoggerOptions({loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});if(n.trackPublications.forEach((t=>{t.track&&t.track===e&&(l=t)})),l)return n.log.warn("track has already been published, skipping",Object.assign(Object.assign({},n.logContext),Vd(l))),l;const d="channelCount"in e.mediaStreamTrack.getSettings()&&2===e.mediaStreamTrack.getSettings().channelCount||2===e.mediaStreamTrack.getConstraints().channelCount,u=null!==(o=null==t?void 0:t.forceStereo)&&void 0!==o?o:d;u&&(t||(t={}),void 0===t.dtx&&n.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},n.logContext),Vd(e))),void 0===t.red&&n.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),null!==(a=t.dtx)&&void 0!==a||(t.dtx=!1),null!==(s=t.red)&&void 0!==s||(t.red=!1));const h=Object.assign(Object.assign({},n.roomOptions.publishDefaults),t);!function(){const e=Pl(),t="17.2";if(e)return!!("Safari"!==e.name&&"iOS"!==e.os||"iOS"===e.os&&e.osVersion&&ld(t,e.osVersion)>=0)||"Safari"===e.name&&ld(t,e.version)>=0}()&&n.roomOptions.e2ee&&(n.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},n.logContext)),h.simulcast=!1),h.source&&(e.source=h.source);const p=new Promise(((t,i)=>Ws(n,void 0,void 0,(function*(){try{if(this.engine.client.currentState!==Xd.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Vd(e)}));const n=setTimeout((()=>{i(new Cl("publishing rejected as engine not connected within timeout",408))}),15e3);yield this.waitUntilEngineConnected(),clearTimeout(n);const r=yield this.publish(e,h,u);t(r)}else try{const n=yield this.publish(e,h,u);t(n)}catch(e){i(e)}}catch(e){i(e)}}))));n.pendingPublishPromises.set(e,p);try{return yield p}catch(e){throw e}finally{n.pendingPublishPromises.delete(e)}}()}))}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new yd),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Vd(e))),!1;const{canPublish:t,canPublishSources:n}=this.permissions;return!(!t||0!==n.length&&!n.map((e=>function(e){switch(e){case Wo.CAMERA:return Nl.Source.Camera;case Wo.MICROPHONE:return Nl.Source.Microphone;case Wo.SCREEN_SHARE:return Nl.Source.ScreenShare;case Wo.SCREEN_SHARE_AUDIO:return Nl.Source.ScreenShareAudio;default:return Nl.Source.Unknown}}(e))).includes(e.source))||(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Vd(e))),!1)}publish(e,t,n){return Ws(this,void 0,void 0,(function*(){var i,r,o,a,s,c,l,d,u,h;if(!this.hasPermissionsToPublish(e))throw new Cl("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find((t=>_d(e)&&t.source===e.source))&&e.source!==Nl.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Vd(e))),t.stopMicTrackOnMute&&xd(e)&&(e.stopOnMute=!0),e.source===Nl.Source.ScreenShare&&Zl()&&(t.simulcast=!1),"av1"===t.videoCodec&&!function(){if(!("getCapabilities"in RTCRtpSender)||ed())return!1;const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/AV1"===n.mimeType){t=!0;break}return t}()&&(t.videoCodec=void 0),"vp9"===t.videoCodec&&!function(){if(!("getCapabilities"in RTCRtpSender)||Zl())return!1;if(ed()){const e=Pl();if(null!=e&&e.version&&ld(e.version,"16")<0||"iOS"===(null==e?void 0:e.os)&&null!=e&&e.osVersion&&ld(e.osVersion,"16")<0)return!1}const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/VP9"===n.mimeType){t=!0;break}return t}()&&(t.videoCodec=void 0),void 0===t.videoCodec&&(t.videoCodec=wu),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some((e=>t.videoCodec===jd(e.mime)))||(t.videoCodec=jd(this.enabledPublishVideoCodecs[0].mime)));const p=t.videoCodec;e.on(pl.Muted,this.onTrackMuted),e.on(pl.Unmuted,this.onTrackUnmuted),e.on(pl.Ended,this.handleTrackEnded),e.on(pl.UpstreamPaused,this.onTrackUpstreamPaused),e.on(pl.UpstreamResumed,this.onTrackUpstreamResumed),e.on(pl.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const m=[],f=!(null===(i=t.dtx)||void 0===i||i),g=e.getSourceTrackSettings();g.autoGainControl&&m.push(Qo.TF_AUTO_GAIN_CONTROL),g.echoCancellation&&m.push(Qo.TF_ECHO_CANCELLATION),g.noiseSuppression&&m.push(Qo.TF_NOISE_SUPPRESSION),g.channelCount&&g.channelCount>1&&m.push(Qo.TF_STEREO),f&&m.push(Qo.TF_NO_DTX),Rd(e)&&e.hasPreConnectBuffer&&m.push(Qo.TF_PRECONNECT_BUFFER);const v=new za({cid:e.mediaStreamTrack.id,name:t.name,type:Nl.kindToProto(e.kind),muted:e.isMuted,source:Nl.sourceToProto(e.source),disableDtx:f,encryption:this.encryptionType,stereo:n,disableRed:this.isE2EEEnabled||!(null===(r=t.red)||void 0===r||r),stream:null==t?void 0:t.stream,backupCodecPolicy:null==t?void 0:t.backupCodecPolicy,audioFeatures:m});let b;if(e.kind===Nl.Kind.Video){let n={width:0,height:0};try{n=yield e.waitForDimensions()}catch(t){const i=null!==(a=null===(o=this.roomOptions.videoCaptureDefaults)||void 0===o?void 0:o.resolution)&&void 0!==a?a:zl.h720.resolution;n={width:i.width,height:i.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Vd(e)),{dims:n}))}v.width=n.width,v.height=n.height,Pd(e)&&(Xl(p)&&(e.source===Nl.Source.ScreenShare&&(t.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Vd(e))))),t.scalabilityMode=null!==(s=t.scalabilityMode)&&void 0!==s?s:"L3T3_KEY"),v.simulcastCodecs=[new Ha({codec:p,cid:e.mediaStreamTrack.id})],!0===t.backupCodec&&(t.backupCodec={codec:wu}),t.backupCodec&&p!==t.backupCodec.codec&&v.encryption===aa.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),v.simulcastCodecs.push(new Ha({codec:t.backupCodec.codec,cid:""})))),b=Wu(e.source===Nl.Source.ScreenShare,v.width,v.height,t),v.layers=Zu(v.width,v.height,b,Xl(t.videoCodec))}else e.kind===Nl.Kind.Audio&&(b=[{maxBitrate:null===(c=t.audioPreset)||void 0===c?void 0:c.maxBitrate,priority:null!==(d=null===(l=t.audioPreset)||void 0===l?void 0:l.priority)&&void 0!==d?d:"high",networkPriority:null!==(h=null===(u=t.audioPreset)||void 0===u?void 0:u.priority)&&void 0!==h?h:"high"}]);if(!this.engine||this.engine.isClosed)throw new kl("cannot publish track when not connected");const y=()=>Ws(this,void 0,void 0,(function*(){var n,i,r;if(!this.engine.pcManager)throw new kl("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,t,b),this.emit(ul.LocalSenderCreated,e.sender,e),Pd(e)&&(null!==(n=t.degradationPreference)&&void 0!==n||(t.degradationPreference=function(e){return e.source===Nl.Source.ScreenShare||e.constraints.height&&kd(e.constraints.height)>=1080?"maintain-resolution":"balanced"}(e)),e.setDegradationPreference(t.degradationPreference)),b)if(Zl()&&e.kind===Nl.Kind.Audio){let t;for(const n of this.engine.pcManager.publisher.getTransceivers())if(n.sender===e.sender){t=n;break}t&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:t,codec:"opus",maxbr:null!==(i=b[0])&&void 0!==i&&i.maxBitrate?b[0].maxBitrate/1e3:0})}else e.codec&&Xl(e.codec)&&null!==(r=b[0])&&void 0!==r&&r.maxBitrate&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:v.cid,codec:e.codec,maxbr:b[0].maxBitrate/1e3});yield this.engine.negotiate()}));let k;const w=new Promise(((t,n)=>Ws(this,void 0,void 0,(function*(){var i;try{k=yield this.engine.addTrack(v),t(k)}catch(t){e.sender&&!(null===(i=this.engine.pcManager)||void 0===i)&&i.publisher&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch((t=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Vd(e)),{error:t}))}))),n(t)}}))));if(this.enabledPublishVideoCodecs.length>0)k=(yield Promise.all([w,y()]))[0];else{let n;if(k=yield w,k.codecs.forEach((e=>{void 0===n&&(n=e.mimeType)})),n&&e.kind===Nl.Kind.Video){const i=jd(n);i!==p&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Vd(e)),{codec:i})),t.videoCodec=i,b=Wu(e.source===Nl.Source.ScreenShare,v.width,v.height,t))}yield y()}const C=new _h(e.kind,k,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(C.on(pl.CpuConstrained,(e=>this.onTrackCpuConstrained(e,C))),C.options=t,e.sid=k.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:b,trackInfo:k})),Pd(e)?e.startMonitor(this.engine.client):Rd(e)&&e.startMonitor(),this.addTrackPublication(C),this.emit(ul.LocalTrackPublished,C),Rd(e)&&k.audioFeatures.includes(Qo.TF_PRECONNECT_BUFFER)){const t=e.getPreConnectBuffer(),n=e.getPreConnectBufferMimeType();this.on(ul.LocalTrackSubscribed,(t=>{if(t.trackSid===k.sid){if(!e.hasPreConnectBuffer)return void this.log.warn("subscribe event came to late, buffer already closed",this.logContext);this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Vd(e))),e.stopPreConnectBuffer()}})),t&&new Promise(((i,r)=>Ws(this,void 0,void 0,(function*(){var o,a,s,c,l,d;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Vd(e)));const m=setTimeout((()=>{r(new Error("agent not active within 10 seconds"))}),1e4),f=yield this.waitUntilActiveAgentPresent();clearTimeout(m),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Vd(e)));const v=yield this.streamBytes({name:"preconnect-buffer",mimeType:n,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[f.identity],attributes:{trackId:C.trackSid,sampleRate:String(null!==(l=g.sampleRate)&&void 0!==l?l:"48000"),channels:String(null!==(d=g.channelCount)&&void 0!==d?d:"1")}});try{for(var u,h=!0,p=Gs(t);!(o=(u=yield p.next()).done);h=!0){c=u.value,h=!1;const e=c;yield v.write(e)}}catch(e){a={error:e}}finally{try{!h&&!o&&(s=p.return)&&(yield s.call(p))}finally{if(a)throw a.error}}yield v.close(),i()}catch(e){r(e)}})))).then((()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Vd(e)))})).catch((t=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Vd(e)),{error:t}))}))}return C}))}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,n){return Ws(this,void 0,void 0,(function*(){var i;if(this.encryptionType!==aa.NONE)return;let r;if(this.trackPublications.forEach((t=>{t.track&&t.track===e&&(r=t)})),!r)throw new bl("track is not published");if(!Pd(e))throw new bl("track is not a video track");const o=Object.assign(Object.assign({},null===(i=this.roomOptions)||void 0===i?void 0:i.publishDefaults),n),a=function(e,t,n){var i,r,o,a;if(!n.backupCodec||!0===n.backupCodec||n.backupCodec.codec===n.videoCodec)return;t!==n.backupCodec.codec&&Bs.warn("requested a different codec than specified as backup",{serverRequested:t,backup:n.backupCodec.codec}),n.videoCodec=t,n.videoEncoding=n.backupCodec.encoding;const s=e.mediaStreamTrack.getSettings(),c=null!==(i=s.width)&&void 0!==i?i:null===(r=e.dimensions)||void 0===r?void 0:r.width,l=null!==(o=s.height)&&void 0!==o?o:null===(a=e.dimensions)||void 0===a?void 0:a.height;return e.source===Nl.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),Wu(e.source===Nl.Source.ScreenShare,c,l,n)}(e,t,o);if(!a)return void this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Vd(e)));const s=e.addSimulcastTrack(t,a);if(!s)return;const c=new za({cid:s.mediaStreamTrack.id,type:Nl.kindToProto(e.kind),muted:e.isMuted,source:Nl.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:s.mediaStreamTrack.id}]});if(c.layers=Zu(c.width,c.height,a),!this.engine||this.engine.isClosed)throw new kl("cannot publish track when not connected");const l=(yield Promise.all([this.engine.addTrack(c),(()=>Ws(this,void 0,void 0,(function*(){yield this.engine.createSimulcastSender(e,s,o,a),yield this.engine.negotiate()})))()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:l}))}))}unpublishTrack(e,t){return Ws(this,void 0,void 0,(function*(){var n,i;if(_d(e)){const t=this.pendingPublishPromises.get(e);t&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Vd(e))),yield t)}const r=this.getPublicationForTrack(e),o=r?Vd(r):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!r||!r.track)return void this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));(e=r.track).off(pl.Muted,this.onTrackMuted),e.off(pl.Unmuted,this.onTrackUnmuted),e.off(pl.Ended,this.handleTrackEnded),e.off(pl.UpstreamPaused,this.onTrackUpstreamPaused),e.off(pl.UpstreamResumed,this.onTrackUpstreamResumed),e.off(pl.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),void 0===t&&(t=null===(i=null===(n=this.roomOptions)||void 0===n?void 0:n.stopLocalTrackOnUnpublish)||void 0===i||i),t?e.stop():e.stopMonitor();let a=!1;const s=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Eu.FAILED&&s)try{for(const e of this.engine.pcManager.publisher.getTransceivers())e.sender===s&&(e.direction="inactive",a=!0);if(this.engine.removeTrack(s)&&(a=!0),Pd(e)){for(const[,t]of e.simulcastCodecs)t.sender&&(this.engine.removeTrack(t.sender)&&(a=!0),t.sender=void 0);e.simulcastCodecs.clear()}}catch(e){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:e}))}switch(this.trackPublications.delete(r.trackSid),r.kind){case Nl.Kind.Audio:this.audioTrackPublications.delete(r.trackSid);break;case Nl.Kind.Video:this.videoTrackPublications.delete(r.trackSid)}return this.emit(ul.LocalTrackUnpublished,r),r.setTrack(void 0),a&&(yield this.engine.negotiate()),r}))}unpublishTracks(e){return Ws(this,void 0,void 0,(function*(){return(yield Promise.all(e.map((e=>this.unpublishTrack(e))))).filter((e=>!!e))}))}republishAllTracks(e){return Ws(this,arguments,void 0,(function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){t.republishPromise&&(yield t.republishPromise),t.republishPromise=new Promise(((i,r)=>Ws(t,void 0,void 0,(function*(){try{const t=[];this.trackPublications.forEach((n=>{n.track&&(e&&(n.options=Object.assign(Object.assign({},n.options),e)),t.push(n))})),yield Promise.all(t.map((e=>Ws(this,void 0,void 0,(function*(){const t=e.track;yield this.unpublishTrack(t,!1),n&&!t.isMuted&&t.source!==Nl.Source.ScreenShare&&t.source!==Nl.Source.ScreenShareAudio&&(Rd(t)||Pd(t))&&!t.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:e.trackSid})),yield t.restartTrack()),yield this.publishOrRepublishTrack(t,e.options,!0)}))))),i()}catch(e){r(e)}finally{this.republishPromise=void 0}})))),yield t.republishPromise}()}))}publishData(e){return Ws(this,arguments,void 0,(function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const i=n.reliable?ua.RELIABLE:ua.LOSSY,r=n.destinationIdentities,o=n.topic,a=new da({kind:i,value:{case:"user",value:new ma({participantIdentity:t.identity,payload:e,destinationIdentities:r,topic:o})}});yield t.engine.sendDataPacket(a,i)}()}))}publishDtmf(e,t){return Ws(this,void 0,void 0,(function*(){const n=new da({kind:ua.RELIABLE,value:{case:"sipDtmf",value:new fa({code:e,digit:t})}});yield this.engine.sendDataPacket(n,ua.RELIABLE)}))}sendChatMessage(e,t){return Ws(this,void 0,void 0,(function*(){const n={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:null==t?void 0:t.attachments},i=new da({value:{case:"chatMessage",value:new ba(Object.assign(Object.assign({},n),{timestamp:Er.parse(n.timestamp)}))}});return yield this.engine.sendDataPacket(i,ua.RELIABLE),this.emit(ul.ChatMessage,n),n}))}editChatMessage(e,t){return Ws(this,void 0,void 0,(function*(){const n=Object.assign(Object.assign({},t),{message:e,editTimestamp:Date.now()}),i=new da({value:{case:"chatMessage",value:new ba(Object.assign(Object.assign({},n),{timestamp:Er.parse(n.timestamp),editTimestamp:Er.parse(n.editTimestamp)}))}});return yield this.engine.sendDataPacket(i,ua.RELIABLE),this.emit(ul.ChatMessage,n),n}))}sendText(e,t){return Ws(this,void 0,void 0,(function*(){return this.roomOutgoingDataStreamManager.sendText(e,t)}))}streamText(e){return Ws(this,void 0,void 0,(function*(){return this.roomOutgoingDataStreamManager.streamText(e)}))}sendFile(e,t){return Ws(this,void 0,void 0,(function*(){return this.roomOutgoingDataStreamManager.sendFile(e,t)}))}streamBytes(e){return Ws(this,void 0,void 0,(function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)}))}performRpc(e){return Ws(this,arguments,void 0,(function(e){var t=this;let{destinationIdentity:n,method:i,payload:r,responseTimeout:o=1e4}=e;return function*(){return new Promise(((e,a)=>Ws(t,void 0,void 0,(function*(){var t,s,c,l;if(Iu(r)>15360)return void a(Ru.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));if(null!==(s=null===(t=this.engine.latestJoinResponse)||void 0===t?void 0:t.serverInfo)&&void 0!==s&&s.version&&ld(null===(l=null===(c=this.engine.latestJoinResponse)||void 0===c?void 0:c.serverInfo)||void 0===l?void 0:l.version,"1.8.0")<0)return void a(Ru.builtIn("UNSUPPORTED_SERVER"));const d=crypto.randomUUID();yield this.publishRpcRequest(n,d,i,r,o-2e3);const u=setTimeout((()=>{this.pendingAcks.delete(d),a(Ru.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(d),clearTimeout(h)}),2e3);this.pendingAcks.set(d,{resolve:()=>{clearTimeout(u)},participantIdentity:n});const h=setTimeout((()=>{this.pendingResponses.delete(d),a(Ru.builtIn("RESPONSE_TIMEOUT"))}),o);this.pendingResponses.set(d,{resolve:(t,n)=>{clearTimeout(h),this.pendingAcks.has(d)&&(console.warn("RPC response received before ack",d),this.pendingAcks.delete(d),clearTimeout(u)),n?a(n):e(null!=t?t:"")},participantIdentity:n})}))))}()}))}registerRpcMethod(e,t){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,t,n){const i=this.pendingResponses.get(e);i?(i.resolve(t,n),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,t,n,i,r){return Ws(this,void 0,void 0,(function*(){const o=new da({destinationIdentities:[e],kind:ua.RELIABLE,value:{case:"rpcRequest",value:new ya({id:t,method:n,payload:i,responseTimeoutMs:r,version:1})}});yield this.engine.sendDataPacket(o,ua.RELIABLE)}))}handleParticipantDisconnected(e){for(const[t,{participantIdentity:n}]of this.pendingAcks)n===e&&this.pendingAcks.delete(t);for(const[t,{participantIdentity:n,resolve:i}]of this.pendingResponses)n===e&&(i(null,Ru.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(t))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter((e=>"video"===e.mime.split("/")[0].toLowerCase()))}updateInfo(e){return!!super.updateInfo(e)&&(e.tracks.forEach((e=>{var t,n;const i=this.trackPublications.get(e.sid);if(i){const r=i.isMuted||null!==(n=null===(t=i.track)||void 0===t?void 0:t.isUpstreamPaused)&&void 0!==n&&n;r!==e.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Vd(i)),{mutedOnServer:r})),this.engine.client.sendMuteTrack(e.sid,r))}})),!0)}setActiveAgent(e){var t,n,i,r;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?null===(n=null===(t=this.activeAgentFuture)||void 0===t?void 0:t.resolve)||void 0===n||n.call(t,e):null===(r=null===(i=this.activeAgentFuture)||void 0===i?void 0:i.reject)||void 0===r||r.call(i,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new yd),this.activeAgentFuture.promise)}getPublicationForTrack(e){let t;return this.trackPublications.forEach((n=>{const i=n.track;i&&(e instanceof MediaStreamTrack?(Rd(i)||Pd(i))&&i.mediaStreamTrack===e&&(t=n):e===i&&(t=n))})),t}waitForPendingPublicationOfSource(e){return Ws(this,void 0,void 0,(function*(){const t=Date.now();for(;Date.now()<t+1e4;){const t=Array.from(this.pendingPublishPromises.entries()).find((t=>{let[n]=t;return n.source===e}));if(t)return t[1];yield $l(20)}}))}}class Rh extends Sh{constructor(e,t,n,i){super(e,t.sid,t.name,i),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=e=>{this.setTrack(void 0),this.emit(pl.Ended,e)},this.handleVisibilityChange=e=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(e),this.logContext),this.visible=e,this.emitTrackUpdate()},this.handleVideoDimensionsChange=e=>{this.log.debug("adaptivestream video dimensions ".concat(e.width,"x").concat(e.height),this.logContext),this.videoDimensionsAdaptiveStream=e,this.emitTrackUpdate()},this.subscribed=n,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const i=new Za({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Ta({participantSid:"",trackSids:[this.trackSid]})]});this.emit(pl.UpdateSubscription,i),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(n)}get subscriptionStatus(){return!1===this.subscribed?Sh.SubscriptionStatus.Unsubscribed:super.isSubscribed?Sh.SubscriptionStatus.Subscribed:Sh.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Sh.PermissionStatus.Allowed:Sh.PermissionStatus.NotAllowed}get isSubscribed(){return!1!==this.subscribed&&super.isSubscribed}get isDesired(){return!1!==this.subscribed}get isEnabled(){return void 0!==this.requestedDisabled?!this.requestedDisabled:!this.isAdaptiveStream||this.visible}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,n;this.isManualOperationAllowed()&&((null===(t=this.requestedVideoDimensions)||void 0===t?void 0:t.width)===e.width&&(null===(n=this.requestedVideoDimensions)||void 0===n?void 0:n.height)===e.height||(Dd(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Dd(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return null!==(e=this.requestedMaxQuality)&&void 0!==e?e:Ml.HIGH}setTrack(e){const t=this.subscriptionStatus,n=this.permissionStatus,i=this.track;i!==e&&(i&&(i.off(pl.VideoDimensionsChanged,this.handleVideoDimensionsChange),i.off(pl.VisibilityChanged,this.handleVisibilityChange),i.off(pl.Ended,this.handleEnded),i.detach(),i.stopMonitor(),this.emit(pl.Unsubscribed,i)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(pl.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(pl.VisibilityChanged,this.handleVisibilityChange),e.on(pl.Ended,this.handleEnded),this.emit(pl.Subscribed,e)),this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(pl.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?pl.Muted:pl.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(pl.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(pl.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return!!this.isDesired||(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Dd(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new es({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===Nl.Kind.Video){let t=this.requestedVideoDimensions;if(void 0!==this.videoDimensionsAdaptiveStream)if(t)Hd(this.videoDimensionsAdaptiveStream,t)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream);else if(void 0!==this.requestedMaxQuality&&this.trackInfo){const e=function(e,t){var n;return null===(n=e.layers)||void 0===n?void 0:n.find((e=>e.quality===t))}(this.trackInfo,this.requestedMaxQuality);e&&Hd(this.videoDimensionsAdaptiveStream,e)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream;t?(e.width=Math.ceil(t.width),e.height=Math.ceil(t.height)):void 0!==this.requestedMaxQuality?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:Ml.HIGH})),e.quality=Ml.HIGH)}this.emit(pl.UpdateSettings,e)}}class Ih extends Eh{static fromParticipantInfo(e,t,n){return new Ih(e,t.sid,t.identity,t.name,t.metadata,t.attributes,n,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,n,i,r,o,a){super(t,n||"",i,r,o,a,arguments.length>7&&void 0!==arguments[7]?arguments[7]:ra.STANDARD),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(pl.UpdateSettings,(t=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Vd(e)),{settings:t})),this.signalClient.sendUpdateTrackSettings(t)})),e.on(pl.UpdateSubscription,(e=>{e.participantTracks.forEach((e=>{e.participantSid=this.sid})),this.signalClient.sendUpdateSubscription(e)})),e.on(pl.SubscriptionPermissionChanged,(t=>{this.emit(ul.TrackSubscriptionPermissionChanged,e,t)})),e.on(pl.SubscriptionStatusChanged,(t=>{this.emit(ul.TrackSubscriptionStatusChanged,e,t)})),e.on(pl.Subscribed,(t=>{this.emit(ul.TrackSubscribed,t,e)})),e.on(pl.Unsubscribed,(t=>{this.emit(ul.TrackUnsubscribed,t,e)})),e.on(pl.SubscriptionFailed,(t=>{this.emit(ul.TrackSubscriptionFailed,e.trackSid,t)}))}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Nl.Source.Microphone;this.volumeMap.set(t,e);const n=this.getTrackPublication(t);n&&n.track&&n.track.setVolume(e)}getVolume(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Nl.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,n,i,r,o){let a,s=this.getTrackPublicationBySid(t);return s||t.startsWith("TR")||this.trackPublications.forEach((t=>{!s&&e.kind===t.kind.toString()&&(s=t)})),s?"ended"===e.readyState?(this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Vd(s))),void this.emit(ul.TrackSubscriptionFailed,t)):(a="video"===e.kind?new kh(e,t,i,r):new yh(e,t,i,this.audioContext,this.audioOutput),a.source=s.source,a.isMuted=s.isMuted,a.setMediaStream(n),a.start(),s.setTrack(a),this.volumeMap.has(s.source)&&Id(a)&&xd(a)&&a.setVolume(this.volumeMap.get(s.source)),s):0===o?(this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),void this.emit(ul.TrackSubscriptionFailed,t)):(void 0===o&&(o=20),void setTimeout((()=>{this.addSubscribedMediaTrack(e,t,n,i,r,o-1)}),150))}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,n=new Map;return e.tracks.forEach((e=>{var i,r;let o=this.getTrackPublicationBySid(e.sid);if(o)o.updateInfo(e);else{const t=Nl.kindFromProto(e.type);if(!t)return;o=new Rh(t,e,null===(i=this.signalClient.connectOptions)||void 0===i?void 0:i.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:null===(r=this.loggerOptions)||void 0===r?void 0:r.loggerName}),o.updateInfo(e),n.set(e.sid,o);const a=Array.from(this.trackPublications.values()).find((e=>e.source===(null==o?void 0:o.source)));a&&o.source!==Nl.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(o.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Vd(a),newTrack:Vd(o)})),this.addTrackPublication(o)}t.set(e.sid,o)})),this.trackPublications.forEach((e=>{t.has(e.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Vd(e))),this.unpublishTrack(e.trackSid,!0))})),n.forEach((e=>{this.emit(ul.TrackPublished,e)})),!0}unpublishTrack(e,t){const n=this.trackPublications.get(e);if(!n)return;const{track:i}=n;switch(i&&(i.stop(),n.setTrack(void 0)),this.trackPublications.delete(e),n.kind){case Nl.Kind.Audio:this.audioTrackPublications.delete(e);break;case Nl.Kind.Video:this.videoTrackPublications.delete(e)}t&&this.emit(ul.TrackUnpublished,n)}setAudioOutput(e){return Ws(this,void 0,void 0,(function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach((n=>{var i;xd(n.track)&&Id(n.track)&&t.push(n.track.setSinkId(null!==(i=e.deviceId)&&void 0!==i?i:"default"))})),yield Promise.all(t)}))}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:n})),super.emit(e,...n)}}!function(e){e.Disconnected="disconnected",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting"}(oh||(oh={}));class Oh extends Js.EventEmitter{constructor(e){var t,n,i,r;if(super(),t=this,this.state=oh.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Bs,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(e,t,n)=>Ws(this,void 0,void 0,(function*(){var i;if(typeof RTCPeerConnection>"u"||!Jl()&&!Yl())throw rd()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const r=yield this.disconnectLock.lock();if(this.state===oh.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),r(),Promise.resolve();if(this.connectFuture)return r(),this.connectFuture.promise;this.setAndEmitConnectionState(oh.Connecting),(null===(i=this.regionUrlProvider)||void 0===i?void 0:i.getServerUrl().toString())!==e&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),od(new URL(e))&&(void 0===this.regionUrlProvider?this.regionUrlProvider=new lh(e,t):this.regionUrlProvider.updateToken(t),this.regionUrlProvider.fetchRegionSettings().then((e=>{var t;null===(t=this.regionUrlProvider)||void 0===t||t.setServerReportedRegions(e)})).catch((e=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:e}))})));const o=(i,a,s)=>Ws(this,void 0,void 0,(function*(){var c,l;this.abortController&&this.abortController.abort();const d=new AbortController;this.abortController=d,null==r||r();try{yield this.attemptConnection(null!=s?s:e,t,n,d),this.abortController=void 0,i()}catch(e){if(this.regionUrlProvider&&e instanceof gl&&e.reason!==al.Cancelled&&e.reason!==al.NotAllowed){let t=null;try{t=yield this.regionUrlProvider.getNextBestRegionUrl(null===(c=this.abortController)||void 0===c?void 0:c.signal)}catch(e){if(e instanceof gl&&(401===e.status||e.reason===al.Cancelled))return this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),void a(e)}!t||null!==(l=this.abortController)&&void 0!==l&&l.signal.aborted?(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Cd(e)),a(e)):(this.log.info("Initial connection failed with ConnectionError: ".concat(e.message,". Retrying with another region: ").concat(t),this.logContext),this.recreateEngine(),yield o(i,a,t))}else{let t=Jo.UNKNOWN_REASON;e instanceof gl&&(t=Cd(e)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t),a(e)}}})),a=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new yd(((e,t)=>{o(e,t,a)}),(()=>{this.clearConnectionFutures()})),this.connectFuture.promise})),this.connectSignal=(e,t,n,i,r,o)=>Ws(this,void 0,void 0,(function*(){var a,s,c;const l=yield n.join(e,t,{autoSubscribe:i.autoSubscribe,adaptiveStream:"object"==typeof r.adaptiveStream||r.adaptiveStream,maxRetries:i.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:i.websocketTimeout},o.signal);let d=l.serverInfo;if(d||(d={version:l.serverVersion,region:l.serverRegion}),this.serverInfo=d,this.log.debug("connected to Livekit Server ".concat(Object.entries(d).map((e=>{let[t,n]=e;return"".concat(t,": ").concat(n)})).join(", ")),{room:null===(a=l.room)||void 0===a?void 0:a.name,roomSid:null===(s=l.room)||void 0===s?void 0:s.sid,identity:null===(c=l.participant)||void 0===c?void 0:c.identity}),!d.version)throw new yl("unknown server version");return"0.15.1"===d.version&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),r.dynacast=!1),l})),this.applyJoinResponse=e=>{const t=e.participant;if(this.localParticipant.sid=t.sid,this.localParticipant.identity=t.identity,this.localParticipant.setEnabledPublishCodecs(e.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(e.sifTrailer)}catch(e){this.log.error(e instanceof Error?e.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:e}))}this.handleParticipantUpdates([t,...e.otherParticipants]),e.room&&this.handleRoomUpdate(e.room)},this.attemptConnection=(e,t,n,i)=>Ws(this,void 0,void 0,(function*(){var r,o;this.state===oh.Reconnecting||this.isResuming||null!==(r=this.engine)&&void 0!==r&&r.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!(null===(o=this.regionUrlProvider)||void 0===o)&&o.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},xu),n),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const n=yield this.connectSignal(e,t,this.engine,this.connOptions,this.options,i);this.applyJoinResponse(n),this.setupLocalParticipantEvents(),this.emit(dl.SignalConnected)}catch(e){yield this.engine.close(),this.recreateEngine();const t=new gl("could not establish signal connection",al.ServerUnreachable);throw e instanceof Error&&(t.message="".concat(t.message,": ").concat(e.message)),e instanceof gl&&(t.reason=e.reason,t.status=e.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:e})),t}if(i.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new gl("Connection attempt aborted",al.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,i)}catch(e){throw yield this.engine.close(),this.recreateEngine(),e}id()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),id()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(oh.Connected),this.emit(dl.Connected),this.registerConnectionReconcile()})),this.disconnect=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return Ws(t,[...n],void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,i,r,o;const a=yield e.disconnectLock.lock();try{if(e.state===oh.Disconnected)return void e.log.debug("already disconnected",e.logContext);e.log.info("disconnect from room",Object.assign({},e.logContext)),(e.state===oh.Connecting||e.state===oh.Reconnecting||e.isResuming)&&(e.log.warn("abort connection attempt",e.logContext),null===(n=e.abortController)||void 0===n||n.abort(),null===(r=null===(i=e.connectFuture)||void 0===i?void 0:i.reject)||void 0===r||r.call(i,new gl("Client initiated disconnect",al.Cancelled)),e.connectFuture=void 0),!(null===(o=e.engine)||void 0===o)&&o.client.isDisconnected||(yield e.engine.client.sendLeave()),e.engine&&(yield e.engine.close()),e.handleDisconnect(t,Jo.CLIENT_INITIATED),e.engine=void 0}finally{a()}}()}))},this.onPageLeave=()=>Ws(this,void 0,void 0,(function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()})),this.startAudio=()=>Ws(this,void 0,void 0,(function*(){const e=[],t=Pl();if(t&&"iOS"===t.os){const t="livekit-dummy-audio-el";let n=document.getElementById(t);if(!n){n=document.createElement("audio"),n.id=t,n.autoplay=!0,n.hidden=!0;const e=bd();e.enabled=!0;const i=new MediaStream([e]);n.srcObject=i,document.addEventListener("visibilitychange",(()=>{n&&(n.srcObject=document.hidden?null:i,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))})),document.body.append(n),this.once(dl.Disconnected,(()=>{null==n||n.remove(),n=null}))}e.push(n)}this.remoteParticipants.forEach((t=>{t.audioTrackPublications.forEach((t=>{t.track&&t.track.attachedElements.forEach((t=>{e.push(t)}))}))}));try{yield Promise.all([this.acquireAudioContext(),...e.map((e=>(e.muted=!1,e.play())))]),this.handleAudioPlaybackStarted()}catch(e){throw this.handleAudioPlaybackFailed(e),e}})),this.startVideo=()=>Ws(this,void 0,void 0,(function*(){const e=[];for(const t of this.remoteParticipants.values())t.videoTrackPublications.forEach((t=>{var n;null===(n=t.track)||void 0===n||n.attachedElements.forEach((t=>{e.includes(t)||e.push(t)}))}));yield Promise.all(e.map((e=>e.play()))).then((()=>{this.handleVideoPlaybackStarted()})).catch((e=>{"NotAllowedError"===e.name?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)}))})),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const e of this.remoteParticipants.values())this.handleParticipantDisconnected(e.identity,e);this.setAndEmitConnectionState(oh.Reconnecting)&&this.emit(dl.Reconnecting)},this.handleSignalRestarted=e=>Ws(this,void 0,void 0,(function*(){this.log.debug("signal reconnected to server, region ".concat(e.serverRegion),Object.assign(Object.assign({},this.logContext),{region:e.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(e);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(e){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:e}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:e.serverRegion}))}catch(e){return}this.setAndEmitConnectionState(oh.Connected),this.emit(dl.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()})),this.handleParticipantUpdates=e=>{e.forEach((e=>{var t;if(e.identity===this.localParticipant.identity)return void this.localParticipant.updateInfo(e);""===e.identity&&(e.identity=null!==(t=this.sidToIdentity.get(e.sid))&&void 0!==t?t:"");let n=this.remoteParticipants.get(e.identity);e.state===ia.DISCONNECTED?this.handleParticipantDisconnected(e.identity,n):n=this.getOrCreateParticipant(e.identity,e)}))},this.handleActiveSpeakersUpdate=e=>{const t=[],n={};e.forEach((e=>{if(n[e.sid]=!0,e.sid===this.localParticipant.sid)this.localParticipant.audioLevel=e.level,this.localParticipant.setIsSpeaking(!0),t.push(this.localParticipant);else{const n=this.getRemoteParticipantBySid(e.sid);n&&(n.audioLevel=e.level,n.setIsSpeaking(!0),t.push(n))}})),n[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach((e=>{n[e.sid]||(e.audioLevel=0,e.setIsSpeaking(!1))})),this.activeSpeakers=t,this.emitWhenConnected(dl.ActiveSpeakersChanged,t)},this.handleSpeakersChanged=e=>{const t=new Map;this.activeSpeakers.forEach((e=>{const n=this.remoteParticipants.get(e.identity);n&&n.sid!==e.sid||t.set(e.sid,e)})),e.forEach((e=>{let n=this.getRemoteParticipantBySid(e.sid);e.sid===this.localParticipant.sid&&(n=this.localParticipant),n&&(n.audioLevel=e.level,n.setIsSpeaking(e.active),e.active?t.set(e.sid,n):t.delete(e.sid))}));const n=Array.from(t.values());n.sort(((e,t)=>t.audioLevel-e.audioLevel)),this.activeSpeakers=n,this.emitWhenConnected(dl.ActiveSpeakersChanged,n)},this.handleStreamStateUpdate=e=>{e.streamStates.forEach((e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);if(!n||!n.track)return;const i=Nl.streamStateFromProto(e.state);i!==n.track.streamState&&(n.track.streamState=i,t.emit(ul.TrackStreamStateChanged,n,n.track.streamState),this.emitWhenConnected(dl.TrackStreamStateChanged,n,n.track.streamState,t))}))},this.handleSubscriptionPermissionUpdate=e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setAllowed(e.allowed)},this.handleSubscriptionError=e=>{const t=Array.from(this.remoteParticipants.values()).find((t=>t.trackPublications.has(e.trackSid)));if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setSubscriptionError(e.err)},this.handleDataPacket=e=>{const t=this.remoteParticipants.get(e.participantIdentity);if("user"===e.value.case)this.handleUserPacket(t,e.value.value,e.kind);else if("transcription"===e.value.case)this.handleTranscription(t,e.value.value);else if("sipDtmf"===e.value.case)this.handleSipDtmf(t,e.value.value);else if("chatMessage"===e.value.case)this.handleChatMessage(t,e.value.value);else if("metrics"===e.value.case)this.handleMetrics(e.value.value,t);else if("streamHeader"===e.value.case||"streamChunk"===e.value.case||"streamTrailer"===e.value.case)this.handleDataStream(e);else if("rpcRequest"===e.value.case){const t=e.value.value;this.handleIncomingRpcRequest(e.participantIdentity,t.id,t.method,t.payload,t.responseTimeoutMs,t.version)}},this.handleUserPacket=(e,t,n)=>{this.emit(dl.DataReceived,t.payload,e,n,t.topic),null==e||e.emit(ul.DataReceived,t.payload,n)},this.handleSipDtmf=(e,t)=>{this.emit(dl.SipDTMFReceived,t,e),null==e||e.emit(ul.SipDTMFReceived,t)},this.handleTranscription=(e,t)=>{const n=t.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(t.transcribedParticipantIdentity),i=null==n?void 0:n.trackPublications.get(t.trackId),r=function(e,t){return e.segments.map((e=>{let{id:n,text:i,language:r,startTime:o,endTime:a,final:s}=e;var c;const l=null!==(c=t.get(n))&&void 0!==c?c:Date.now(),d=Date.now();return s?t.delete(n):t.set(n,l),{id:n,text:i,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:s,language:r,firstReceivedTime:l,lastReceivedTime:d}}))}(t,this.transcriptionReceivedTimes);null==i||i.emit(pl.TranscriptionReceived,r),null==n||n.emit(ul.TranscriptionReceived,r,i),this.emit(dl.TranscriptionReceived,r,n,i)},this.handleChatMessage=(e,t)=>{const n=function(e){const{id:t,timestamp:n,message:i,editTimestamp:r}=e;return{id:t,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}(t);this.emit(dl.ChatMessage,n,e)},this.handleMetrics=(e,t)=>{this.emit(dl.MetricsReceived,e,t)},this.handleDataStream=e=>{this.incomingDataStreamManager.handleDataStreamPacket(e)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(dl.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=e=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:e})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(dl.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(dl.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(dl.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>Ws(this,void 0,void 0,(function*(){var e;"iOS"!==(null===(e=Pl())||void 0===e?void 0:e.os)&&(yield this.selectDefaultDevices()),this.emit(dl.MediaDevicesChanged)})),this.handleRoomUpdate=e=>{const t=this.roomInfo;this.roomInfo=e,t&&t.metadata!==e.metadata&&this.emitWhenConnected(dl.RoomMetadataChanged,e.metadata),(null==t?void 0:t.activeRecording)!==e.activeRecording&&this.emitWhenConnected(dl.RecordingStatusChanged,e.activeRecording)},this.handleConnectionQualityUpdate=e=>{e.updates.forEach((e=>{if(e.participantSid===this.localParticipant.sid)return void this.localParticipant.setConnectionQuality(e.quality);const t=this.getRemoteParticipantBySid(e.participantSid);t&&t.setConnectionQuality(e.quality)}))},this.onLocalParticipantMetadataChanged=e=>{this.emit(dl.ParticipantMetadataChanged,e,this.localParticipant)},this.onLocalParticipantNameChanged=e=>{this.emit(dl.ParticipantNameChanged,e,this.localParticipant)},this.onLocalAttributesChanged=e=>{this.emit(dl.ParticipantAttributesChanged,e,this.localParticipant)},this.onLocalTrackMuted=e=>{this.emit(dl.TrackMuted,e,this.localParticipant)},this.onLocalTrackUnmuted=e=>{this.emit(dl.TrackUnmuted,e,this.localParticipant)},this.onTrackProcessorUpdate=e=>{var t;null===(t=null==e?void 0:e.onPublish)||void 0===t||t.call(e,this)},this.onLocalTrackPublished=e=>Ws(this,void 0,void 0,(function*(){var t,n,i,r,o,a;null===(t=e.track)||void 0===t||t.on(pl.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.on(pl.Restarted,this.onLocalTrackRestarted),null===(o=null===(r=null===(i=e.track)||void 0===i?void 0:i.getProcessor())||void 0===r?void 0:r.onPublish)||void 0===o||o.call(r,this),this.emit(dl.LocalTrackPublished,e,this.localParticipant),Rd(e.track)&&(yield e.track.checkForSilence())&&this.emit(dl.LocalAudioSilenceDetected,e);const s=yield null===(a=e.track)||void 0===a?void 0:a.getDeviceId(!1),c=Fd(e.source);c&&s&&s!==this.localParticipant.activeDeviceMap.get(c)&&(this.localParticipant.activeDeviceMap.set(c,s),this.emit(dl.ActiveDeviceChanged,c,s))})),this.onLocalTrackUnpublished=e=>{var t,n;null===(t=e.track)||void 0===t||t.off(pl.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.off(pl.Restarted,this.onLocalTrackRestarted),this.emit(dl.LocalTrackUnpublished,e,this.localParticipant)},this.onLocalTrackRestarted=e=>Ws(this,void 0,void 0,(function*(){const t=yield e.getDeviceId(!1),n=Fd(e.source);n&&t&&t!==this.localParticipant.activeDeviceMap.get(n)&&(this.log.debug("local track restarted, setting ".concat(n," ").concat(t," active"),this.logContext),this.localParticipant.activeDeviceMap.set(n,t),this.emit(dl.ActiveDeviceChanged,n,t))})),this.onLocalConnectionQualityChanged=e=>{this.emit(dl.ConnectionQualityChanged,e,this.localParticipant)},this.onMediaDevicesError=(e,t)=>{this.emit(dl.MediaDevicesError,e,t)},this.onLocalParticipantPermissionsChanged=e=>{this.emit(dl.ParticipantPermissionsChanged,e,this.localParticipant)},this.onLocalChatMessageSent=e=>{this.emit(dl.ChatMessage,e,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},_u),e),this.log=Vs(null!==(n=this.options.loggerName)&&void 0!==n?n:Ls.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},Tu),null==e?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Su),null==e?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},Cu),null==e?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new ph,this.outgoingDataStreamManager=new vh(this.engine,this.log),this.disconnectLock=new or,this.localParticipant=new Ph("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",kd(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",kd(this.options.audioCaptureDefaults.deviceId)),!(null===(i=this.options.audioOutput)||void 0===i)&&i.deviceId&&this.switchActiveDevice("audiooutput",kd(this.options.audioOutput.deviceId)).catch((e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext))),this.options.e2ee&&this.setupE2EE(),id()){const e=new AbortController;null===(r=navigator.mediaDevices)||void 0===r||r.addEventListener("devicechange",this.handleDeviceChange,{signal:e.signal}),Oh.cleanupRegistry&&Oh.cleanupRegistry.register(this,(()=>{e.abort()}))}}registerTextStreamHandler(e,t){return this.incomingDataStreamManager.registerTextStreamHandler(e,t)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,t){return this.incomingDataStreamManager.registerByteStreamHandler(e,t)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,t){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return Ws(this,void 0,void 0,(function*(){if(!this.e2eeManager)throw Error("e2ee not configured, please set e2ee settings within the room options");yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),""!==this.localParticipant.identity&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity)}))}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new zd(this.options.e2ee),this.e2eeManager.on(rl.ParticipantEncryptionStatusChanged,((e,t)=>{(function(e){return e.isLocal})(t)&&(this.isE2EEEnabled=e),this.emit(dl.ParticipantEncryptionStatusChanged,e,t)})),this.e2eeManager.on(rl.EncryptionError,(e=>this.emit(dl.EncryptionError,e))),null===(e=this.e2eeManager)||void 0===e||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:null===(e=this.roomInfo)||void 0===e?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.activeRecording)&&void 0!==t&&t}getSid(){return Ws(this,void 0,void 0,(function*(){return this.state===oh.Disconnected?"":this.roomInfo&&""!==this.roomInfo.sid?this.roomInfo.sid:new Promise(((e,t)=>{const n=t=>{""!==t.sid&&(this.engine.off(hl.RoomUpdate,n),e(t.sid))};this.engine.on(hl.RoomUpdate,n),this.once(dl.Disconnected,(()=>{this.engine.off(hl.RoomUpdate,n),t("Room disconnected before room server id was available")}))}))}))}get name(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.name)&&void 0!==t?t:""}get metadata(){var e;return null===(e=this.roomInfo)||void 0===e?void 0:e.metadata}get numParticipants(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numParticipants)&&void 0!==t?t:0}get numPublishers(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numPublishers)&&void 0!==t?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new sh(this.options),this.engine.on(hl.ParticipantUpdate,this.handleParticipantUpdates).on(hl.RoomUpdate,this.handleRoomUpdate).on(hl.SpeakersChanged,this.handleSpeakersChanged).on(hl.StreamStateChanged,this.handleStreamStateUpdate).on(hl.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(hl.SubscriptionError,this.handleSubscriptionError).on(hl.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(hl.MediaTrackAdded,((e,t,n)=>{this.onTrackAdded(e,t,n)})).on(hl.Disconnected,(e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)})).on(hl.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(hl.DataPacketReceived,this.handleDataPacket).on(hl.Resuming,(()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(oh.SignalReconnecting)&&this.emit(dl.SignalReconnecting)})).on(hl.Resumed,(()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(oh.Connected)&&this.emit(dl.Reconnected)})).on(hl.SignalResumed,(()=>{this.bufferedEvents=[],(this.state===oh.Reconnecting||this.isResuming)&&this.sendSyncState()})).on(hl.Restarting,this.handleRestarting).on(hl.SignalRestarted,this.handleSignalRestarted).on(hl.Offline,(()=>{this.setAndEmitConnectionState(oh.Reconnecting)&&this.emit(dl.Reconnecting)})).on(hl.DCBufferStatusChanged,((e,t)=>{this.emit(dl.DCBufferStatusChanged,e,t)})).on(hl.LocalTrackSubscribed,(e=>{const t=this.localParticipant.getTrackPublications().find((t=>{let{trackSid:n}=t;return n===e}));t?(this.localParticipant.emit(ul.LocalTrackSubscribed,t),this.emitWhenConnected(dl.LocalTrackSubscribed,t,this.localParticipant)):this.log.warn("could not find local track subscription for subscribed event",this.logContext)})).on(hl.RoomMoved,(e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach(((e,t)=>{this.handleParticipantDisconnected(t,e)})),this.emit(dl.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)})),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Gd.getInstance().getDevices(e,t)}prepareConnection(e,t){return Ws(this,void 0,void 0,(function*(){if(this.state===oh.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(od(new URL(e))&&t){this.regionUrlProvider=new lh(e,t);const n=yield this.regionUrlProvider.getNextBestRegionUrl();n&&this.state===oh.Disconnected&&(this.regionUrl=n,yield fetch(wd(n),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(n),this.logContext))}else yield fetch(wd(e),{method:"HEAD"})}catch(e){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:e}))}}}))}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return Ws(this,void 0,void 0,(function*(){let n,i=()=>{};switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":n=new Ss({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":n=new Ss({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":n=new Ss({scenario:{case:"serverLeave",value:!0}});break;case"migration":n=new Ss({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>Ws(this,void 0,void 0,(function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")})),n=new Ss({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>Ws(this,void 0,void 0,(function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")})),n=new Ss({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":n=new Ss({scenario:{case:"switchCandidateProtocol",value:"force-tls"===e?2:1}}),i=()=>Ws(this,void 0,void 0,(function*(){const e=this.engine.client.onLeave;e&&e(new is({reason:Jo.CLIENT_INITIATED,action:rs.RECONNECT}))}));break;case"subscriber-bandwidth":if(void 0===t||"number"!=typeof t)throw new Error("subscriber-bandwidth requires a number as argument");n=new Ss({scenario:{case:"subscriberBandwidth",value:Sd(t)}});break;case"leave-full-reconnect":n=new Ss({scenario:{case:"leaveRequestFullReconnect",value:!0}})}n&&(yield this.engine.client.sendSimulateScenario(n),yield i())}))}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){return Ws(this,arguments,void 0,(function(e,t){var n=this;let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function*(){var r,o,a,s,c,l,d;let u=!0,h=!1;const p=i?{exact:t}:t;if("audioinput"===e){h=0===n.localParticipant.audioTrackPublications.size;const t=null!==(r=n.getActiveDevice(e))&&void 0!==r?r:n.options.audioCaptureDefaults.deviceId;n.options.audioCaptureDefaults.deviceId=p;const i=Array.from(n.localParticipant.audioTrackPublications.values()).filter((e=>e.source===Nl.Source.Microphone));try{u=(yield Promise.all(i.map((e=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.setDeviceId(p)})))).every((e=>!0===e))}catch(e){throw n.options.audioCaptureDefaults.deviceId=t,e}const o=i.some((e=>{var t,n;return null!==(n=null===(t=e.track)||void 0===t?void 0:t.isMuted)&&void 0!==n&&n}));u&&o&&(h=!0)}else if("videoinput"===e){h=0===n.localParticipant.videoTrackPublications.size;const t=null!==(o=n.getActiveDevice(e))&&void 0!==o?o:n.options.videoCaptureDefaults.deviceId;n.options.videoCaptureDefaults.deviceId=p;const i=Array.from(n.localParticipant.videoTrackPublications.values()).filter((e=>e.source===Nl.Source.Camera));try{u=(yield Promise.all(i.map((e=>{var t;return null===(t=e.videoTrack)||void 0===t?void 0:t.setDeviceId(p)})))).every((e=>!0===e))}catch(e){throw n.options.videoCaptureDefaults.deviceId=t,e}const r=i.some((e=>{var t,n;return null!==(n=null===(t=e.track)||void 0===t?void 0:t.isMuted)&&void 0!==n&&n}));u&&r&&(h=!0)}else if("audiooutput"===e){if(h=!0,!Ql()&&!n.options.webAudioMix||n.options.webAudioMix&&n.audioContext&&!("setSinkId"in n.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");n.options.webAudioMix&&(t=null!==(a=yield Gd.getInstance().normalizeDeviceId("audiooutput",t))&&void 0!==a?a:""),null!==(s=(d=n.options).audioOutput)&&void 0!==s||(d.audioOutput={});const i=null!==(c=n.getActiveDevice(e))&&void 0!==c?c:n.options.audioOutput.deviceId;n.options.audioOutput.deviceId=t;try{n.options.webAudioMix&&(null===(l=n.audioContext)||void 0===l||l.setSinkId(t)),yield Promise.all(Array.from(n.remoteParticipants.values()).map((e=>e.setAudioOutput({deviceId:t}))))}catch(e){throw n.options.audioOutput.deviceId=i,e}}return h&&(n.localParticipant.activeDeviceMap.set(e,t),n.emit(dl.ActiveDeviceChanged,e,t)),u}()}))}setupLocalParticipantEvents(){this.localParticipant.on(ul.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ul.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ul.AttributesChanged,this.onLocalAttributesChanged).on(ul.TrackMuted,this.onLocalTrackMuted).on(ul.TrackUnmuted,this.onLocalTrackUnmuted).on(ul.LocalTrackPublished,this.onLocalTrackPublished).on(ul.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ul.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ul.MediaDevicesError,this.onMediaDevicesError).on(ul.AudioStreamAcquired,this.startAudio).on(ul.ChatMessage,this.onLocalChatMessageSent).on(ul.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;null===(e=this.engine)||void 0===e||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,n){if(this.state===oh.Connecting||this.state===oh.Reconnecting){const i=()=>{this.onTrackAdded(e,t,n),r()},r=()=>{this.off(dl.Reconnected,i),this.off(dl.Connected,i),this.off(dl.Disconnected,r)};return this.once(dl.Reconnected,i),this.once(dl.Connected,i),void this.once(dl.Disconnected,r)}if(this.state===oh.Disconnected)return void this.log.warn("skipping incoming track after Room disconnected",this.logContext);if("ended"===e.readyState)return void this.log.info("skipping incoming track as it already ended",this.logContext);const i=function(e){const t=e.split("|");return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}(t.id),r=i[0];let o=i[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),r===this.localParticipant.sid)return void this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);const s=Array.from(this.remoteParticipants.values()).find((e=>e.sid===r));if(!s)return void this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(r),this.logContext);let c;this.options.adaptiveStream&&(c="object"==typeof this.options.adaptiveStream?this.options.adaptiveStream:{}),s.addSubscribedMediaTrack(e,a,t,n,c)}handleDisconnect(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;var n;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearHandlersAndControllers(),this.state!==oh.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach((e=>{e.trackPublications.forEach((t=>{e.unpublishTrack(t.trackSid)}))})),this.localParticipant.trackPublications.forEach((t=>{var n,i,r;t.track&&this.localParticipant.unpublishTrack(t.track,e),e?(null===(n=t.track)||void 0===n||n.detach(),null===(i=t.track)||void 0===i||i.stop()):null===(r=t.track)||void 0===r||r.stopMonitor()})),this.localParticipant.off(ul.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ul.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ul.AttributesChanged,this.onLocalAttributesChanged).off(ul.TrackMuted,this.onLocalTrackMuted).off(ul.TrackUnmuted,this.onLocalTrackUnmuted).off(ul.LocalTrackPublished,this.onLocalTrackPublished).off(ul.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ul.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ul.MediaDevicesError,this.onMediaDevicesError).off(ul.AudioStreamAcquired,this.startAudio).off(ul.ChatMessage,this.onLocalChatMessageSent).off(ul.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&"boolean"==typeof this.options.webAudioMix&&(this.audioContext.close(),this.audioContext=void 0),id()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),null===(n=navigator.mediaDevices)||void 0===n||n.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(oh.Disconnected),this.emit(dl.Disconnected,t)}}}handleParticipantDisconnected(e,t){var n;this.remoteParticipants.delete(e),t&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),t.trackPublications.forEach((e=>{t.unpublishTrack(e.trackSid,!0)})),this.emit(dl.ParticipantDisconnected,t),t.setDisconnected(),null===(n=this.localParticipant)||void 0===n||n.handleParticipantDisconnected(t.identity))}handleIncomingRpcRequest(e,t,n,i,r,o){return Ws(this,void 0,void 0,(function*(){if(yield this.engine.publishRpcAck(e,t),1!==o)return void(yield this.engine.publishRpcResponse(e,t,null,Ru.builtIn("UNSUPPORTED_VERSION")));const a=this.rpcHandlers.get(n);if(!a)return void(yield this.engine.publishRpcResponse(e,t,null,Ru.builtIn("UNSUPPORTED_METHOD")));let s=null,c=null;try{const o=yield a({requestId:t,callerIdentity:e,payload:i,responseTimeout:r});Iu(o)>15360?(s=Ru.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(n))):c=o}catch(e){e instanceof Ru?s=e:(console.warn("Uncaught error returned by RPC handler for ".concat(n,". Returning APPLICATION_ERROR instead."),e),s=Ru.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,t,c,s)}))}selectDefaultDevices(){return Ws(this,void 0,void 0,(function*(){var e,t,n;const i=Gd.getInstance().previousDevices,r=yield Gd.getInstance().getDevices(void 0,!1),o=Pl();if("Chrome"===(null==o?void 0:o.name)&&"iOS"!==o.os)for(let e of r){const t=i.find((t=>t.deviceId===e.deviceId));t&&""!==t.label&&t.kind===e.kind&&t.label!==e.label&&"default"===this.getActiveDevice(e.kind)&&this.emit(dl.ActiveDeviceChanged,e.kind,e.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let o of a){const a=Ud(o),s=this.localParticipant.getTrackPublication(a);if(s&&null!==(e=s.track)&&void 0!==e&&e.isUserProvided)continue;const c=r.filter((e=>e.kind===o)),l=this.getActiveDevice(o);l===(null===(t=i.filter((e=>e.kind===o))[0])||void 0===t?void 0:t.deviceId)&&c.length>0&&(null===(n=c[0])||void 0===n?void 0:n.deviceId)!==l?yield this.switchActiveDevice(o,c[0].deviceId):"audioinput"===o&&!td()||"videoinput"===o||c.length>0&&!c.find((e=>e.deviceId===this.getActiveDevice(o)))&&("audiooutput"!==o||!td())&&(yield this.switchActiveDevice(o,c[0].deviceId))}}))}acquireAudioContext(){return Ws(this,void 0,void 0,(function*(){var e,t;if("boolean"!=typeof this.options.webAudioMix&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||"closed"===this.audioContext.state)&&(this.audioContext=null!==(e=Ld())&&void 0!==e?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach((e=>e.setAudioContext(this.audioContext))),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&"suspended"===this.audioContext.state)try{yield Promise.race([this.audioContext.resume(),$l(200)])}catch(e){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:e}))}const n="running"===(null===(t=this.audioContext)||void 0===t?void 0:t.state);n!==this.canPlaybackAudio&&(this.audioEnabled=n,this.emit(dl.AudioPlaybackStatusChanged,n))}))}createParticipant(e,t){var n;let i;return i=t?Ih.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):new Ih(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&i.setAudioContext(this.audioContext),!(null===(n=this.options.audioOutput)||void 0===n)&&n.deviceId&&i.setAudioOutput(this.options.audioOutput).catch((e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext))),i}getOrCreateParticipant(e,t){if(this.remoteParticipants.has(e)){const n=this.remoteParticipants.get(e);return t&&n.updateInfo(t)&&this.sidToIdentity.set(t.sid,t.identity),n}const n=this.createParticipant(e,t);return this.remoteParticipants.set(e,n),this.sidToIdentity.set(t.sid,t.identity),this.emitWhenConnected(dl.ParticipantConnected,n),n.on(ul.TrackPublished,(e=>{this.emitWhenConnected(dl.TrackPublished,e,n)})).on(ul.TrackSubscribed,((e,t)=>{e.kind===Nl.Kind.Audio?(e.on(pl.AudioPlaybackStarted,this.handleAudioPlaybackStarted),e.on(pl.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):e.kind===Nl.Kind.Video&&(e.on(pl.VideoPlaybackFailed,this.handleVideoPlaybackFailed),e.on(pl.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(dl.TrackSubscribed,e,t,n)})).on(ul.TrackUnpublished,(e=>{this.emit(dl.TrackUnpublished,e,n)})).on(ul.TrackUnsubscribed,((e,t)=>{this.emit(dl.TrackUnsubscribed,e,t,n)})).on(ul.TrackMuted,(e=>{this.emitWhenConnected(dl.TrackMuted,e,n)})).on(ul.TrackUnmuted,(e=>{this.emitWhenConnected(dl.TrackUnmuted,e,n)})).on(ul.ParticipantMetadataChanged,(e=>{this.emitWhenConnected(dl.ParticipantMetadataChanged,e,n)})).on(ul.ParticipantNameChanged,(e=>{this.emitWhenConnected(dl.ParticipantNameChanged,e,n)})).on(ul.AttributesChanged,(e=>{this.emitWhenConnected(dl.ParticipantAttributesChanged,e,n)})).on(ul.ConnectionQualityChanged,(e=>{this.emitWhenConnected(dl.ConnectionQualityChanged,e,n)})).on(ul.ParticipantPermissionsChanged,(e=>{this.emitWhenConnected(dl.ParticipantPermissionsChanged,e,n)})).on(ul.TrackSubscriptionStatusChanged,((e,t)=>{this.emitWhenConnected(dl.TrackSubscriptionStatusChanged,e,t,n)})).on(ul.TrackSubscriptionFailed,((e,t)=>{this.emit(dl.TrackSubscriptionFailed,e,n,t)})).on(ul.TrackSubscriptionPermissionChanged,((e,t)=>{this.emitWhenConnected(dl.TrackSubscriptionPermissionChanged,e,t,n)})).on(ul.Active,(()=>{this.emitWhenConnected(dl.ParticipantActive,n),n.kind===ra.AGENT&&this.localParticipant.setActiveAgent(n)})),t&&n.updateInfo(t),n}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce(((e,t)=>(e.push(...t.getTrackPublications()),e)),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&Od(t)&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Dl.setInterval((()=>{this.engine&&!this.engine.isClosed&&this.engine.verifyTransport()?e=0:(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Jo.STATE_MISMATCH)))}),4e3)}clearConnectionReconcile(){this.connectionReconcileInterval&&Dl.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e!==this.state&&(this.state=e,this.emit(dl.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach((e=>{let[t,n]=e;this.emit(t,...n)})),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(this.state===oh.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,n]);else if(this.state===oh.Connected)return this.emit(e,...n);return!1}simulateParticipants(e){return Ws(this,void 0,void 0,(function*(){var t,n;const i=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),r=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new Zo({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:Er.parse((new Date).getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new na({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(dl.SignalConnected),this.emit(dl.Connected),this.setAndEmitConnectionState(oh.Connected),i.video){const e=new _h(Nl.Kind.Video,new ca({source:Wo.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:zo.AUDIO,name:"video-dummy"}),new Yu(i.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:gd(160*(null!==(t=r.aspectRatios[0])&&void 0!==t?t:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(ul.LocalTrackPublished,e)}if(i.audio){const e=new _h(Nl.Kind.Audio,new ca({source:Wo.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:zo.AUDIO}),new Fu(i.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:bd(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(ul.LocalTrackPublished,e)}for(let e=0;e<r.count-1;e+=1){let t=new na({sid:Math.floor(1e4*Math.random()).toString(),identity:"simulated-".concat(e),state:ia.ACTIVE,tracks:[],joinedAt:Er.parse(Date.now())});const i=this.getOrCreateParticipant(t.identity,t);if(r.video){const o=gd(160*(null!==(n=r.aspectRatios[e%r.aspectRatios.length])&&void 0!==n?n:1),160,!1,!0),a=new ca({source:Wo.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:zo.AUDIO});i.addSubscribedMediaTrack(o,a.sid,new MediaStream([o]),new RTCRtpReceiver),t.tracks=[...t.tracks,a]}if(r.audio){const e=bd(),n=new ca({source:Wo.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:zo.AUDIO});i.addSubscribedMediaTrack(e,n.sid,new MediaStream([e]),new RTCRtpReceiver),t.tracks=[...t.tracks,n]}i.updateInfo(t)}}))}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(e!==dl.ActiveSpeakersChanged&&e!==dl.TranscriptionReceived){const t=Dh(n).filter((e=>void 0!==e));this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:t}))}return super.emit(e,...n)}}function Dh(e){return e.map((e=>{if(e)return Array.isArray(e)?Dh(e):"object"==typeof e?"logContext"in e?e.logContext:void 0:e}))}function Ah(){return Ah=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ah.apply(null,arguments)}Oh.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry((e=>{e()})),function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.SKIPPED=2]="SKIPPED",e[e.SUCCESS=3]="SUCCESS",e[e.FAILED=4]="FAILED"}(ah||(ah={})),Js.EventEmitter,Js.EventEmitter;const Mh=new Uint8Array(0);let Nh=class{static getFullOptions(e){return Ah({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{},onInterruption:()=>{}},e)}constructor(e,t){var n=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=0,this.canSendFeedback=!1,this.endSessionWithDetails=async function(e){"connected"!==n.status&&"connecting"!==n.status||(n.updateStatus("disconnecting"),await n.handleEndSession(),n.updateStatus("disconnected"),n.options.onDisconnect&&n.options.onDisconnect(e))},this.onMessage=async function(e){switch(e.type){case"interruption":return void n.handleInterruption(e);case"agent_response":return void n.handleAgentResponse(e);case"user_transcript":return void n.handleUserTranscript(e);case"internal_tentative_agent_response":return void n.handleTentativeAgentResponse(e);case"client_tool_call":try{await n.handleClientToolCall(e)}catch(t){n.onError(`Unexpected error in client tool call handling: ${t instanceof Error?t.message:String(t)}`,{clientToolName:e.client_tool_call.tool_name,toolCallId:e.client_tool_call.tool_call_id})}return;case"audio":return void n.handleAudio(e);case"vad_score":return void n.handleVadScore(e);case"ping":return void n.connection.sendMessage({type:"pong",event_id:e.ping_event.event_id});case"mcp_tool_call":return void n.handleMCPToolCall(e);case"mcp_connection_status":return void n.handleMCPConnectionStatus(e);case"agent_tool_response":return void n.handleAgentToolResponse(e);case"conversation_initiation_metadata":return void n.handleConversationMetadata(e);case"asr_initiation_metadata":return void n.handleAsrInitiationMetadata(e);case"agent_chat_response_part":return void n.handleAgentChatResponsePart(e);case"error":return void n.handleErrorEvent(e);default:return void(n.options.onDebug&&n.options.onDebug(e))}},this.setVolume=({volume:e})=>{this.volume=e},this.options=e,this.connection=t,this.options.onConnect&&this.options.onConnect({conversationId:t.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.connection.onModeChange((e=>this.updateMode(e))),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(e){e!==this.mode&&(this.mode=e,this.options.onModeChange&&this.options.onModeChange({mode:e}))}updateStatus(e){e!==this.status&&(this.status=e,this.options.onStatusChange&&this.options.onStatusChange({status:e}))}updateCanSendFeedback(){const e=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==e&&(this.canSendFeedback=e,this.options.onCanSendFeedbackChange&&this.options.onCanSendFeedbackChange({canSendFeedback:e}))}handleInterruption(e){e.interruption_event&&(this.lastInterruptTimestamp=e.interruption_event.event_id,this.options.onInterruption&&this.options.onInterruption({event_id:e.interruption_event.event_id}))}handleAgentResponse(e){this.options.onMessage&&this.options.onMessage({source:"ai",message:e.agent_response_event.agent_response})}handleUserTranscript(e){this.options.onMessage&&this.options.onMessage({source:"user",message:e.user_transcription_event.user_transcript})}handleTentativeAgentResponse(e){this.options.onDebug&&this.options.onDebug({type:"tentative_agent_response",response:e.tentative_agent_response_internal_event.tentative_agent_response})}handleVadScore(e){this.options.onVadScore&&this.options.onVadScore({vadScore:e.vad_score_event.vad_score})}async handleClientToolCall(e){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,e.client_tool_call.tool_name))try{var t;const n=null!=(t=await this.options.clientTools[e.client_tool_call.tool_name](e.client_tool_call.parameters))?t:"Client tool execution successful.",i="object"==typeof n?JSON.stringify(n):String(n);this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:i,is_error:!1})}catch(t){this.onError(`Client tool execution failed with following error: ${null==t?void 0:t.message}`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool execution failed: ${null==t?void 0:t.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(e.client_tool_call);this.onError(`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(e){}handleMCPToolCall(e){this.options.onMCPToolCall&&this.options.onMCPToolCall(e.mcp_tool_call)}handleMCPConnectionStatus(e){this.options.onMCPConnectionStatus&&this.options.onMCPConnectionStatus(e.mcp_connection_status)}handleAgentToolResponse(e){"end_call"===e.agent_tool_response.tool_name&&this.endSessionWithDetails({reason:"agent",context:new CloseEvent("end_call",{reason:"Agent ended the call"})}),this.options.onAgentToolResponse&&this.options.onAgentToolResponse(e.agent_tool_response)}handleConversationMetadata(e){this.options.onConversationMetadata&&this.options.onConversationMetadata(e.conversation_initiation_metadata_event)}handleAsrInitiationMetadata(e){this.options.onAsrInitiationMetadata&&this.options.onAsrInitiationMetadata(e.asr_initiation_metadata_event)}handleAgentChatResponsePart(e){this.options.onAgentChatResponsePart&&this.options.onAgentChatResponsePart(e.text_response_part)}handleErrorEvent(e){const t=e.error_event.error_type,n=e.error_event.message||e.error_event.reason||"Unknown error";"max_duration_exceeded"!==t?this.onError(`Server error: ${n}`,{errorType:t,code:e.error_event.code,debugMessage:e.error_event.debug_message,details:e.error_event.details}):this.endSessionWithDetails({reason:"error",message:n,context:new Event("max_duration_exceeded")})}onError(e,t){console.error(e,t),this.options.onError&&this.options.onError(e,t)}getId(){return this.connection.conversationId}isOpen(){return"connected"===this.status}setMicMuted(e){this.connection.setMicMuted(e)}getInputByteFrequencyData(){return Mh}getOutputByteFrequencyData(){return Mh}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(e){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:e?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(0===this.lastFeedbackEventId?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(e){this.connection.sendMessage({type:"contextual_update",text:e})}sendUserMessage(e){this.connection.sendMessage({type:"user_message",text:e})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(e,t){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:e,is_approved:t})}};class Lh{constructor(e={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onModeChangeCallback=null,this.onDebug=void 0,this.onDebug=e.onDebug}debug(e){this.onDebug&&this.onDebug(e)}onMessage(e){this.onMessageCallback=e;const t=this.queue;this.queue=[],t.length>0&&queueMicrotask((()=>{t.forEach(e)}))}onDisconnect(e){this.onDisconnectCallback=e;const t=this.disconnectionDetails;t&&queueMicrotask((()=>{e(t)}))}onModeChange(e){this.onModeChangeCallback=e}updateMode(e){var t;null==(t=this.onModeChangeCallback)||t.call(this,e)}disconnect(e){var t;this.disconnectionDetails||(this.disconnectionDetails=e,null==(t=this.onDisconnectCallback)||t.call(this,e))}handleMessage(e){this.onMessageCallback?this.onMessageCallback(e):this.queue.push(e)}}function Uh(e){const[t,n]=e.split("_");if(!["pcm","ulaw"].includes(t))throw new Error(`Invalid format: ${e}`);const i=Number.parseInt(n);if(Number.isNaN(i))throw new Error(`Invalid sample rate: ${n}`);return{format:t,sampleRate:i}}const Fh="0.11.0";function jh(e){return!!e.type}const Bh="conversation_initiation_client_data";function Vh(e){var t;const n={type:Bh};var i,r,o,a,s;return e.overrides&&(n.conversation_config_override={agent:{prompt:null==(i=e.overrides.agent)?void 0:i.prompt,first_message:null==(r=e.overrides.agent)?void 0:r.firstMessage,language:null==(o=e.overrides.agent)?void 0:o.language},tts:{voice_id:null==(a=e.overrides.tts)?void 0:a.voiceId},conversation:{text_only:null==(s=e.overrides.conversation)?void 0:s.textOnly}}),e.customLlmExtraBody&&(n.custom_llm_extra_body=e.customLlmExtraBody),e.dynamicVariables&&(n.dynamic_variables=e.dynamicVariables),e.userId&&(n.user_id=e.userId),null!=(t=e.overrides)&&t.client&&(n.source_info={source:e.overrides.client.source,version:e.overrides.client.version}),n}class qh extends Lh{constructor(e,t,n,i){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=e,this.conversationId=t,this.inputFormat=n,this.outputFormat=i,this.socket.addEventListener("error",(e=>{setTimeout((()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:e})),0)})),this.socket.addEventListener("close",(e=>{this.disconnect(1e3===e.code?{reason:"agent",context:e}:{reason:"error",message:e.reason||"The connection was closed by the server.",context:e})})),this.socket.addEventListener("message",(e=>{try{const t=JSON.parse(e.data);if(!jh(t))return void this.debug({type:"invalid_event",message:"Received invalid socket event",data:e.data});this.handleMessage(t)}catch(t){this.debug({type:"parsing_error",message:"Failed to parse socket message",error:t instanceof Error?t.message:String(t),data:e.data})}}))}static async create(e){let t=null;try{var n,i,r;const o=null!=(n=e.origin)?n:"wss://api.elevenlabs.io";let a;const s=(null==(i=e.overrides)||null==(i=i.client)?void 0:i.version)||Fh,c=(null==(r=e.overrides)||null==(r=r.client)?void 0:r.source)||"js_sdk";if(e.signedUrl){const t=e.signedUrl.includes("?")?"&":"?";a=`${e.signedUrl}${t}source=${c}&version=${s}`}else a=`${o}/v1/convai/conversation?agent_id=${e.agentId}&source=${c}&version=${s}`;const l=["convai"];e.authorization&&l.push(`bearer.${e.authorization}`),t=new WebSocket(a,l);const d=await new Promise(((n,i)=>{t.addEventListener("open",(()=>{var n;const i=Vh(e);null==(n=t)||n.send(JSON.stringify(i))}),{once:!0}),t.addEventListener("error",(e=>{setTimeout((()=>i(e)),0)})),t.addEventListener("close",i),t.addEventListener("message",(e=>{const t=JSON.parse(e.data);jh(t)&&("conversation_initiation_metadata"===t.type?n(t.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))}),{once:!0})})),{conversation_id:u,agent_output_audio_format:h,user_input_audio_format:p}=d,m=Uh(null!=p?p:"pcm_16000"),f=Uh(h);return new qh(t,u,m,f)}catch(e){var o;throw null==(o=t)||o.close(),e}}close(){this.socket.close()}sendMessage(e){this.socket.send(JSON.stringify(e))}async setMicMuted(e){console.warn(`WebSocket connection setMicMuted called with ${e}, but this is handled by VoiceConversation`)}}function Hh(e){const t=new Uint8Array(e);return window.btoa(String.fromCharCode(...t))}function zh(e){const t=window.atob(e),n=t.length,i=new Uint8Array(n);for(let e=0;e<n;e++)i[e]=t.charCodeAt(e);return i.buffer}const Wh=new Map;function Gh(e,t){return async(n,i)=>{const r=Wh.get(e);if(r)return n.addModule(r);if(i)try{return await n.addModule(i),void Wh.set(e,i)}catch(t){throw new Error(`Failed to load the ${e} worklet module from path: ${i}. Error: ${t}`)}const o=new Blob([t],{type:"application/javascript"}),a=URL.createObjectURL(o);try{return await n.addModule(a),void Wh.set(e,a)}catch(e){URL.revokeObjectURL(a)}try{const i=`data:application/javascript;base64,${btoa(t)}`;await n.addModule(i),Wh.set(e,i)}catch(t){throw new Error(`Failed to load the ${e} worklet module. Make sure the browser supports AudioWorklets. If you are using a strict CSP, you may need to self-host the worklet files.`)}}}const Kh=Gh("rawAudioProcessor",'/*\n * ulaw encoding logic taken from the wavefile library\n * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js\n * USED BY @elevenlabs/client\n */\n\nconst BIAS = 0x84;\nconst CLIP = 32635;\nconst encodeTable = [\n  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,\n  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,\n  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,\n  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,\n  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,\n  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,\n  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,\n  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,\n  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7\n];\n\nfunction encodeSample(sample) {\n  let sign;\n  let exponent;\n  let mantissa;\n  let muLawSample;\n  sign = (sample >> 8) & 0x80;\n  if (sign !== 0) sample = -sample;\n  sample = sample + BIAS;\n  if (sample > CLIP) sample = CLIP;\n  exponent = encodeTable[(sample>>7) & 0xFF];\n  mantissa = (sample >> (exponent+3)) & 0x0F;\n  muLawSample = ~(sign | (exponent << 4) | mantissa);\n  \n  return muLawSample;\n}\n\nclass RawAudioProcessor extends AudioWorkletProcessor {\n  constructor() {\n    super();\n              \n    this.port.onmessage = ({ data }) => {\n      switch (data.type) {\n        case "setFormat":\n          this.isMuted = false;\n          this.buffer = []; // Initialize an empty buffer\n          this.bufferSize = data.sampleRate / 4;\n          this.format = data.format;\n\n          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {\n            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {\n              this.resampler = resampler;\n            });\n          }\n          break;\n        case "setMuted":\n          this.isMuted = data.isMuted;\n          break;\n      }\n    };\n  }\n  process(inputs) {\n    if (!this.buffer) {\n      return true;\n    }\n    \n    const input = inputs[0]; // Get the first input node\n    if (input.length > 0) {\n      let channelData = input[0]; // Get the first channel\'s data\n\n      // Resample the audio if necessary\n      if (this.resampler) {\n        channelData = this.resampler.full(channelData);\n      }\n\n      // Add channel data to the buffer\n      this.buffer.push(...channelData);\n      // Get max volume \n      let sum = 0.0;\n      for (let i = 0; i < channelData.length; i++) {\n        sum += channelData[i] * channelData[i];\n      }\n      const maxVolume = Math.sqrt(sum / channelData.length);\n      // Check if buffer size has reached or exceeded the threshold\n      if (this.buffer.length >= this.bufferSize) {\n        const float32Array = this.isMuted \n          ? new Float32Array(this.buffer.length)\n          : new Float32Array(this.buffer);\n\n        let encodedArray = this.format === "ulaw"\n          ? new Uint8Array(float32Array.length)\n          : new Int16Array(float32Array.length);\n\n        // Iterate through the Float32Array and convert each sample to PCM16\n        for (let i = 0; i < float32Array.length; i++) {\n          // Clamp the value to the range [-1, 1]\n          let sample = Math.max(-1, Math.min(1, float32Array[i]));\n\n          // Scale the sample to the range [-32768, 32767]\n          let value = sample < 0 ? sample * 32768 : sample * 32767;\n          if (this.format === "ulaw") {\n            value = encodeSample(Math.round(value));\n          }\n\n          encodedArray[i] = value;\n        }\n\n        // Send the buffered data to the main script\n        this.port.postMessage([encodedArray, maxVolume]);\n\n        // Clear the buffer after sending\n        this.buffer = [];\n      }\n    }\n    return true; // Continue processing\n  }\n}\nregisterProcessor("rawAudioProcessor", RawAudioProcessor);\n');class $h extends Lh{constructor(e,t,n,i,r={}){super(r),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.audioEventId=1,this.audioCaptureContext=null,this.audioElements=[],this.outputDeviceId=null,this.outputAnalyser=null,this.outputFrequencyData=null,this.room=e,this.conversationId=t,this.inputFormat=n,this.outputFormat=i,this.setupRoomEventListeners()}static async create(e){let t;if("conversationToken"in e&&e.conversationToken)t=e.conversationToken;else{if(!("agentId"in e)||!e.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{var n,i,r;const a=(null==(n=e.overrides)||null==(n=n.client)?void 0:n.version)||Fh,s=(null==(i=e.overrides)||null==(i=i.client)?void 0:i.source)||"js_sdk",c=`${o=null!=(r=e.origin)?r:"https://api.elevenlabs.io",o.replace(/^wss:\/\//,"https://")}/v1/convai/conversation/token?agent_id=${e.agentId}&source=${s}&version=${a}`,l=await fetch(c);if(!l.ok)throw new Error(`ElevenLabs API returned ${l.status} ${l.statusText}`);if(t=(await l.json()).token,!t)throw new Error("No conversation token received from API")}catch(t){let n=t instanceof Error?t.message:String(t);throw t instanceof Error&&t.message.includes("401")&&(n="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error(`Failed to fetch conversation token for agent ${e.agentId}: ${n}`)}}var o;const a=new Oh;try{const n=`room_${Date.now()}`,i=Uh("pcm_48000"),r=Uh("pcm_48000"),o=new $h(a,n,i,r,e),c=e.livekitUrl||"wss://livekit.rtc.elevenlabs.io";var s;await a.connect(c,t),await new Promise((e=>{if(o.isConnected)e();else{const t=()=>{a.off(dl.Connected,t),e()};a.on(dl.Connected,t)}})),a.name&&(o.conversationId=(null==(s=a.name.match(/(conv_[a-zA-Z0-9]+)/))?void 0:s[0])||a.name),await a.localParticipant.setMicrophoneEnabled(!0);const l=Vh(e);return o.debug({type:Bh,message:l}),await o.sendMessage(l),o}catch(e){throw await a.disconnect(),e}}setupRoomEventListeners(){var e=this;this.room.on(dl.Connected,(async function(){e.isConnected=!0,console.info("WebRTC room connected")})),this.room.on(dl.Disconnected,(e=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:null==e?void 0:e.toString()})})})),this.room.on(dl.ConnectionStateChanged,(e=>{e===oh.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${e}`,context:new Event("connection_state_changed")}))})),this.room.on(dl.DataReceived,((e,t)=>{try{const t=JSON.parse((new TextDecoder).decode(e));if("audio"===t.type)return;jh(t)?this.handleMessage(t):console.warn("Invalid socket event received:",t)}catch(t){console.warn("Failed to parse incoming data message:",t),console.warn("Raw payload:",(new TextDecoder).decode(e))}})),this.room.on(dl.TrackSubscribed,(async function(t,n,i){if(t.kind===Nl.Kind.Audio&&i.identity.includes("agent")){const n=t,i=n.attach();if(i.autoplay=!0,i.controls=!1,e.outputDeviceId&&i.setSinkId)try{await i.setSinkId(e.outputDeviceId)}catch(e){console.warn("Failed to set output device for new audio element:",e)}i.style.display="none",document.body.appendChild(i),e.audioElements.push(i),1===e.audioElements.length&&(null==e.onDebug||e.onDebug({type:"audio_element_ready"})),await e.setupAudioCapture(n)}})),this.room.on(dl.ActiveSpeakersChanged,(async function(t){e.updateMode(t.length>0&&t[0].identity.startsWith("agent")?"speaking":"listening")}))}close(){if(this.isConnected){try{this.room.localParticipant.audioTrackPublications.forEach((e=>{e.track&&e.track.stop()}))}catch(e){console.warn("Error stopping local tracks:",e)}this.audioCaptureContext&&(this.audioCaptureContext.close().catch((e=>{console.warn("Error closing audio capture context:",e)})),this.audioCaptureContext=null),this.audioElements.forEach((e=>{e.parentNode&&e.parentNode.removeChild(e)})),this.audioElements=[],this.room.disconnect()}}async sendMessage(e){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in e))try{const t=(new TextEncoder).encode(JSON.stringify(e));await this.room.localParticipant.publishData(t,{reliable:!0})}catch(t){this.debug({type:"send_message_error",message:{message:e,error:t}}),console.error("Failed to send message via WebRTC:",t)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}async setMicMuted(e){if(!this.isConnected||!this.room.localParticipant)return void console.warn("Cannot set microphone muted: room not connected or no local participant");const t=this.room.localParticipant.getTrackPublication(Nl.Source.Microphone);if(null!=t&&t.track)try{e?await t.track.mute():await t.track.unmute()}catch(t){await this.room.localParticipant.setMicrophoneEnabled(!e)}else await this.room.localParticipant.setMicrophoneEnabled(!e)}async setupAudioCapture(e){try{const t=new AudioContext;this.audioCaptureContext=t,this.outputAnalyser=t.createAnalyser(),this.outputAnalyser.fftSize=2048,this.outputAnalyser.smoothingTimeConstant=.8;const n=new MediaStream([e.mediaStreamTrack]),i=t.createMediaStreamSource(n);i.connect(this.outputAnalyser),await Kh(t.audioWorklet);const r=new AudioWorkletNode(t,"rawAudioProcessor");this.outputAnalyser.connect(r),r.port.postMessage({type:"setFormat",format:this.outputFormat.format,sampleRate:this.outputFormat.sampleRate}),r.port.onmessage=e=>{const[t,n]=e.data;if(n>.01){const e=Hh(t.buffer),n=this.audioEventId++;this.handleMessage({type:"audio",audio_event:{audio_base_64:e,event_id:n}})}},i.connect(r)}catch(e){console.warn("Failed to set up audio capture:",e)}}setAudioVolume(e){this.audioElements.forEach((t=>{t.volume=e}))}async setAudioOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");const t=this.audioElements.map((async function(t){try{await t.setSinkId(e)}catch(e){throw console.error("Failed to set sink ID for audio element:",e),e}}));await Promise.all(t),this.outputDeviceId=e}async setAudioInputDevice(e){if(!this.isConnected||!this.room.localParticipant)throw new Error("Cannot change input device: room not connected or no local participant");try{const t=this.room.localParticipant.getTrackPublication(Nl.Source.Microphone);null!=t&&t.track&&(await t.track.stop(),await this.room.localParticipant.unpublishTrack(t.track));const n={deviceId:{exact:e},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}},i=await function(e){return Ws(this,void 0,void 0,(function*(){return(yield xh({audio:null==e||e,video:!1}))[0]}))}(n);await this.room.localParticipant.publishTrack(i,{name:"microphone",source:Nl.Source.Microphone})}catch(e){console.error("Failed to change input device:",e);try{await this.room.localParticipant.setMicrophoneEnabled(!0)}catch(e){console.error("Failed to recover microphone after device switch error:",e)}throw e}}getOutputByteFrequencyData(){return this.outputAnalyser?(null!=this.outputFrequencyData||(this.outputFrequencyData=new Uint8Array(this.outputAnalyser.frequencyBinCount)),this.outputAnalyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData):null}}async function Jh(e){const t=(n=e).connectionType?n.connectionType:"conversationToken"in n&&n.conversationToken?"webrtc":"websocket";var n;switch(t){case"websocket":return qh.create(e);case"webrtc":return $h.create(e);default:throw new Error(`Unknown connection type: ${t}`)}}function Yh(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function Xh(e={default:0,android:3e3}){let t=e.default;var n;if(/android/i.test(navigator.userAgent))t=null!=(n=e.android)?n:t;else if(Yh()){var i;t=null!=(i=e.ios)?i:t}t>0&&await new Promise((e=>setTimeout(e,t)))}class Qh extends Nh{static async startSession(e){const t=Nh.getFullOptions(e);t.onStatusChange&&t.onStatusChange({status:"connecting"}),t.onCanSendFeedbackChange&&t.onCanSendFeedbackChange({canSendFeedback:!1}),t.onModeChange&&t.onModeChange({mode:"listening"}),t.onCanSendFeedbackChange&&t.onCanSendFeedbackChange({canSendFeedback:!1});let n=null;try{return await Xh(t.connectionDelay),n=await Jh(e),new Qh(t,n)}catch(e){var i;throw t.onStatusChange&&t.onStatusChange({status:"disconnected"}),null==(i=n)||i.close(),e}}}const Zh={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}};class ep{static async create({sampleRate:e,format:t,preferHeadphonesForIosDevices:n,inputDeviceId:i,workletPaths:r,libsampleratePath:o}){let a=null,s=null;try{const c=Ah({sampleRate:{ideal:e}},Zh);if(Yh()&&n){const e=(await window.navigator.mediaDevices.enumerateDevices()).find((e=>"audioinput"===e.kind&&["airpod","headphone","earphone"].find((t=>e.label.toLowerCase().includes(t)))));e&&(c.deviceId={ideal:e.deviceId})}i&&(c.deviceId={exact:i});const l=navigator.mediaDevices.getSupportedConstraints().sampleRate;a=new window.AudioContext(l?{sampleRate:e}:{});const d=a.createAnalyser();if(!l){const e=o||"https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js";await a.audioWorklet.addModule(e)}await Kh(a.audioWorklet,null==r?void 0:r.rawAudioProcessor);const u=Ah({voiceIsolation:!0},c);s=await navigator.mediaDevices.getUserMedia({audio:u});const h=a.createMediaStreamSource(s),p=new AudioWorkletNode(a,"rawAudioProcessor");return p.port.postMessage({type:"setFormat",format:t,sampleRate:e}),h.connect(d),d.connect(p),await a.resume(),new ep(a,d,p,s,h)}catch(e){var c,l;throw null==(c=s)||c.getTracks().forEach((e=>{e.stop()})),null==(l=a)||l.close(),e}}constructor(e,t,n,i,r){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.mediaStreamSource=void 0,this.context=e,this.analyser=t,this.worklet=n,this.inputStream=i,this.mediaStreamSource=r}async close(){this.inputStream.getTracks().forEach((e=>{e.stop()})),this.mediaStreamSource.disconnect(),await this.context.close()}setMuted(e){this.worklet.port.postMessage({type:"setMuted",isMuted:e})}async setInputDevice(e){try{const t=Ah({},Zh);e&&(t.deviceId={exact:e});const n=Ah({voiceIsolation:!0},t),i=await navigator.mediaDevices.getUserMedia({audio:n});this.inputStream.getTracks().forEach((e=>{e.stop()})),this.mediaStreamSource.disconnect(),this.inputStream=i,this.mediaStreamSource=this.context.createMediaStreamSource(i),this.mediaStreamSource.connect(this.analyser)}catch(e){throw console.error("Failed to switch input device:",e),e}}}const tp=Gh("audioConcatProcessor",'/*\n * ulaw decoding logic taken from the wavefile library\n * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js\n * USED BY @elevenlabs/client\n */\n\nconst decodeTable = [0,132,396,924,1980,4092,8316,16764];\n\nfunction decodeSample(muLawSample) {\n  let sign;\n  let exponent;\n  let mantissa;\n  let sample;\n  muLawSample = ~muLawSample;\n  sign = (muLawSample & 0x80);\n  exponent = (muLawSample >> 4) & 0x07;\n  mantissa = muLawSample & 0x0F;\n  sample = decodeTable[exponent] + (mantissa << (exponent+3));\n  if (sign !== 0) sample = -sample;\n\n  return sample;\n}\n\nclass AudioConcatProcessor extends AudioWorkletProcessor {\n  constructor() {\n    super();\n    this.buffers = []; // Initialize an empty buffer\n    this.cursor = 0;\n    this.currentBuffer = null;\n    this.wasInterrupted = false;\n    this.finished = false;\n    \n    this.port.onmessage = ({ data }) => {\n      switch (data.type) {\n        case "setFormat":\n          this.format = data.format;\n          break;\n        case "buffer":\n          this.wasInterrupted = false;\n          this.buffers.push(\n            this.format === "ulaw"\n              ? new Uint8Array(data.buffer)\n              : new Int16Array(data.buffer)\n          );\n          break;\n        case "interrupt":\n          this.wasInterrupted = true;\n          break;\n        case "clearInterrupted":\n          if (this.wasInterrupted) {\n            this.wasInterrupted = false;\n            this.buffers = [];\n            this.currentBuffer = null;\n          }\n      }\n    };\n  }\n  process(_, outputs) {\n    let finished = false;\n    const output = outputs[0][0];\n    for (let i = 0; i < output.length; i++) {\n      if (!this.currentBuffer) {\n        if (this.buffers.length === 0) {\n          finished = true;\n          break;\n        }\n        this.currentBuffer = this.buffers.shift();\n        this.cursor = 0;\n      }\n\n      let value = this.currentBuffer[this.cursor];\n      if (this.format === "ulaw") {\n        value = decodeSample(value);\n      }\n      output[i] = value / 32768;\n      this.cursor++;\n\n      if (this.cursor >= this.currentBuffer.length) {\n        this.currentBuffer = null;\n      }\n    }\n\n    if (this.finished !== finished) {\n      this.finished = finished;\n      this.port.postMessage({ type: "process", finished });\n    }\n\n    return true; // Continue processing\n  }\n}\n\nregisterProcessor("audioConcatProcessor", AudioConcatProcessor);\n');class np{static async create({sampleRate:e,format:t,outputDeviceId:n,workletPaths:i}){let r=null,o=null;try{r=new AudioContext({sampleRate:e});const a=r.createAnalyser(),s=r.createGain();o=new Audio,o.src="",o.load(),o.autoplay=!0,o.style.display="none",document.body.appendChild(o);const c=r.createMediaStreamDestination();o.srcObject=c.stream,s.connect(a),a.connect(c),await tp(r.audioWorklet,null==i?void 0:i.audioConcatProcessor);const l=new AudioWorkletNode(r,"audioConcatProcessor");return l.port.postMessage({type:"setFormat",format:t}),l.connect(s),await r.resume(),n&&o.setSinkId&&await o.setSinkId(n),new np(r,a,s,l,o)}catch(e){var a,s;throw null!=(a=o)&&a.parentNode&&o.parentNode.removeChild(o),null==(s=o)||s.pause(),r&&"closed"!==r.state&&await r.close(),e}}constructor(e,t,n,i,r){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.audioElement=void 0,this.context=e,this.analyser=t,this.gain=n,this.worklet=i,this.audioElement=r}async setOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");await this.audioElement.setSinkId(e||"")}async close(){this.audioElement.parentNode&&this.audioElement.parentNode.removeChild(this.audioElement),this.audioElement.pause(),await this.context.close()}}class ip extends Nh{static async startSession(e){var t;const n=Nh.getFullOptions(e);n.onStatusChange&&n.onStatusChange({status:"connecting"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1});let i=null,r=null,o=null,a=null,s=null;if(null==(t=e.useWakeLock)||t)try{s=await navigator.wakeLock.request("screen")}catch(e){}try{var c;return a=await navigator.mediaDevices.getUserMedia({audio:!0}),await Xh(n.connectionDelay),r=await Jh(e),[i,o]=await Promise.all([ep.create(Ah({},r.inputFormat,{preferHeadphonesForIosDevices:e.preferHeadphonesForIosDevices,inputDeviceId:e.inputDeviceId,workletPaths:e.workletPaths,libsampleratePath:e.libsampleratePath})),np.create(Ah({},r.outputFormat,{outputDeviceId:e.outputDeviceId,workletPaths:e.workletPaths}))]),null==(c=a)||c.getTracks().forEach((e=>{e.stop()})),a=null,new ip(n,r,i,o,s)}catch(e){var l,d,u,h;n.onStatusChange&&n.onStatusChange({status:"disconnected"}),null==(l=a)||l.getTracks().forEach((e=>{e.stop()})),null==(d=r)||d.close(),await(null==(u=i)?void 0:u.close()),await(null==(h=o)?void 0:h.close());try{var p;await(null==(p=s)?void 0:p.release()),s=null}catch(e){}throw e}}constructor(e,t,n,i,r){super(e,t),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.onInputWorkletMessage=e=>{"connected"===this.status&&this.connection.sendMessage({user_audio_chunk:Hh(e.data[0].buffer)})},this.onOutputWorkletMessage=({data:e})=>{"process"===e.type&&this.updateMode(e.finished?"listening":"speaking")},this.addAudioBase64Chunk=e=>{this.output.gain.gain.cancelScheduledValues(this.output.context.currentTime),this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:zh(e)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout((()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})}),2e3)},this.calculateVolume=e=>{if(0===e.length)return 0;let t=0;for(let n=0;n<e.length;n++)t+=e[n]/255;return t/=e.length,t<0?0:t>1?1:t},this.setVolume=({volume:e})=>{const t=Number.isFinite(e)?Math.min(1,Math.max(0,e)):1;this.volume=t,this.connection instanceof $h?this.connection.setAudioVolume(t):this.output.gain.gain.value=t},this.input=n,this.output=i,this.wakeLock=r,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage}async handleEndSession(){await super.handleEndSession();try{var e;await(null==(e=this.wakeLock)?void 0:e.release()),this.wakeLock=null}catch(e){}await this.input.close(),await this.output.close()}handleInterruption(e){super.handleInterruption(e),this.fadeOutAudio()}handleAudio(e){var t,n;this.lastInterruptTimestamp<=e.audio_event.event_id&&(null==(t=(n=this.options).onAudio)||t.call(n,e.audio_event.audio_base_64),this.connection instanceof $h||this.addAudioBase64Chunk(e.audio_event.audio_base_64),this.currentEventId=e.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(e){this.connection instanceof $h?this.connection.setMicMuted(e):this.input.setMuted(e)}getInputByteFrequencyData(){return null!=this.inputFrequencyData||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.connection instanceof $h?this.connection.getOutputByteFrequencyData()||new Uint8Array(1024):(null!=this.outputFrequencyData||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData)}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}async changeInputDevice({sampleRate:e,format:t,preferHeadphonesForIosDevices:n,inputDeviceId:i}){try{if(this.connection instanceof qh)try{return await this.input.setInputDevice(i),this.input}catch(e){console.warn("Failed to change device on existing input, recreating:",e)}this.connection instanceof $h&&await this.connection.setAudioInputDevice(i||""),await this.input.close();const r=await ep.create({sampleRate:null!=e?e:this.connection.inputFormat.sampleRate,format:null!=t?t:this.connection.inputFormat.format,preferHeadphonesForIosDevices:n,inputDeviceId:i,workletPaths:this.options.workletPaths,libsampleratePath:this.options.libsampleratePath});return this.input=r,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.input}catch(e){throw console.error("Error changing input device",e),e}}async changeOutputDevice({sampleRate:e,format:t,outputDeviceId:n}){try{if(this.connection instanceof qh)try{return await this.output.setOutputDevice(n),this.output}catch(e){console.warn("Failed to change device on existing output, recreating:",e)}this.connection instanceof $h&&await this.connection.setAudioOutputDevice(n||""),await this.output.close();const i=await np.create({sampleRate:null!=e?e:this.connection.outputFormat.sampleRate,format:null!=t?t:this.connection.outputFormat.format,outputDeviceId:n,workletPaths:this.options.workletPaths});return this.output=i,this.output}catch(e){throw console.error("Error changing output device",e),e}}}function rp(e,t,n="https://api.elevenlabs.io"){const i={};return"boolean"==typeof t?i.feedback=t?"like":"dislike":(i.rating=t.rating,i.comment=t.comment),fetch(`${n}/v1/convai/conversations/${e}/feedback`,{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}})}var op,ap,sp;!function(e){e.SESSION_STARTED="session_started",e.PARTIAL_TRANSCRIPT="partial_transcript",e.COMMITTED_TRANSCRIPT="committed_transcript",e.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS="committed_transcript_with_timestamps",e.AUTH_ERROR="auth_error",e.ERROR="error",e.OPEN="open",e.CLOSE="close",e.QUOTA_EXCEEDED="quota_exceeded"}(op||(op={})),function(e){e.PCM_8000="pcm_8000",e.PCM_16000="pcm_16000",e.PCM_22050="pcm_22050",e.PCM_24000="pcm_24000",e.PCM_44100="pcm_44100",e.PCM_48000="pcm_48000",e.ULAW_8000="ulaw_8000"}(ap||(ap={})),function(e){e.MANUAL="manual",e.VAD="vad"}(sp||(sp={}));class cp extends Nh{static startSession(e){return e.textOnly?Qh.startSession(e):ip.startSession(e)}}const lp=Qe(null);function dp({children:e}){var t,n;const i=Tp(),r=Pi((()=>{var e;return null!==(e=i.value.mic_muting_enabled)&&void 0!==e&&e})),o=Ei(null!==(t=null==(n=i.peek().auto_resume)?void 0:n.micMuted)&&void 0!==t&&t),a=At((()=>({isMuted:hi((()=>!!r.value&&o.value)),setIsMuted:e=>{o.value=e},isMutingEnabled:r})),[]);return ht(lp.Provider,{value:a,children:e})}function up(){return zi(lp)}const hp=Qe(null);function pp({children:e}){const{language:t}=tr(),n=Ki("override-prompt"),r=Ki("override-first-message"),o=Ki("override-voice-id"),a=Ki("override-text-only"),s=Ki("user-id"),c=Pi((()=>{var e;return{agent:{prompt:{prompt:n.value},firstMessage:r.value,language:t.value.languageCode},tts:{voiceId:o.value},conversation:{textOnly:null!==(e=ct(a.value))&&void 0!==e?e:void 0}}})),l=Ki("dynamic-variables"),d=Pi((()=>{if(l.value)try{return JSON.parse(l.value)}catch(e){console.error(`[ConversationalAI] Cannot parse dynamic-variables: ${null==e?void 0:e.message}`)}})),{webSocketUrl:u}=Yi(),h=Ki("agent-id"),p=Ki("signed-url"),m=Sp(),f=function(){const e=Tp();return Pi((()=>{var t;return null!==(t=e.value.use_rtc)&&void 0!==t&&t}))}(),g=Pi((()=>{const e=f.value,t={dynamicVariables:d.value,overrides:c.value,connectionDelay:{default:300},textOnly:m.value,userId:s.value||void 0};return h.value?i(e?{agentId:h.value,origin:u.value,connectionType:"webrtc"}:{agentId:h.value,origin:u.value,connectionType:"websocket"},t):p.value?i({signedUrl:p.value,connectionType:"websocket"},t):(console.error("[ConversationalAI] Either agent-id or signed-url is required"),null)}));return g.value?ht(hp.Provider,{value:g,children:e}):null}const mp=Qe(null);function fp({children:e}){const t=Tp(),n=At((()=>{const e=t.peek().terms_key,n=!!e&&!!localStorage.getItem(e),i=si(!1),r=si(n),o=hi((()=>!t.value.terms_html||r.value));let a=[];return{termsShown:i,termsAccepted:o,dismissTerms:()=>{i.value=!1,a.forEach((e=>e.reject())),a=[]},acceptTerms:()=>{r.value=!0,i.value=!1;const e=t.peek().terms_key;e&&localStorage.setItem(e,"true"),a.forEach((e=>e.resolve())),a=[]},requestTerms:async()=>{o.peek()||(i.value=!0,await new Promise(((e,t)=>{a.push({resolve:e,reject:t})})))}}}),[]);return ht(mp.Provider,{value:n,children:e})}function gp(){return zi(mp)}function vp(e){const t=Ot(e);return It((()=>{t.current=e}),[e]),Mt(((...e)=>t.current(...e)),[])}const bp=Qe(null);function yp({children:e}){const t=function(){const e=Ot(null),t=Ot(null),n=Ot(!1),r=Ot(null),o=Ot(null),a=Ot(!1),s=Tp(),c=xp(),l=gp(),d=zi(hp),{isMuted:u}=up(),{subscribe:h,publish:p}=function(){const e=Ot([]);return{subscribe:Mt((t=>(e.current=[...e.current,t],()=>{e.current=e.current.filter((e=>e!==t))})),[]),publish:Mt(((...t)=>{for(const n of e.current)n(...t)}),[])}}(),m=function(){const e=Ei(!1),t=vp((()=>{e.value=!0}));return Rt((()=>(window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)})),[t]),e}();return Ni((()=>{var t;const n=u.value;null==(t=null==e?void 0:e.current)||t.setMicMuted(n)})),Rt((()=>()=>{var t;null==(t=e.current)||t.endSession()}),[]),At((()=>{var f;const g=si("disconnected"),v=si(!1),b=hi((()=>v.value?"connecting":g.value)),y=hi((()=>"disconnected"===b.value)),k=si("listening"),w=hi((()=>"speaking"===k.value)),C=si(null),T=si(null),S=si(!1),_=si(null!==(f=s.value.transcript_entries)&&void 0!==f?f:[]),x=si(0),E=si(null);return{status:b,isSpeaking:w,mode:k,isDisconnected:y,lastId:T,error:C,canSendFeedback:S,conversationIndex:x,conversationTextOnly:E,transcript:_,startSession:async(h,f={})=>{var b,y,w,P,R,I,O,D,A,M,N,L;const U=f.resume?"/* continue */":f.initialMessage;if(await l.requestTerms(),null!=(P=e.current)&&P.isOpen())return e.current.getId();if(t.current)return(await t.current).getId();let F=structuredClone(d.peek());(null!=(R=f.resume)&&R.textOnly||f.initialMessage)&&s.value.supports_text_only&&(F.textOnly=!0,s.value.text_only||(null!==(b=F.overrides)&&void 0!==b||(F.overrides={}),null!==(y=(I=F.overrides).conversation)&&void 0!==y||(I.conversation={}),F.overrides.conversation.textOnly=!0));try{F=function(e,t,n){try{const r=new CustomEvent("elevenlabs-convai:call",{bubbles:!0,composed:!0,detail:i({config:t},n)});return e.dispatchEvent(r),r.detail.config}catch(e){return console.error("[ConversationalAI] Could not trigger call event:",e),t}}(h,F,{micMuted:u.peek(),setExpanded:e=>p(e)})}catch(e){console.error("[ConversationalAI] Error triggering call event:",e)}r.current=F,E.value=null!==(w=F.textOnly)&&void 0!==w&&w,f.initialMessage&&(_.value=[{type:"message",role:"user",message:f.initialMessage,isText:!0,conversationIndex:x.peek()}],null==(O=F.onSendUserMessage)||O.call(F,f.initialMessage));try{if(t.current=function(e,{signal:t,tries:n=5}={}){return async(...i)=>{t&&(t.value=!0);try{for(let t=1;t<=n;t++)try{return await e(...i)}catch(e){if(t===n)throw e;await new Promise((e=>setTimeout(e,1e3)))}}finally{t&&(t.value=!1)}}}(cp.startSession,{signal:v})(i(i({},F),{},{overrides:i(i({},F.overrides),{},{client:i(i({},null==(D=F.overrides)?void 0:D.client),{},{source:(null==(M=null==(A=F.overrides)?void 0:A.client)?void 0:M.source)||"widget",version:(null==(L=null==(N=F.overrides)?void 0:N.client)?void 0:L.version)||"0.5.2-cobrowse.3"})}),onModeChange:e=>{m.peek()||(k.value=e.mode)},onStatusChange:e=>{m.peek()||(g.value=e.status)},onCanSendFeedbackChange:e=>{m.peek()||(S.value=e.canSendFeedback)},onMessage:e=>{var t;const{source:i,message:r}=e;!c.peek()||!0!==E.peek()||"ai"!==i||n.current?("ai"===i&&(n.current=!0),null==(t=F.onMessage)||t.call(F,e),"ai"===i&&a.current?a.current=!1:_.value=[..._.value,{type:"message",role:i,message:r,isText:!1,conversationIndex:x.peek()}]):n.current=!0},onAgentChatResponsePart:({text:e,type:t})=>{if(c.peek()&&!0===E.peek()&&!n.current)return;const r=_.peek();if("start"===t)a.current=!0,o.current=r.length;else if("delta"===t){const t=o.current;if(null!==t&&e){var s;const n=[...r],o=null!==(s=n[t])&&void 0!==s?s:n[t]={type:"message",role:"ai",message:"",isText:!0,conversationIndex:x.peek()};"message"===o.type&&(n[t]=i(i({},o),{},{message:o.message+e}),_.value=n)}}else"stop"===t&&(o.current=null)},onDisconnect:e=>{var t;n.current=!1,!m.peek()&&(E.value=null,o.current=null,a.current=!1,_.value=[..._.value,"error"===e.reason?{type:"error",message:e.message,conversationIndex:x.peek()}:{type:"disconnection",role:"user"===e.reason?"user":"ai",conversationIndex:x.peek()}],x.value++,"error"===e.reason&&(C.value=e.message,console.error("[ConversationalAI] Disconnected due to an error:",e.message)),null==(t=F.onDisconnect)||t.call(F,e))}})),e.current=await t.current,e.current.setMicMuted(u.peek()),U){const t=e.current;setTimeout((()=>t.sendUserMessage(U)),100)}const r=e.current.getId();return T.value=r,C.value=null,r}catch(e){let t="Could not start a conversation.";e instanceof CloseEvent?t=e.reason||t:e instanceof Error&&(t=e.message||t),C.value=t,_.value=[..._.value,{type:"error",message:t,conversationIndex:x.peek()}]}finally{t.current=null}},endSession:async()=>{const t=e.current;e.current=null,await(null==t?void 0:t.endSession())},getInputVolume:()=>{var t,n;return null!==(t=null==(n=e.current)?void 0:n.getInputVolume())&&void 0!==t?t:0},getOutputVolume:()=>{var t,n;return null!==(t=null==(n=e.current)?void 0:n.getOutputVolume())&&void 0!==t?t:0},sendFeedback:t=>{var n;null==(n=e.current)||n.sendFeedback(t)},sendUserMessage:t=>{var n,i,o;null==(n=e.current)||n.sendUserMessage(t),_.value=[..._.value,{type:"message",role:"user",message:t,isText:!0,conversationIndex:x.peek()}],!function(e){return e.startsWith("/* ")&&e.endsWith(" */")}(t)&&(null==(o=null==(i=r.current)?void 0:i.onSendUserMessage)||o.call(i,t))},sendUserActivity:()=>{var t;null==(t=e.current)||t.sendUserActivity()},subscribeOnSetExpanded:h}}),[d,u])}();return Ni((()=>{if(!0===t.conversationTextOnly.value){t.transcript.value;const e=setTimeout((()=>{t.endSession()}),6e5);return()=>{clearTimeout(e)}}})),ht(bp.Provider,{value:t,children:e})}function kp(){return zi(bp)}const wp=Qe(null);function Cp({children:e}){const{serverUrl:t}=Yi(),n=Ki("agent-id"),r=Ki("override-config"),o=Ki("signed-url"),a=Ei(null);Ni((()=>{if(r.value)try{const e=JSON.parse(r.value);if(e)return void(a.value=e)}catch(e){console.error(`[ConversationalAI] Cannot parse override-config: ${null==e?void 0:e.message}`)}let e,i=n.value;if(o.value){var s,c;const t=new URL(o.value).searchParams;i=null!==(s=t.get("agent_id"))&&void 0!==s?s:n.value,e=null!==(c=t.get("conversation_signature"))&&void 0!==c?c:void 0}if(!i)return void(a.value=null);const l=new AbortController;return async function(e,t,n,i){const r=await(await fetch(`${t}/v1/convai/agents/${e}/widget${i?`?conversation_signature=${encodeURIComponent(i)}`:""}`,{signal:n})).json();if(!r.widget_config)throw new Error("Response does not contain widget_config");return r.widget_config}(i,t.value,l.signal,e).then((e=>{l.signal.aborted||(a.value=e)})).catch((e=>{console.error(`[ConversationalAI] Cannot fetch config for agent ${n.value}: ${null==e?void 0:e.message}`),l.signal.aborted||(a.value=null)})),()=>{l.abort()}}));const s=Ki("variant"),c=Ki("placement"),l=Ki("terms-key"),d=Ki("mic-muting"),u=Ki("transcript"),h=Ki("transcript-entries"),p=Ki("text-input"),m=Ki("default-expanded"),f=Ki("always-expanded"),g=Ki("override-text-only"),v=Ki("use-rtc"),b=Ki("auto-resume"),y=Pi((()=>{var e,t,n,r,o,y,k,w,C,T,S,_,x,E,P,R;if(!a.value)return null;const I=null!==(e=s.value)&&void 0!==e?e:a.value.variant,O=null!==(t=c.value)&&void 0!==t?t:a.value.placement,D=null!==(n=l.value)&&void 0!==n?n:a.value.terms_key,A=null!==(r=null!==(o=ct(g.value))&&void 0!==o?o:a.value.text_only)&&void 0!==r&&r,M=null!==(y=ct(d.value))&&void 0!==y?y:a.value.mic_muting_enabled,N=null!==(k=ct(u.value))&&void 0!==k?k:a.value.transcript_enabled,L=null!==(w=ct(p.value))&&void 0!==w?w:a.value.text_input_enabled,U=null!==(C=null!==(T=ct(f.value))&&void 0!==T?T:a.value.always_expanded)&&void 0!==C&&C,F=null!==(S=null!==(_=ct(m.value))&&void 0!==_?_:a.value.default_expanded)&&void 0!==S&&S,j=null!==(x=null!==(E=ct(v.value))&&void 0!==E?E:a.value.use_rtc)&&void 0!==x&&x,B=null!==(P=lt(b.value))&&void 0!==P?P:void 0,V=null!==(R=lt(h.value))&&void 0!==R?R:[];return i(i({},a.value),{},{variant:Ui(I),placement:ji(O),terms_key:D,mic_muting_enabled:!A&&M,transcript_enabled:A||N,transcript_entries:V,text_input_enabled:A||L,always_expanded:U,default_expanded:F,use_rtc:j,auto_resume:B})}));return y.value?ht(wp.Provider,{value:y,children:e}):null}function Tp(){return zi(wp)}function Sp(){const e=Ki("override-text-only"),t=Tp();return Pi((()=>{var n,i;return null!==(n=null!==(i=ct(e.value))&&void 0!==i?i:t.value.text_only)&&void 0!==n&&n}))}function _p(){const e=Sp(),{conversationTextOnly:t}=kp();return Pi((()=>{var n;return null!==(n=t.value)&&void 0!==n?n:e.value}))}function xp(){const e=Ki("override-first-message"),t=Tp(),{language:n}=tr();return Pi((()=>{var i,r,o,a,s;return null!==(i=null!==(r=null!==(o=e.value)&&void 0!==o?o:null==(s=null==(a=t.value.language_presets)?void 0:a[n.value.languageCode])?void 0:s.first_message)&&void 0!==r?r:t.value.first_message)&&void 0!==i?i:null}))}const Ep=en((function(){const e=Tp(),t=Pi((()=>{const t=e.value.styles;return`:host, :root {\n${Hi.map((e=>{var n;return`${function(e){return`--el-${e.replace(/_/g,"-")}`}(e)}: ${function(e){return"number"==typeof e?`${e}px`:e}(null!==(n=null==t?void 0:t[e])&&void 0!==n?n:qi[e])};`})).join("\n")}\n}`}));return ht("style",{children:[t,'@import"https://fonts.googleapis.com/css2?family=Inter:wght@400,500&display=swap";*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:currentColor}:before,:after{--tw-content: ""}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.\\!container{width:100%!important}.container{width:100%}@media (min-width: 640px){.\\!container{max-width:640px!important}.container{max-width:640px}}@media (min-width: 768px){.\\!container{max-width:768px!important}.container{max-width:768px}}@media (min-width: 1024px){.\\!container{max-width:1024px!important}.container{max-width:1024px}}@media (min-width: 1280px){.\\!container{max-width:1280px!important}.container{max-width:1280px}}@media (min-width: 1536px){.\\!container{max-width:1536px!important}.container{max-width:1536px}}.pointer-events-auto{pointer-events:auto}.\\!visible{visibility:visible!important}.visible{visibility:visible}.collapse{visibility:collapse}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{top:0;right:0;bottom:0;left:0}.-bottom-3{bottom:-12px}.bottom-0{bottom:0}.bottom-1{bottom:4px}.bottom-20{bottom:80px}.left-0{left:0}.left-1\\/2{left:50%}.left-4{left:16px}.right-0{right:0}.right-1{right:4px}.top-0{top:0}.top-1\\/2{top:50%}.top-20{top:80px}.top-4{top:16px}.top-\\[88px\\]{top:88px}.z-1{z-index:1}.z-10{z-index:10}.m-1{margin:4px}.-mx-0\\.5{margin-left:-2px;margin-right:-2px}.mx-1{margin-left:4px;margin-right:4px}.-mr-1\\.5{margin-right:-6px}.mb-4{margin-bottom:16px}.ml-auto{margin-left:auto}.mt-2{margin-top:8px}.mt-3{margin-top:12px}.block{display:block}.inline{display:inline}.\\!flex{display:flex!important}.flex{display:flex}.inline-flex{display:inline-flex}.grid{display:grid}.contents{display:contents}.hidden{display:none}.\\!h-8{height:32px!important}.h-11{height:44px}.h-4{height:16px}.h-48{height:192px}.h-5{height:20px}.h-6{height:24px}.h-7{height:28px}.h-8{height:32px}.h-9{height:36px}.h-\\[calc\\(100\\%-80px\\)\\]{height:calc(100% - 80px)}.h-full{height:100%}.h-screen{height:100vh}.max-h-\\[550px\\]{max-height:550px}.max-h-\\[8lh\\]{max-height:8lh}.max-h-\\[min\\(384px\\,var\\(--radix-select-content-available-height\\)\\)\\]{max-height:min(384px,var(--radix-select-content-available-height))}.min-h-0{min-height:0px}.min-h-\\[6lh\\]{min-height:6lh}.min-h-full{min-height:100%}.min-h-min{min-height:-moz-min-content;min-height:min-content}.\\!w-8{width:32px!important}.w-20{width:80px}.w-4{width:16px}.w-48{width:192px}.w-5{width:20px}.w-6{width:24px}.w-64{width:256px}.w-7{width:28px}.w-8{width:32px}.w-9{width:36px}.w-full{width:100%}.w-screen{width:100vw}.\\!min-w-60{min-width:240px!important}.min-w-0{min-width:0px}.min-w-60{min-width:240px}.min-w-9{min-width:36px}.min-w-\\[var\\(--radix-select-trigger-width\\)\\]{min-width:var(--radix-select-trigger-width)}.min-w-max{min-width:-moz-max-content;min-width:max-content}.min-w-min{min-width:-moz-min-content;min-width:min-content}.max-w-64{max-width:256px}.max-w-\\[400px\\]{max-width:400px}.shrink-0{flex-shrink:0}.grow{flex-grow:1}.origin-bottom{transform-origin:bottom}.origin-bottom-left{transform-origin:bottom left}.origin-bottom-right{transform-origin:bottom right}.origin-top{transform-origin:top}.origin-top-left{transform-origin:top left}.origin-top-right{transform-origin:top right}.-translate-x-1\\/2{--tw-translate-x: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-1\\/2{--tw-translate-y: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-\\[calc\\(var\\(--el-overlay-padding\\)\\)\\]{--tw-translate-y: calc(calc(var(--el-overlay-padding)) * -1);transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-1\\/2{--tw-translate-y: 50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-\\[calc\\(var\\(--el-overlay-padding\\)\\)\\]{--tw-translate-y: calc(var(--el-overlay-padding));transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-full{--tw-translate-y: 100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-rotate-180{--tw-rotate: -180deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-rotate-90{--tw-rotate: -90deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-100{--tw-scale-x: 1;--tw-scale-y: 1;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-150{--tw-scale-x: 1.5;--tw-scale-y: 1.5;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-75{--tw-scale-x: .75;--tw-scale-y: .75;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-90{--tw-scale-x: .9;--tw-scale-y: .9;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-\\[0\\.1667\\]{--tw-scale-x: .1667;--tw-scale-y: .1667;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.cursor-default{cursor:default}.cursor-pointer{cursor:pointer}.select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.resize-none{resize:none}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-col-reverse{flex-direction:column-reverse}.place-content-center{place-content:center}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.gap-1{gap:4px}.gap-2{gap:8px}.gap-2\\.5{gap:10px}.gap-3{gap:12px}.gap-8{gap:32px}.overflow-hidden{overflow:hidden}.overflow-y-auto{overflow-y:auto}.overflow-x-hidden{overflow-x:hidden}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.whitespace-nowrap{white-space:nowrap}.break-all{word-break:break-all}.rounded-\\[calc\\(var\\(--el-button-radius\\)\\+4px\\)\\]{border-radius:calc(var(--el-button-radius) + 4px)}.rounded-bubble{border-radius:var(--el-bubble-radius)}.rounded-button{border-radius:var(--el-button-radius)}.rounded-compact-sheet{border-radius:var(--el-compact-sheet-radius)}.rounded-dropdown-sheet{border-radius:var(--el-dropdown-sheet-radius)}.rounded-full{border-radius:9999px}.rounded-input{border-radius:var(--el-input-radius)}.rounded-sheet{border-radius:var(--el-sheet-radius)}.border{border-width:1px}.border-accent{border-color:var(--el-accent)}.border-base{border-color:var(--el-base)}.border-base-border{border-color:var(--el-base-border)}.bg-accent{background-color:var(--el-accent)}.bg-base{background-color:var(--el-base)}.bg-base-active{background-color:var(--el-base-active)}.bg-base-border{background-color:var(--el-base-border)}.bg-base-hover{background-color:var(--el-base-hover)}.bg-cover{background-size:cover}.object-cover{-o-object-fit:cover;object-fit:cover}.p-1{padding:4px}.p-1\\.5{padding:6px}.p-2{padding:8px}.p-3{padding:12px}.p-4{padding:16px}.px-1{padding-left:4px;padding-right:4px}.px-1\\.5{padding-left:6px;padding-right:6px}.px-2{padding-left:8px;padding-right:8px}.px-2\\.5{padding-left:10px;padding-right:10px}.px-3{padding-left:12px;padding-right:12px}.px-4{padding-left:16px;padding-right:16px}.px-8{padding-left:32px;padding-right:32px}.py-1\\.5{padding-top:6px;padding-bottom:6px}.py-2\\.5{padding-top:10px;padding-bottom:10px}.py-4{padding-top:16px;padding-bottom:16px}.py-\\[calc\\(theme\\(spacing\\.2\\)-1px\\)\\]{padding-top:7px;padding-bottom:7px}.pb-1{padding-bottom:4px}.pb-2{padding-bottom:8px}.pb-3{padding-bottom:12px}.pl-16{padding-left:64px}.pr-16{padding-right:64px}.pr-3{padding-right:12px}.pr-9{padding-right:36px}.pt-1{padding-top:4px}.pt-3{padding-top:12px}.pt-4{padding-top:16px}.text-center{text-align:center}.text-\\[10px\\]{font-size:10px}.text-lg{font-size:18px;line-height:26px}.text-md{font-size:16px;line-height:24px}.text-sm{font-size:14px;line-height:20px}.text-xl{font-size:20px;line-height:28px}.text-xs{font-size:12px;line-height:16px}.font-medium{font-weight:500}.text-accent-primary{color:var(--el-accent-primary)}.text-base-border{color:var(--el-base-border)}.text-base-error{color:var(--el-base-error)}.text-base-primary{color:var(--el-base-primary)}.text-base-subtle{color:var(--el-base-subtle)}.underline{text-decoration-line:underline}.opacity-0{opacity:0}.opacity-30{opacity:.3}.shadow-header{--tw-shadow: 0 0 1px 0 rgba(0, 0, 0, .4), 0 2px 2px 0 rgba(0, 0, 0, .04);--tw-shadow-colored: 0 0 1px 0 var(--tw-shadow-color), 0 2px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow: 0 2px 40px 1px rgba(0, 0, 0, .12);--tw-shadow-colored: 0 2px 40px 1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-md{--tw-shadow: 0 2px 24px 1px rgba(0, 0, 0, .16);--tw-shadow-colored: 0 2px 24px 1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-\\[border-radius\\]{transition-property:border-radius;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-\\[margin\\]{transition-property:margin;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-\\[opacity\\,transform\\]{transition-property:opacity,transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-\\[opacity\\,width\\,height\\,transform\\,flex-grow\\]{transition-property:opacity,width,height,transform,flex-grow;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-\\[transform\\,left\\,top\\,opacity\\,scale\\]{transition-property:transform,left,top,opacity,scale;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-\\[transform\\,opacity\\]{transition-property:transform,opacity;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-200{transition-duration:.2s}.duration-300{transition-duration:.3s}.ease-out{transition-timing-function:cubic-bezier(0,0,.2,1)}.overlay{position:absolute;inset:var(--el-overlay-padding);right:calc(var(--el-overlay-padding) + var(--removed-body-scroll-bar-size, 0px))}.focus-ring{--tw-ring-color: var(--el-accent);--tw-ring-offset-width: 2px;--tw-ring-offset-color: var(--el-base)}.focus-ring:focus-visible{outline:2px solid transparent;outline-offset:2px;--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.animate-text{background-image:linear-gradient(75deg,var(--el-base-primary),var(--el-base-subtle),var(--el-base-primary),var(--el-base-subtle));background-size:300% 100%;-webkit-background-clip:text;background-clip:text;color:transparent;animation:TextAnimation 2s linear infinite}@keyframes TextAnimation{0%{background-position:0 0}to{background-position:100% 0}}.\\!terms h6,.terms h6{font-size:12px;line-height:16px;font-weight:500;color:var(--el-base-primary)}.\\!terms h5,.terms h5{font-size:14px;line-height:20px;font-weight:500;color:var(--el-base-primary)}.\\!terms h4,.terms h4{font-size:16px;line-height:24px;font-weight:500;color:var(--el-base-primary)}.\\!terms h3,.terms h3{font-size:18px;line-height:26px;font-weight:500;color:var(--el-base-primary)}.\\!terms h2,.terms h2{font-size:20px;line-height:28px;font-weight:500;color:var(--el-base-primary)}.\\!terms h2,.terms h2{font-size:24px;line-height:30px;font-weight:500;color:var(--el-base-primary)}.\\[field-sizing\\:content\\]{field-sizing:content}.\\[line-height\\:var\\(--el-overlay-padding\\)\\]{line-height:var(--el-overlay-padding)}.\\[overflow-wrap\\:break-word\\]{overflow-wrap:break-word}.dev-host,:host{pointer-events:none;position:fixed;top:0;right:0;bottom:0;left:0;z-index:1000;font-size:16px;line-height:24px;color:var(--el-base-primary);font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;scrollbar-color:#e5e7eb transparent}.placeholder\\:text-base-subtle::-moz-placeholder{color:var(--el-base-subtle)}.placeholder\\:text-base-subtle::placeholder{color:var(--el-base-subtle)}.hover\\:border-accent-hover:hover{border-color:var(--el-accent-hover)}.hover\\:border-base-hover:hover{border-color:var(--el-base-hover)}.hover\\:bg-accent-hover:hover{background-color:var(--el-accent-hover)}.hover\\:bg-base-hover:hover{background-color:var(--el-base-hover)}.hover\\:opacity-50:hover{opacity:.5}.focus-visible\\:underline-offset-2:focus-visible{text-underline-offset:2px}.focus-visible\\:opacity-100:focus-visible{opacity:1}.focus-visible\\:outline-none:focus-visible{outline:2px solid transparent;outline-offset:2px}.active\\:border-accent-active:active{border-color:var(--el-accent-active)}.active\\:border-base-active:active{border-color:var(--el-base-active)}.active\\:bg-accent-active:active{background-color:var(--el-accent-active)}.active\\:bg-base-active:active{background-color:var(--el-base-active)}.data-hidden\\:-translate-y-4[data-shown=false]{--tw-translate-y: -16px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-hidden\\:translate-x-full[data-shown=false]{--tw-translate-x: 100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-hidden\\:translate-y-2[data-shown=false]{--tw-translate-y: 8px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-hidden\\:scale-100[data-shown=false]{--tw-scale-x: 1;--tw-scale-y: 1;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-hidden\\:scale-75[data-shown=false]{--tw-scale-x: .75;--tw-scale-y: .75;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-hidden\\:scale-90[data-shown=false]{--tw-scale-x: .9;--tw-scale-y: .9;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-hidden\\:opacity-0[data-shown=false]{opacity:0}.data-\\[highlighted\\]\\:bg-base-active[data-highlighted]{background-color:var(--el-base-active)}']})})),Pp=Qe(null);function Rp({children:e}){const t=Tp(),{language:n}=tr(),i=Ki("text-contents"),r=Pi((()=>{try{if(i.value){const e=JSON.parse(i.value);if("object"==typeof e)return e}}catch(e){console.error("[ConversationalAI] Cannot parse text-contents:",e)}return{}})),o=At((()=>Object.fromEntries(Vi.map((e=>[e,hi((()=>{var i,o,a,s,c,l,d;return null!==(i=null!==(o=null!==(a=r.value[e])&&void 0!==a?a:null==(l=null==(c=null==(s=t.value.language_presets)?void 0:s[n.value.languageCode])?void 0:c.text_contents)?void 0:l[e])&&void 0!==o?o:null==(d=t.value.text_contents)?void 0:d[e])&&void 0!==i?i:Bi[e]}))])))),[]);return ht(Pp.Provider,{value:o,children:e})}function Ip(){return zi(Pp)}const Op=Qe(null);function Dp({children:e}){const t=Tp(),n=Ki("avatar-image-url"),i=Ki("avatar-orb-color-1"),r=Ki("avatar-orb-color-2"),o=Ei(""),a=Pi((()=>n.value?{type:"image",url:n.value}:i.value&&r.value?{type:"orb",color_1:i.value,color_2:r.value}:t.value.avatar)),s=Pi((()=>{switch(a.value.type){case"url":return a.value.custom_url;case"orb":return o.value;case"image":return a.value.url}})),c=At((()=>({config:a,previewUrl:s,canvasUrl:o})),[]);return ht(Op.Provider,{value:c,children:e})}function Ap(){return zi(Op)}function Mp(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(n=Mp(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}function Np(){for(var e,t,n=0,i="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=Mp(e))&&(i&&(i+=" "),i+=t);return i}const Lp=Qe(null);function Up(e){let{children:t}=e,n=r(e,l);const[o,a]=Et(null);return ht("div",i(i({ref:a},n),{},{children:o&&ht(Lp.Provider,{value:o,children:t})}))}function Fp(){return zi(Lp)}function jp(e){return e&&"object"==typeof e&&"peek"in e}function Bp(e){return jp(e)?e.value:e}function Vp(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function qp(...e){return t=>{let n=!1;const i=e.map((e=>{const i=Vp(e,t);return!n&&"function"==typeof i&&(n=!0),i}));if(n)return()=>{for(let t=0;t<i.length;t++){const n=i[t];"function"==typeof n?n():Vp(e[t],null)}}}}function Hp(...e){return Mt(qp(...e),e)}function zp(e){const t=Gp(e),n=rn(((e,n)=>{const{children:o}=e,a=r(e,d),s=an.toArray(o),c=s.find($p);if(c){const e=c.props.children,r=s.map((t=>t===c?an.count(e)>1?an.only(null):Fn(e)?e.props.children:null:t));return ht(t,i(i({},a),{},{ref:n,children:Fn(e)?Vn(e,void 0,r):null}))}return ht(t,i(i({},a),{},{ref:n,children:o}))}));return n.displayName=`${e}.Slot`,n}var Wp=zp("Slot");function Gp(e){const t=rn(((e,t)=>{const{children:n}=e,o=r(e,u);if(Fn(n)){const e=function(e){var t,n;let i=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,r=i&&"isReactWarning"in i&&i.isReactWarning;return r?e.ref:(i=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get,r=i&&"isReactWarning"in i&&i.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}(n),r=function(e,t){const n=i({},t);for(const r in t){const o=e[r],a=t[r];/^on[A-Z]/.test(r)?o&&a?n[r]=(...e)=>{const t=a(...e);return o(...e),t}:o&&(n[r]=o):"style"===r?n[r]=i(i({},o),a):"className"===r&&(n[r]=[o,a].filter(Boolean).join(" "))}return i(i({},e),n)}(o,n.props);return n.type!==Re&&(r.ref=t?qp(t,e):e),Vn(n,r)}return an.count(n)>1?an.only(null):null}));return t.displayName=`${e}.SlotClone`,t}var Kp=Symbol("radix.slottable");function $p(e){return Fn(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===Kp}const Jp=window.matchMedia("(prefers-reduced-motion: reduce)");function Yp(){const e=Ei(Jp.matches);return Rt((()=>{const t=t=>{e.value=t.matches};return Jp.addEventListener("change",t),()=>Jp.removeEventListener("change",t)}),[]),e}function Xp({onStart:e,onEnd:t}){var n;const i=Ot();null!==(n=i.current)&&void 0!==n||(i.current=new Set);const r=Ot(e);r.current=e;const o=Ot(t);o.current=t;const a=Ei(!1),s=Mt((e=>{var t,n;e.target===e.currentTarget&&(null==(t=i.current)||t.add(e.propertyName),a.peek()||(a.value=!0,null==(n=r.current)||n.call(r)))}),[]),c=Mt((e=>{var t,n,r;e.target===e.currentTarget&&(null==(t=i.current)||t.delete(e.propertyName),null!=(n=i.current)&&n.size||(a.value=!1,null==(r=o.current)||r.call(o)))}),[]);return{transitioning:a,handlers:{onTransitionStart:s,onTransitionEnd:c}}}function Qp(e){return ht(Yp().value?Zp:em,i({},e))}function Zp(e){let{active:t}=e,n=r(e,h);return Bp(t)?ht(Wp,i({"data-shown":!0},n)):null}function em(e){let{active:t,initial:n=t}=e,o=r(e,p);const a=function(e){const t=jp(e),n=Ei(t?e.peek():e);return t?e:(n.value=e,n)}(t),s=Ei(function(e){return jp(e)?e.peek():e}(n));Ni((()=>{a.value&&(s.value=a.value)}));const{handlers:c}=Xp({onEnd:()=>{s.value=a.value}});return a.value||s.value?ht(Wp,i(i({"data-shown":a.value&&s.value},c),o)):null}const tm=new Float32Array([-1,1,-1,-1,1,1,1,-1]),nm=class e{constructor(t){ye(this,"gl"),ye(this,"program"),ye(this,"startTime"),ye(this,"targetSpeed",0),ye(this,"speed",.5),ye(this,"rafId",null),ye(this,"resizeObserver"),ye(this,"colorA",[0,0,0]),ye(this,"colorB",[0,0,0]),ye(this,"offsets",new Float32Array(7).map((()=>Math.random()*Math.PI*2))),ye(this,"copyNoiseImage",(()=>{this.gl&&(this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e.noiseImage),this.gl.generateMipmap(this.gl.TEXTURE_2D))})),ye(this,"toDataURL",(()=>this.gl.canvas.toDataURL("image/png"))),ye(this,"render",(()=>{if(!this.gl)return void(this.rafId=null);const e=(performance.now()-this.startTime)/1e3;this.gl.uniform1f(this.gl.getUniformLocation(this.program,"uTime"),e),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.rafId=requestAnimationFrame(this.render)}));const n=t.getContext("webgl2",{depth:!1,stencil:!1});this.gl=n,this.program=this.setupProgram("#version 300 es\nprecision highp float;\n\nuniform float uTime;\nuniform float uOffsets[7];\nuniform vec3 uColor1;\nuniform vec3 uColor2;\nuniform sampler2D uPerlinTexture;\n\nin vec2 vUv;\n\nout vec4 outColor;\n\nconst float PI = 3.14159265358979323846;\n\n// Draw a single oval with soft edges and calculate its gradient color\nbool drawOval(vec2 polarUv, vec2 polarCenter, float a, float b, bool reverseGradient, float softness, out vec4 color) {\n    vec2 p = polarUv - polarCenter;\n    float oval = (p.x * p.x) / (a * a) + (p.y * p.y) / (b * b);\n    \n    float edge = smoothstep(1.0, 1.0 - softness, oval);\n    \n    if (edge > 0.0) {\n        float gradient = reverseGradient ? (1.0 - (p.x / a + 1.0) / 2.0) : ((p.x / a + 1.0) / 2.0);\n        color = vec4(vec3(gradient), 0.8 * edge);\n        return true;\n    }\n    return false;\n}\n\n// Map grayscale value to a 4-color ramp (color1, color2, color3, color4)\nvec3 colorRamp(float grayscale, vec3 color1, vec3 color2, vec3 color3, vec3 color4) {\n    if (grayscale < 0.33) {\n        return mix(color1, color2, grayscale * 3.0);\n    } else if (grayscale < 0.66) {\n        return mix(color2, color3, (grayscale - 0.33) * 3.0);\n    } else {\n        return mix(color3, color4, (grayscale - 0.66) * 3.0);\n    }\n}\n\nvec2 hash2(vec2 p) {\n    return fract(sin(vec2(dot(p, vec2(127.1, 311.7)), dot(p, vec2(269.5, 183.3)))) * 43758.5453);\n}\n\n// 2D noise for the ring\nfloat noise2D(vec2 p) {\n    vec2 i = floor(p);\n    vec2 f = fract(p);\n    \n    vec2 u = f * f * (3.0 - 2.0 * f);\n    float n = mix(\n        mix(dot(hash2(i + vec2(0.0, 0.0)), f - vec2(0.0, 0.0)),\n            dot(hash2(i + vec2(1.0, 0.0)), f - vec2(1.0, 0.0)), u.x),\n        mix(dot(hash2(i + vec2(0.0, 1.0)), f - vec2(0.0, 1.0)),\n            dot(hash2(i + vec2(1.0, 1.0)), f - vec2(1.0, 1.0)), u.x),\n        u.y\n    );\n\n    return 0.5 + 0.5 * n;\n}\n\nfloat sharpRing(vec2 uv, float theta, float time) {\n    float ringStart = 1.0;\n    float ringWidth = 0.5;\n    float noiseScale = 5.0;\n    \n    vec2 noiseCoord = vec2(theta / (2.0 * PI), time * 0.1);\n    noiseCoord *= noiseScale;\n    \n    float noise = noise2D(noiseCoord);\n    noise = (noise - 0.5) * 4.0;\n    \n    return ringStart + noise * ringWidth * 1.5;\n}\n\nfloat smoothRing(vec2 uv, float time) {\n    float angle = atan(uv.y, uv.x);\n    if (angle < 0.0) angle += 2.0 * PI;\n    \n    vec2 noiseCoord = vec2(angle / (2.0 * PI), time * 0.1);\n    noiseCoord *= 6.0;\n    \n    float noise = noise2D(noiseCoord);\n    noise = (noise - 0.5) * 8.0;\n    \n    float ringStart = 0.9;\n    float ringWidth = 0.3;\n    \n    return ringStart + noise * ringWidth;\n}\n\nvoid main() {\n    // Normalize vUv to be centered around (0.0, 0.0)\n    vec2 uv = vUv * 2.0 - 1.0;\n\n    // Convert uv to polar coordinates\n    float radius = length(uv);\n    float theta = atan(uv.y, uv.x);\n    if (theta < 0.0) theta += 2.0 * PI; // Normalize theta to [0, 2*PI]\n\n    // Initialize the base color to white\n    vec4 color = vec4(1.0, 1.0, 1.0, 1.0);\n\n    // Original parameters for the ovals in polar coordinates\n    float originalCenters[7] = float[7](0.0, 0.5 * PI, 1.0 * PI, 1.5 * PI, 2.0 * PI, 2.5 * PI, 3.0 * PI);\n\n    // Parameters for the animated centers in polar coordinates\n    float centers[7];\n    for (int i = 0; i < 7; i++) {\n        centers[i] = originalCenters[i] + 0.5 * sin(uTime / 20.0 + uOffsets[i]);\n    }\n\n    float a, b;\n    vec4 ovalColor;\n\n    // Check if the pixel is inside any of the ovals\n    for (int i = 0; i < 7; i++) {\n        float noise = texture(uPerlinTexture, vec2(mod(centers[i] + uTime * 0.05, 1.0), 0.5)).r;\n        a = noise * 1.5; // Increased variance: goes from 0.0 to 1.0\n        b = noise * 4.5; // Tall semi-minor axis\n        bool reverseGradient = (i % 2 == 1); // Reverse gradient for every second oval\n\n        // Calculate the distance in polar coordinates\n        float distTheta = abs(theta - centers[i]);\n        if (distTheta > PI) distTheta = 2.0 * PI - distTheta; // Shortest distance on circle\n        float distRadius = radius;\n\n        float softness = 0.4; // Controls edge softness (e.g. how much blur is applied to the ovals)\n\n        // Check if the pixel is inside the oval in polar coordinates\n        if (drawOval(vec2(distTheta, distRadius), vec2(0.0, 0.0), a, b, reverseGradient, softness, ovalColor)) {\n            // Blend the oval color with the existing color\n            color.rgb = mix(color.rgb, ovalColor.rgb, ovalColor.a);\n            color.a = max(color.a, ovalColor.a); // Max alpha\n        }\n    }\n    \n    // Calculate both noisy rings\n    float ringRadius1 = sharpRing(uv, theta, uTime);\n    float ringRadius2 = smoothRing(uv, uTime);\n    \n    // Blend both rings\n    float ringAlpha1 = (radius >= ringRadius1) ? 0.3 : 0.0;\n    float ringAlpha2 = smoothstep(ringRadius2 - 0.05, ringRadius2 + 0.05, radius) * 0.25;\n    \n    float totalRingAlpha = max(ringAlpha1, ringAlpha2);\n    \n    // Apply screen blend mode for combined rings\n    vec3 ringColor = vec3(1.0); // White ring color\n    color.rgb = 1.0 - (1.0 - color.rgb) * (1.0 - ringColor * totalRingAlpha);\n\n    // Define colours to ramp against greyscale (could increase the amount of colours in the ramp)\n    vec3 color1 = vec3(0.0, 0.0, 0.0); // Black\n    vec3 color2 = uColor1; // Darker Color\n    vec3 color3 = uColor2; // Lighter Color\n    vec3 color4 = vec3(1.0, 1.0, 1.0); // White\n\n    // Convert grayscale color to the color ramp\n    float luminance = color.r; \n    color.rgb = colorRamp(luminance, color1, color2, color3, color4); // Apply the color ramp\n\n    outColor = color;\n}\n","#version 300 es\nprecision highp float;\n\nin vec2 position;\n\nout vec2 vUv;\n\nvoid main() {\n  vUv = position * 0.5 + 0.5;\n  gl_Position = vec4(position, 0, 1);\n}\n");const i=n.createTexture();n.bindTexture(n.TEXTURE_2D,i),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,new Uint8Array([128,128,128,255])),e.noiseImage||(e.noiseImage=new Image,e.noiseImage.crossOrigin="anonymous",e.noiseImage.src="https://storage.googleapis.com/eleven-public-cdn/images/perlin-noise.png"),e.noiseImage.complete?this.copyNoiseImage():e.noiseImage.addEventListener("load",this.copyNoiseImage);const r=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferData(n.ARRAY_BUFFER,tm,n.STATIC_DRAW),n.vertexAttribPointer(0,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(0),this.updateColors("#2792DC","#9CE6E6"),this.resizeObserver=new ResizeObserver((e=>{const n=e[0],i=n.devicePixelContentBoxSize?n.devicePixelContentBoxSize[0]:n.contentBoxSize[0];t.width=Math.min(512,i.inlineSize),t.height=Math.min(512,i.blockSize),this.updateViewport()}));const o=t.parentElement;if(o)try{this.resizeObserver.observe(o,{box:"device-pixel-content-box"})}catch(e){this.resizeObserver.observe(o)}this.startTime=performance.now(),this.rafId=requestAnimationFrame(this.render)}dispose(){var e;null!==this.rafId&&cancelAnimationFrame(this.rafId),null==(e=this.resizeObserver)||e.disconnect(),this.gl=null,this.program=null}updateViewport(){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}updateColors(e,t){var n,i;this.gl&&(this.colorA=null!==(n=this.updateColor("uColor1",e))&&void 0!==n?n:this.colorA,this.colorB=null!==(i=this.updateColor("uColor2",t))&&void 0!==i?i:this.colorB)}updateVolume(e,t){this.targetSpeed=.2+1.8*(1-Math.pow(t-1,2)),this.targetSpeed>this.speed&&(this.speed=this.targetSpeed),this.gl.uniform1f(this.gl.getUniformLocation(this.program,"uInputVolume"),e),this.gl.uniform1f(this.gl.getUniformLocation(this.program,"uOutputVolume"),t)}updateColor(e,t){try{const n=parseInt(t.slice(1,3),16)/255,i=parseInt(t.slice(3,5),16)/255,r=parseInt(t.slice(5,7),16)/255,o=[Math.pow(n,2.2),Math.pow(i,2.2),Math.pow(r,2.2)];return this.gl.uniform3fv(this.gl.getUniformLocation(this.program,e),o),o}catch(e){console.error(`[ConversationalAI] Failed to parse ${t} as color:`,e)}}setupProgram(e,t){const n=this.getShader(this.gl.FRAGMENT_SHADER,e),i=this.getShader(this.gl.VERTEX_SHADER,t);if(!n||!i)throw new Error("Failed to compile shaders");if(this.program=this.gl.createProgram(),this.gl.attachShader(this.program,n),this.gl.attachShader(this.program,i),this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))throw new Error("Failed to link program");return this.gl.useProgram(this.program),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"uPerlinTexture"),0),this.gl.uniform1fv(this.gl.getUniformLocation(this.program,"uOffsets"),this.offsets),this.gl.uniform3fv(this.gl.getUniformLocation(this.program,"uColor1"),this.colorA),this.gl.uniform3fv(this.gl.getUniformLocation(this.program,"uColor2"),this.colorB),this.program}getShader(e,t){const n=this.gl.createShader(e);return this.gl.shaderSource(n,t),this.gl.compileShader(n),this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)?n:(this.gl.deleteShader(n),null)}};ye(nm,"noiseImage");let im=nm;const rm={sm:"w-9 h-9",lg:"w-48 h-48"};function om({size:e="sm",className:t}){const{getInputVolume:n,getOutputVolume:i,isSpeaking:r,isDisconnected:o}=kp(),{config:a}=Ap(),s=Ot(null),c=Ot(null);Ni((()=>{if(o.value)return s.current.style.transform="",void(c.current.style.transform="");let e;return function t(){const o=n(),a=i(),l=r.peek()?1:1-.4*o,d=r.peek()?1+.4*a:1;s.current.style.transform=`scale(${d})`,c.current.style.transform=`scale(${l})`,e=requestAnimationFrame(t)}(),()=>{cancelAnimationFrame(e)}}));const l=Pi((()=>({backgroundImage:"image"===a.value.type?`url(${a.value.url})`:"url"===a.value.type?`url(${a.value.custom_url})`:void 0})));return ht("div",{className:Np("relative shrink-0",rm[e],t),children:[ht("div",{ref:s,className:"absolute inset-0 rounded-full bg-base-border"}),ht("div",{ref:c,style:l,className:"absolute inset-0 rounded-full overflow-hidden bg-base bg-cover",children:"orb"===a.value.type&&ht(am,{color1:a.value.color_1,color2:a.value.color_2})})]})}function am({color1:e,color2:t}){const{canvasUrl:n}=Ap(),[i,r]=Et(null);return Rt((()=>{i&&(i.updateColors(e,t),i.render(),n.value=i.toDataURL())}),[i,e,t]),ht("canvas",{className:"w-full h-full",ref:Mt((e=>{if(e){const t=new im(e);return r(t),()=>t.dispose()}r(null)}),[r])})}const sm={phone:function(e){return ht("svg",i(i({height:"1em",width:"1em",viewBox:"0 0 18 18",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},e),{},{children:ht("path",{d:"M3.7489 2.25C2.93286 2.25 2.21942 2.92142 2.27338 3.7963C2.6686 10.2041 7.79483 15.3303 14.2026 15.7255C15.0775 15.7795 15.7489 15.066 15.7489 14.25V11.958C15.7489 11.2956 15.3144 10.7116 14.6799 10.5213L12.6435 9.91035C12.1149 9.75179 11.542 9.89623 11.1518 10.2864L10.5901 10.8482C9.15291 10.0389 7.95998 8.84599 7.15074 7.40881L7.71246 6.84709C8.10266 6.45689 8.24711 5.88396 8.08854 5.35541L7.47761 3.31898C7.28727 2.6845 6.70329 2.25 6.04087 2.25H3.7489Z"})}))},"phone-off":function(e){return ht("svg",i(i({height:"1em",width:"1em",viewBox:"0 0 19 18",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},e),{},{children:[ht("path",{d:"M16.0303 3.53033C16.3232 3.23744 16.3232 2.76256 16.0303 2.46967C15.7374 2.17678 15.2626 2.17678 14.9697 2.46967L8.6271 8.81224C8.25925 8.3778 7.93185 7.90804 7.65074 7.40881L8.21246 6.84709C8.60266 6.45689 8.74711 5.88396 8.58854 5.35541L7.97761 3.31898C7.78727 2.6845 7.20329 2.25 6.54087 2.25H4.2489C3.43286 2.25 2.71942 2.92142 2.77338 3.7963C2.95462 6.73468 4.13069 9.40357 5.96899 11.4703L2.96967 14.4697C2.67678 14.7626 2.67678 15.2374 2.96967 15.5303C3.26256 15.8232 3.73744 15.8232 4.03033 15.5303L16.0303 3.53033Z"}),ht("path",{d:"M14.7026 15.7255C12.2994 15.5773 10.0765 14.7636 8.21584 13.4665L10.9278 10.7545C10.9815 10.7863 11.0356 10.8175 11.0901 10.8482L11.6518 10.2864C12.042 9.89623 12.6149 9.75179 13.1435 9.91035L15.1799 10.5213C15.8144 10.7116 16.2489 11.2956 16.2489 11.958V14.25C16.2489 15.066 15.5775 15.7795 14.7026 15.7255Z"})]}))},chat:function(e){return ht("svg",i(i({height:"1em",width:"1em",viewBox:"0 0 19 18",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},e),{},{children:ht("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M1.5 6.75C1.5 4.26472 3.51472 2.25 6 2.25H12C14.4853 2.25 16.5 4.26472 16.5 6.75V11.25C16.5 13.7353 14.4853 15.75 12 15.75H2.25C1.83579 15.75 1.5 15.4142 1.5 15V6.75ZM6 9.9375C5.48223 9.9375 5.0625 9.51777 5.0625 9C5.0625 8.48223 5.48223 8.0625 6 8.0625C6.51777 8.0625 6.9375 8.48223 6.9375 9C6.9375 9.51777 6.51777 9.9375 6 9.9375ZM9 9.9375C8.48223 9.9375 8.0625 9.51777 8.0625 9C8.0625 8.48223 8.48223 8.0625 9 8.0625C9.51777 8.0625 9.9375 8.48223 9.9375 9C9.9375 9.51777 9.51777 9.9375 9 9.9375ZM11.0625 9C11.0625 9.51777 11.4822 9.9375 12 9.9375C12.5178 9.9375 12.9375 9.51777 12.9375 9C12.9375 8.48223 12.5178 8.0625 12 8.0625C11.4822 8.0625 11.0625 8.48223 11.0625 9Z"})}))},mic:function(e){return ht("svg",i(i({height:"1em",width:"1em",viewBox:"0 0 19 18",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},e),{},{children:[ht("path",{d:"M9.50008 1.5C7.42901 1.5 5.75008 3.17893 5.75008 5.25V8.25C5.75008 10.3211 7.42901 12 9.50008 12C11.5712 12 13.2501 10.3211 13.2501 8.25V5.25C13.2501 3.17893 11.5712 1.5 9.50008 1.5Z"}),ht("path",{d:"M4.88997 10.8417C4.66448 10.4943 4.20002 10.3954 3.85256 10.6209C3.50509 10.8463 3.40621 11.3108 3.63169 11.6583C4.47442 12.9569 6.08493 14.6838 8.75008 14.9616V15.75C8.75008 16.1642 9.08587 16.5 9.50008 16.5C9.9143 16.5 10.2501 16.1642 10.2501 15.75V14.9616C12.9152 14.6838 14.5257 12.9569 15.3685 11.6583C15.594 11.3108 15.4951 10.8463 15.1476 10.6209C14.8001 10.3954 14.3357 10.4943 14.1102 10.8417C13.3305 12.0432 11.9002 13.5 9.50008 13.5C7.1 13.5 5.66968 12.0432 4.88997 10.8417Z"})]}))},"mic-off":function(e){return ht("svg",i(i({height:"1em",width:"1em",viewBox:"0 0 19 18",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},e),{},{children:[ht("path",{d:"M13.25 8.25C13.25 8.64791 13.188 9.03135 13.0732 9.39119L6.57947 2.8975C7.26687 2.04521 8.31974 1.5 9.49995 1.5C11.571 1.5 13.25 3.17893 13.25 5.25V8.25Z"}),ht("path",{d:"M2.21967 1.71967C2.51256 1.42678 2.98744 1.42678 3.28033 1.71967L16.7803 15.2197C17.0732 15.5126 17.0732 15.9874 16.7803 16.2803C16.4874 16.5732 16.0126 16.5732 15.7197 16.2803L13.2828 13.8435C12.4719 14.4022 11.4678 14.8338 10.25 14.9614V15.75C10.25 16.1642 9.91422 16.5 9.50001 16.5C9.08579 16.5 8.75001 16.1642 8.75001 15.75V14.9616C6.08485 14.6838 4.47434 12.9569 3.63162 11.6583C3.40614 11.3108 3.50502 10.8463 3.85248 10.6209C4.19995 10.3954 4.66441 10.4943 4.88989 10.8417C5.6696 12.0432 7.09993 13.5 9.50001 13.5C10.5978 13.5 11.4845 13.1981 12.1992 12.7598L11.0875 11.6482C10.605 11.8739 10.0667 12 9.50001 12C7.42894 12 5.75001 10.3211 5.75001 8.25V6.31067L2.21967 2.78033C1.92678 2.48744 1.92678 2.01256 2.21967 1.71967Z"})]}))},check:function(e){return ht("svg",i(i({xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},e),{},{children:ht("path",{d:"M20 6 9 17l-5-5"})}))},"chevron-down":function(e){return ht("svg",i(i({xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},e),{},{children:ht("path",{d:"m6 9 6 6 6-6"})}))},"chevron-up":function(e){return ht("svg",i(i({xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},e),{},{children:ht("path",{d:"m18 15-6-6-6 6"})}))},send:function(e){return ht("svg",i(i({xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",viewBox:"0 0 20 20",fill:"currentColor"},e),{},{children:ht("path",{d:"M2.59413 5.1485C2.04 3.39377 3.86657 1.83482 5.51245 2.65776L16.47 8.13653C18.0055 8.90429 18.0055 11.0955 16.47 11.8633L5.51245 17.3421C3.86656 18.165 2.04 16.6061 2.59413 14.8513L3.86297 10.8333H7.50006C7.9603 10.8333 8.33339 10.4602 8.33339 10C8.33339 9.53976 7.9603 9.16667 7.50006 9.16667H3.86302L2.59413 5.1485Z"})}))},star:function(e){return ht("svg",i(i({height:"1em",width:"1em",viewBox:"0 0 21 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},e),{},{children:ht("path",{d:"M11.8621 0.854898C11.3145 -0.284967 9.68804 -0.284965 9.1404 0.854899L6.77181 5.78487C6.77181 5.78487 6.76902 5.78867 6.7646 5.78925L1.31499 6.50272C0.0591912 6.66713 -0.452868 8.21568 0.474832 9.09033L4.45896 12.8466C4.46075 12.8483 4.46059 12.8502 4.46059 12.8502L3.46003 18.2169C3.22657 19.4691 4.55184 20.4152 5.66108 19.8172L10.4957 17.2111C10.4991 17.2093 10.5035 17.2093 10.5068 17.2111L15.3415 19.8172C16.4507 20.4152 17.776 19.4691 17.5425 18.2169L16.542 12.8502C16.542 12.8502 16.5418 12.8483 16.5436 12.8466L20.5277 9.09033C21.4554 8.21568 20.9434 6.66713 19.6876 6.50272L14.2379 5.78925C14.2335 5.78867 14.2307 5.78487 14.2307 5.78487L11.8621 0.854898Z"})}))}},cm={sm:"text-xs",md:"text-lg",lg:"text-xl"};function lm({name:e,size:t="md",className:n}){const i=sm[e];return ht("slot",{name:`icon-${e}`,className:Np("flex",cm[t],n),"aria-hidden":!0,children:ht(i,{})})}function dm({orbColor:e,circleBackgroundColor:t,starColor:n,className:i}){return ht("slot",{name:"icon-feedback",className:Np("flex",i),"aria-hidden":!0,children:ht("svg",{width:"100%",height:"100%",viewBox:"0 0 82 88",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[ht("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M9 42C9 59.6731 23.3269 74 41 74C58.6731 74 73 59.6731 73 42C73 24.3269 58.6731 10 41 10C23.3269 10 9 24.3269 9 42ZM29.4529 18.5973C31.1347 18.0574 32.8641 17.5023 34.9844 16.6005C42.2533 13.5091 48.3526 11.9217 51.7782 14.094C53.5063 15.1899 54.4051 16.7749 55.6117 18.9024C56.7969 20.9922 58.279 23.6057 61.1358 26.7937C62.2737 28.0636 63.3886 29.2195 64.4371 30.3064C68.7007 34.7263 71.8645 38.0061 70.9949 43.1697C70.2965 47.316 67.9794 49.4559 65.6038 51.65C63.4317 53.656 61.2107 55.7073 60.1332 59.3786C57.8774 67.0653 53.5327 71.9113 48.3526 72.7468C43.1725 73.5823 36.6555 75.1698 29.8043 70.1567C26.1949 67.5157 25.229 64.3182 24.1947 60.894C23.2657 57.8184 22.2814 54.56 19.2768 51.3577C14.1619 45.9062 10.2533 29.6345 19.2768 23.0339C23.736 20.4327 26.5223 19.5382 29.4529 18.5973Z",fill:e,"fill-opacity":"0.15",stroke:e,"stroke-opacity":"0.35"}),ht("path",{d:"M43.5 73.4212C40.4387 73.4212 35.0039 71.1025 37.556 56.4696C40.143 41.6365 42.6582 40.577 44.6991 25.744C46.3318 13.8775 41.1635 8.87964 33 10.9988",stroke:e,"stroke-opacity":"0.35"}),ht("path",{d:"M43.5 73.4212C40.4387 73.4212 35.0039 71.1025 37.556 56.4696C40.143 41.6365 42.6582 40.577 44.6991 25.744C46.3318 13.8775 41.1635 8.87964 33 10.9988",stroke:e,"stroke-opacity":"0.35"}),ht("path",{d:"M21.9366 68.1987C21.3549 66.5119 21.0386 60.9231 28.1376 53.3448C37.0114 43.8719 40.5 43.9579 51.4911 31.7482C59.5691 22.7747 59.1723 17.0524 58.0993 15.4626",stroke:e,"stroke-opacity":"0.35"}),ht("path",{d:"M9.26819 42.161C10.4003 43.5337 15.6951 46.3853 25.7661 44.3926C38.3548 41.9018 52.434 40.307 57.694 41.0287C70.352 42.7655 71.4138 51.3035 71.4138 51.3035",stroke:e,"stroke-opacity":"0.35"}),ht("path",{d:"M22 16.4916C18.815 21.85 19.6451 26.0591 27.9943 32.0828C38.4307 39.6124 50.2985 48.8304 53.5024 53.1027C58.6684 59.9914 59.5 67.928 59.5 67.928",stroke:e,"stroke-opacity":"0.35"}),ht("rect",{x:"9.26099",y:"10",width:"63.7129",height:"63.7129",rx:"31.8565",stroke:e,"stroke-opacity":"0.43","stroke-width":"1.5"}),ht("g",{"clip-path":"url(#clip0_7006_42127)",children:[ht("circle",{cx:"62.4996",cy:"18.2032",r:"15.0195",transform:"rotate(6.27205 62.4996 18.2032)",fill:t}),ht("path",{d:"M60.7142 12.1753C62.057 10.0714 65.2294 10.4202 66.0833 12.7654L66.6158 14.2308L68.1251 14.6217C70.5415 15.2484 71.1908 18.3742 69.2237 19.911L67.9944 20.8704L68.0896 22.4262C68.2403 24.9178 65.4681 26.5011 63.3987 25.1056L62.1065 24.2326L60.6555 24.8041C58.3322 25.7172 55.9702 23.5694 56.6585 21.1698L57.0884 19.6717L56.0977 18.4684C54.5112 16.541 55.8231 13.6307 58.318 13.5438L59.8751 13.4899L60.7142 12.1753Z",fill:n,stroke:t,"stroke-width":"3.27381"}),ht("path",{d:"M63.925 5.23719C71.0867 6.02431 76.2545 12.4676 75.4676 19.6293C74.6805 26.7911 68.2364 31.959 61.0746 31.1718C53.9129 30.3845 48.7459 23.9406 49.533 16.7789C50.3203 9.61739 56.7634 4.45029 63.925 5.23719ZM63.6957 7.32326C57.6866 6.66302 52.2797 10.9991 51.6191 17.0082C50.9586 23.0174 55.2946 28.4251 61.3038 29.0858C67.3132 29.7462 72.7211 25.4094 73.3816 19.4C74.0418 13.3908 69.705 7.98372 63.6957 7.32326Z",fill:n,stroke:t,"stroke-width":"0.3","stroke-linecap":"round","stroke-linejoin":"round"})]}),ht("ellipse",{cx:"41",cy:"85",rx:"15",ry:"3",fill:e,"fill-opacity":"0.35"}),ht("defs",{children:ht("clipPath",{id:"clip0_7006_42127",children:ht("rect",{width:"33",height:"33",fill:"white",transform:"translate(47.9012) rotate(6.27205)"})})})]})})}function um(e){return ht(Yp().value?hm:pm,i({},e))}function hm(e){let{visible:t,className:n,grow:o,dep:a}=e,s=r(e,m);return t?ht("div",i({className:Np(o&&"grow",n)},s)):null}function pm(e){let{visible:t,children:n,className:o,grow:a,dep:s}=e,c=r(e,f);const[l,d]=Et(t),[u,h]=Et(null),[p,m]=Et(null),g=Ot(n);t&&(g.current=n);const v=Mt((e=>{h(e),e&&!t&&(e.style.width="0px",e.style.height="0px")}),[]);Rt((()=>{p&&(p.style.transition="none",p.style.opacity="0",p.offsetWidth,p.style.transition="",p.style.opacity="")}),[s]),At((()=>{u&&(u.style.width=`${u.offsetWidth}px`,u.style.height=`${u.offsetHeight}px`)}),[u,t,s]),Rt((()=>{if(!u||!p)return;t&&d(!0);const e=t?p.offsetWidth:0,n=t?p.offsetHeight:0;u.style.width=t&&u.offsetWidth===e?"":`${e}px`,u.style.height=t&&u.offsetHeight===n?"":`${n}px`}),[u,p,t,s]);const{transitioning:b,handlers:y}=Xp({onEnd:()=>{t?(u.style.width="",u.style.height=""):d(!1)}});return ht("div",i(i({ref:v,className:Np("relative inline-flex shrink-0 justify-center items-center transition-[opacity,width,height,transform,flex-grow] duration-200 min-w-0",!t&&"opacity-0 scale-75",t&&a&&"grow",t&&l&&!b.value&&"z-1")},y),{},{children:ht("div",i(i({ref:m,className:Np("shrink-0 min-h-min min-w-min transition-opacity duration-200",a&&"grow",o)},c),{},{children:(t||l)&&g.current}))}))}const mm={primary:"text-accent-primary border border-accent bg-accent hover:border-accent-hover hover:bg-accent-hover active:border-accent-active active:bg-accent-active",secondary:"text-base-primary border border-base-border bg-base hover:bg-base-hover active:bg-base-active",ghost:"text-base-primary border border-base bg-base hover:bg-base-hover hover:border-base-hover active:bg-base-active active:border-base-active"},fm=rn((function(e,t){let{variant:n="secondary",children:o,icon:a,className:s,iconClassName:c,truncate:l=!0}=e,d=r(e,g);const u=!!a&&!o;return ht("button",i(i({ref:t,className:Np("h-9 flex px-2.5 text-sm items-center transition-colors justify-center rounded-button duration-200 focus-ring overflow-hidden select-none",mm[n],u&&"min-w-9",s),type:"button"},d),{},{children:[a&&ht(lm,{className:Np("transition-[margin] duration-200",u&&"-mx-0.5",c),name:a}),ht(um,{visible:!!o,dep:o,children:ht("span",{className:"block whitespace-nowrap max-w-64 truncate px-1.5",children:o})})]}))}));function gm(e){let{className:t}=e,n=r(e,v);const{status:o,isSpeaking:a}=kp(),s=_p(),c=Ip(),l=Pi((()=>"connected"!==o.value?c.connecting_status.value:s.value?c.chatting_status.value:a.value?c.speaking_status.value:c.listening_status.value)),[d,u]=Et(l.peek());return Ni((()=>{const e=l.value;if("connected"!==o.value||!a.value){const t=setTimeout((()=>{u(e)}),500);return()=>clearTimeout(t)}u(e)})),ht("div",i(i({className:Np("py-1.5 px-3 bg-base-active overflow-hidden rounded-bubble text-sm",t)},n),{},{children:ht(Qp,{initial:!1,active:!0,children:ht("div",{className:"animate-text whitespace-nowrap transition-[opacity,transform] ease-out duration-200 data-hidden:opacity-0 transform data-hidden:translate-y-2",children:d})},d)}))}const vm=Qe(null);function bm({children:e}){const t=Ei(null),n=Ei(""),i=Ei("initial"),{lastId:r}=kp(),o=Ki("agent-id"),{serverUrl:a}=Yi(),s=Mt((async e=>{const n=r.value,s=o.value;if(n&&s)try{t.value=e,i.value="submitted-rating",await rp(n,{rating:e},a.value)}catch(e){console.error("[ConversationalAI] Failed to submit rating:",e)}else console.warn("[ConversationalAI] Cannot submit rating: missing agent_id or conversation_id")}),[]),c=Mt((async()=>{const e=r.value,s=o.value;if(e&&s)if(null!==t.value){if(n.value)try{i.value="submitted-follow-up",await rp(e,{rating:t.value,comment:n.value||void 0},a.value)}catch(e){console.error("[ConversationalAI] Failed to submit feedback:",e)}}else console.warn("[ConversationalAI] Cannot submit feedback: rating not set");else console.warn("[ConversationalAI] Cannot submit feedback: missing agent_id or conversation_id")}),[]),l=Mt((()=>{t.value=null,n.value="",i.value="initial"}),[]);Ni((()=>{null!==r.value&&l()}));const d=At((()=>({rating:t,feedbackText:n,feedbackProgress:i,submitRating:s,submitFeedback:c,reset:l})),[s,c,l]);return ht(vm.Provider,{value:d,children:e})}function ym(){return zi(vm)}const km=Qe(null);function wm({defaultContent:e="transcript",children:t}){const n=Ei(e),i=At((()=>{const e="feedback"===n.value?{showHeaderBack:!0,onHeaderBack:()=>{n.value="transcript"}}:{showHeaderBack:!1};return{currentContent:n,currentConfig:e}}),[n.value]);return ht(km.Provider,{value:i,children:t})}function Cm(){return zi(km)}const Tm=(e,t)=>Array.from({length:t-e+1},((t,n)=>n+e)),Sm=({isFilled:e,iconName:t})=>ht("span",{className:Np("w-8 h-8 grid place-content-center",e?"text-base-primary":"text-base-border"),children:ht(lm,{name:t,size:"lg"})}),_m=({value:e,rating:t,hoverRating:n,onClick:i,onHover:r,onKeyDown:o,iconName:a})=>{const s=null!==t.value&&e<=t.value,c=null!==n.value&&e<=n.value,l=Mt((t=>{t.stopPropagation(),i(e)}),[i,e]),d=Mt((t=>{o(t,e)}),[o,e]);return ht("button",{type:"button",role:"radio","aria-checked":s,"aria-label":e.toString(),onMouseEnter:()=>r(e),onClick:l,onKeyDown:d,className:Np("w-8 h-8 grid place-content-center rounded-full focus-ring transition-colors cursor-pointer",s||c?"text-base-primary":"text-base-border"),children:ht(lm,{name:a,size:"lg"})})},xm=({onRate:e,min:t=1,max:n=5,ariaLabel:i,icon:r="star"})=>{const o=Ei(null),a=Ei(null),s=Tm(t,n),c=Mt((e=>{a.value=e}),[a]),l=Mt((()=>{a.value=null}),[a]),d=Mt((t=>{o.value=t,e(t)}),[o,e]),u=Mt(((i,r)=>{if("Enter"===i.key||" "===i.key)i.preventDefault(),o.value=r,e(r);else if("ArrowLeft"===i.key||"ArrowDown"===i.key){if(i.preventDefault(),r-1>=t){const e=i.currentTarget,t=null==e?void 0:e.previousElementSibling;null==t||t.focus()}}else if(("ArrowRight"===i.key||"ArrowUp"===i.key)&&(i.preventDefault(),r+1<=n)){const e=i.currentTarget,t=null==e?void 0:e.nextElementSibling;null==t||t.focus()}}),[o,e,t,n]);return ht("div",{role:"radiogroup","aria-label":i,className:"flex no-wrap cursor-pointer",onMouseLeave:l,children:s.map((e=>ht(_m,{value:e,rating:o,hoverRating:a,onClick:d,onHover:c,onKeyDown:u,iconName:r},e)))})};function Em({rating:e,min:t=1,max:n=5,icon:i="star"}){const r=Tm(t,n);return ht("div",{className:"flex no-wrap",role:"img","aria-label":`Rating: ${e} out of ${n}`,children:r.map((t=>ht(Sm,{isFilled:e>=t,iconName:i},t)))})}function Pm({icon:e,onRate:t}){const n=Ip();return ht("div",{className:"flex flex-col items-center",children:[ht("div",{className:"text-sm text-base-primary font-medium",children:n.initiate_feedback}),ht("div",{className:"py-4",children:ht(xm,{onRate:t,ariaLabel:n.initiate_feedback,icon:e})})]})}function Rm({icon:e,rating:t,showFollowUpButton:n,onFollowUpClick:i}){const r=Ip();return ht("div",{className:"flex flex-col items-center gap-3 mb-4",children:[ht("div",{className:"text-sm text-base-primary font-medium",children:r.thanks_for_feedback}),ht(Em,{rating:t,min:1,max:5,icon:e}),n&&ht(fm,{variant:"secondary",onClick:i,children:r.request_follow_up_feedback})]})}function Im({icon:e="star"}){var t;const{currentContent:n}=Cm(),{rating:i,feedbackProgress:r,submitRating:o}=ym(),a="initial"!==r.value&&null!==i.value,s=Mt((e=>{o(e),n.value="feedback"}),[o]),c=Mt((()=>{n.value="feedback"}),[]);return a?ht(Rm,{icon:e,rating:null!==(t=i.value)&&void 0!==t?t:0,showFollowUpButton:"submitted-follow-up"!==r.value,onFollowUpClick:c}):ht(Pm,{icon:e,onRate:s})}function Om({entry:e}){const{previewUrl:t}=Ap();return ht("div",{className:Np("flex gap-2.5 transition-[opacity,transform] duration-200 data-hidden:opacity-0 data-hidden:scale-75","user"===e.role?"justify-end pl-16 origin-top-right":"pr-16 origin-top-left"),children:["ai"===e.role&&ht("img",{src:t,alt:"AI agent avatar",className:"bg-base-border shrink-0 w-5 h-5 rounded-full"}),ht("div",{dir:"auto",className:Np("px-3 py-2.5 rounded-bubble text-sm min-w-0 [overflow-wrap:break-word]","user"===e.role?"bg-accent text-accent-primary":"bg-base-active text-base-primary"),children:e.message})]})}function Dm({entry:e}){const t=Ip(),{lastId:n}=kp(),i=function(){const e=Tp();return Pi((()=>{var t,n;return null!==(t=null==(n=e.value.end_feedback)?void 0:n.type)&&void 0!==t?t:null}))}();return ht("div",{className:"mt-3 px-8 flex flex-col",children:["rating"===i.value&&ht(Im,{}),ht("div",{className:"text-xs text-base-subtle text-center transition-opacity duration-200 data-hidden:opacity-0",children:["user"===e.role?t.user_ended_conversation:t.agent_ended_conversation,ht("br",{}),n.value&&ht("span",{className:"break-all",children:[t.conversation_id,": ",n.value]})]})]})}function Am({entry:e}){const t=Ip(),{lastId:n}=kp();return ht("div",{className:"mt-2 px-8 text-xs text-base-error text-center transition-opacity duration-200 data-hidden:opacity-0",children:[t.error_occurred,ht("br",{}),e.message,n.value&&ht(Re,{children:[ht("br",{}),ht("span",{className:"text-base-subtle break-all",children:[t.conversation_id,": ",n.value]})]})]})}function Mm({entry:e,animateIn:t}){return ht(Qp,{initial:!t,active:!0,children:"message"===e.type?ht(Om,{entry:e}):"disconnection"===e.type?ht(Dm,{entry:e}):ht(Am,{entry:e})})}function Nm({scrollPinned:e,transcript:t}){const n=Ot(null),i=Ot(0),r=Ot(null),o=Ot(!1),a=Ot(!1),s=e=>{var t;null==(t=n.current)||t.scrollTo({top:n.current.scrollHeight,behavior:e?"smooth":"instant"})},c=()=>{const e=n.current;if(!e||!o.current||a.current)return;const t=e.scrollTop,i=e.scrollHeight-e.clientHeight,s=i-t;if(Math.abs(s)<1)return e.scrollTop=i,void(r.current=requestAnimationFrame(c));const l=.2*s;e.scrollTop=t+Math.max(l,2),r.current=requestAnimationFrame(c)},l=()=>{!n.current||a.current||o.current||(o.current=!0,r.current=requestAnimationFrame(c))},d=Ot(!0);return Rt((()=>(d.current=!1,s(!1),()=>{r.current&&cancelAnimationFrame(r.current)})),[]),Ni((()=>{var n;const c=t.value;if(!e.peek())return;const d=c[c.length-1];if("message"===(null==d?void 0:d.type)&&"ai"===(null==d?void 0:d.role)&&!0===(null==d?void 0:d.isText)){const t=(null==(n=d.message)?void 0:n.length)||0;0===i.current&&t>0?(i.current=t,a.current=!1,requestAnimationFrame((()=>{requestAnimationFrame((()=>{!a.current&&e.peek()&&(s(!1),l())}))}))):t>i.current&&(i.current=t,l())}else i.current=0,o.current=!1,a.current=!1,r.current&&(cancelAnimationFrame(r.current),r.current=null),s(!0)})),ht("div",{ref:n,onWheel:t=>{const n=t.currentTarget.scrollTop>=t.currentTarget.scrollHeight-t.currentTarget.clientHeight-16;e.value=n,!n&&o.current&&(a.current=!0,o.current=!1,r.current&&(cancelAnimationFrame(r.current),r.current=null))},className:"px-4 pt-3 pb-3 grow flex flex-col gap-3 overflow-x-hidden overflow-y-auto",children:t.value.map(((e,t)=>ht(Mm,{entry:e,animateIn:!d.current},`${t}-${e.conversationIndex}`)))})}function Lm(e){let{className:t}=e,n=r(e,b);return ht("textarea",i({className:Np("px-3 py-[calc(theme(spacing.2)-1px)] border text-sm text-base-primary bg-base border-base-border rounded-input focus-ring resize-none [field-sizing:content] placeholder:text-base-subtle",t)},n))}function Um(e,t,n){try{const i=new CustomEvent(`elevenlabs-convai:${e}`,{bubbles:!0,composed:!0,detail:n});t.dispatchEvent(i)}catch(t){console.error(`[ConversationalAI] Could not trigger ${e} event:`,t)}}function Fm(e,t){return Um("setExpanded",e,t)}function jm(e){let{visible:t}=e,n=r(e,y);const o=Ip(),{isMuted:a,isMutingEnabled:s,setIsMuted:c}=up(),l=Mt((e=>{const t=!a.peek();c(t),Um("setMicMuted",e.currentTarget,{micMuted:t})}),[c]);return s.value?ht(um,{visible:t,className:"p-1",children:ht(fm,i({"aria-label":o.mute_microphone,"aria-pressed":a,icon:a.value?"mic-off":"mic",onClick:l},n))}):null}function Bm(e){let{iconOnly:t,isDisconnected:n,children:o}=e,a=r(e,k);const{endSession:s,startSession:c}=kp(),l=Ip();return ht(fm,i(i({variant:n?"primary":"secondary",icon:n?"phone":"phone-off",onClick:n?e=>c(e.currentTarget):s,"aria-label":n?l.start_call:l.end_call},a),{},{children:t?void 0:null!=o?o:n?l.start_call:l.end_call}))}function Vm({showTranscript:e,scrollPinned:t}){const n=Ei(""),i=_p(),{text_input_enabled:r}=Tp().value,o=Ip(),{isDisconnected:a,status:s,startSession:c,sendUserMessage:l,sendUserActivity:d,conversationIndex:u}=kp(),h=Mt((async e=>{e.preventDefault();const i=n.value.trim();i&&(t.value=!0,n.value="",a.value?await c(e.currentTarget,{initialMessage:i}):l(i))}),[n,t,a,c,l]),p=Mt((async e=>{"Enter"===e.key&&!e.shiftKey&&await h(e)}),[h]),m=Mt((e=>{n.value=e.currentTarget.value}),[n]),f=Pi((()=>!!n.value.trim()));return ht("div",{className:"shrink-0 overflow-hidden flex p-3 items-end justify-end",children:[r&&ht("div",{className:"relative grow min-w-0 flex z-1 m-1",children:[ht(Lm,{rows:1,"aria-label":o.input_label,value:n,onInput:d,onChange:m,onKeyDown:p,className:"min-w-0 w-full max-h-[8lh] pr-9",placeholder:i.value?a.value&&u.value>0?o.input_placeholder_new_conversation:o.input_placeholder_text_only:o.input_placeholder}),ht(Qp,{active:f,children:ht("button",{"aria-label":o.send_message,className:"absolute right-1 bottom-1 w-7 h-7 flex items-center justify-center hover:bg-base-hover active:bg-base-active rounded-button focus-ring transition-[transform,opacity] duration-200 data-hidden:opacity-0 data-hidden:scale-90",onClick:h,children:ht(lm,{name:"send"})})})]}),ht("div",{className:"flex h-11 items-center",children:[ht(jm,{visible:!i.value&&!a.value}),ht(um,{visible:!a.value||e,className:"p-1",children:ht(Bm,{iconOnly:!a.value,isDisconnected:a.value,disabled:"disconnecting"===s.value||"connecting"===s.value,children:o.new_call})})]})]})}function qm(){const e=Ip(),{rating:t,feedbackText:n}=ym(),i=Mt((e=>{n.value=e.currentTarget.value}),[]);return ht("div",{className:"grow flex flex-col overflow-y-auto overflow-x-hidden px-4",children:ht("div",{className:"flex flex-col gap-8 min-h-full pt-4 pb-2",children:[ht("div",{className:"flex flex-col items-center justify-center gap-3",children:[ht(dm,{orbColor:"var(--el-base-subtle)",circleBackgroundColor:"var(--el-base)",starColor:"var(--el-base-primary)",className:"w-20 h-22"}),null!==t.value&&ht(Em,{rating:t.value,min:1,max:5}),ht("div",{className:"text-center",children:[ht("p",{className:"text-sm text-base-primary font-medium",children:e.thanks_for_feedback}),ht("p",{className:"text-sm text-base-subtle",children:e.thanks_for_feedback_details})]})]}),ht(Lm,{className:"w-full min-h-[6lh]",placeholder:e.follow_up_feedback_placeholder,rows:6,value:n,onInput:i})]})})}function Hm(){const e=Ip(),{currentContent:t}=Cm(),{submitFeedback:n}=ym(),i=Mt((()=>{n(),t.value="transcript"}),[n]);return ht("div",{className:"shrink-0 overflow-hidden flex p-3 items-end justify-end",children:ht(fm,{variant:"primary",onClick:i,children:e.submit})})}function zm(e,[t,n]){return Math.min(n,Math.max(t,e))}function Wm(e,t,{checkForDefaultPrevented:n=!0}={}){return function(i){if(null==e||e(i),!1===n||!i.defaultPrevented)return null==t?void 0:t(i)}}function Gm(e,t=[]){let n=[];const o=()=>{const t=n.map((e=>Qe(e)));return function(n){const r=(null==n?void 0:n[e])||t;return At((()=>({[`__scope${e}`]:i(i({},n),{},{[e]:r})})),[n,r])}};return o.scopeName=e,[function(t,i){const o=Qe(i),a=n.length;n=[...n,i];const s=t=>{var n;const{scope:i,children:s}=t,c=r(t,w),l=(null==(n=null==i?void 0:i[e])?void 0:n[a])||o,d=At((()=>c),Object.values(c));return ht(l.Provider,{value:d,children:s})};return s.displayName=t+"Provider",[s,function(n,r){var s;const c=Nt((null==(s=null==r?void 0:r[e])?void 0:s[a])||o);if(c)return c;if(void 0!==i)return i;throw new Error(`\`${n}\` must be used within \`${t}\``)}]},Km(o,...t)]}function Km(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map((e=>({useScope:e(),scopeName:e.scopeName})));return function(e){const r=n.reduce(((t,{useScope:n,scopeName:r})=>{const o=n(e)[`__scope${r}`];return i(i({},t),o)}),{});return At((()=>({[`__scope${t.scopeName}`]:r})),[r])}};return n.scopeName=t.scopeName,n}var $m=Qe(void 0),Jm=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce(((e,t)=>{const n=zp(`Primitive.${t}`),o=rn(((e,o)=>{const{asChild:a}=e,s=r(e,T),c=a?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),ht(c,i(i({},s),{},{ref:o}))}));return o.displayName=`Primitive.${t}`,i(i({},e),{},{[t]:o})}),{});function Ym(e){const t=Ot(e);return Rt((()=>{t.current=e})),At((()=>(...e)=>{var n;return null==(n=t.current)?void 0:n.call(t,...e)}),[])}var Xm,Qm="dismissableLayer.update",Zm=Qe({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),ef=rn(((e,t)=>{var n;const{disableOutsidePointerEvents:o=!1,onEscapeKeyDown:a,onPointerDownOutside:s,onFocusOutside:c,onInteractOutside:l,onDismiss:d}=e,u=r(e,S),h=Nt(Zm),[p,m]=Et(null),f=null!==(n=null==p?void 0:p.ownerDocument)&&void 0!==n?n:null==globalThis?void 0:globalThis.document,[,g]=Et({}),v=Hp(t,(e=>m(e))),b=Array.from(h.layers),[y]=[...h.layersWithOutsidePointerEventsDisabled].slice(-1),k=b.indexOf(y),w=p?b.indexOf(p):-1,C=h.layersWithOutsidePointerEventsDisabled.size>0,T=w>=k,_=function(e,t=(null==globalThis?void 0:globalThis.document)){const n=Ym(e),i=Ot(!1),r=Ot((()=>{}));return Rt((()=>{const e=e=>{if(e.target&&!i.current){let i=function(){rf("dismissableLayer.pointerDownOutside",n,o,{discrete:!0})};const o={originalEvent:e};"touch"===e.pointerType?(t.removeEventListener("click",r.current),r.current=i,t.addEventListener("click",r.current,{once:!0})):i()}else t.removeEventListener("click",r.current);i.current=!1},o=window.setTimeout((()=>{t.addEventListener("pointerdown",e)}),0);return()=>{window.clearTimeout(o),t.removeEventListener("pointerdown",e),t.removeEventListener("click",r.current)}}),[t,n]),{onPointerDownCapture:()=>i.current=!0}}((e=>{const t=e.target,n=[...h.branches].some((e=>e.contains(t)));!T||n||(null==s||s(e),null==l||l(e),e.defaultPrevented||null==d||d())}),f),x=function(e,t=(null==globalThis?void 0:globalThis.document)){const n=Ym(e),i=Ot(!1);return Rt((()=>{const e=e=>{e.target&&!i.current&&rf("dismissableLayer.focusOutside",n,{originalEvent:e},{discrete:!1})};return t.addEventListener("focusin",e),()=>t.removeEventListener("focusin",e)}),[t,n]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}((e=>{const t=e.target;[...h.branches].some((e=>e.contains(t)))||(null==c||c(e),null==l||l(e),e.defaultPrevented||null==d||d())}),f);return function(e,t=(null==globalThis?void 0:globalThis.document)){const n=Ym(e);Rt((()=>{const e=e=>{"Escape"===e.key&&n(e)};return t.addEventListener("keydown",e,{capture:!0}),()=>t.removeEventListener("keydown",e,{capture:!0})}),[n,t])}((e=>{w===h.layers.size-1&&(null==a||a(e),!e.defaultPrevented&&d&&(e.preventDefault(),d()))}),f),Rt((()=>{if(p)return o&&(0===h.layersWithOutsidePointerEventsDisabled.size&&(Xm=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),h.layersWithOutsidePointerEventsDisabled.add(p)),h.layers.add(p),nf(),()=>{o&&1===h.layersWithOutsidePointerEventsDisabled.size&&(f.body.style.pointerEvents=Xm)}}),[p,f,o,h]),Rt((()=>()=>{p&&(h.layers.delete(p),h.layersWithOutsidePointerEventsDisabled.delete(p),nf())}),[p,h]),Rt((()=>{const e=()=>g({});return document.addEventListener(Qm,e),()=>document.removeEventListener(Qm,e)}),[]),ht(Jm.div,i(i({},u),{},{ref:v,style:i({pointerEvents:C?T?"auto":"none":void 0},e.style),onFocusCapture:Wm(e.onFocusCapture,x.onFocusCapture),onBlurCapture:Wm(e.onBlurCapture,x.onBlurCapture),onPointerDownCapture:Wm(e.onPointerDownCapture,_.onPointerDownCapture)}))}));ef.displayName="DismissableLayer";var tf=rn(((e,t)=>{const n=Nt(Zm),r=Ot(null),o=Hp(t,r);return Rt((()=>{const e=r.current;if(e)return n.branches.add(e),()=>{n.branches.delete(e)}}),[n.branches]),ht(Jm.div,i(i({},e),{},{ref:o}))}));function nf(){const e=new CustomEvent(Qm);document.dispatchEvent(e)}function rf(e,t,n,{discrete:i}){const r=n.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&r.addEventListener(e,t,{once:!0}),i?function(e,t){e&&Wn((()=>e.dispatchEvent(t)))}(r,o):r.dispatchEvent(o)}tf.displayName="DismissableLayerBranch";var of=0;function af(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var sf="focusScope.autoFocusOnMount",cf="focusScope.autoFocusOnUnmount",lf={bubbles:!1,cancelable:!0},df=rn(((e,t)=>{const{loop:n=!1,trapped:o=!1,onMountAutoFocus:a,onUnmountAutoFocus:s}=e,c=r(e,_),[l,d]=Et(null),u=Ym(a),h=Ym(s),p=Ot(null),m=Hp(t,(e=>d(e))),f=Ot({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;Rt((()=>{if(o){let e=function(e){if(f.paused||!l)return;const t=e.target;l.contains(t)?p.current=t:mf(p.current,{select:!0})},t=function(e){if(f.paused||!l)return;const t=e.relatedTarget;null!==t&&(l.contains(t)||mf(p.current,{select:!0}))},n=function(e){if(document.activeElement===document.body)for(const t of e)t.removedNodes.length>0&&mf(l)};document.addEventListener("focusin",e),document.addEventListener("focusout",t);const i=new MutationObserver(n);return l&&i.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),i.disconnect()}}}),[o,l,f.paused]),Rt((()=>{if(l){ff.add(f);const e=document.activeElement;if(!l.contains(e)){const t=new CustomEvent(sf,lf);l.addEventListener(sf,u),l.dispatchEvent(t),t.defaultPrevented||(function(e,{select:t=!1}={}){const n=document.activeElement;for(const i of e)if(mf(i,{select:t}),document.activeElement!==n)return}(function(e){return e.filter((e=>"A"!==e.tagName))}(uf(l)),{select:!0}),document.activeElement===e&&mf(l))}return()=>{l.removeEventListener(sf,u),setTimeout((()=>{const t=new CustomEvent(cf,lf);l.addEventListener(cf,h),l.dispatchEvent(t),t.defaultPrevented||mf(null!=e?e:document.body,{select:!0}),l.removeEventListener(cf,h),ff.remove(f)}),0)}}}),[l,u,h,f]);const g=Mt((e=>{if(!n&&!o||f.paused)return;const t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,i=document.activeElement;if(t&&i){const t=e.currentTarget,[r,o]=function(e){const t=uf(e);return[hf(t,e),hf(t.reverse(),e)]}(t);r&&o?e.shiftKey||i!==o?e.shiftKey&&i===r&&(e.preventDefault(),n&&mf(o,{select:!0})):(e.preventDefault(),n&&mf(r,{select:!0})):i===t&&e.preventDefault()}}),[n,o,f.paused]);return ht(Jm.div,i(i({tabIndex:-1},c),{},{ref:m,onKeyDown:g}))}));function uf(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function hf(e,t){for(const n of e)if(!pf(n,{upTo:t}))return n}function pf(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(void 0!==t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function mf(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&function(e){return e instanceof HTMLInputElement&&"select"in e}(e)&&t&&e.select()}}df.displayName="FocusScope";var ff=function(){let e=[];return{add(t){const n=e[0];t!==n&&(null==n||n.pause()),e=gf(e,t),e.unshift(t)},remove(t){var n;e=gf(e,t),null==(n=e[0])||n.resume()}}}();function gf(e,t){const n=[...e],i=n.indexOf(t);return-1!==i&&n.splice(i,1),n}var vf=null!=globalThis&&globalThis.document?It:()=>{},bf=Jn[" useId ".trim().toString()]||(()=>{}),yf=0;function kf(e){const[t,n]=Et(bf());return vf((()=>{n((e=>null!=e?e:String(yf++)))}),[e]),t?`radix-${t}`:""}const wf=["top","right","bottom","left"],Cf=Math.min,Tf=Math.max,Sf=Math.round,_f=Math.floor,xf=e=>({x:e,y:e}),Ef={left:"right",right:"left",bottom:"top",top:"bottom"},Pf={start:"end",end:"start"};function Rf(e,t,n){return Tf(e,Cf(t,n))}function If(e,t){return"function"==typeof e?e(t):e}function Of(e){return e.split("-")[0]}function Df(e){return e.split("-")[1]}function Af(e){return"x"===e?"y":"x"}function Mf(e){return"y"===e?"height":"width"}const Nf=new Set(["top","bottom"]);function Lf(e){return Nf.has(Of(e))?"y":"x"}function Uf(e){return Af(Lf(e))}function Ff(e){return e.replace(/start|end/g,(e=>Pf[e]))}const jf=["left","right"],Bf=["right","left"],Vf=["top","bottom"],qf=["bottom","top"];function Hf(e){return e.replace(/left|right|bottom|top/g,(e=>Ef[e]))}function zf(e){return"number"!=typeof e?function(e){return i({top:0,right:0,bottom:0,left:0},e)}(e):{top:e,right:e,bottom:e,left:e}}function Wf(e){const{x:t,y:n,width:i,height:r}=e;return{width:i,height:r,top:n,left:t,right:t+i,bottom:n+r,x:t,y:n}}function Gf(e,t,n){let{reference:i,floating:r}=e;const o=Lf(t),a=Uf(t),s=Mf(a),c=Of(t),l="y"===o,d=i.x+i.width/2-r.width/2,u=i.y+i.height/2-r.height/2,h=i[s]/2-r[s]/2;let p;switch(c){case"top":p={x:d,y:i.y-r.height};break;case"bottom":p={x:d,y:i.y+i.height};break;case"right":p={x:i.x+i.width,y:u};break;case"left":p={x:i.x-r.width,y:u};break;default:p={x:i.x,y:i.y}}switch(Df(t)){case"start":p[a]-=h*(n&&l?-1:1);break;case"end":p[a]+=h*(n&&l?-1:1)}return p}async function Kf(e,t){var n;void 0===t&&(t={});const{x:i,y:r,platform:o,rects:a,elements:s,strategy:c}=e,{boundary:l="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:h=!1,padding:p=0}=If(t,e),m=zf(p),f=s[h?"floating"===u?"reference":"floating":u],g=Wf(await o.getClippingRect({element:null==(n=await(null==o.isElement?void 0:o.isElement(f)))||n?f:f.contextElement||await(null==o.getDocumentElement?void 0:o.getDocumentElement(s.floating)),boundary:l,rootBoundary:d,strategy:c})),v="floating"===u?{x:i,y:r,width:a.floating.width,height:a.floating.height}:a.reference,b=await(null==o.getOffsetParent?void 0:o.getOffsetParent(s.floating)),y=await(null==o.isElement?void 0:o.isElement(b))&&await(null==o.getScale?void 0:o.getScale(b))||{x:1,y:1},k=Wf(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:v,offsetParent:b,strategy:c}):v);return{top:(g.top-k.top+m.top)/y.y,bottom:(k.bottom-g.bottom+m.bottom)/y.y,left:(g.left-k.left+m.left)/y.x,right:(k.right-g.right+m.right)/y.x}}function $f(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function Jf(e){return wf.some((t=>e[t]>=0))}const Yf=new Set(["left","top"]);function Xf(){return typeof window<"u"}function Qf(e){return tg(e)?(e.nodeName||"").toLowerCase():"#document"}function Zf(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function eg(e){var t;return null==(t=(tg(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function tg(e){return!!Xf()&&(e instanceof Node||e instanceof Zf(e).Node)}function ng(e){return!!Xf()&&(e instanceof Element||e instanceof Zf(e).Element)}function ig(e){return!!Xf()&&(e instanceof HTMLElement||e instanceof Zf(e).HTMLElement)}function rg(e){return!(!Xf()||typeof ShadowRoot>"u")&&(e instanceof ShadowRoot||e instanceof Zf(e).ShadowRoot)}const og=new Set(["inline","contents"]);function ag(e){const{overflow:t,overflowX:n,overflowY:i,display:r}=bg(e);return/auto|scroll|overlay|hidden|clip/.test(t+i+n)&&!og.has(r)}const sg=new Set(["table","td","th"]);function cg(e){return sg.has(Qf(e))}const lg=[":popover-open",":modal"];function dg(e){return lg.some((t=>{try{return e.matches(t)}catch(e){return!1}}))}const ug=["transform","translate","scale","rotate","perspective"],hg=["transform","translate","scale","rotate","perspective","filter"],pg=["paint","layout","strict","content"];function mg(e){const t=fg(),n=ng(e)?bg(e):e;return ug.some((e=>!!n[e]&&"none"!==n[e]))||!!n.containerType&&"normal"!==n.containerType||!t&&!!n.backdropFilter&&"none"!==n.backdropFilter||!t&&!!n.filter&&"none"!==n.filter||hg.some((e=>(n.willChange||"").includes(e)))||pg.some((e=>(n.contain||"").includes(e)))}function fg(){return!(typeof CSS>"u"||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}const gg=new Set(["html","body","#document"]);function vg(e){return gg.has(Qf(e))}function bg(e){return Zf(e).getComputedStyle(e)}function yg(e){return ng(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function kg(e){if("html"===Qf(e))return e;const t=e.assignedSlot||e.parentNode||rg(e)&&e.host||eg(e);return rg(t)?t.host:t}function wg(e){const t=kg(e);return vg(t)?e.ownerDocument?e.ownerDocument.body:e.body:ig(t)&&ag(t)?t:wg(t)}function Cg(e,t,n){var i;void 0===t&&(t=[]),void 0===n&&(n=!0);const r=wg(e),o=r===(null==(i=e.ownerDocument)?void 0:i.body),a=Zf(r);if(o){const e=Tg(a);return t.concat(a,a.visualViewport||[],ag(r)?r:[],e&&n?Cg(e):[])}return t.concat(r,Cg(r,[],n))}function Tg(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function Sg(e){const t=bg(e);let n=parseFloat(t.width)||0,i=parseFloat(t.height)||0;const r=ig(e),o=r?e.offsetWidth:n,a=r?e.offsetHeight:i,s=Sf(n)!==o||Sf(i)!==a;return s&&(n=o,i=a),{width:n,height:i,$:s}}function _g(e){return ng(e)?e:e.contextElement}function xg(e){const t=_g(e);if(!ig(t))return xf(1);const n=t.getBoundingClientRect(),{width:i,height:r,$:o}=Sg(t);let a=(o?Sf(n.width):n.width)/i,s=(o?Sf(n.height):n.height)/r;return(!a||!Number.isFinite(a))&&(a=1),(!s||!Number.isFinite(s))&&(s=1),{x:a,y:s}}const Eg=xf(0);function Pg(e){const t=Zf(e);return fg()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:Eg}function Rg(e,t,n,i){void 0===t&&(t=!1),void 0===n&&(n=!1);const r=e.getBoundingClientRect(),o=_g(e);let a=xf(1);t&&(i?ng(i)&&(a=xg(i)):a=xg(e));const s=function(e,t,n){return void 0===t&&(t=!1),!(!n||t&&n!==Zf(e))&&t}(o,n,i)?Pg(o):xf(0);let c=(r.left+s.x)/a.x,l=(r.top+s.y)/a.y,d=r.width/a.x,u=r.height/a.y;if(o){const e=Zf(o),t=i&&ng(i)?Zf(i):i;let n=e,r=Tg(n);for(;r&&i&&t!==n;){const e=xg(r),t=r.getBoundingClientRect(),i=bg(r),o=t.left+(r.clientLeft+parseFloat(i.paddingLeft))*e.x,a=t.top+(r.clientTop+parseFloat(i.paddingTop))*e.y;c*=e.x,l*=e.y,d*=e.x,u*=e.y,c+=o,l+=a,n=Zf(r),r=Tg(n)}}return Wf({width:d,height:u,x:c,y:l})}function Ig(e,t){const n=yg(e).scrollLeft;return t?t.left+n:Rg(eg(e)).left+n}function Og(e,t,n){void 0===n&&(n=!1);const i=e.getBoundingClientRect();return{x:i.left+t.scrollLeft-(n?0:Ig(e,i)),y:i.top+t.scrollTop}}const Dg=new Set(["absolute","fixed"]);function Ag(e,t,n){let i;if("viewport"===t)i=function(e,t){const n=Zf(e),i=eg(e),r=n.visualViewport;let o=i.clientWidth,a=i.clientHeight,s=0,c=0;if(r){o=r.width,a=r.height;const e=fg();(!e||e&&"fixed"===t)&&(s=r.offsetLeft,c=r.offsetTop)}return{width:o,height:a,x:s,y:c}}(e,n);else if("document"===t)i=function(e){const t=eg(e),n=yg(e),i=e.ownerDocument.body,r=Tf(t.scrollWidth,t.clientWidth,i.scrollWidth,i.clientWidth),o=Tf(t.scrollHeight,t.clientHeight,i.scrollHeight,i.clientHeight);let a=-n.scrollLeft+Ig(e);const s=-n.scrollTop;return"rtl"===bg(i).direction&&(a+=Tf(t.clientWidth,i.clientWidth)-r),{width:r,height:o,x:a,y:s}}(eg(e));else if(ng(t))i=function(e,t){const n=Rg(e,!0,"fixed"===t),i=n.top+e.clientTop,r=n.left+e.clientLeft,o=ig(e)?xg(e):xf(1);return{width:e.clientWidth*o.x,height:e.clientHeight*o.y,x:r*o.x,y:i*o.y}}(t,n);else{const n=Pg(e);i={x:t.x-n.x,y:t.y-n.y,width:t.width,height:t.height}}return Wf(i)}function Mg(e,t){const n=kg(e);return!(n===t||!ng(n)||vg(n))&&("fixed"===bg(n).position||Mg(n,t))}function Ng(e,t){const n=t.get(e);if(n)return n;let i=Cg(e,[],!1).filter((e=>ng(e)&&"body"!==Qf(e))),r=null;const o="fixed"===bg(e).position;let a=o?kg(e):e;for(;ng(a)&&!vg(a);){const t=bg(a),n=mg(a);!n&&"fixed"===t.position&&(r=null),(o?!n&&!r:!n&&"static"===t.position&&r&&Dg.has(r.position)||ag(a)&&!n&&Mg(e,a))?i=i.filter((e=>e!==a)):r=t,a=kg(a)}return t.set(e,i),i}function Lg(e,t,n){const i=ig(t),r=eg(t),o="fixed"===n,a=Rg(e,!0,o,t);let s={scrollLeft:0,scrollTop:0};const c=xf(0);function l(){c.x=Ig(r)}if(i||!i&&!o)if(("body"!==Qf(t)||ag(r))&&(s=yg(t)),i){const e=Rg(t,!0,o,t);c.x=e.x+t.clientLeft,c.y=e.y+t.clientTop}else r&&l();o&&!i&&r&&l();const d=!r||i||o?xf(0):Og(r,s);return{x:a.left+s.scrollLeft-c.x-d.x,y:a.top+s.scrollTop-c.y-d.y,width:a.width,height:a.height}}function Ug(e){return"static"===bg(e).position}function Fg(e,t){if(!ig(e)||"fixed"===bg(e).position)return null;if(t)return t(e);let n=e.offsetParent;return eg(e)===n&&(n=n.ownerDocument.body),n}function jg(e,t){const n=Zf(e);if(dg(e))return n;if(!ig(e)){let t=kg(e);for(;t&&!vg(t);){if(ng(t)&&!Ug(t))return t;t=kg(t)}return n}let i=Fg(e,t);for(;i&&cg(i)&&Ug(i);)i=Fg(i,t);return i&&vg(i)&&Ug(i)&&!mg(i)?n:i||function(e){let t=kg(e);for(;ig(t)&&!vg(t);){if(mg(t))return t;if(dg(t))return null;t=kg(t)}return null}(e)||n}const Bg={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:t,rect:n,offsetParent:i,strategy:r}=e;const o="fixed"===r,a=eg(i),s=!!t&&dg(t.floating);if(i===a||s&&o)return n;let c={scrollLeft:0,scrollTop:0},l=xf(1);const d=xf(0),u=ig(i);if((u||!u&&!o)&&(("body"!==Qf(i)||ag(a))&&(c=yg(i)),ig(i))){const e=Rg(i);l=xg(i),d.x=e.x+i.clientLeft,d.y=e.y+i.clientTop}const h=!a||u||o?xf(0):Og(a,c,!0);return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+d.x+h.x,y:n.y*l.y-c.scrollTop*l.y+d.y+h.y}},getDocumentElement:eg,getClippingRect:function(e){let{element:t,boundary:n,rootBoundary:i,strategy:r}=e;const o=[..."clippingAncestors"===n?dg(t)?[]:Ng(t,this._c):[].concat(n),i],a=o[0],s=o.reduce(((e,n)=>{const i=Ag(t,n,r);return e.top=Tf(i.top,e.top),e.right=Cf(i.right,e.right),e.bottom=Cf(i.bottom,e.bottom),e.left=Tf(i.left,e.left),e}),Ag(t,a,r));return{width:s.right-s.left,height:s.bottom-s.top,x:s.left,y:s.top}},getOffsetParent:jg,getElementRects:async function(e){const t=this.getOffsetParent||jg,n=this.getDimensions,i=await n(e.floating);return{reference:Lg(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}},getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){const{width:t,height:n}=Sg(e);return{width:t,height:n}},getScale:xg,isElement:ng,isRTL:function(e){return"rtl"===bg(e).direction}};function Vg(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}const qg=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var n,i;const{placement:o,middlewareData:a,rects:s,initialPlacement:c,platform:l,elements:d}=t,u=If(e,t),{mainAxis:h=!0,crossAxis:p=!0,fallbackPlacements:m,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:v=!0}=u,b=r(u,x);if(null!=(n=a.arrow)&&n.alignmentOffset)return{};const y=Of(o),k=Lf(c),w=Of(c)===c,C=await(null==l.isRTL?void 0:l.isRTL(d.floating)),T=m||(w||!v?[Hf(c)]:function(e){const t=Hf(e);return[Ff(e),t,Ff(t)]}(c)),S="none"!==g;!m&&S&&T.push(...function(e,t,n,i){const r=Df(e);let o=function(e,t,n){switch(e){case"top":case"bottom":return n?t?Bf:jf:t?jf:Bf;case"left":case"right":return t?Vf:qf;default:return[]}}(Of(e),"start"===n,i);return r&&(o=o.map((e=>e+"-"+r)),t&&(o=o.concat(o.map(Ff)))),o}(c,v,g,C));const _=[c,...T],E=await Kf(t,b),P=[];let R=(null==(i=a.flip)?void 0:i.overflows)||[];if(h&&P.push(E[y]),p){const e=function(e,t,n){void 0===n&&(n=!1);const i=Df(e),r=Uf(e),o=Mf(r);let a="x"===r?i===(n?"end":"start")?"right":"left":"start"===i?"bottom":"top";return t.reference[o]>t.floating[o]&&(a=Hf(a)),[a,Hf(a)]}(o,s,C);P.push(E[e[0]],E[e[1]])}if(R=[...R,{placement:o,overflows:P}],!P.every((e=>e<=0))){var I,O;const e=((null==(I=a.flip)?void 0:I.index)||0)+1,t=_[e];if(t&&("alignment"!==p||k===Lf(t)||R.every((e=>Lf(e.placement)!==k||e.overflows[0]>0))))return{data:{index:e,overflows:R},reset:{placement:t}};let n=null==(O=R.filter((e=>e.overflows[0]<=0)).sort(((e,t)=>e.overflows[1]-t.overflows[1]))[0])?void 0:O.placement;if(!n)switch(f){case"bestFit":{var D;const e=null==(D=R.filter((e=>{if(S){const t=Lf(e.placement);return t===k||"y"===t}return!0})).map((e=>[e.placement,e.overflows.filter((e=>e>0)).reduce(((e,t)=>e+t),0)])).sort(((e,t)=>e[1]-t[1]))[0])?void 0:D[0];e&&(n=e);break}case"initialPlacement":n=c}if(o!==n)return{reset:{placement:n}}}return{}}}},Hg=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:r,placement:o,rects:a,platform:s,elements:c,middlewareData:l}=t,{element:d,padding:u=0}=If(e,t)||{};if(null==d)return{};const h=zf(u),p={x:n,y:r},m=Uf(o),f=Mf(m),g=await s.getDimensions(d),v="y"===m,b=v?"top":"left",y=v?"bottom":"right",k=v?"clientHeight":"clientWidth",w=a.reference[f]+a.reference[m]-p[m]-a.floating[f],C=p[m]-a.reference[m],T=await(null==s.getOffsetParent?void 0:s.getOffsetParent(d));let S=T?T[k]:0;(!S||!await(null==s.isElement?void 0:s.isElement(T)))&&(S=c.floating[k]||a.floating[f]);const _=w/2-C/2,x=S/2-g[f]/2-1,E=Cf(h[b],x),P=Cf(h[y],x),R=E,I=S-g[f]-P,O=S/2-g[f]/2+_,D=Rf(R,O,I),A=!l.arrow&&null!=Df(o)&&O!==D&&a.reference[f]/2-(O<R?E:P)-g[f]/2<0,M=A?O<R?O-R:O-I:0;return{[m]:p[m]+M,data:i({[m]:D,centerOffset:O-D-M},A&&{alignmentOffset:M}),reset:A}}});var zg=typeof document<"u"?It:function(){};function Wg(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;let n,i,r;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(i=n;0!=i--;)if(!Wg(e[i],t[i]))return!1;return!0}if(r=Object.keys(e),n=r.length,n!==Object.keys(t).length)return!1;for(i=n;0!=i--;)if(!{}.hasOwnProperty.call(t,r[i]))return!1;for(i=n;0!=i--;){const n=r[i];if(!("_owner"===n&&e.$$typeof||Wg(e[n],t[n])))return!1}return!0}return e!=e&&t!=t}function Gg(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function Kg(e,t){const n=Gg(e);return Math.round(t*n)/n}function $g(e){const t=Ot(e);return zg((()=>{t.current=e})),t}const Jg=(e,t)=>i(i({},function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){var n,r;const{x:o,y:a,placement:s,middlewareData:c}=t,l=await async function(e,t){const{placement:n,platform:i,elements:r}=e,o=await(null==i.isRTL?void 0:i.isRTL(r.floating)),a=Of(n),s=Df(n),c="y"===Lf(n),l=Yf.has(a)?-1:1,d=o&&c?-1:1,u=If(t,e);let{mainAxis:h,crossAxis:p,alignmentAxis:m}="number"==typeof u?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return s&&"number"==typeof m&&(p="end"===s?-1*m:m),c?{x:p*d,y:h*l}:{x:h*l,y:p*d}}(t,e);return s===(null==(n=c.offset)?void 0:n.placement)&&null!=(r=c.arrow)&&r.alignmentOffset?{}:{x:o+l.x,y:a+l.y,data:i(i({},l),{},{placement:s})}}}}(e)),{},{options:[e,t]}),Yg=(e,t)=>i(i({},function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:o,placement:a}=t,s=If(e,t),{mainAxis:c=!0,crossAxis:l=!1,limiter:d={fn:e=>{let{x:t,y:n}=e;return{x:t,y:n}}}}=s,u=r(s,P),h={x:n,y:o},p=await Kf(t,u),m=Lf(Of(a)),f=Af(m);let g=h[f],v=h[m];if(c){const e="y"===f?"bottom":"right";g=Rf(g+p["y"===f?"top":"left"],g,g-p[e])}if(l){const e="y"===m?"bottom":"right";v=Rf(v+p["y"===m?"top":"left"],v,v-p[e])}const b=d.fn(i(i({},t),{},{[f]:g,[m]:v}));return i(i({},b),{},{data:{x:b.x-n,y:b.y-o,enabled:{[f]:c,[m]:l}}})}}}(e)),{},{options:[e,t]}),Xg=(e,t)=>i(i({},function(e){return void 0===e&&(e={}),{options:e,fn(t){const{x:n,y:r,placement:o,rects:a,middlewareData:s}=t,{offset:c=0,mainAxis:l=!0,crossAxis:d=!0}=If(e,t),u={x:n,y:r},h=Lf(o),p=Af(h);let m=u[p],f=u[h];const g=If(c,t),v="number"==typeof g?{mainAxis:g,crossAxis:0}:i({mainAxis:0,crossAxis:0},g);if(l){const e="y"===p?"height":"width",t=a.reference[p]-a.floating[e]+v.mainAxis,n=a.reference[p]+a.reference[e]-v.mainAxis;m<t?m=t:m>n&&(m=n)}if(d){var b,y;const e="y"===p?"width":"height",t=Yf.has(Of(o)),n=a.reference[h]-a.floating[e]+(t&&(null==(b=s.offset)?void 0:b[h])||0)+(t?0:v.crossAxis),i=a.reference[h]+a.reference[e]+(t?0:(null==(y=s.offset)?void 0:y[h])||0)-(t?v.crossAxis:0);f<n?f=n:f>i&&(f=i)}return{[p]:m,[h]:f}}}}(e)),{},{options:[e,t]}),Qg=(e,t)=>i(i({},qg(e)),{},{options:[e,t]}),Zg=(e,t)=>i(i({},function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){var n,o;const{placement:a,rects:s,platform:c,elements:l}=t,d=If(e,t),{apply:u=()=>{}}=d,h=r(d,R),p=await Kf(t,h),m=Of(a),f=Df(a),g="y"===Lf(a),{width:v,height:b}=s.floating;let y,k;"top"===m||"bottom"===m?(y=m,k=f===(await(null==c.isRTL?void 0:c.isRTL(l.floating))?"start":"end")?"left":"right"):(k=m,y="end"===f?"top":"bottom");const w=b-p.top-p.bottom,C=v-p.left-p.right,T=Cf(b-p[y],w),S=Cf(v-p[k],C),_=!t.middlewareData.shift;let x=T,E=S;if(null!=(n=t.middlewareData.shift)&&n.enabled.x&&(E=C),null!=(o=t.middlewareData.shift)&&o.enabled.y&&(x=w),_&&!f){const e=Tf(p.left,0),t=Tf(p.right,0),n=Tf(p.top,0),i=Tf(p.bottom,0);g?E=v-2*(0!==e||0!==t?e+t:Tf(p.left,p.right)):x=b-2*(0!==n||0!==i?n+i:Tf(p.top,p.bottom))}await u(i(i({},t),{},{availableWidth:E,availableHeight:x}));const P=await c.getDimensions(l.floating);return v!==P.width||b!==P.height?{reset:{rects:!0}}:{}}}}(e)),{},{options:[e,t]}),ev=(e,t)=>i(i({},function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,o=If(e,t),{strategy:a="referenceHidden"}=o,s=r(o,E);switch(a){case"referenceHidden":{const e=$f(await Kf(t,i(i({},s),{},{elementContext:"reference"})),n.reference);return{data:{referenceHiddenOffsets:e,referenceHidden:Jf(e)}}}case"escaped":{const e=$f(await Kf(t,i(i({},s),{},{altBoundary:!0})),n.floating);return{data:{escapedOffsets:e,escaped:Jf(e)}}}default:return{}}}}}(e)),{},{options:[e,t]}),tv=(e,t)=>i(i({},(e=>({name:"arrow",options:e,fn(t){const{element:n,padding:i}="function"==typeof e?e(t):e;return n&&function(e){return{}.hasOwnProperty.call(e,"current")}(n)?null!=n.current?Hg({element:n.current,padding:i}).fn(t):{}:n?Hg({element:n,padding:i}).fn(t):{}}}))(e)),{},{options:[e,t]});var nv=rn(((e,t)=>{const{children:n,width:o=10,height:a=5}=e,s=r(e,I);return ht(Jm.svg,i(i({},s),{},{ref:t,width:o,height:a,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:ht("polygon",{points:"0,0 30,0 15,10"})}))}));nv.displayName="Arrow";var iv=nv,rv="Popper",[ov,av]=Gm(rv),[sv,cv]=ov(rv),lv=e=>{const{__scopePopper:t,children:n}=e,[i,r]=Et(null);return ht(sv,{scope:t,anchor:i,onAnchorChange:r,children:n})};lv.displayName=rv;var dv="PopperAnchor",uv=rn(((e,t)=>{const{__scopePopper:n,virtualRef:o}=e,a=r(e,O),s=cv(dv,n),c=Ot(null),l=Hp(t,c),d=Ot(null);return Rt((()=>{const e=d.current;d.current=(null==o?void 0:o.current)||c.current,e!==d.current&&s.onAnchorChange(d.current)})),o?null:ht(Jm.div,i(i({},a),{},{ref:l}))}));uv.displayName=dv;var hv="PopperContent",[pv,mv]=ov(hv),fv=rn(((e,t)=>{var n,o,a,s,c,l,d,u;const{__scopePopper:h,side:p="bottom",sideOffset:m=0,align:f="center",alignOffset:g=0,arrowPadding:v=0,avoidCollisions:b=!0,collisionBoundary:y=[],collisionPadding:k=0,sticky:w="partial",hideWhenDetached:C=!1,updatePositionStrategy:T="optimized",onPlaced:S}=e,_=r(e,D),x=cv(hv,h),[E,P]=Et(null),R=Hp(t,(e=>P(e))),[I,O]=Et(null),A=function(e){const[t,n]=Et(void 0);return vf((()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const t=new ResizeObserver((t=>{if(!Array.isArray(t)||!t.length)return;const i=t[0];let r,o;if("borderBoxSize"in i){const e=i.borderBoxSize,t=Array.isArray(e)?e[0]:e;r=t.inlineSize,o=t.blockSize}else r=e.offsetWidth,o=e.offsetHeight;n({width:r,height:o})}));return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}n(void 0)}),[e]),t}(I),M=null!==(n=null==A?void 0:A.width)&&void 0!==n?n:0,N=null!==(o=null==A?void 0:A.height)&&void 0!==o?o:0,L=p+("center"!==f?"-"+f:""),U="number"==typeof k?k:i({top:0,right:0,bottom:0,left:0},k),F=Array.isArray(y)?y:[y],j=F.length>0,B={padding:U,boundary:F.filter(yv),altBoundary:j},{refs:V,floatingStyles:q,placement:H,isPositioned:z,middlewareData:W}=function(e){void 0===e&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:o,elements:{reference:a,floating:s}={},transform:c=!0,whileElementsMounted:l,open:d}=e,[u,h]=Et({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[p,m]=Et(r);Wg(p,r)||m(r);const[f,g]=Et(null),[v,b]=Et(null),y=Mt((e=>{e!==T.current&&(T.current=e,g(e))}),[]),k=Mt((e=>{e!==S.current&&(S.current=e,b(e))}),[]),w=a||f,C=s||v,T=Ot(null),S=Ot(null),_=Ot(u),x=null!=l,E=$g(l),P=$g(o),R=$g(d),I=Mt((()=>{if(!T.current||!S.current)return;const e={placement:t,strategy:n,middleware:p};P.current&&(e.platform=P.current),((e,t,n)=>{const r=new Map,o=i({platform:Bg},n),a=i(i({},o.platform),{},{_c:r});return(async(e,t,n)=>{const{placement:r="bottom",strategy:o="absolute",middleware:a=[],platform:s}=n,c=a.filter(Boolean),l=await(null==s.isRTL?void 0:s.isRTL(t));let d=await s.getElementRects({reference:e,floating:t,strategy:o}),{x:u,y:h}=Gf(d,r,l),p=r,m={},f=0;for(let n=0;n<c.length;n++){const{name:a,fn:g}=c[n],{x:v,y:b,data:y,reset:k}=await g({x:u,y:h,initialPlacement:r,placement:p,strategy:o,middlewareData:m,rects:d,platform:s,elements:{reference:e,floating:t}});u=null!=v?v:u,h=null!=b?b:h,m=i(i({},m),{},{[a]:i(i({},m[a]),y)}),k&&f<=50&&(f++,"object"==typeof k&&(k.placement&&(p=k.placement),k.rects&&(d=!0===k.rects?await s.getElementRects({reference:e,floating:t,strategy:o}):k.rects),({x:u,y:h}=Gf(d,p,l))),n=-1)}return{x:u,y:h,placement:p,strategy:o,middlewareData:m}})(e,t,i(i({},o),{},{platform:a}))})(T.current,S.current,e).then((e=>{const t=i(i({},e),{},{isPositioned:!1!==R.current});O.current&&!Wg(_.current,t)&&(_.current=t,Wn((()=>{h(t)})))}))}),[p,t,n,P,R]);zg((()=>{!1===d&&_.current.isPositioned&&(_.current.isPositioned=!1,h((e=>i(i({},e),{},{isPositioned:!1}))))}),[d]);const O=Ot(!1);zg((()=>(O.current=!0,()=>{O.current=!1})),[]),zg((()=>{if(w&&(T.current=w),C&&(S.current=C),w&&C){if(E.current)return E.current(w,C,I);I()}}),[w,C,I,E,x]);const D=At((()=>({reference:T,floating:S,setReference:y,setFloating:k})),[y,k]),A=At((()=>({reference:w,floating:C})),[w,C]),M=At((()=>{const e={position:n,left:0,top:0};if(!A.floating)return e;const t=Kg(A.floating,u.x),r=Kg(A.floating,u.y);return c?i(i({},e),{},{transform:"translate("+t+"px, "+r+"px)"},Gg(A.floating)>=1.5&&{willChange:"transform"}):{position:n,left:t,top:r}}),[n,c,A.floating,u.x,u.y]);return At((()=>i(i({},u),{},{update:I,refs:D,elements:A,floatingStyles:M})),[u,I,D,A,M])}({strategy:"fixed",placement:L,whileElementsMounted:(...e)=>function(e,t,n,r){void 0===r&&(r={});const{ancestorScroll:o=!0,ancestorResize:a=!0,elementResize:s="function"==typeof ResizeObserver,layoutShift:c="function"==typeof IntersectionObserver,animationFrame:l=!1}=r,d=_g(e),u=o||a?[...d?Cg(d):[],...Cg(t)]:[];u.forEach((e=>{o&&e.addEventListener("scroll",n,{passive:!0}),a&&e.addEventListener("resize",n)}));const h=d&&c?function(e,t){let n,r=null;const o=eg(e);function a(){var e;clearTimeout(n),null==(e=r)||e.disconnect(),r=null}return function s(c,l){void 0===c&&(c=!1),void 0===l&&(l=1),a();const d=e.getBoundingClientRect(),{left:u,top:h,width:p,height:m}=d;if(c||t(),!p||!m)return;const f={rootMargin:-_f(h)+"px "+-_f(o.clientWidth-(u+p))+"px "+-_f(o.clientHeight-(h+m))+"px "+-_f(u)+"px",threshold:Tf(0,Cf(1,l))||1};let g=!0;function v(t){const i=t[0].intersectionRatio;if(i!==l){if(!g)return s();i?s(!1,i):n=setTimeout((()=>{s(!1,1e-7)}),1e3)}1===i&&!Vg(d,e.getBoundingClientRect())&&s(),g=!1}try{r=new IntersectionObserver(v,i(i({},f),{},{root:o.ownerDocument}))}catch(e){r=new IntersectionObserver(v,f)}r.observe(e)}(!0),a}(d,n):null;let p=-1,m=null;s&&(m=new ResizeObserver((e=>{let[i]=e;i&&i.target===d&&m&&(m.unobserve(t),cancelAnimationFrame(p),p=requestAnimationFrame((()=>{var e;null==(e=m)||e.observe(t)}))),n()})),d&&!l&&m.observe(d),m.observe(t));let f,g=l?Rg(e):null;return l&&function t(){const i=Rg(e);g&&!Vg(g,i)&&n(),g=i,f=requestAnimationFrame(t)}(),n(),()=>{var e;u.forEach((e=>{o&&e.removeEventListener("scroll",n),a&&e.removeEventListener("resize",n)})),null==h||h(),null==(e=m)||e.disconnect(),m=null,l&&cancelAnimationFrame(f)}}(...e,{animationFrame:"always"===T}),elements:{reference:x.anchor},middleware:[Jg({mainAxis:m+N,alignmentAxis:g}),b&&Yg(i({mainAxis:!0,crossAxis:!1,limiter:"partial"===w?Xg():void 0},B)),b&&Qg(i({},B)),Zg(i(i({},B),{},{apply:({elements:e,rects:t,availableWidth:n,availableHeight:i})=>{const{width:r,height:o}=t.reference,a=e.floating.style;a.setProperty("--radix-popper-available-width",`${n}px`),a.setProperty("--radix-popper-available-height",`${i}px`),a.setProperty("--radix-popper-anchor-width",`${r}px`),a.setProperty("--radix-popper-anchor-height",`${o}px`)}})),I&&tv({element:I,padding:v}),kv({arrowWidth:M,arrowHeight:N}),C&&ev(i({strategy:"referenceHidden"},B))]}),[G,K]=wv(H),$=Ym(S);vf((()=>{z&&(null==$||$())}),[z,$]);const J=null==(a=W.arrow)?void 0:a.x,Y=null==(s=W.arrow)?void 0:s.y,X=0!==(null==(c=W.arrow)?void 0:c.centerOffset),[Q,Z]=Et();return vf((()=>{E&&Z(window.getComputedStyle(E).zIndex)}),[E]),ht("div",{ref:V.setFloating,"data-radix-popper-content-wrapper":"",style:i(i({},q),{},{transform:z?q.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Q,"--radix-popper-transform-origin":[null==(l=W.transformOrigin)?void 0:l.x,null==(d=W.transformOrigin)?void 0:d.y].join(" ")},(null==(u=W.hide)?void 0:u.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}),dir:e.dir,children:ht(pv,{scope:h,placedSide:G,onArrowChange:O,arrowX:J,arrowY:Y,shouldHideArrow:X,children:ht(Jm.div,i(i({"data-side":G,"data-align":K},_),{},{ref:R,style:i(i({},_.style),{},{animation:z?void 0:"none"})}))})})}));fv.displayName=hv;var gv="PopperArrow",vv={top:"bottom",right:"left",bottom:"top",left:"right"},bv=rn((function(e,t){const{__scopePopper:n}=e,o=r(e,A),a=mv(gv,n),s=vv[a.placedSide];return ht("span",{ref:a.onArrowChange,style:{position:"absolute",left:a.arrowX,top:a.arrowY,[s]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[a.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[a.placedSide],visibility:a.shouldHideArrow?"hidden":void 0},children:ht(iv,i(i({},o),{},{ref:t,style:i(i({},o.style),{},{display:"block"})}))})}));function yv(e){return null!==e}bv.displayName=gv;var kv=e=>({name:"transformOrigin",options:e,fn(t){var n,i,r,o,a;const{placement:s,rects:c,middlewareData:l}=t,d=0!==(null==(r=l.arrow)?void 0:r.centerOffset),u=d?0:e.arrowWidth,h=d?0:e.arrowHeight,[p,m]=wv(s),f={start:"0%",center:"50%",end:"100%"}[m],g=(null!==(n=null==(o=l.arrow)?void 0:o.x)&&void 0!==n?n:0)+u/2,v=(null!==(i=null==(a=l.arrow)?void 0:a.y)&&void 0!==i?i:0)+h/2;let b="",y="";return"bottom"===p?(b=d?f:`${g}px`,y=-h+"px"):"top"===p?(b=d?f:`${g}px`,y=`${c.floating.height+h}px`):"right"===p?(b=-h+"px",y=d?f:`${v}px`):"left"===p&&(b=`${c.floating.width+h}px`,y=d?f:`${v}px`),{data:{x:b,y:y}}}});function wv(e){const[t,n="center"]=e.split("-");return[t,n]}var Cv=lv,Tv=uv,Sv=fv,_v=bv,xv=rn(((e,t)=>{var n;const{container:o}=e,a=r(e,M),[s,c]=Et(!1);vf((()=>c(!0)),[]);const l=o||s&&(null==(n=null==globalThis?void 0:globalThis.document)?void 0:n.body);return l?$n.createPortal(ht(Jm.div,i(i({},a),{},{ref:t})),l):null}));xv.displayName="Portal";var Ev=Jn[" useInsertionEffect ".trim().toString()]||vf;function Pv({prop:e,defaultProp:t,onChange:n=()=>{},caller:i}){const[r,o,a]=function({defaultProp:e,onChange:t}){const[n,i]=Et(e),r=Ot(n),o=Ot(t);return Ev((()=>{o.current=t}),[t]),Rt((()=>{var e;r.current!==n&&(null==(e=o.current)||e.call(o,n),r.current=n)}),[n,r]),[n,i,o]}({defaultProp:t,onChange:n}),s=void 0!==e,c=s?e:r;{const t=Ot(void 0!==e);Rt((()=>{const e=t.current;e!==s&&console.warn(`${i} is changing from ${e?"controlled":"uncontrolled"} to ${s?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),t.current=s}),[s,i])}return[c,Mt((t=>{var n;if(s){const i=function(e){return"function"==typeof e}(t)?t(e):t;i!==e&&(null==(n=a.current)||n.call(a,i))}else o(t)}),[s,e,o,a])]}var Rv=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Iv=rn(((e,t)=>ht(Jm.span,i(i({},e),{},{ref:t,style:i(i({},Rv),e.style)}))));Iv.displayName="VisuallyHidden";var Ov=new WeakMap,Dv=new WeakMap,Av={},Mv=0,Nv=function(e){return e&&(e.host||Nv(e.parentNode))},Lv=function(e,t,n){void 0===n&&(n="data-aria-hidden");var i=Array.from(Array.isArray(e)?e:[e]),r=function(e){return typeof document>"u"?null:(Array.isArray(e)?e[0]:e).ownerDocument.body}(e);return r?(i.push.apply(i,Array.from(r.querySelectorAll("[aria-live], script"))),function(e,t,n,i){var r=function(e,t){return t.map((function(t){if(e.contains(t))return t;var n=Nv(t);return n&&e.contains(n)?n:(console.error("aria-hidden",t,"in not contained inside",e,". Doing nothing"),null)})).filter((function(e){return!!e}))}(t,Array.isArray(e)?e:[e]);Av[n]||(Av[n]=new WeakMap);var o=Av[n],a=[],s=new Set,c=new Set(r),l=function(e){!e||s.has(e)||(s.add(e),l(e.parentNode))};r.forEach(l);var d=function(e){!e||c.has(e)||Array.prototype.forEach.call(e.children,(function(e){if(s.has(e))d(e);else try{var t=e.getAttribute(i),r=null!==t&&"false"!==t,c=(Ov.get(e)||0)+1,l=(o.get(e)||0)+1;Ov.set(e,c),o.set(e,l),a.push(e),1===c&&r&&Dv.set(e,!0),1===l&&e.setAttribute(n,"true"),r||e.setAttribute(i,"true")}catch(t){console.error("aria-hidden: cannot operate on ",e,t)}}))};return d(t),s.clear(),Mv++,function(){a.forEach((function(e){var t=Ov.get(e)-1,r=o.get(e)-1;Ov.set(e,t),o.set(e,r),t||(Dv.has(e)||e.removeAttribute(i),Dv.delete(e)),r||e.removeAttribute(n)})),--Mv||(Ov=new WeakMap,Ov=new WeakMap,Dv=new WeakMap,Av={})}}(i,r,n,"aria-hidden")):function(){return null}},Uv=function(){return Uv=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Uv.apply(this,arguments)};function Fv(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}var jv="right-scroll-bar-position",Bv="width-before-scroll-bar";function Vv(e,t){return"function"==typeof e?e(t):e&&(e.current=t),e}var qv=typeof window<"u"?It:Rt,Hv=new WeakMap;function zv(e){return e}var Wv=function(e){var t=e.sideCar,n=Fv(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=t.read();if(!i)throw new Error("Sidecar medium not found");return xe(i,Uv({},n))};Wv.isSideCarExport=!0;var Gv=function(e){void 0===e&&(e={});var t=function(e,t){void 0===t&&(t=zv);var n=[],i=!1;return{read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:null},useMedium:function(e){var r=t(e,i);return n.push(r),function(){n=n.filter((function(e){return e!==r}))}},assignSyncMedium:function(e){for(i=!0;n.length;){var t=n;n=[],t.forEach(e)}n={push:function(t){return e(t)},filter:function(){return n}}},assignMedium:function(e){i=!0;var t=[];if(n.length){var r=n;n=[],r.forEach(e),t=n}var o=function(){var n=t;t=[],n.forEach(e)},a=function(){return Promise.resolve().then(o)};a(),n={push:function(e){t.push(e),a()},filter:function(e){return t=t.filter(e),n}}}}}();return t.options=Uv({async:!0,ssr:!1},e),t}(),Kv=function(){},$v=rn((function(e,t){var n=Ot(null),i=Et({onScrollCapture:Kv,onWheelCapture:Kv,onTouchMoveCapture:Kv}),r=i[0],o=i[1],a=e.forwardProps,s=e.children,c=e.className,l=e.removeScrollBar,d=e.enabled,u=e.shards,h=e.sideCar,p=e.noRelative,m=e.noIsolation,f=e.inert,g=e.allowPinchZoom,v=e.as,b=void 0===v?"div":v,y=e.gapMode,k=Fv(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),w=h,C=function(e){var t=function(e,t){var n=Et((function(){return{value:null,callback:t,facade:{get current(){return n.value},set current(e){var t=n.value;t!==e&&(n.value=e,n.callback(e,t))}}}}))[0];return n.callback=t,n.facade}(0,(function(t){return e.forEach((function(e){return Vv(e,t)}))}));return qv((function(){var n=Hv.get(t);if(n){var i=new Set(n),r=new Set(e),o=t.current;i.forEach((function(e){r.has(e)||Vv(e,null)})),r.forEach((function(e){i.has(e)||Vv(e,o)}))}Hv.set(t,e)}),[e]),t}([n,t]),T=Uv(Uv({},k),r);return xe(Re,null,d&&xe(w,{sideCar:Gv,removeScrollBar:l,shards:u,noRelative:p,noIsolation:m,inert:f,setCallbacks:o,allowPinchZoom:!!g,lockRef:n,gapMode:y}),a?Vn(an.only(s),Uv(Uv({},T),{ref:C})):xe(b,Uv({},T,{className:c,ref:C}),s))}));$v.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},$v.classNames={fullWidth:Bv,zeroRight:jv};var Jv=function(){var e=0,t=null;return{add:function(n){0==e&&(t=function(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__}();return t&&e.setAttribute("nonce",t),e}())&&(function(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}(t,n),function(e){(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}(t)),e++},remove:function(){! --e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},Yv=function(){var e=function(){var e=Jv();return function(t,n){Rt((function(){return e.add(t),function(){e.remove()}}),[t&&n])}}();return function(t){var n=t.styles,i=t.dynamic;return e(n,i),null}},Xv={left:0,top:0,right:0,gap:0},Qv=function(e){return parseInt(e||"",10)||0},Zv=Yv(),eb="data-scroll-locked",tb=function(e,t,n,i){var r=e.left,o=e.top,a=e.right,s=e.gap;return void 0===n&&(n="margin"),"\n  .".concat("with-scroll-bars-hidden"," {\n   overflow: hidden ").concat(i,";\n   padding-right: ").concat(s,"px ").concat(i,";\n  }\n  body[").concat(eb,"] {\n    overflow: hidden ").concat(i,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(i,";"),"margin"===n&&"\n    padding-left: ".concat(r,"px;\n    padding-top: ").concat(o,"px;\n    padding-right: ").concat(a,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(s,"px ").concat(i,";\n    "),"padding"===n&&"padding-right: ".concat(s,"px ").concat(i,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(jv," {\n    right: ").concat(s,"px ").concat(i,";\n  }\n  \n  .").concat(Bv," {\n    margin-right: ").concat(s,"px ").concat(i,";\n  }\n  \n  .").concat(jv," .").concat(jv," {\n    right: 0 ").concat(i,";\n  }\n  \n  .").concat(Bv," .").concat(Bv," {\n    margin-right: 0 ").concat(i,";\n  }\n  \n  body[").concat(eb,"] {\n    ").concat("--removed-body-scroll-bar-size",": ").concat(s,"px;\n  }\n")},nb=function(){var e=parseInt(document.body.getAttribute(eb)||"0",10);return isFinite(e)?e:0},ib=function(e){var t=e.noRelative,n=e.noImportant,i=e.gapMode,r=void 0===i?"margin":i;Rt((function(){return document.body.setAttribute(eb,(nb()+1).toString()),function(){var e=nb()-1;e<=0?document.body.removeAttribute(eb):document.body.setAttribute(eb,e.toString())}}),[]);var o=At((function(){return function(e){if(void 0===e&&(e="margin"),typeof window>"u")return Xv;var t=function(e){var t=window.getComputedStyle(document.body),n=t["padding"===e?"paddingLeft":"marginLeft"],i=t["padding"===e?"paddingTop":"marginTop"],r=t["padding"===e?"paddingRight":"marginRight"];return[Qv(n),Qv(i),Qv(r)]}(e),n=document.documentElement.clientWidth,i=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,i-n+t[2]-t[0])}}(r)}),[r]);return xe(Zv,{styles:tb(o,!t,r,n?"":"!important")})},rb=!1;if(typeof window<"u")try{var ob=Object.defineProperty({},"passive",{get:function(){return rb=!0,!0}});window.addEventListener("test",ob,ob),window.removeEventListener("test",ob,ob)}catch(e){rb=!1}var ab=!!rb&&{passive:!1},sb=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return"hidden"!==n[t]&&!(n.overflowY===n.overflowX&&!function(e){return"TEXTAREA"===e.tagName}(e)&&"visible"===n[t])},cb=function(e,t){var n=t.ownerDocument,i=t;do{if(typeof ShadowRoot<"u"&&i instanceof ShadowRoot&&(i=i.host),lb(e,i)){var r=db(e,i);if(r[1]>r[2])return!0}i=i.parentNode}while(i&&i!==n.body);return!1},lb=function(e,t){return"v"===e?function(e){return sb(e,"overflowY")}(t):function(e){return sb(e,"overflowX")}(t)},db=function(e,t){return"v"===e?function(e){return[e.scrollTop,e.scrollHeight,e.clientHeight]}(t):function(e){return[e.scrollLeft,e.scrollWidth,e.clientWidth]}(t)},ub=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},hb=function(e){return[e.deltaX,e.deltaY]},pb=function(e){return e&&"current"in e?e.current:e},mb=function(e){return"\n  .block-interactivity-".concat(e," {pointer-events: none;}\n  .allow-interactivity-").concat(e," {pointer-events: all;}\n")},fb=0,gb=[];function vb(e){for(var t=null;null!==e;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const bb=(Gv.useMedium((function(e){var t=Ot([]),n=Ot([0,0]),i=Ot(),r=Et(fb++)[0],o=Et(Yv)[0],a=Ot(e);Rt((function(){a.current=e}),[e]),Rt((function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(r));var t=function(e,t){for(var n,i=0,r=t.length;i<r;i++)(n||!(i in t))&&(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}([e.lockRef.current],(e.shards||[]).map(pb)).filter(Boolean);return t.forEach((function(e){return e.classList.add("allow-interactivity-".concat(r))})),function(){document.body.classList.remove("block-interactivity-".concat(r)),t.forEach((function(e){return e.classList.remove("allow-interactivity-".concat(r))}))}}}),[e.inert,e.lockRef.current,e.shards]);var s=Mt((function(e,t){if("touches"in e&&2===e.touches.length||"wheel"===e.type&&e.ctrlKey)return!a.current.allowPinchZoom;var r,o=ub(e),s=n.current,c="deltaX"in e?e.deltaX:s[0]-o[0],l="deltaY"in e?e.deltaY:s[1]-o[1],d=e.target,u=Math.abs(c)>Math.abs(l)?"h":"v";if("touches"in e&&"h"===u&&"range"===d.type)return!1;var h=cb(u,d);if(!h)return!0;if(h?r=u:(r="v"===u?"h":"v",h=cb(u,d)),!h)return!1;if(!i.current&&"changedTouches"in e&&(c||l)&&(i.current=r),!r)return!0;var p=i.current||r;return function(e,t,n,i){var r=function(e,t){return"h"===e&&"rtl"===t?-1:1}(e,window.getComputedStyle(t).direction),o=r*i,a=n.target,s=t.contains(a),c=!1,l=o>0,d=0,u=0;do{if(!a)break;var h=db(e,a),p=h[0],m=h[1]-h[2]-r*p;(p||m)&&lb(e,a)&&(d+=m,u+=p);var f=a.parentNode;a=f&&f.nodeType===Node.DOCUMENT_FRAGMENT_NODE?f.host:f}while(!s&&a!==document.body||s&&(t.contains(a)||t===a));return(l&&Math.abs(d)<1||!l&&Math.abs(u)<1)&&(c=!0),c}(p,t,e,"h"===p?c:l)}),[]),c=Mt((function(e){var n=e;if(gb.length&&gb[gb.length-1]===o){var i="deltaY"in n?hb(n):ub(n),r=t.current.filter((function(e){return e.name===n.type&&(e.target===n.target||n.target===e.shadowParent)&&function(e,t){return e[0]===t[0]&&e[1]===t[1]}(e.delta,i)}))[0];if(r&&r.should)return void(n.cancelable&&n.preventDefault());if(!r){var c=(a.current.shards||[]).map(pb).filter(Boolean).filter((function(e){return e.contains(n.target)}));(c.length>0?s(n,c[0]):!a.current.noIsolation)&&n.cancelable&&n.preventDefault()}}}),[]),l=Mt((function(e,n,i,r){var o={name:e,delta:n,target:i,should:r,shadowParent:vb(i)};t.current.push(o),setTimeout((function(){t.current=t.current.filter((function(e){return e!==o}))}),1)}),[]),d=Mt((function(e){n.current=ub(e),i.current=void 0}),[]),u=Mt((function(t){l(t.type,hb(t),t.target,s(t,e.lockRef.current))}),[]),h=Mt((function(t){l(t.type,ub(t),t.target,s(t,e.lockRef.current))}),[]);Rt((function(){return gb.push(o),e.setCallbacks({onScrollCapture:u,onWheelCapture:u,onTouchMoveCapture:h}),document.addEventListener("wheel",c,ab),document.addEventListener("touchmove",c,ab),document.addEventListener("touchstart",d,ab),function(){gb=gb.filter((function(e){return e!==o})),document.removeEventListener("wheel",c,ab),document.removeEventListener("touchmove",c,ab),document.removeEventListener("touchstart",d,ab)}}),[]);var p=e.removeScrollBar;return xe(Re,null,e.inert?xe(o,{styles:mb(r)}):null,p?xe(ib,{noRelative:e.noRelative,gapMode:e.gapMode}):null)})),Wv);var yb=rn((function(e,t){return xe($v,Uv({},e,{ref:t,sideCar:bb}))}));yb.classNames=$v.classNames;var kb=[" ","Enter","ArrowUp","ArrowDown"],wb=[" ","Enter"],Cb="Select",[Tb,Sb,_b]=function(e){const t=e+"CollectionProvider",[n,o]=Gm(t),[a,s]=n(t,{collectionRef:{current:null},itemMap:new Map}),c=e=>{const{scope:t,children:n}=e,i=$n.useRef(null),r=$n.useRef(new Map).current;return ht(a,{scope:t,itemMap:r,collectionRef:i,children:n})};c.displayName=t;const l=e+"CollectionSlot",d=zp(l),u=$n.forwardRef(((e,t)=>{const{scope:n,children:i}=e,r=Hp(t,s(l,n).collectionRef);return ht(d,{ref:r,children:i})}));u.displayName=l;const h=e+"CollectionItemSlot",p="data-radix-collection-item",m=zp(h),f=$n.forwardRef(((e,t)=>{const{scope:n,children:o}=e,a=r(e,C),c=$n.useRef(null),l=Hp(t,c),d=s(h,n);return $n.useEffect((()=>(d.itemMap.set(c,i({ref:c},a)),()=>{d.itemMap.delete(c)}))),ht(m,{[p]:"",ref:l,children:o})}));return f.displayName=h,[{Provider:c,Slot:u,ItemSlot:f},function(t){const n=s(e+"CollectionConsumer",t);return $n.useCallback((()=>{const e=n.collectionRef.current;if(!e)return[];const t=Array.from(e.querySelectorAll(`[${p}]`));return Array.from(n.itemMap.values()).sort(((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current)))}),[n.collectionRef,n.itemMap])},o]}(Cb),[xb]=Gm(Cb,[_b,av]),Eb=av(),[Pb,Rb]=xb(Cb),[Ib,Ob]=xb(Cb),Db=e=>{const{__scopeSelect:t,children:n,open:r,defaultOpen:o,onOpenChange:a,value:s,defaultValue:c,onValueChange:l,dir:d,name:u,autoComplete:h,disabled:p,required:m,form:f}=e,g=Eb(t),[v,b]=Et(null),[y,k]=Et(null),[w,C]=Et(!1),T=function(e){const t=Nt($m);return e||t||"ltr"}(d),[S,_]=Pv({prop:r,defaultProp:null!=o&&o,onChange:a,caller:Cb}),[x,E]=Pv({prop:s,defaultProp:c,onChange:l,caller:Cb}),P=Ot(null),R=!v||f||!!v.closest("form"),[I,O]=Et(new Set),D=Array.from(I).map((e=>e.props.value)).join(";");return ht(Cv,i(i({},g),{},{children:ht(Pb,{required:m,scope:t,trigger:v,onTriggerChange:b,valueNode:y,onValueNodeChange:k,valueNodeHasChildren:w,onValueNodeHasChildrenChange:C,contentId:kf(),value:x,onValueChange:E,open:S,onOpenChange:_,dir:T,triggerPointerDownPosRef:P,disabled:p,children:[ht(Tb.Provider,{scope:t,children:ht(Ib,{scope:e.__scopeSelect,onNativeOptionAdd:Mt((e=>{O((t=>new Set(t).add(e)))}),[]),onNativeOptionRemove:Mt((e=>{O((t=>{const n=new Set(t);return n.delete(e),n}))}),[]),children:n})}),R?ht(ky,{"aria-hidden":!0,required:m,tabIndex:-1,name:u,autoComplete:h,value:x,onChange:e=>E(e.target.value),disabled:p,form:f,children:[void 0===x?ht("option",{value:""}):null,Array.from(I)]},D):null]})}))};Db.displayName=Cb;var Ab="SelectTrigger",Mb=rn(((e,t)=>{const{__scopeSelect:n,disabled:o=!1}=e,a=r(e,N),s=Eb(n),c=Rb(Ab,n),l=c.disabled||o,d=Hp(t,c.onTriggerChange),u=Sb(n),h=Ot("touch"),[p,m,f]=Cy((e=>{const t=u().filter((e=>!e.disabled)),n=t.find((e=>e.value===c.value)),i=Ty(t,e,n);void 0!==i&&c.onValueChange(i.value)})),g=e=>{l||(c.onOpenChange(!0),f()),e&&(c.triggerPointerDownPosRef.current={x:Math.round(e.pageX),y:Math.round(e.pageY)})};return ht(Tv,i(i({asChild:!0},s),{},{children:ht(Jm.button,i(i({type:"button",role:"combobox","aria-controls":c.contentId,"aria-expanded":c.open,"aria-required":c.required,"aria-autocomplete":"none",dir:c.dir,"data-state":c.open?"open":"closed",disabled:l,"data-disabled":l?"":void 0,"data-placeholder":wy(c.value)?"":void 0},a),{},{ref:d,onClick:Wm(a.onClick,(e=>{e.currentTarget.focus(),"mouse"!==h.current&&g(e)})),onPointerDown:Wm(a.onPointerDown,(e=>{h.current=e.pointerType;const t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),0===e.button&&!1===e.ctrlKey&&"mouse"===e.pointerType&&(g(e),e.preventDefault())})),onKeyDown:Wm(a.onKeyDown,(e=>{const t=""!==p.current;!(e.ctrlKey||e.altKey||e.metaKey)&&1===e.key.length&&m(e.key),(!t||" "!==e.key)&&kb.includes(e.key)&&(g(),e.preventDefault())}))}))}))}));Mb.displayName=Ab;var Nb="SelectValue",Lb=rn(((e,t)=>{const{__scopeSelect:n,className:o,style:a,children:s,placeholder:c=""}=e,l=r(e,L),d=Rb(Nb,n),{onValueNodeHasChildrenChange:u}=d,h=void 0!==s,p=Hp(t,d.onValueNodeChange);return vf((()=>{u(h)}),[u,h]),ht(Jm.span,i(i({},l),{},{ref:p,style:{pointerEvents:"none"},children:wy(d.value)?ht(Re,{children:c}):s}))}));Lb.displayName=Nb;var Ub=rn(((e,t)=>{const{__scopeSelect:n,children:o}=e,a=r(e,U);return ht(Jm.span,i(i({"aria-hidden":!0},a),{},{ref:t,children:o||"▼"}))}));Ub.displayName="SelectIcon";var Fb=e=>ht(xv,i({asChild:!0},e));Fb.displayName="SelectPortal";var jb="SelectContent",Bb=rn(((e,t)=>{const n=Rb(jb,e.__scopeSelect),[r,o]=Et();if(vf((()=>{o(new DocumentFragment)}),[]),!n.open){const t=r;return t?bn(ht(qb,{scope:e.__scopeSelect,children:ht(Tb.Slot,{scope:e.__scopeSelect,children:ht("div",{children:e.children})})}),t):null}return ht(Wb,i(i({},e),{},{ref:t}))}));Bb.displayName=jb;var Vb=10,[qb,Hb]=xb(jb),zb=zp("SelectContent.RemoveScroll"),Wb=rn(((e,t)=>{const{__scopeSelect:n,position:o="item-aligned",onCloseAutoFocus:a,onEscapeKeyDown:s,onPointerDownOutside:c,side:l,sideOffset:d,align:u,alignOffset:h,arrowPadding:p,collisionBoundary:m,collisionPadding:f,sticky:g,hideWhenDetached:v,avoidCollisions:b}=e,y=r(e,F),k=Rb(jb,n),[w,C]=Et(null),[T,S]=Et(null),_=Hp(t,(e=>C(e))),[x,E]=Et(null),[P,R]=Et(null),I=Sb(n),[O,D]=Et(!1),A=Ot(!1);Rt((()=>{if(w)return Lv(w)}),[w]),Rt((()=>{var e,t;const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",null!==(e=n[0])&&void 0!==e?e:af()),document.body.insertAdjacentElement("beforeend",null!==(t=n[1])&&void 0!==t?t:af()),of++,()=>{1===of&&document.querySelectorAll("[data-radix-focus-guard]").forEach((e=>e.remove())),of--}}),[]);const M=Mt((e=>{const[t,...n]=I().map((e=>e.ref.current)),[i]=n.slice(-1),r=document.activeElement;for(const n of e)if(n===r||(null==n||n.scrollIntoView({block:"nearest"}),n===t&&T&&(T.scrollTop=0),n===i&&T&&(T.scrollTop=T.scrollHeight),null==n||n.focus(),document.activeElement!==r))return}),[I,T]),N=Mt((()=>M([x,w])),[M,x,w]);Rt((()=>{O&&N()}),[O,N]);const{onOpenChange:L,triggerPointerDownPosRef:U}=k;Rt((()=>{if(w){let e={x:0,y:0};const t=t=>{var n,i,r,o;e={x:Math.abs(Math.round(t.pageX)-(null!==(n=null==(r=U.current)?void 0:r.x)&&void 0!==n?n:0)),y:Math.abs(Math.round(t.pageY)-(null!==(i=null==(o=U.current)?void 0:o.y)&&void 0!==i?i:0))}},n=n=>{e.x<=10&&e.y<=10?n.preventDefault():w.contains(n.target)||L(!1),document.removeEventListener("pointermove",t),U.current=null};return null!==U.current&&(document.addEventListener("pointermove",t),document.addEventListener("pointerup",n,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",t),document.removeEventListener("pointerup",n,{capture:!0})}}}),[w,L,U]),Rt((()=>{const e=()=>L(!1);return window.addEventListener("blur",e),window.addEventListener("resize",e),()=>{window.removeEventListener("blur",e),window.removeEventListener("resize",e)}}),[L]);const[j,B]=Cy((e=>{const t=I().filter((e=>!e.disabled)),n=t.find((e=>e.ref.current===document.activeElement)),i=Ty(t,e,n);i&&setTimeout((()=>i.ref.current.focus()))})),V=Mt(((e,t,n)=>{const i=!A.current&&!n;(void 0!==k.value&&k.value===t||i)&&(E(e),i&&(A.current=!0))}),[k.value]),q=Mt((()=>null==w?void 0:w.focus()),[w]),H=Mt(((e,t,n)=>{const i=!A.current&&!n;(void 0!==k.value&&k.value===t||i)&&R(e)}),[k.value]),z="popper"===o?Kb:Gb,W=z===Kb?{side:l,sideOffset:d,align:u,alignOffset:h,arrowPadding:p,collisionBoundary:m,collisionPadding:f,sticky:g,hideWhenDetached:v,avoidCollisions:b}:{};return ht(qb,{scope:n,content:w,viewport:T,onViewportChange:S,itemRefCallback:V,selectedItem:x,onItemLeave:q,itemTextRefCallback:H,focusSelectedItem:N,selectedItemText:P,position:o,isPositioned:O,searchRef:j,children:ht(yb,{as:zb,allowPinchZoom:!0,children:ht(df,{asChild:!0,trapped:k.open,onMountAutoFocus:e=>{e.preventDefault()},onUnmountAutoFocus:Wm(a,(e=>{var t;null==(t=k.trigger)||t.focus({preventScroll:!0}),e.preventDefault()})),children:ht(ef,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:s,onPointerDownOutside:c,onFocusOutside:e=>e.preventDefault(),onDismiss:()=>k.onOpenChange(!1),children:ht(z,i(i(i({role:"listbox",id:k.contentId,"data-state":k.open?"open":"closed",dir:k.dir,onContextMenu:e=>e.preventDefault()},y),W),{},{onPlaced:()=>D(!0),ref:_,style:i({display:"flex",flexDirection:"column",outline:"none"},y.style),onKeyDown:Wm(y.onKeyDown,(e=>{const t=e.ctrlKey||e.altKey||e.metaKey;if("Tab"===e.key&&e.preventDefault(),!t&&1===e.key.length&&B(e.key),["ArrowUp","ArrowDown","Home","End"].includes(e.key)){let t=I().filter((e=>!e.disabled)).map((e=>e.ref.current));if(["ArrowUp","End"].includes(e.key)&&(t=t.slice().reverse()),["ArrowUp","ArrowDown"].includes(e.key)){const n=e.target,i=t.indexOf(n);t=t.slice(i+1)}setTimeout((()=>M(t))),e.preventDefault()}}))}))})})})})}));Wb.displayName="SelectContentImpl";var Gb=rn(((e,t)=>{const{__scopeSelect:n,onPlaced:o}=e,a=r(e,j),s=Rb(jb,n),c=Hb(jb,n),[l,d]=Et(null),[u,h]=Et(null),p=Hp(t,(e=>h(e))),m=Sb(n),f=Ot(!1),g=Ot(!0),{viewport:v,selectedItem:b,selectedItemText:y,focusSelectedItem:k}=c,w=Mt((()=>{if(s.trigger&&s.valueNode&&l&&u&&v&&b&&y){const e=s.trigger.getBoundingClientRect(),t=u.getBoundingClientRect(),n=s.valueNode.getBoundingClientRect(),i=y.getBoundingClientRect();if("rtl"!==s.dir){const r=i.left-t.left,o=n.left-r,a=e.left-o,s=e.width+a,c=Math.max(s,t.width),d=window.innerWidth-Vb,u=zm(o,[Vb,Math.max(Vb,d-c)]);l.style.minWidth=s+"px",l.style.left=u+"px"}else{const r=t.right-i.right,o=window.innerWidth-n.right-r,a=window.innerWidth-e.right-o,s=e.width+a,c=Math.max(s,t.width),d=window.innerWidth-Vb,u=zm(o,[Vb,Math.max(Vb,d-c)]);l.style.minWidth=s+"px",l.style.right=u+"px"}const r=m(),a=window.innerHeight-2*Vb,c=v.scrollHeight,d=window.getComputedStyle(u),h=parseInt(d.borderTopWidth,10),p=parseInt(d.paddingTop,10),g=parseInt(d.borderBottomWidth,10),k=h+p+c+parseInt(d.paddingBottom,10)+g,w=Math.min(5*b.offsetHeight,k),C=window.getComputedStyle(v),T=parseInt(C.paddingTop,10),S=parseInt(C.paddingBottom,10),_=e.top+e.height/2-Vb,x=a-_,E=b.offsetHeight/2,P=h+p+(b.offsetTop+E),R=k-P;if(P<=_){const e=r.length>0&&b===r[r.length-1].ref.current;l.style.bottom="0px";const t=u.clientHeight-v.offsetTop-v.offsetHeight,n=P+Math.max(x,E+(e?S:0)+t+g);l.style.height=n+"px"}else{const e=r.length>0&&b===r[0].ref.current;l.style.top="0px";const t=Math.max(_,h+v.offsetTop+(e?T:0)+E)+R;l.style.height=t+"px",v.scrollTop=P-_+v.offsetTop}l.style.margin=`${Vb}px 0`,l.style.minHeight=w+"px",l.style.maxHeight=a+"px",null==o||o(),requestAnimationFrame((()=>f.current=!0))}}),[m,s.trigger,s.valueNode,l,u,v,b,y,s.dir,o]);vf((()=>w()),[w]);const[C,T]=Et();vf((()=>{u&&T(window.getComputedStyle(u).zIndex)}),[u]);const S=Mt((e=>{e&&!0===g.current&&(w(),null==k||k(),g.current=!1)}),[w,k]);return ht($b,{scope:n,contentWrapper:l,shouldExpandOnScrollRef:f,onScrollButtonChange:S,children:ht("div",{ref:d,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:C},children:ht(Jm.div,i(i({},a),{},{ref:p,style:i({boxSizing:"border-box",maxHeight:"100%"},a.style)}))})})}));Gb.displayName="SelectItemAlignedPosition";var Kb=rn(((e,t)=>{const{__scopeSelect:n,align:o="start",collisionPadding:a=Vb}=e,s=r(e,B),c=Eb(n);return ht(Sv,i(i(i({},c),s),{},{ref:t,align:o,collisionPadding:a,style:i(i({boxSizing:"border-box"},s.style),{},{"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"})}))}));Kb.displayName="SelectPopperPosition";var[$b,Jb]=xb(jb,{}),Yb="SelectViewport",Xb=rn(((e,t)=>{const{__scopeSelect:n,nonce:o}=e,a=r(e,V),s=Hb(Yb,n),c=Jb(Yb,n),l=Hp(t,s.onViewportChange),d=Ot(0);return ht(Re,{children:[ht("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),ht(Tb.Slot,{scope:n,children:ht(Jm.div,i(i({"data-radix-select-viewport":"",role:"presentation"},a),{},{ref:l,style:i({position:"relative",flex:1,overflow:"hidden auto"},a.style),onScroll:Wm(a.onScroll,(e=>{const t=e.currentTarget,{contentWrapper:n,shouldExpandOnScrollRef:i}=c;if(null!=i&&i.current&&n){const e=Math.abs(d.current-t.scrollTop);if(e>0){const i=window.innerHeight-2*Vb,r=parseFloat(n.style.minHeight),o=parseFloat(n.style.height),a=Math.max(r,o);if(a<i){const r=a+e,o=Math.min(i,r),s=r-o;n.style.height=o+"px","0px"===n.style.bottom&&(t.scrollTop=s>0?s:0,n.style.justifyContent="flex-end")}}}d.current=t.scrollTop}))}))})]})}));Xb.displayName=Yb;var Qb="SelectGroup",[Zb,ey]=xb(Qb),ty=rn(((e,t)=>{const{__scopeSelect:n}=e,o=r(e,q),a=kf();return ht(Zb,{scope:n,id:a,children:ht(Jm.div,i(i({role:"group","aria-labelledby":a},o),{},{ref:t}))})}));ty.displayName=Qb;var ny="SelectLabel",iy=rn(((e,t)=>{const{__scopeSelect:n}=e,o=r(e,H),a=ey(ny,n);return ht(Jm.div,i(i({id:a.id},o),{},{ref:t}))}));iy.displayName=ny;var ry="SelectItem",[oy,ay]=xb(ry),sy=rn(((e,t)=>{const{__scopeSelect:n,value:o,disabled:a=!1,textValue:s}=e,c=r(e,z),l=Rb(ry,n),d=Hb(ry,n),u=l.value===o,[h,p]=Et(null!=s?s:""),[m,f]=Et(!1),g=Hp(t,(e=>{var t;return null==(t=d.itemRefCallback)?void 0:t.call(d,e,o,a)})),v=kf(),b=Ot("touch"),y=()=>{a||(l.onValueChange(o),l.onOpenChange(!1))};if(""===o)throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return ht(oy,{scope:n,value:o,disabled:a,textId:v,isSelected:u,onItemTextChange:Mt((e=>{p((t=>{var n;return t||(null!==(n=null==e?void 0:e.textContent)&&void 0!==n?n:"").trim()}))}),[]),children:ht(Tb.ItemSlot,{scope:n,value:o,disabled:a,textValue:h,children:ht(Jm.div,i(i({role:"option","aria-labelledby":v,"data-highlighted":m?"":void 0,"aria-selected":u&&m,"data-state":u?"checked":"unchecked","aria-disabled":a||void 0,"data-disabled":a?"":void 0,tabIndex:a?void 0:-1},c),{},{ref:g,onFocus:Wm(c.onFocus,(()=>f(!0))),onBlur:Wm(c.onBlur,(()=>f(!1))),onClick:Wm(c.onClick,(()=>{"mouse"!==b.current&&y()})),onPointerUp:Wm(c.onPointerUp,(()=>{"mouse"===b.current&&y()})),onPointerDown:Wm(c.onPointerDown,(e=>{b.current=e.pointerType})),onPointerMove:Wm(c.onPointerMove,(e=>{var t;b.current=e.pointerType,a?null==(t=d.onItemLeave)||t.call(d):"mouse"===b.current&&e.currentTarget.focus({preventScroll:!0})})),onPointerLeave:Wm(c.onPointerLeave,(e=>{var t;e.currentTarget===document.activeElement&&(null==(t=d.onItemLeave)||t.call(d))})),onKeyDown:Wm(c.onKeyDown,(e=>{var t;""!==(null==(t=d.searchRef)?void 0:t.current)&&" "===e.key||(wb.includes(e.key)&&y()," "===e.key&&e.preventDefault())}))}))})})}));sy.displayName=ry;var cy="SelectItemText",ly=rn(((e,t)=>{const{__scopeSelect:n,className:o,style:a}=e,s=r(e,W),c=Rb(cy,n),l=Hb(cy,n),d=ay(cy,n),u=Ob(cy,n),[h,p]=Et(null),m=Hp(t,(e=>p(e)),d.onItemTextChange,(e=>{var t;return null==(t=l.itemTextRefCallback)?void 0:t.call(l,e,d.value,d.disabled)})),f=null==h?void 0:h.textContent,g=At((()=>ht("option",{value:d.value,disabled:d.disabled,children:f},d.value)),[d.disabled,d.value,f]),{onNativeOptionAdd:v,onNativeOptionRemove:b}=u;return vf((()=>(v(g),()=>b(g))),[v,b,g]),ht(Re,{children:[ht(Jm.span,i(i({id:d.textId},s),{},{ref:m})),d.isSelected&&c.valueNode&&!c.valueNodeHasChildren?bn(s.children,c.valueNode):null]})}));ly.displayName=cy;var dy="SelectItemIndicator",uy=rn(((e,t)=>{const{__scopeSelect:n}=e,o=r(e,G);return ay(dy,n).isSelected?ht(Jm.span,i(i({"aria-hidden":!0},o),{},{ref:t})):null}));uy.displayName=dy;var hy="SelectScrollUpButton",py=rn(((e,t)=>{const n=Hb(hy,e.__scopeSelect),r=Jb(hy,e.__scopeSelect),[o,a]=Et(!1),s=Hp(t,r.onScrollButtonChange);return vf((()=>{if(n.viewport&&n.isPositioned){let e=function(){const e=t.scrollTop>0;a(e)};const t=n.viewport;return e(),t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)}}),[n.viewport,n.isPositioned]),o?ht(gy,i(i({},e),{},{ref:s,onAutoScroll:()=>{const{viewport:e,selectedItem:t}=n;e&&t&&(e.scrollTop=e.scrollTop-t.offsetHeight)}})):null}));py.displayName=hy;var my="SelectScrollDownButton",fy=rn(((e,t)=>{const n=Hb(my,e.__scopeSelect),r=Jb(my,e.__scopeSelect),[o,a]=Et(!1),s=Hp(t,r.onScrollButtonChange);return vf((()=>{if(n.viewport&&n.isPositioned){let e=function(){const e=t.scrollHeight-t.clientHeight,n=Math.ceil(t.scrollTop)<e;a(n)};const t=n.viewport;return e(),t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)}}),[n.viewport,n.isPositioned]),o?ht(gy,i(i({},e),{},{ref:s,onAutoScroll:()=>{const{viewport:e,selectedItem:t}=n;e&&t&&(e.scrollTop=e.scrollTop+t.offsetHeight)}})):null}));fy.displayName=my;var gy=rn(((e,t)=>{const{__scopeSelect:n,onAutoScroll:o}=e,a=r(e,K),s=Hb("SelectScrollButton",n),c=Ot(null),l=Sb(n),d=Mt((()=>{null!==c.current&&(window.clearInterval(c.current),c.current=null)}),[]);return Rt((()=>()=>d()),[d]),vf((()=>{var e;const t=l().find((e=>e.ref.current===document.activeElement));null==(e=null==t?void 0:t.ref.current)||e.scrollIntoView({block:"nearest"})}),[l]),ht(Jm.div,i(i({"aria-hidden":!0},a),{},{ref:t,style:i({flexShrink:0},a.style),onPointerDown:Wm(a.onPointerDown,(()=>{null===c.current&&(c.current=window.setInterval(o,50))})),onPointerMove:Wm(a.onPointerMove,(()=>{var e;null==(e=s.onItemLeave)||e.call(s),null===c.current&&(c.current=window.setInterval(o,50))})),onPointerLeave:Wm(a.onPointerLeave,(()=>{d()}))}))})),vy=rn(((e,t)=>{const{__scopeSelect:n}=e,o=r(e,$);return ht(Jm.div,i(i({"aria-hidden":!0},o),{},{ref:t}))}));vy.displayName="SelectSeparator";var by="SelectArrow",yy=rn(((e,t)=>{const{__scopeSelect:n}=e,o=r(e,J),a=Eb(n),s=Rb(by,n),c=Hb(by,n);return s.open&&"popper"===c.position?ht(_v,i(i(i({},a),o),{},{ref:t})):null}));yy.displayName=by;var ky=rn(((e,t)=>{let{__scopeSelect:n,value:o}=e,a=r(e,Y);const s=Ot(null),c=Hp(t,s),l=function(e){const t=Ot({value:e,previous:e});return At((()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous)),[e])}(o);return Rt((()=>{const e=s.current;if(!e)return;const t=window.HTMLSelectElement.prototype,n=Object.getOwnPropertyDescriptor(t,"value").set;if(l!==o&&n){const t=new Event("change",{bubbles:!0});n.call(e,o),e.dispatchEvent(t)}}),[l,o]),ht(Jm.select,i(i({},a),{},{style:i(i({},Rv),a.style),ref:c,defaultValue:o}))}));function wy(e){return""===e||void 0===e}function Cy(e){const t=Ym(e),n=Ot(""),i=Ot(0),r=Mt((e=>{const r=n.current+e;t(r),function e(t){n.current=t,window.clearTimeout(i.current),""!==t&&(i.current=window.setTimeout((()=>e("")),1e3))}(r)}),[t]),o=Mt((()=>{n.current="",window.clearTimeout(i.current)}),[]);return Rt((()=>()=>window.clearTimeout(i.current)),[]),[n,r,o]}function Ty(e,t,n){const i=t.length>1&&Array.from(t).every((e=>e===t[0]))?t[0]:t,r=n?e.indexOf(n):-1;let o=function(e,t){return e.map(((n,i)=>e[(t+i)%e.length]))}(e,Math.max(r,0));1===i.length&&(o=o.filter((e=>e!==n)));const a=o.find((e=>e.textValue.toLowerCase().startsWith(i.toLowerCase())));return a!==n?a:void 0}ky.displayName="SelectBubbleInput";var Sy=Db,_y=Mb,xy=Ub,Ey=Fb,Py=Bb,Ry=Xb,Iy=sy,Oy=ly,Dy=uy,Ay=py,My=fy;const Ny={sm:"w-4 h-4",md:"w-6 h-6"};function Ly(e){let{size:t="md",flagCode:n,className:o}=e,a=r(e,X);return ht("img",i({className:Np("rounded-full object-cover",Ny[t],o),src:`https://storage.googleapis.com/eleven-public-cdn/images/flags/circle-flags/${n}.svg`,alt:`${n.toUpperCase()} flag`},a))}function Uy(e){let{children:t}=e,n=r(e,Q);const[o,a]=Et(!1),{language:s,setLanguage:c,options:l}=tr(),d=Fp();return ht(Sy,{open:o,value:s.value.languageCode,onValueChange:e=>{c(e),a(!1)},onOpenChange:e=>{e&&a(!0)},children:[t,ht(Ey,{container:d,children:ht(Py,i(i({className:"overflow-hidden bg-base border border-base-border rounded-dropdown-sheet max-h-[min(384px,var(--radix-select-content-available-height))] min-w-[var(--radix-select-trigger-width)] z-10",position:"popper",sideOffset:8,align:"end",side:"top",onPointerDownOutside:()=>a(!1),onCloseAutoFocus:()=>a(!1),onEscapeKeyDown:()=>a(!1)},n),{},{children:[ht(Ay,{className:"flex items-center justify-center h-6 bg-base text-base-subtle cursor-default",children:ht(lm,{size:"sm",name:"chevron-up"})}),ht(Ry,{className:"p-1.5",children:l.value.map((e=>ht(Iy,{value:e.languageCode,className:"flex select-none items-center p-1.5 pr-3 gap-2 cursor-pointer rounded-input relative focus-visible:outline-none data-[highlighted]:bg-base-active text-sm",children:[ht(Ly,{flagCode:e.flagCode}),ht(Oy,{children:e.name}),ht(Dy,{className:"text-base-primary p-1.5 -mr-1.5 ml-auto",children:ht(lm,{size:"sm",name:"check"})})]},e.languageCode)))}),ht(My,{className:"flex items-center justify-center h-6 bg-base text-base-subtle cursor-default",children:ht(lm,{size:"sm",name:"chevron-down"})})]}))})]})}function Fy(e){let{className:t}=e,n=r(e,Z);const o=Ip(),{language:a,showPicker:s}=tr();return s.value?ht(Uy,{align:"center",children:ht(_y,i(i({className:Np("h-9 min-w-max rounded-button focus-ring px-2 flex gap-2 items-center text-base-primary bg-base hover:bg-base-hover active:bg-base-active font-medium",t),"aria-label":o.change_language},n),{},{children:[ht(Ly,{size:"sm",flagCode:a.value.flagCode}),a.value.name,ht(xy,{className:"text-base-subtle",asChild:!0,children:ht(lm,{size:"sm",name:"chevron-down"})})]}))}):null}function jy({showBackButton:e,onBackClick:t,showStatusLabel:n,showShadow:i,showLanguageSelector:r}){const o=Ip();return ht("div",{className:Np("bg-base shrink-0 relative",i&&"shadow-header"),children:[ht("div",{className:"flex gap-2 p-4 items-start",children:[e?ht(fm,{variant:"ghost",onClick:t,"aria-label":o.go_back,className:"!h-8 !w-8",children:ht(lm,{name:"chevron-up",className:"-rotate-90",size:"sm"})}):ht("div",{className:"relative w-8 h-8"}),ht(Qp,{active:n,children:ht(gm,{className:"transition-opacity data-hidden:opacity-0"})})]}),ht(Qp,{active:r,children:ht("div",{className:"absolute top-0 left-0 right-0 p-4 flex justify-center transition-[opacity,transform] duration-200 data-hidden:opacity-0 data-hidden:-translate-y-4",children:ht(Fy,{})})})]})}const By={"top-left":"origin-top-left",top:"origin-top","top-right":"origin-top-right","bottom-left":"origin-bottom-left","bottom-right":"origin-bottom-right",bottom:"origin-bottom"};function Vy({open:e}){const t=Ip(),n=Sp(),i=_p(),r=Tp(),o=r.value.placement,{isDisconnected:a,startSession:s,transcript:c,conversationIndex:l}=kp(),d=xp(),{currentContent:u,currentConfig:h}=Cm(),p=Pi((()=>{var e,t;return n.value||i.value?d.value&&n.value?[{type:"message",role:"ai",message:d.value,isText:!0,conversationIndex:null!==(e=null==(t=c.value[0])?void 0:t.conversationIndex)&&void 0!==e?e:l.peek()},...c.value]:c.value:r.value.transcript_enabled?c.value:c.value.filter((e=>"message"!==e.type||e.isText))})),m=p.value.length>0||!a.value&&r.value.transcript_enabled,f=Ei(!0),g="feedback"!==u.value;return ht(Qp,{initial:!1,active:e,children:ht("div",{className:Np("elevenlabs-widget-sheet","flex flex-col overflow-hidden absolute bg-base shadow-lg pointer-events-auto rounded-sheet w-full max-w-[400px] h-[calc(100%-80px)] max-h-[550px]","transition-[transform,opacity] duration-200 data-hidden:scale-90 data-hidden:opacity-0",By[o],o.startsWith("top")?r.value.always_expanded?"top-0":"top-20":r.value.always_expanded?"bottom-0":"bottom-20"),children:[ht(jy,{showBackButton:h.showHeaderBack,onBackClick:h.onHeaderBack,showStatusLabel:m&&!a.value,showShadow:m,showLanguageSelector:"feedback"!==u.value&&(!m||a.value)}),ht(Qp,{active:"transcript"===u.value,children:ht("div",{className:"grow flex flex-col min-h-0 transition-opacity duration-300 ease-out data-hidden:opacity-0",children:[ht(Nm,{transcript:p,scrollPinned:f}),ht(Vm,{scrollPinned:f,showTranscript:m})]})}),ht(Qp,{active:"feedback"===u.value,children:ht("div",{className:"absolute inset-0 top-[88px] flex flex-col bg-base transition-transform duration-300 ease-out data-hidden:translate-x-full",children:[ht(qm,{}),ht(Hm,{})]})}),ht(Qp,{active:g,children:ht("div",{className:Np("absolute origin-top-left transition-[transform,left,top,opacity,scale] duration-200 z-1","data-hidden:opacity-0",m?"top-4 left-4 scale-[0.1667]":"top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 scale-100"),children:[ht(om,{size:"lg"}),ht(Qp,{active:!m&&a.value&&!n.value,children:ht("div",{className:"absolute bottom-0 p-1 rounded-[calc(var(--el-button-radius)+4px)] bg-base left-1/2 -translate-x-1/2 translate-y-1/2 transition-[opacity,transform] data-hidden:opacity-0 data-hidden:scale-100 scale-150",children:ht(fm,{"aria-label":t.start_call,variant:"primary",icon:"phone",onClick:e=>s(e.currentTarget)})})}),ht(Qp,{active:!m&&!a.value,children:ht("div",{className:"absolute -bottom-3 left-1/2 -translate-x-1/2 translate-y-full transition-[opacity,transform] data-hidden:opacity-0 data-hidden:scale-75",children:ht(gm,{})})})]})})]})})}function qy({expanded:e}){const t=_p(),n=Tp().value.variant,{isDisconnected:i}=kp(),r=Ip(),o=Fp(),a=Mt((()=>{const t=!e.value;e.value=t,Fm(o,{expanded:t})}),[e,o]);return ht(Re,{children:["full"===n&&ht(um,{visible:!e.value&&!i.value,className:"p-1",children:ht(om,{})}),ht(um,{grow:"tiny"!==n,visible:!t.value&&!e.value&&!i.value,className:"p-1",children:ht(Bm,{iconOnly:!0,isDisconnected:!1})}),ht(jm,{visible:!t.value&&!e.value&&!i.value}),ht(um,{grow:i.value,visible:!0,className:"p-1",children:ht(fm,{className:"w-full",variant:"primary",iconClassName:Np((e.value||!i.value)&&"transition-transform duration-200",e.value&&"-rotate-180"),icon:e.value?"chevron-up":i.value?t.value?"chat":"phone":"chevron-up","aria-label":e.value?r.collapse:i.value?t.value?r.start_chat:r.start_call:r.expand,onClick:e.value||i.value?void 0:a,children:!e.value&&i.value&&"tiny"!==n?t.value?r.start_chat:r.start_call:void 0})})]})}function Hy(e){let{expanded:t,className:n}=e,o=r(e,ee);const{isDisconnected:a}=kp(),s=Ip();return ht("div",i(i({className:Np("transition-[border-radius] flex flex-col p-2",!t.value&&a.value?"rounded-sheet":"rounded-compact-sheet",n)},o),{},{children:[ht(um,{visible:!t.value&&a.value,className:"p-1 !min-w-60",children:ht("div",{className:"flex items-center gap-2",children:[ht(om,{}),ht("div",{className:"text-sm max-w-64",children:s.main_label})]})}),ht("div",{className:"flex items-center",children:ht(qy,{expanded:t})})]}))}function zy(e){let{expanded:t,className:n}=e,o=r(e,te);return ht("div",i(i({className:Np("rounded-compact-sheet flex items-center p-2",n)},o),{},{children:[ht(um,{visible:!t.value,className:"p-1",children:ht(om,{})}),ht(qy,{expanded:t})]}))}function Wy(e){let{visible:t,className:n}=e,o=r(e,ne);const a=Ip(),{language:s,showPicker:c}=tr();return c.value?ht(um,{visible:t,className:"p-1",children:ht(Uy,{children:ht(_y,i(i({className:Np("h-9 min-w-max border border-base-border rounded-button focus-ring px-1.5 flex gap-1 items-center transition-colors duration-200 hover:bg-base-hover active:bg-base-active",n),"aria-label":a.change_language},o),{},{children:[ht(Ly,{flagCode:s.value.flagCode}),ht(xy,{className:"px-1 text-base-subtle",asChild:!0,children:ht(lm,{size:"sm",name:"chevron-down"})})]}))})}):null}function Gy(){const e=Tp().value.variant,{isDisconnected:t,status:n}=kp();return ht(Re,{children:[ht(Bm,{isDisconnected:t.value,iconOnly:"tiny"===e,className:"w-full m-1 z-1",disabled:"disconnecting"===n.value||"connecting"===n.value}),ht(Wy,{visible:t.value}),ht(jm,{visible:!t.value})]})}function Ky(e){let{className:t}=e,n=r(e,ie);const{isDisconnected:o}=kp(),a=Ip();return ht("div",i(i({className:Np("flex flex-col p-2 rounded-sheet",t)},n),{},{children:[ht("div",{className:"flex items-center p-1 gap-2 min-w-60",children:[ht(om,{}),ht("div",{className:"relative text-sm max-w-64",children:[ht("span",{className:Np("block transition-[transform,opacity] duration-200",!o.value&&"opacity-0 scale-90"),children:a.main_label}),ht(Qp,{active:!o.value,children:ht(gm,{className:"absolute top-1/2 -translate-y-1/2 transition-[transform,opacity] duration-200 data-hidden:opacity-0 data-hidden:scale-90"})})]})]}),ht("div",{className:"flex items-center",children:ht(Gy,{})})]}))}function $y(e){let{className:t}=e,n=r(e,re);return ht("div",i(i({className:Np("rounded-compact-sheet flex items-center p-2",t)},n),{},{children:[ht(om,{className:"mx-1"}),ht(Gy,{})]}))}function Jy({expandable:e,expanded:t}){const n=Tp().value.variant,i=gp(),{isDisconnected:r}=kp(),o=Fp(),a=Mt((async()=>{await i.requestTerms();const e=!t.peek();t.value=e,Fm(o,{expanded:e})}),[t]),s="full"===n;return e?ht(s?Hy:zy,{expanded:t,className:Np("bg-base shadow-md pointer-events-auto overflow-hidden",(r.value||t.value)&&"cursor-pointer"),onClick:r.value||t.value?a:void 0}):ht(s?Ky:$y,{className:"bg-base shadow-md pointer-events-auto overflow-hidden"})}function Yy(){var e;const t=Ip(),n=Tp(),{dismissTerms:i,acceptTerms:r}=gp();return ht("div",{className:"max-w-[400px] flex flex-col gap-2 bg-base shadow-md pointer-events-auto rounded-sheet p-3 text-sm",children:[ht("div",{className:"flex flex-col gap-1 terms p-2 pt-1",dangerouslySetInnerHTML:{__html:null!==(e=n.value.terms_html)&&void 0!==e?e:""}}),ht("div",{className:"flex justify-end gap-2",children:[ht(fm,{onClick:i,children:t.dismiss_terms}),ht(fm,{onClick:r,variant:"primary",children:t.accept_terms})]})]})}function Xy({copyText:e,children:t}){const n=Ip(),[i,r]=Et(!1);Rt((()=>{if(i){const e=setTimeout((()=>{r(!1)}),2e3);return()=>{clearTimeout(e)}}}),[i]);const o=Mt((()=>{const t=Bp(e);t&&(navigator.clipboard.writeText(t),r(!0))}),[]);return ht(fm,{onClick:o,children:i?n.copied:t})}function Qy({sawError:e}){const t=Ip(),{error:n,lastId:i}=kp(),r=Mt((()=>{e.value=!0}),[]);return ht("div",{className:"max-w-[400px] flex flex-col gap-2 bg-base shadow-md pointer-events-auto rounded-sheet p-3 text-sm",children:[ht("div",{className:"p-2 pt-1",children:[ht("h1",{className:"text-md font-medium pb-1",children:t.error_occurred}),n.value,i.value&&ht(Re,{children:[ht("br",{}),ht("span",{className:"text-base-subtle",children:[t.conversation_id,": ",i.value]})]})]}),ht("div",{className:"flex justify-end gap-2",children:[ht(Xy,{copyText:i,children:t.copy_id}),ht(fm,{variant:"primary",onClick:r,children:"Close"})]})]})}function Zy(){const e=Tp();return e.value.disable_banner?null:ht("p",{className:Np("whitespace-nowrap [line-height:var(--el-overlay-padding)] text-[10px] px-3",e.value.placement.startsWith("top")?"-translate-y-[calc(var(--el-overlay-padding))]":"translate-y-[calc(var(--el-overlay-padding))]"),children:[ht("span",{className:"opacity-30",children:"Powered by ElevenLabs"})," ",ht("a",{href:e.value.override_link||"https://elevenlabs.io/conversational-ai",className:"underline cursor-pointer pointer-events-auto focus-visible:outline-none opacity-30 hover:opacity-50 focus-visible:opacity-100 focus-visible:underline-offset-2",target:"_blank",children:"Agents"})]})}function ek(e){const t=Ot(null),n=Tp(),{isDisconnected:r,startSession:o}=kp(),a=vp((()=>{t.current&&o(t.current,{resume:n.value.auto_resume})})),s=vp((()=>{n.value.auto_resume&&r.value&&a()}));return Rt((()=>{s()}),[s]),ht("div",i({ref:t},e))}const tk="items-start",nk="items-center",ik="items-end",rk="flex-col-reverse justify-end",ok="flex-col justify-end",ak={"top-left":`${rk} ${tk}`,top:`${rk} ${nk}`,"top-right":`${rk} ${ik}`,"bottom-left":`${ok} ${tk}`,bottom:`${ok} ${nk}`,"bottom-right":`${ok} ${ik}`},sk={display:"none"},ck=en((function(){const e=Tp(),t=Ei(e.peek().default_expanded),n=Ei(!1),{error:i,subscribeOnSetExpanded:r}=kp(),o=gp(),a=Pi((()=>e.value.transcript_enabled||e.value.text_input_enabled)),s=Pi((()=>Np("overlay !flex transition-opacity duration-200 data-hidden:opacity-0",ak[e.value.placement])));(function(e,t){Rt((()=>e(t)),[e])})(r,(e=>t.value=e)),Ni((()=>{i.value&&(a.value?(n.value=!0,t.value=!0):n.value=!1)})),Ni((()=>{const e=e=>{var n,i,r;"expand"===(null==(n=e.detail)?void 0:n.action)?t.value=!0:"collapse"===(null==(i=e.detail)?void 0:i.action)?t.value=!1:"toggle"===(null==(r=e.detail)?void 0:r.action)&&(t.value=!t.value)};return document.addEventListener("elevenlabs-agent:expand",e),()=>{document.removeEventListener("elevenlabs-agent:expand",e)}}));const c=Pi((()=>a.value||!i.value||n.value?!o.termsAccepted.value&&o.termsShown.value?"terms":"conversation":"error")),l=Pi((()=>"error"===c.value)),d=Pi((()=>"terms"===c.value));return ht(ek,{children:[ht(Qp,{initial:!1,active:Pi((()=>"conversation"===c.value)),children:ht(Up,{className:s,style:sk,children:e.value.always_expanded?ht(Vy,{open:!0}):ht(Re,{children:[a.value&&ht(Vy,{open:t}),ht(Jy,{expandable:a.value,expanded:t})]})})}),ht(Qp,{initial:!1,active:d,children:ht(Up,{className:s,style:sk,children:ht(Yy,{})})}),ht(Qp,{initial:!1,active:l,children:ht(Up,{className:s,style:sk,children:ht(Qy,{sawError:n})})}),ht(Up,{className:s,style:sk,children:ht(Zy,{})})]})}));function lk(e){return ht(Gi,{value:e,children:ht(Ji,{children:ht(Cp,{children:ht(fp,{children:ht(er,{children:ht(dp,{children:ht(pp,{children:ht(yp,{children:ht(Rp,{children:ht(Dp,{children:ht(wm,{children:ht(bm,{children:[ht(Ep,{}),ht(ck,{})]})})})})})})})})})})})})}const dk=o("cbio.VirtualAgent.ElevenLabs"),uk=o("cbio.VirtualAgent.ElevenLabs.widget"),hk="elevenlabs-convai",pk="_cobrowse_elevenlabs_transcript",mk="_cobrowse_elevenlabs_config",fk=function(){const e={onScrollCompleteHandlers:[],scrollHandle:void 0};function t(t){clearTimeout(e.scrollHandle),e.scrollHandle=void 0;try{e.onScrollCompleteHandlers.forEach((e=>e()))}finally{e.onScrollCompleteHandlers.length=0}}function n(n){clearTimeout(e.scrollHandle),e.scrollHandle=setTimeout(t,250)}function i(e){t()}return window.addEventListener("scroll",n,!0),window.addEventListener("scrollend",i,!0),{onceNotScrolling:async()=>new Promise((t=>{setTimeout((()=>{e.scrollHandle?e.onScrollCompleteHandlers.push(t):t()}),100)})),destroy(){window.removeEventListener("scrollend",i,!0),window.removeEventListener("scroll",n,!0),clearTimeout(e.scrollHandle)}}}();async function gk(e,t){const n=function(e,t){const{dynamicVariables:n,url:r}=e.data(),o=yk(t),a=document.createElement(hk);let s;return a.style.zIndex="2147483647",a.setAttribute("class","__cbio_virtual_agent_ignored"),a.setAttribute("signed-url",r),t.customData.user_id&&a.setAttribute("user-id",t.customData.user_id),vk(a,n,t),a.addEventListener("elevenlabs-convai:call",(e=>{var i;uk("event(elevenlabs-convai:call)",e.detail),s=e.detail,e.detail.config.onMessage=({source:e,message:n})=>bk(e,n,t),e.detail.config.onSendUserMessage=e=>bk("user",e,t),e.detail.config.onDisconnect=e=>function(e,t,n,i){if(dk("disconnect: %O",e),"user"===e.reason||"agent"===e.reason){var r;const e=yk(i);e.removeItem(pk),e.removeItem(mk),vk(t,n,i),null===(r=i.currentSession)||void 0===r||r.end()}}(e,a,n,t),o.setItem(mk,{expanded:null===(i=o.getItem(mk))||void 0===i?void 0:i.expanded,micMuted:e.detail.micMuted,textOnly:e.detail.config.textOnly})})),a.addEventListener("elevenlabs-convai:setMicMuted",(e=>{uk("event(elevenlabs-convai:setMicMuted)",e.detail),o.setItem(mk,i(i({},o.getItem(mk)),{},{micMuted:e.detail.micMuted}))})),a.addEventListener("elevenlabs-convai:setExpanded",(e=>{uk("event(elevenlabs-convai:setExpanded)",e.detail),o.setItem(mk,i(i({},o.getItem(mk)),{},{expanded:e.detail.expanded}))})),t.on("highlight.updated",(async({target:e,visible:t})=>{if(dk("CobrowseIO(highlight.updated)",{target:e,visible:t}),s)if(t){const t=a.shadowRoot.querySelector(".elevenlabs-widget-sheet");if(dk("-> locating transcript",t),!t)return;await fk.onceNotScrolling();const n=t.getBoundingClientRect(),i=e.getBoundingClientRect();if(dk("-> checking collision",{target:i,transcript:n}),!kk(n,i))return;dk("-> collapsing widget"),s.setExpanded(!1)}else{var n,i,r;dk("-> set expanded",null===(n=o.getItem(mk))||void 0===n?void 0:n.expanded),s.setExpanded(null===(i=null===(r=o.getItem(mk))||void 0===r?void 0:r.expanded)||void 0===i||i)}})),a}(e,t);document.body.append(n),function(e="elevenlabs-convai"){!function(e,t,n,i){function r(){var t=Reflect.construct(HTMLElement,[],r);return t._vdomComponent=e,t._root=i&&i.shadow?t.attachShadow({mode:i.mode||"open"}):t,t}(r.prototype=Object.create(HTMLElement.prototype)).constructor=r,r.prototype.connectedCallback=nt,r.prototype.attributeChangedCallback=rt,r.prototype.disconnectedCallback=ot,n=n||e.observedAttributes||Object.keys(e.propTypes||{}),r.observedAttributes=n,n.forEach((function(e){Object.defineProperty(r.prototype,e,{get:function(){return this._vdom.props[e]},set:function(t){this._vdom?this.attributeChangedCallback(e,null,t):(this._props||(this._props={}),this._props[e]=t,this.connectedCallback());var n=typeof t;null!=t&&"string"!==n&&"boolean"!==n&&"number"!==n||this.setAttribute(e,t)}})})),customElements.define(t||e.tagName||e.displayName||e.name,r)}(lk,e,[...dt],{shadow:!0,mode:"open"})}(hk)}function vk(e,t,n){var r,o;const a=n.deviceId(),s=null===(r=n.currentSession)||void 0===r?void 0:r.id(),c=yk(n);t=i(i({cobrowse_device_id:`Cobrowse device ID: ${a}`},t),{},{cobrowse_session_id:s?`Cobrowse session ID: ${s}`:"",url:document.location.toString()});const l=null!==(o=c.getItem(pk))&&void 0!==o?o:[],d=JSON.stringify(l);if(l.length){var u,h;dk("resuming with transcript",l);const n=null!==(u=c.getItem(mk))&&void 0!==u?u:{};e.setAttribute("default-expanded",String(null===(h=n.expanded)||void 0===h||h)),e.setAttribute("override-first-message",""),e.setAttribute("auto-resume",JSON.stringify(n)),t.history=`\n      You are resuming a conversation that has been taking place, and the user performed an action\n      that caused the page to reload. Here is the history of the conversation:\n      ${d}\n    `}else e.removeAttribute("default-expanded"),e.removeAttribute("override-first-message"),e.removeAttribute("auto-resume");e.setAttribute("dynamic-variables",JSON.stringify(t)),e.setAttribute("transcript-entries",d)}function bk(e,t,n){var i;dk("%s: %s",e,t);const r=yk(n),o=null!==(i=r.getItem(pk))&&void 0!==i?i:[];r.setItem(pk,[...o,{type:"message",role:"user"===e?"user":"ai",message:t,isText:!0,conversationIndex:o.length}])}function yk(e){return a(e.license)}function kk(e,t){const n=e.left,i=e.top,r=e.right,o=e.bottom,a=t.left,s=t.top,c=t.right,l=t.bottom;return!(r<=a||c<=n||o<=s||l<=i)}export{gk as loadElevenLabsWidget,kk as overlaps};